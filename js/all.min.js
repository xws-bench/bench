var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(b,a,c){if(c.get||c.set)throw new TypeError("ES3 does not support getters and setters.");b!=Array.prototype&&b!=Object.prototype&&(b[a]=c.value)};$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(b){return $jscomp.SYMBOL_PREFIX+(b||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.iterator;b||(b=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[b]&&$jscomp.defineProperty(Array.prototype,b,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(b){var a=0;return $jscomp.iteratorPrototype(function(){return a<b.length?{done:!1,value:b[a++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(b){$jscomp.initSymbolIterator();b={next:b};b[$jscomp.global.Symbol.iterator]=function(){return this};return b};$jscomp.array=$jscomp.array||{};$jscomp.iteratorFromArray=function(b,a){$jscomp.initSymbolIterator();b instanceof String&&(b+="");var c=0,e={next:function(){if(c<b.length){var f=c++;return{value:a(f,b[f]),done:!1}}e.next=function(){return{done:!0,value:void 0}};return e.next()}};e[Symbol.iterator]=function(){return e};return e};
$jscomp.polyfill=function(b,a,c,e){if(a){c=$jscomp.global;b=b.split(".");for(e=0;e<b.length-1;e++){var f=b[e];f in c||(c[f]={});c=c[f]}b=b[b.length-1];e=c[b];a=a(e);a!=e&&null!=a&&$jscomp.defineProperty(c,b,{configurable:!0,writable:!0,value:a})}};$jscomp.polyfill("Array.prototype.keys",function(b){return b?b:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6-impl","es3");
$jscomp.findInternal=function(b,a,c){b instanceof String&&(b=String(b));for(var e=b.length,f=0;f<e;f++){var h=b[f];if(a.call(c,h,f,b))return{i:f,v:h}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(b){return b?b:function(a,b){return $jscomp.findInternal(this,a,b).v}},"es6-impl","es3");$jscomp.owns=function(b,a){return Object.prototype.hasOwnProperty.call(b,a)};
$jscomp.polyfill("Object.assign",function(b){return b?b:function(a,b){for(var c=1;c<arguments.length;c++){var f=arguments[c];if(f)for(var h in f)$jscomp.owns(f,h)&&(a[h]=f[h])}return a}},"es6-impl","es3");$jscomp.checkStringArgs=function(b,a,c){if(null==b)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(a instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return b+""};
$jscomp.polyfill("String.prototype.repeat",function(b){return b?b:function(a){var b=$jscomp.checkStringArgs(this,null,"repeat");if(0>a||1342177279<a)throw new RangeError("Invalid count value");a|=0;for(var e="";a;)if(a&1&&(e+=b),a>>>=1)b+=b;return e}},"es6-impl","es3");var gapi=window.gapi=window.gapi||{};gapi._bs=(new Date).getTime();
(function(){var b=window,a=document,c=b.location,e=function(){},f=/\[native code\]/,h=function(a,b,c){return a[b]=a[b]||c},l=function(a){for(var b=0;b<this.length;b++)if(this[b]===a)return b;return-1},t=function(a){a=a.sort();for(var b=[],c=void 0,e=0;e<a.length;e++){var f=a[e];f!=c&&b.push(f);c=f}return b},x=function(){var a;if((a=Object.create)&&f.test(a))a=a(null);else{a={};for(var b in a)a[b]=void 0}return a},q=h(b,"gapi",{}),m;m=h(b,"___jsl",x());h(m,"I",0);h(m,"hel",10);var r=function(){var a=
c.href,b;if(m.dpo)b=m.h;else{b=m.h;var e=RegExp("([#].*&|[#])jsh=([^&#]*)","g"),f=RegExp("([?#].*&|[?#])jsh=([^&#]*)","g");if(a=a&&(e.exec(a)||f.exec(a)))try{b=decodeURIComponent(a[2])}catch(V){}}return b},y=function(a){var b=h(m,"PQ",[]);m.PQ=[];var c=b.length;if(0===c)a();else for(var e=0,f=function(){++e===c&&a()},q=0;q<c;q++)b[q](f)},B=function(a){return h(h(m,"H",x()),a,x())},z=h(m,"perf",x()),E=h(z,"g",x()),G=h(z,"i",x());h(z,"r",[]);x();x();var I=function(a,b,c){var e=z.r;"function"===typeof e?
e(a,b,c):e.push([a,b,c])},F=function(a,b,c){b&&0<b.length&&(b=D(b),c&&0<c.length&&(b+="___"+D(c)),28<b.length&&(b=b.substr(0,28)+(b.length-28)),c=b,b=h(G,"_p",x()),h(b,c,x())[a]=(new Date).getTime(),I(a,"_p",c))},D=function(a){return a.join("__").replace(/\./g,"_").replace(/\-/g,"_").replace(/\,/g,"_")},H=x(),M=[],N=function(a){throw Error("Bad hint"+(a?": "+a:""));};M.push(["jsl",function(a){for(var b in a)if(Object.prototype.hasOwnProperty.call(a,b)){var c=a[b];"object"==typeof c?m[b]=h(m,b,[]).concat(c):
h(m,b,c)}if(b=a.u)a=h(m,"us",[]),a.push(b),(b=/^https:(.*)$/.exec(b))&&a.push("http:"+b[1])}]);var L=/^(\/[a-zA-Z0-9_\-]+)+$/,O=/^[a-zA-Z0-9\-_\.,!]+$/,S=/^gapi\.loaded_[0-9]+$/,ka=/^[a-zA-Z0-9,._-]+$/,sa=function(a,b,c,e){var f=a.split(";"),h=f.shift(),m=H[h],q=null;m?q=m(f,b,c,e):N("no hint processor for: "+h);q||N("failed to generate load url");b=q;c=b.match(J);(e=b.match(ea))&&1===e.length&&ba.test(b)&&c&&1===c.length||N("failed sanity: "+a);return q},W=function(a,b,c,e){a=ma(a);S.test(c)||N("invalid_callback");
b=pa(b);e=e&&e.length?pa(e):null;var f=function(a){return encodeURIComponent(a).replace(/%2C/g,",")};return[encodeURIComponent(a.g).replace(/%2C/g,",").replace(/%2F/g,"/"),"/k=",f(a.version),"/m=",f(b),e?"/exm="+f(e):"","/rt=j/sv=1/d=1/ed=1",a.a?"/am="+f(a.a):"",a.c?"/rs="+f(a.c):"",a.f?"/t="+f(a.f):"","/cb=",f(c)].join("")},ma=function(a){"/"!==a.charAt(0)&&N("relative path");for(var b=a.substring(1).split("/"),c=[];b.length;){a=b.shift();if(!a.length||0==a.indexOf("."))N("empty/relative directory");
else if(0<a.indexOf("=")){b.unshift(a);break}c.push(a)}a={};for(var e=0,f=b.length;e<f;++e){var h=b[e].split("="),m=decodeURIComponent(h[0]),q=decodeURIComponent(h[1]);2==h.length&&m&&q&&(a[m]=a[m]||q)}b="/"+c.join("/");L.test(b)||N("invalid_prefix");c=fa(a,"k",!0);e=fa(a,"am");f=fa(a,"rs");a=fa(a,"t");return{g:b,version:c,a:e,c:f,f:a}},pa=function(a){for(var b=[],c=0,e=a.length;c<e;++c){var f=a[c].replace(/\./g,"_").replace(/-/g,"_");ka.test(f)&&b.push(f)}return b.join(",")},fa=function(a,b,c){a=
a[b];!a&&c&&N("missing: "+b);if(a){if(O.test(a))return a;N("invalid: "+b)}return null},ba=/^https?:\/\/[a-z0-9_.-]+\.google\.com(:\d+)?\/[a-zA-Z0-9_.,!=\-\/]+$/,ea=/\/cb=/g,J=/\/\//g,R=function(){var a=r();if(!a)throw Error("Bad hint");return a};H.m=function(a,b,c,e){(a=a[0])||N("missing_hint");return"https://apis.google.com"+W(a,b,c,e)};var aa=decodeURI("%73cript"),T=function(a,b){for(var c=[],e=0;e<a.length;++e){var f=a[e];f&&0>l.call(b,f)&&c.push(f)}return c},ta=function(b){"loading"!=a.readyState?
Ba(b):a.write("<"+aa+' src="'+encodeURI(b)+'"></'+aa+">")},Ba=function(b){var c=a.createElement(aa);c.setAttribute("src",b);c.async="true";(b=a.getElementsByTagName(aa)[0])?b.parentNode.insertBefore(c,b):(a.head||a.body||a.documentElement).appendChild(c)},ha=function(a,b){var c=b&&b._c;if(c)for(var e=0;e<M.length;e++){var f=M[e][0],h=M[e][1];h&&Object.prototype.hasOwnProperty.call(c,f)&&h(c[f],a,b)}},ca=function(a,b,c){U(function(){var c;c=b===r()?h(q,"_",x()):x();c=h(B(b),"_",c);a(c)},c)},ja=function(a,
b){var c=b||{};"function"==typeof b&&(c={},c.callback=b);ha(a,c);var e=a?a.split(":"):[],f=c.h||R(),q=h(m,"ah",x());if(q["::"]&&e.length){for(var r=[],l=null;l=e.shift();){var y=l.split("."),y=q[l]||q[y[1]&&"ns:"+y[0]||""]||f,t=r.length&&r[r.length-1]||null,B=t;t&&t.hint==y||(B={hint:y,b:[]},r.push(B));B.b.push(l)}var z=r.length;if(1<z){var D=c.callback;D&&(c.callback=function(){0==--z&&D()})}for(;e=r.shift();)ia(e.b,c,e.hint)}else ia(e||[],c,f)},ia=function(a,c,f){a=t(a)||[];var r=c.callback,l=c.config,
x=c.timeout,z=c.ontimeout,na=c.onerror,D=void 0;"function"==typeof na&&(D=na);var E=null,L=!1;if(x&&!z||!x&&z)throw"Timeout requires both the timeout parameter and ontimeout parameter to be set";var na=h(B(f),"r",[]).sort(),O=h(B(f),"L",[]).sort(),G=[].concat(na),H=function(a,c){if(L)return 0;b.clearTimeout(E);O.push.apply(O,U);var e=((q||{}).config||{}).update;e?e(l):l&&h(m,"cu",[]).push(l);if(c){F("me0",a,G);try{ca(c,f,D)}finally{F("me1",a,G)}}return 1};0<x&&(E=b.setTimeout(function(){L=!0;z()},
x));var U=T(a,O);if(U.length){var U=T(a,na),M=h(m,"CP",[]),w=M.length;M[w]=function(a){if(!a)return 0;F("ml1",U,G);var b=function(b){M[w]=null;H(U,a)&&y(function(){r&&r();b()})},c=function(){var a=M[w+1];a&&a()};0<w&&M[w-1]?M[w]=function(){b(c)}:b(c)};if(U.length){var S="loaded_"+m.I++;q[S]=function(a){M[w](a);q[S]=null};a=sa(f,U,"gapi."+S,na);na.push.apply(na,U);F("ml0",U,G);c.sync||b.___gapisync?ta(a):Ba(a)}else M[w](e)}else H(U)&&r&&r()},U=function(a,b){if(m.hee&&0<m.hel)try{return a()}catch(ya){b&&
b(ya),m.hel--,ja("debug_error",function(){try{window.___jsl.hefn(ya)}catch(za){throw ya;}})}else try{return a()}catch(ya){throw b&&b(ya),ya;}};q.load=function(a,b){return U(function(){return ja(a,b)})};E.bs0=window.gapi._bs||(new Date).getTime();I("bs0");E.bs1=(new Date).getTime();I("bs1");delete window.gapi._bs})();
gapi.load("",{callback:window.gapi_onload,_c:{jsl:{ci:{deviceType:"desktop","oauth-flow":{authUrl:"https://accounts.google.com/o/oauth2/auth",proxyUrl:"https://accounts.google.com/o/oauth2/postmessageRelay",disableOpt:!0,idpIframeUrl:"https://accounts.google.com/o/oauth2/iframe",usegapi:!1},debug:{reportExceptionRate:.05,forceIm:!1,rethrowException:!1,host:"https://apis.google.com"},lexps:[81,97,100,122,124,30,79,127],enableMultilogin:!0,"googleapis.config":{auth:{useFirstPartyAuthV2:!1}},isPlusUser:!1,
inline:{css:1},disableRealtimeCallback:!1,drive_share:{skipInitCommand:!0},csi:{rate:.01},report:{apiRate:{"gapi\\.signin\\..*":.05,"gapi\\.signin2\\..*":.05},apis:["iframes\\..*","gadgets\\..*","gapi\\.appcirclepicker\\..*","gapi\\.auth\\..*","gapi\\.client\\..*"],rate:.001,host:"https://apis.google.com"},client:{headers:{request:"Accept Accept-Language Authorization Cache-Control Content-Disposition Content-Encoding Content-Language Content-Length Content-MD5 Content-Range Content-Type Date GData-Version Host If-Match If-Modified-Since If-None-Match If-Unmodified-Since Origin OriginToken Pragma Range Slug Transfer-Encoding Want-Digest X-ClientDetails X-GData-Client X-GData-Key X-Goog-AuthUser X-Goog-PageId X-Goog-Encode-Response-If-Executable X-Goog-Correlation-Id X-Goog-Request-Info X-Goog-Experiments x-goog-iam-authority-selector x-goog-iam-authorization-token X-Goog-Spatula X-Goog-Upload-Command X-Goog-Upload-Content-Disposition X-Goog-Upload-Content-Length X-Goog-Upload-Content-Type X-Goog-Upload-File-Name X-Goog-Upload-Offset X-Goog-Upload-Protocol X-Goog-Visitor-Id X-HTTP-Method-Override X-JavaScript-User-Agent X-Pan-Versionid X-Origin X-Referer X-Upload-Content-Length X-Upload-Content-Type X-Use-HTTP-Status-Code-Override X-Ios-Bundle-Identifier X-Android-Package X-YouTube-VVT X-YouTube-Page-CL X-YouTube-Page-Timestamp".split(" "),
response:"Digest Cache-Control Content-Disposition Content-Encoding Content-Language Content-Length Content-MD5 Content-Range Content-Type Date ETag Expires Last-Modified Location Pragma Range Server Transfer-Encoding WWW-Authenticate Vary Unzipped-Content-MD5 X-Goog-Generation X-Goog-Metageneration X-Goog-Safety-Content-Type X-Goog-Safety-Encoding X-Google-Trace X-Goog-Upload-Chunk-Granularity X-Goog-Upload-Control-URL X-Goog-Upload-Size-Received X-Goog-Upload-Status X-Goog-Upload-URL X-Goog-Diff-Download-Range X-Goog-Hash X-Goog-Updated-Authorization X-Server-Object-Version X-Guploader-Customer X-Guploader-Upload-Result X-Guploader-Uploadid X-Google-Gfe-Backend-Request-Cost".split(" ")},
rms:"migrated",cors:!1},isLoggedIn:!1,signInDeprecation:{rate:0},include_granted_scopes:!0,llang:"fr",iframes:{youtube:{params:{location:["search","hash"]},url:":socialhost:/:session_prefix:_/widget/render/youtube?usegapi=1",methods:["scroll","openwindow"]},ytsubscribe:{url:"https://www.youtube.com/subscribe_embed?usegapi=1"},plus_circle:{params:{url:""},url:":socialhost:/:session_prefix::se:_/widget/plus/circle?usegapi=1"},plus_share:{params:{url:""},url:":socialhost:/:session_prefix::se:_/+1/sharebutton?plusShare=true&usegapi=1"},
rbr_s:{params:{url:""},url:":socialhost:/:session_prefix::se:_/widget/render/recobarsimplescroller"},udc_webconsentflow:{params:{url:""},url:"https://www.google.com/settings/webconsent?usegapi=1"},":source:":"3p",playemm:{url:"https://play.google.com/work?usegapi=1&usegapi=1"},blogger:{params:{location:["search","hash"]},url:":socialhost:/:session_prefix:_/widget/render/blogger?usegapi=1",methods:["scroll","openwindow"]},evwidget:{params:{url:""},url:":socialhost:/:session_prefix:_/events/widget?usegapi=1"},
partnersbadge:{url:"https://www.gstatic.com/partners/badge/templates/badge.html?usegapi=1"},":socialhost:":"https://apis.google.com",shortlists:{url:""},hangout:{url:"https://talkgadget.google.com/:session_prefix:talkgadget/_/widget"},plus_followers:{params:{url:""},url:":socialhost:/_/im/_/widget/render/plus/followers?usegapi=1"},post:{params:{url:""},url:":socialhost:/:session_prefix::im_prefix:_/widget/render/post?usegapi=1"},":gplus_url:":"https://plus.google.com",signin:{params:{url:""},url:":socialhost:/:session_prefix:_/widget/render/signin?usegapi=1",
methods:["onauth"]},rbr_i:{params:{url:""},url:":socialhost:/:session_prefix::se:_/widget/render/recobarinvitation"},donation:{url:"https://onetoday.google.com/home/donationWidget?usegapi=1"},share:{url:":socialhost:/:session_prefix::im_prefix:_/widget/render/share?usegapi=1"},plusone:{params:{count:"",size:"",url:""},url:":socialhost:/:session_prefix::se:_/+1/fastbutton?usegapi=1"},comments:{params:{location:["search","hash"]},url:":socialhost:/:session_prefix:_/widget/render/comments?usegapi=1",
methods:["scroll","openwindow"]},":im_socialhost:":"https://plus.googleapis.com",backdrop:{url:"https://clients3.google.com/cast/chromecast/home/widget/backdrop?usegapi=1"},visibility:{params:{url:""},url:":socialhost:/:session_prefix:_/widget/render/visibility?usegapi=1"},autocomplete:{params:{url:""},url:":socialhost:/:session_prefix:_/widget/render/autocomplete"},additnow:{url:"https://apis.google.com/additnow/additnow.html?usegapi=1",methods:["launchurl"]},":signuphost:":"https://plus.google.com",
appcirclepicker:{url:":socialhost:/:session_prefix:_/widget/render/appcirclepicker"},follow:{url:":socialhost:/:session_prefix:_/widget/render/follow?usegapi=1"},community:{url:":ctx_socialhost:/:session_prefix::im_prefix:_/widget/render/community?usegapi=1"},sharetoclassroom:{url:"https://www.gstatic.com/classroom/sharewidget/widget_stable.html?usegapi=1"},ytshare:{params:{url:""},url:":socialhost:/:session_prefix:_/widget/render/ytshare?usegapi=1"},plus:{url:":socialhost:/:session_prefix:_/widget/render/badge?usegapi=1"},
family_creation:{params:{url:""},url:"https://families.google.com/webcreation?usegapi=1&usegapi=1"},commentcount:{url:":socialhost:/:session_prefix:_/widget/render/commentcount?usegapi=1"},configurator:{url:":socialhost:/:session_prefix:_/plusbuttonconfigurator?usegapi=1"},zoomableimage:{url:"https://ssl.gstatic.com/microscope/embed/"},savetowallet:{url:"https://clients5.google.com/s2w/o/savetowallet"},person:{url:":socialhost:/:session_prefix:_/widget/render/person?usegapi=1"},savetodrive:{url:"https://drive.google.com/savetodrivebutton?usegapi=1",
methods:["save"]},page:{url:":socialhost:/:session_prefix:_/widget/render/page?usegapi=1"},card:{url:":socialhost:/:session_prefix:_/hovercard/card"}}},h:"m;/_/scs/apps-static/_/js/k=oz.gapi.fr.RtN3VtG2yac.O/m=__features__/am=EQ/rt=j/d=1/rs=AGLTcCNh3CUzUyRhab3nnFmD-mmgi7MvpA",u:"https://apis.google.com/js/api.js",hee:!0,fp:"8e93d657eacdccd49a48df518caca05fc0f47051",dpo:!1},fp:"8e93d657eacdccd49a48df518caca05fc0f47051",annotation:["interactivepost","recobar","signin2","autocomplete","profile"],bimodal:["signin",
"share"]}});!function(b){var a,c,e=/[\.\/]/,f=/\s*,\s*/,h=function(a,b){return a-b},l={n:{}},t=function(){for(var a=0,b=this.length;b>a;a++)if("undefined"!=typeof this[a])return this[a]},x=function(){for(var a=this.length;--a;)if("undefined"!=typeof this[a])return this[a]},q=function(b,e){b=String(b);var f,m=c,r=Array.prototype.slice.call(arguments,2),l=q.listeners(b),G=0,I=[],F={},D=[],H=a;D.firstDefined=t;D.lastDefined=x;a=b;for(var M=c=0,N=l.length;N>M;M++)"zIndex"in l[M]&&(I.push(l[M].zIndex),0>l[M].zIndex&&
(F[l[M].zIndex]=l[M]));for(I.sort(h);0>I[G];)if(f=F[I[G++]],D.push(f.apply(e,r)),c)return c=m,D;for(M=0;N>M;M++)if(f=l[M],"zIndex"in f)if(f.zIndex==I[G]){if(D.push(f.apply(e,r)),c)break;do if(G++,f=F[I[G]],f&&D.push(f.apply(e,r)),c)break;while(f)}else F[f.zIndex]=f;else if(D.push(f.apply(e,r)),c)break;return c=m,a=H,D};q._events=l;q.listeners=function(a){var b,c,f,h,m,q,t,x=a.split(e);b=l;var D=[b],H=[];a=0;for(h=x.length;h>a;a++){t=[];m=0;for(q=D.length;q>m;m++)for(b=D[m].n,c=[b[x[a]],b["*"]],f=
2;f--;)(b=c[f])&&(t.push(b),H=H.concat(b.f||[]));D=t}return H};q.on=function(a,b){if(a=String(a),"function"!=typeof b)return function(){};for(var c=a.split(f),h=0,m=c.length;m>h;h++)!function(a){var c;a=a.split(e);for(var f=l,h=0,m=a.length;m>h;h++)f=f.n,f=f.hasOwnProperty(a[h])&&f[a[h]]||(f[a[h]]={n:{}});f.f=f.f||[];h=0;for(m=f.f.length;m>h;h++)if(f.f[h]==b){c=!0;break}!c&&f.f.push(b)}(c[h]);return function(a){+a==+a&&(b.zIndex=+a)}};q.f=function(a){var b=[].slice.call(arguments,1);return function(){q.apply(null,
[a,null].concat(b).concat([].slice.call(arguments,0)))}};q.stop=function(){c=1};q.nt=function(b){return b?(new RegExp("(?:\\.|\\/|^)"+b+"(?:\\.|\\/|$)")).test(a):a};q.nts=function(){return a.split(e)};q.off=q.unbind=function(a,b){if(!a)return void(q._events=l={n:{}});var c=a.split(f);if(1<c.length)for(var h=0,m=c.length;m>h;h++)q.off(c[h],b);else{for(var c=a.split(e),r,t,x,F,D=[l],h=0,m=c.length;m>h;h++)for(F=0;F<D.length;F+=x.length-2){if(x=[F,1],r=D[F].n,"*"!=c[h])r[c[h]]&&x.push(r[c[h]]);else for(t in r)r.hasOwnProperty(t)&&
x.push(r[t]);D.splice.apply(D,x)}h=0;for(m=D.length;m>h;h++)for(r=D[h];r.n;){if(b){if(r.f){F=0;for(c=r.f.length;c>F;F++)if(r.f[F]==b){r.f.splice(F,1);break}!r.f.length&&delete r.f}for(t in r.n)if(r.n.hasOwnProperty(t)&&r.n[t].f){x=r.n[t].f;F=0;for(c=x.length;c>F;F++)if(x[F]==b){x.splice(F,1);break}!x.length&&delete r.n[t].f}}else for(t in delete r.f,r.n)r.n.hasOwnProperty(t)&&r.n[t].f&&delete r.n[t].f;r=r.n}}};q.once=function(a,b){var c=function(){return q.unbind(a,c),b.apply(this,arguments)};return q.on(a,
c)};q.version="0.4.2";q.toString=function(){return"You are running Eve 0.4.2"};"undefined"!=typeof module&&module.exports?module.exports=q:"function"==typeof define&&define.amd?define("eve",[],function(){return q}):b.eve=q}(this);
(function(b,a){if("function"==typeof define&&define.amd)define(["eve"],function(c){return a(b,c)});else if("undefined"!=typeof exports){var c=require("eve");module.exports=a(b,c)}else a(b,b.eve)})(window||this,function(b,a){var c=function(a){var c={},e=b.requestAnimationFrame||b.webkitRequestAnimationFrame||b.mozRequestAnimationFrame||b.oRequestAnimationFrame||b.msRequestAnimationFrame||function(a){setTimeout(a,16)},f=Array.isArray||function(a){return a instanceof Array||"[object Array]"==Object.prototype.toString.call(a)},
x=0,q="M"+(+new Date).toString(36),m=function(a){if(null==a)return this.s;var b=this.s-a;this.b+=this.dur*b;this.B+=this.dur*b;this.s=a},r=function(a){return null==a?this.spd:void(this.spd=a)},y=function(a){return null==a?this.dur:(this.s=this.s*a/this.dur,void(this.dur=a))},B=function(){delete c[this.id];this.update();a("mina.stop."+this.id,this)},z=function(){this.pdif||(delete c[this.id],this.update(),this.pdif=this.get()-this.b)},E=function(){this.pdif&&(this.b=this.get()-this.pdif,delete this.pdif,
c[this.id]=this)},G=function(){var a;if(f(this.start)){a=[];for(var b=0,c=this.start.length;c>b;b++)a[b]=+this.start[b]+(this.end[b]-this.start[b])*this.easing(this.s)}else a=+this.start+(this.end-this.start)*this.easing(this.s);this.set(a)},I=function(){var b=0,f;for(f in c)if(c.hasOwnProperty(f)){var h=c[f],m=h.get();b++;h.s=(m-h.b)/(h.dur/h.spd);1<=h.s&&(delete c[f],h.s=1,b--,function(b){setTimeout(function(){a("mina.finish."+b.id,b)})}(h));h.update()}b&&e(I)},F=function(a,b,f,h,l,t,S){a={id:q+
(x++).toString(36),start:a,end:b,b:f,s:0,dur:h-f,spd:1,get:l,set:t,easing:S||F.linear,status:m,speed:r,duration:y,stop:B,pause:z,resume:E,update:G};c[a.id]=a;var D;b=0;for(D in c)if(c.hasOwnProperty(D)&&(b++,2==b))break;return 1==b&&e(I),a};return F.time=Date.now||function(){return+new Date},F.getById=function(a){return c[a]||null},F.linear=function(a){return a},F.easeout=function(a){return Math.pow(a,1.7)},F.easein=function(a){return Math.pow(a,.48)},F.easeinout=function(a){if(1==a)return 1;if(0==
a)return 0;var b=.48-a/1.04,c=Math.sqrt(.1734+b*b);a=c-b;b=-c-b;a=Math.pow(Math.abs(a),1/3)*(0>a?-1:1)+Math.pow(Math.abs(b),1/3)*(0>b?-1:1)+.5;return 3*(1-a)*a*a+a*a*a},F.backin=function(a){return 1==a?1:a*a*(2.70158*a-1.70158)},F.backout=function(a){if(0==a)return 0;--a;return a*a*(2.70158*a+1.70158)+1},F.elastic=function(a){return a==!!a?a:Math.pow(2,-10*a)*Math.sin(2*(a-.075)*Math.PI/.3)+1},F.bounce=function(a){var b;return 1/2.75>a?b=7.5625*a*a:2/2.75>a?(a-=1.5/2.75,b=7.5625*a*a+.75):2.5/2.75>
a?(a-=2.25/2.75,b=7.5625*a*a+.9375):(a-=2.625/2.75,b=7.5625*a*a+.984375),b},b.mina=F,F}("undefined"==typeof a?function(){}:a),e=function(b){function c(a,b){if(a){if(a.nodeType)return F(a);if(f(a,"array")&&c.set)return c.set.apply(c,a);if(a instanceof z)return a;if(null==b)return a=H.doc.querySelector(String(a)),F(a)}return a=null==a?"100%":a,b=null==b?"100%":b,new I(a,b)}function e(a,b){if(b){if("#text"==a&&(a=H.doc.createTextNode(b.text||b["#text"]||"")),"#comment"==a&&(a=H.doc.createComment(b.text||
b["#text"]||"")),"string"==typeof a&&(a=e(a)),"string"==typeof b)return 1==a.nodeType?"xlink:"==b.substring(0,6)?a.getAttributeNS(ca,b.substring(6)):"xml:"==b.substring(0,4)?a.getAttributeNS(ja,b.substring(4)):a.getAttribute(b):"text"==b?a.nodeValue:null;if(1==a.nodeType)for(var c in b){if(b[M](c)){var f=N(b[c]);f?"xlink:"==c.substring(0,6)?a.setAttributeNS(ca,c.substring(6),f):"xml:"==c.substring(0,4)?a.setAttributeNS(ja,c.substring(4),f):a.setAttribute(c,f):a.removeAttribute(c)}}else"text"in b&&
(a.nodeValue=b.text)}else a=H.doc.createElementNS(ja,a);return a}function f(a,b){return b=N.prototype.toLowerCase.call(b),"finite"==b?isFinite(a):"array"==b&&(a instanceof Array||Array.isArray&&Array.isArray(a))?!0:"null"==b&&null===a||b==typeof a&&null!==a||"object"==b&&a===Object(a)||fa.call(a).slice(8,-1).toLowerCase()==b}function x(a){if("function"==typeof a||Object(a)!==a)return a;var b=new a.constructor,c;for(c in a)a[M](c)&&(b[c]=x(a[c]));return b}function q(a,b,c){function e(){var f=Array.prototype.slice.call(arguments,
0),h=f.join("\u2400"),m=e.cache=e.cache||{},q=e.count=e.count||[];if(m[M](h)){a:for(var f=q,q=h,r=0,l=f.length;l>r;r++)if(f[r]===q){f.push(f.splice(r,1)[0]);break a}h=c?c(m[h]):m[h]}else h=(1E3<=q.length&&delete m[q.shift()],q.push(h),m[h]=a.apply(b,f),c?c(m[h]):m[h]);return h}return e}function m(a,b,c,e,f,h){return null==f?(a-=c,b-=e,a||b?(180*S.atan2(-b,-a)/ma+540)%360:0):m(a,b,f,h)-m(c,e,f,h)}function r(a){return a%360*ma/180}function y(a){return a.node.ownerSVGElement&&F(a.node.ownerSVGElement)||
c.select("svg")}function B(a){f(a,"array")||(a=Array.prototype.slice.call(arguments,0));for(var b=0,c=0,e=this.node;this[b];)delete this[b++];for(b=0;b<a.length;b++)"set"==a[b].type?a[b].forEach(function(a){e.appendChild(a.node)}):e.appendChild(a[b].node);for(var h=e.childNodes,b=0;b<h.length;b++)this[c++]=F(h[b]);return this}function z(a){if(a.snap in ia)return ia[a.snap];var b;try{b=a.ownerSVGElement}catch($a){}this.node=a;b&&(this.paper=new I(b));this.type=a.tagName||a.nodeName;b=this.id=ha(this);
if(this.anims={},this._={transform:[]},a.snap=b,ia[b]=this,"g"==this.type&&(this.add=B),this.type in{g:1,mask:1,pattern:1,symbol:1})for(var c in I.prototype)I.prototype[M](c)&&(this[c]=I.prototype[c])}function E(a){this.node=a}function G(a,b){var c=e(a);b.appendChild(c);return F(c)}function I(a,b){var c,f,h,m=I.prototype;if(a&&"svg"==a.tagName){if(a.snap in ia)return ia[a.snap];var q=a.ownerDocument;c=new z(a);f=a.getElementsByTagName("desc")[0];h=a.getElementsByTagName("defs")[0];f||(f=e("desc"),
f.appendChild(q.createTextNode("Created with Snap")),c.node.appendChild(f));h||(h=e("defs"),c.node.appendChild(h));c.defs=h;for(var r in m)m[M](r)&&(c[r]=m[r]);c.paper=c.root=c}else c=G("svg",H.doc.body),e(c.node,{height:b,version:1.1,width:a,xmlns:ja});return c}function F(a){return a?a instanceof z||a instanceof E?a:a.tagName&&"svg"==a.tagName.toLowerCase()?new I(a):a.tagName&&"object"==a.tagName.toLowerCase()&&"image/svg+xml"==a.type?new I(a.contentDocument.getElementsByTagName("svg")[0]):new z(a):
a}function D(a,b){for(var c=0,e=a.length;e>c;c++){var f={type:a[c].type,attr:a[c].attr()},h=a[c].children();b.push(f);h.length&&D(h,f.childNodes=[])}}c.version="0.4.0";c.toString=function(){return"Snap v"+this.version};c._={};var H={win:b.window,doc:b.window.document};c._.glob=H;var M="hasOwnProperty",N=String,L=parseFloat,O=parseInt,S=Math,ka=S.max,sa=S.min,W=S.abs,ma=(S.pow,S.PI),pa=(S.round,""),fa=Object.prototype.toString,ba=/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?%?)\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?%?)\s*\))\s*$/i,
ea=(c._.separator=/[,\s]+/,/[\s]*,[\s]*/),J={hs:1,rg:1},R=/([a-z])[\s,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\s]*,?[\s]*)+)/gi,aa=/([rstm])[\s,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\s]*,?[\s]*)+)/gi,T=/(-?\d*\.?\d*(?:e[\-+]?\\d+)?)[\s]*,?[\s]*/gi,ta=0,Ba="S"+(+new Date).toString(36),ha=function(a){return(a&&a.type?a.type:pa)+Ba+(ta++).toString(36)},ca="http://www.w3.org/1999/xlink",ja="http://www.w3.org/2000/svg",ia={};c.url=function(a){return"url('#"+a+"')"};c._.$=e;c._.id=ha;c.format=function(){var a=/\{([^\}]+)\}/g,
b=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g,c=function(a,c,e){var f=e;return c.replace(b,function(a,b,c,e,h){b=b||e;f&&(b in f&&(f=f[b]),"function"==typeof f&&h&&(f=f()))}),f=(null==f||f==e?a:f)+""};return function(b,e){return N(b).replace(a,function(a,b){return c(a,b,e)})}}();c._.clone=x;c._.cacher=q;c.rad=r;c.deg=function(a){return 180*a/ma%360};c.sin=function(a){return S.sin(c.rad(a))};c.tan=function(a){return S.tan(c.rad(a))};c.cos=function(a){return S.cos(c.rad(a))};c.asin=function(a){return c.deg(S.asin(a))};
c.acos=function(a){return c.deg(S.acos(a))};c.atan=function(a){return c.deg(S.atan(a))};c.atan2=function(a){return c.deg(S.atan2(a))};c.angle=m;c.len=function(a,b,e,f){return Math.sqrt(c.len2(a,b,e,f))};c.len2=function(a,b,c,e){return(a-c)*(a-c)+(b-e)*(b-e)};c.closestPoint=function(a,b,c){function e(a){var e=a.x-b;a=a.y-c;return e*e+a*a}var f,h,m,q;a=a.node;for(var r=a.getTotalLength(),l=r/a.pathSegList.numberOfItems*.125,y=1/0,t=0;r>=t;t+=l)(q=e(m=a.getPointAtLength(t)))<y&&(f=m,h=t,y=q);for(l*=
.5;.5<l;){var x,B,z,na,O,L;0<=(z=h-l)&&(O=e(x=a.getPointAtLength(z)))<y?(f=x,h=z,y=O):(na=h+l)<=r&&(L=e(B=a.getPointAtLength(na)))<y?(f=B,h=na,y=L):l*=.5}return f={x:f.x,y:f.y,length:h,distance:Math.sqrt(y)}};c.is=f;c.snapTo=function(a,b,c){if(c=f(c,"finite")?c:10,f(a,"array"))for(var e=a.length;e--;){if(W(a[e]-b)<=c)return a[e]}else{a=+a;e=b%a;if(c>e)return b-e;if(e>a-c)return b-e+a}return b};c.getRGB=q(function(a){if(!a||(a=N(a)).indexOf("-")+1)return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:ya};
if("none"==a)return{r:-1,g:-1,b:-1,hex:"none",toString:ya};if(!(J[M](a.toLowerCase().substring(0,2))||"#"==a.charAt())&&(a=U(a)),!a)return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:ya};var b,e,h,m,q,r;return(a=a.match(ba))?(a[2]&&(h=O(a[2].substring(5),16),e=O(a[2].substring(3,5),16),b=O(a[2].substring(1,3),16)),a[3]&&(h=O((q=a[3].charAt(3))+q,16),e=O((q=a[3].charAt(2))+q,16),b=O((q=a[3].charAt(1))+q,16)),a[4]&&(r=a[4].split(ea),b=L(r[0]),"%"==r[0].slice(-1)&&(b*=2.55),e=L(r[1]),"%"==r[1].slice(-1)&&
(e*=2.55),h=L(r[2]),"%"==r[2].slice(-1)&&(h*=2.55),"rgba"==a[1].toLowerCase().slice(0,4)&&(m=L(r[3])),r[3]&&"%"==r[3].slice(-1)&&(m/=100)),a[5]?(r=a[5].split(ea),b=L(r[0]),"%"==r[0].slice(-1)&&(b/=100),e=L(r[1]),"%"==r[1].slice(-1)&&(e/=100),h=L(r[2]),"%"==r[2].slice(-1)&&(h/=100),("deg"==r[0].slice(-3)||"\u00b0"==r[0].slice(-1))&&(b/=360),"hsba"==a[1].toLowerCase().slice(0,4)&&(m=L(r[3])),r[3]&&"%"==r[3].slice(-1)&&(m/=100),c.hsb2rgb(b,e,h,m)):a[6]?(r=a[6].split(ea),b=L(r[0]),"%"==r[0].slice(-1)&&
(b/=100),e=L(r[1]),"%"==r[1].slice(-1)&&(e/=100),h=L(r[2]),"%"==r[2].slice(-1)&&(h/=100),("deg"==r[0].slice(-3)||"\u00b0"==r[0].slice(-1))&&(b/=360),"hsla"==a[1].toLowerCase().slice(0,4)&&(m=L(r[3])),r[3]&&"%"==r[3].slice(-1)&&(m/=100),c.hsl2rgb(b,e,h,m)):(b=sa(S.round(b),255),e=sa(S.round(e),255),h=sa(S.round(h),255),m=sa(ka(m,0),1),a={r:b,g:e,b:h,toString:ya},a.hex="#"+(16777216|h|e<<8|b<<16).toString(16).slice(1),a.opacity=f(m,"finite")?m:1,a)):{r:-1,g:-1,b:-1,hex:"none",error:1,toString:ya}},
c);c.hsb=q(function(a,b,e){return c.hsb2rgb(a,b,e).hex});c.hsl=q(function(a,b,e){return c.hsl2rgb(a,b,e).hex});c.rgb=q(function(a,b,c,e){if(f(e,"finite")){var h=S.round;return"rgba("+[h(a),h(b),h(c),+e.toFixed(2)]+")"}return"#"+(16777216|c|b<<8|a<<16).toString(16).slice(1)});var U=function(a){var b=H.doc.getElementsByTagName("head")[0]||H.doc.getElementsByTagName("svg")[0];return(U=q(function(a){if("red"==a.toLowerCase())return"rgb(255, 0, 0)";b.style.color="rgb(255, 0, 0)";b.style.color=a;a=H.doc.defaultView.getComputedStyle(b,
pa).getPropertyValue("color");return"rgb(255, 0, 0)"==a?null:a}))(a)},Ma=function(){return"hsb("+[this.h,this.s,this.b]+")"},Ga=function(){return"hsl("+[this.h,this.s,this.l]+")"},ya=function(){return 1==this.opacity||null==this.opacity?this.hex:"rgba("+[this.r,this.g,this.b,this.opacity]+")"},za=function(a,b,e){if(null==b&&f(a,"object")&&"r"in a&&"g"in a&&"b"in a&&(e=a.b,b=a.g,a=a.r),null==b&&f(a,string))e=c.getRGB(a),a=e.r,b=e.g,e=e.b;return(1<a||1<b||1<e)&&(a/=255,b/=255,e/=255),[a,b,e]},V=function(a,
b,e,h){a=S.round(255*a);b=S.round(255*b);e=S.round(255*e);a={r:a,g:b,b:e,opacity:f(h,"finite")?h:1,hex:c.rgb(a,b,e),toString:ya};return f(h,"finite")&&(a.opacity=h),a};c.color=function(a){var b;return f(a,"object")&&"h"in a&&"s"in a&&"b"in a?(b=c.hsb2rgb(a),a.r=b.r,a.g=b.g,a.b=b.b,a.opacity=1,a.hex=b.hex):f(a,"object")&&"h"in a&&"s"in a&&"l"in a?(b=c.hsl2rgb(a),a.r=b.r,a.g=b.g,a.b=b.b,a.opacity=1,a.hex=b.hex):(f(a,"string")&&(a=c.getRGB(a)),f(a,"object")&&"r"in a&&"g"in a&&"b"in a&&!("error"in a)?
(b=c.rgb2hsl(a),a.h=b.h,a.s=b.s,a.l=b.l,b=c.rgb2hsb(a),a.v=b.b):(a={hex:"none"},a.r=a.g=a.b=a.h=a.s=a.v=a.l=-1,a.error=1)),a.toString=ya,a};c.hsb2rgb=function(a,b,c,e){f(a,"object")&&"h"in a&&"s"in a&&"b"in a&&(c=a.b,b=a.s,e=a.o,a=a.h);a*=360;var h,m,q,r,l;return a=a%360/60,l=c*b,r=l*(1-W(a%2-1)),h=m=q=c-l,a=~~a,h+=[l,r,0,0,r,l][a],m+=[r,l,l,r,0,0][a],q+=[0,0,r,l,l,r][a],V(h,m,q,e)};c.hsl2rgb=function(a,b,c,e){f(a,"object")&&"h"in a&&"s"in a&&"l"in a&&(c=a.l,b=a.s,a=a.h);(1<a||1<b||1<c)&&(a/=360,
b/=100,c/=100);a*=360;var h,m,q,r,l;return a=a%360/60,l=2*b*(.5>c?c:1-c),r=l*(1-W(a%2-1)),h=m=q=c-l/2,a=~~a,h+=[l,r,0,0,r,l][a],m+=[r,l,l,r,0,0][a],q+=[0,0,r,l,l,r][a],V(h,m,q,e)};c.rgb2hsb=function(a,b,c){c=za(a,b,c);a=c[0];b=c[1];c=c[2];var e,f,h,m;return h=ka(a,b,c),m=h-sa(a,b,c),e=0==m?null:h==a?(b-c)/m:h==b?(c-a)/m+2:(a-b)/m+4,e=(e+360)%6*60/360,f=0==m?0:m/h,{h:e,s:f,b:h,toString:Ma}};c.rgb2hsl=function(a,b,c){c=za(a,b,c);a=c[0];b=c[1];c=c[2];var e,f,h,m,q,r;return m=ka(a,b,c),q=sa(a,b,c),r=
m-q,e=0==r?null:m==a?(b-c)/r:m==b?(c-a)/r+2:(a-b)/r+4,e=(e+360)%6*60/360,h=(m+q)/2,f=0==r?0:.5>h?r/(2*h):r/(2-2*h),{h:e,s:f,l:h,toString:Ga}};c.parsePathString=function(a){if(!a)return null;var b=c.path(a);if(b.arr)return c.path.clone(b.arr);var e={a:7,c:6,o:2,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,u:3,z:0},h=[];return f(a,"array")&&f(a[0],"array")&&(h=c.path.clone(a)),h.length||N(a).replace(R,function(a,b,c){var f=[];a=b.toLowerCase();if(c.replace(T,function(a,b){b&&f.push(+b)}),"m"==a&&2<f.length&&(h.push([b].concat(f.splice(0,
2))),a="l",b="m"==b?"l":"L"),"o"==a&&1==f.length&&h.push([b,f[0]]),"r"==a)h.push([b].concat(f));else for(;f.length>=e[a]&&(h.push([b].concat(f.splice(0,e[a]))),e[a]););}),h.toString=c.path.toString,b.arr=c.path.clone(h),h};var fb=c.parseTransformString=function(a){if(!a)return null;var b=[];return f(a,"array")&&f(a[0],"array")&&(b=c.path.clone(a)),b.length||N(a).replace(aa,function(a,c,e){var f=[];c.toLowerCase();e.replace(T,function(a,b){b&&f.push(+b)});b.push([c].concat(f))}),b.toString=c.path.toString,
b};c._.svgTransform2string=function(a){var b=[];return a=a.replace(/(?:^|\s)(\w+)\(([^)]+)\)/g,function(a,c,e){return e=e.split(/\s*,\s*|\s+/),"rotate"==c&&1==e.length&&e.push(0,0),"scale"==c&&(2<e.length?e=e.slice(0,2):2==e.length&&e.push(0,0),1==e.length&&e.push(e[0],0,0)),b.push("skewX"==c?["m",1,0,S.tan(r(e[0])),1,0,0]:"skewY"==c?["m",1,S.tan(r(e[0])),0,1,0,0]:[c.charAt(0)].concat(e)),a}),b};c._.rgTransform=/^[a-z][\s]*-?\.?\d/i;c._.transform2matrix=function(a,b){var e=fb(a),f=new c.Matrix;if(e)for(var h=
0,m=e.length;m>h;h++){var q,r,l,y,t,x=e[h],B=x.length,z=N(x[0]).toLowerCase(),O=x[0]!=z,L=O?f.invert():0;"t"==z&&2==B?f.translate(x[1],0):"t"==z&&3==B?O?(q=L.x(0,0),r=L.y(0,0),l=L.x(x[1],x[2]),y=L.y(x[1],x[2]),f.translate(l-q,y-r)):f.translate(x[1],x[2]):"r"==z?2==B?(t=t||b,f.rotate(x[1],t.x+t.width/2,t.y+t.height/2)):4==B&&(O?(l=L.x(x[2],x[3]),y=L.y(x[2],x[3]),f.rotate(x[1],l,y)):f.rotate(x[1],x[2],x[3])):"s"==z?2==B||3==B?(t=t||b,f.scale(x[1],x[B-1],t.x+t.width/2,t.y+t.height/2)):4==B?O?(l=L.x(x[2],
x[3]),y=L.y(x[2],x[3]),f.scale(x[1],x[1],l,y)):f.scale(x[1],x[1],x[2],x[3]):5==B&&(O?(l=L.x(x[3],x[4]),y=L.y(x[3],x[4]),f.scale(x[1],x[2],l,y)):f.scale(x[1],x[2],x[3],x[4])):"m"==z&&7==B&&f.add(x[1],x[2],x[3],x[4],x[5],x[6])}return f};c._unit2px=function(a,b,c){function f(a){if(null==a)return pa;if(a==+a)return a;e(l,{width:a});try{return l.getBBox().width}catch(ob){return 0}}function h(a){if(null==a)return pa;if(a==+a)return a;e(l,{height:a});try{return l.getBBox().height}catch(ob){return 0}}function m(e,
f){null==b?r[e]=f(a.attr(e)||0):e==b&&(r=f(null==c?a.attr(e)||0:c))}var q=y(a).node,r={},l=q.querySelector(".svg---mgr");switch(l||(l=e("rect"),e(l,{x:-9E9,y:-9E9,width:10,height:10,"class":"svg---mgr",fill:"none"}),q.appendChild(l)),a.type){case "rect":m("rx",f),m("ry",h);case "image":m("width",f),m("height",h);case "text":m("x",f);m("y",h);break;case "circle":m("cx",f);m("cy",h);m("r",f);break;case "ellipse":m("cx",f);m("cy",h);m("rx",f);m("ry",h);break;case "line":m("x1",f);m("x2",f);m("y1",h);
m("y2",h);break;case "marker":m("refX",f);m("markerWidth",f);m("refY",h);m("markerHeight",h);break;case "radialGradient":m("fx",f);m("fy",h);break;case "tspan":m("dx",f);m("dy",h);break;default:m(b,f)}return q.removeChild(l),r};H.doc.contains||H.doc.compareDocumentPosition?function(a,b){var c=9==a.nodeType?a.documentElement:a,e=b&&b.parentNode;return a==e||!(!e||1!=e.nodeType||!(c.contains?c.contains(e):a.compareDocumentPosition&&16&a.compareDocumentPosition(e)))}:function(a,b){if(b)for(;b;)if(b=
b.parentNode,b==a)return!0;return!1};c._.getSomeDefs=function(a){a=a.node.ownerSVGElement&&F(a.node.ownerSVGElement)||a.node.parentNode&&F(a.node.parentNode)||c.select("svg")||c(0,0);var b=a.select("defs"),b=null==b?!1:b.node;return b||(b=G("defs",a.node).node),b};c._.getSomeSVG=y;c.select=function(a){return a=N(a).replace(/([^\\]):/g,"$1\\:"),F(H.doc.querySelector(a))};c.selectAll=function(a){a=H.doc.querySelectorAll(a);for(var b=(c.set||Array)(),e=0;e<a.length;e++)b.push(F(a[e]));return b};setInterval(function(){for(var a in ia)if(ia[M](a)){var b=
ia[a],c=b.node;("svg"!=b.type&&!c.ownerSVGElement||"svg"==b.type&&(!c.parentNode||"ownerSVGElement"in c.parentNode&&!c.ownerSVGElement))&&delete ia[a]}},1E4);z.prototype.attr=function(b,c){var e=this.node;if(!b){if(1!=e.nodeType)return{text:e.nodeValue};for(var h=e.attributes,e={},m=0,q=h.length;q>m;m++)e[h[m].nodeName]=h[m].nodeValue;return e}if(f(b,"string")){if(!(1<arguments.length))return a("snap.util.getattr."+b,this).firstDefined();e={};e[b]=c;b=e}for(h in b)b[M](h)&&a("snap.util.attr."+h,this,
b[h]);return this};c.parse=function(a){var b=H.doc.createDocumentFragment(),c=!0,e=H.doc.createElement("div");if(a=N(a),a.match(/^\s*<\s*svg(?:\s|>)/)||(a="<svg>"+a+"</svg>",c=!1),e.innerHTML=a,a=e.getElementsByTagName("svg")[0])if(c)b=a;else for(;a.firstChild;)b.appendChild(a.firstChild);return new E(b)};c.fragment=function(){for(var a=Array.prototype.slice.call(arguments,0),b=H.doc.createDocumentFragment(),e=0,f=a.length;f>e;e++){var h=a[e];h.node&&h.node.nodeType&&b.appendChild(h.node);h.nodeType&&
b.appendChild(h);"string"==typeof h&&b.appendChild(c.parse(h).node)}return new E(b)};c._.make=G;c._.wrap=F;I.prototype.el=function(a,b){var c=G(a,this.node);return b&&c.attr(b),c};z.prototype.children=function(){for(var a=[],b=this.node.childNodes,e=0,f=b.length;f>e;e++)a[e]=c(b[e]);return a};z.prototype.toJSON=function(){var a=[];return D([this],a),a[0]};a.on("snap.util.getattr",function(){var b=a.nt(),b=b.substring(b.lastIndexOf(".")+1),c=b.replace(/[A-Z]/g,function(a){return"-"+a.toLowerCase()});
return Ja[M](c)?this.node.ownerDocument.defaultView.getComputedStyle(this.node,null).getPropertyValue(c):e(this.node,b)});var Ja={"alignment-baseline":0,"baseline-shift":0,clip:0,"clip-path":0,"clip-rule":0,color:0,"color-interpolation":0,"color-interpolation-filters":0,"color-profile":0,"color-rendering":0,cursor:0,direction:0,display:0,"dominant-baseline":0,"enable-background":0,fill:0,"fill-opacity":0,"fill-rule":0,filter:0,"flood-color":0,"flood-opacity":0,font:0,"font-family":0,"font-size":0,
"font-size-adjust":0,"font-stretch":0,"font-style":0,"font-variant":0,"font-weight":0,"glyph-orientation-horizontal":0,"glyph-orientation-vertical":0,"image-rendering":0,kerning:0,"letter-spacing":0,"lighting-color":0,marker:0,"marker-end":0,"marker-mid":0,"marker-start":0,mask:0,opacity:0,overflow:0,"pointer-events":0,"shape-rendering":0,"stop-color":0,"stop-opacity":0,stroke:0,"stroke-dasharray":0,"stroke-dashoffset":0,"stroke-linecap":0,"stroke-linejoin":0,"stroke-miterlimit":0,"stroke-opacity":0,
"stroke-width":0,"text-anchor":0,"text-decoration":0,"text-rendering":0,"unicode-bidi":0,visibility:0,"word-spacing":0,"writing-mode":0};a.on("snap.util.attr",function(b){var c=a.nt(),f={},c=c.substring(c.lastIndexOf(".")+1);f[c]=b;var h=c.replace(/-(\w)/gi,function(a,b){return b.toUpperCase()}),c=c.replace(/[A-Z]/g,function(a){return"-"+a.toLowerCase()});Ja[M](c)?this.node.style[h]=null==b?pa:b:e(this.node,f)});c.ajax=function(b,c,e,h){var m=new XMLHttpRequest,q=ha();if(m){if(f(c,"function"))h=e,
e=c,c=null;else if(f(c,"object")){var r=[],l;for(l in c)c.hasOwnProperty(l)&&r.push(encodeURIComponent(l)+"="+encodeURIComponent(c[l]));c=r.join("&")}return m.open(c?"POST":"GET",b,!0),c&&(m.setRequestHeader("X-Requested-With","XMLHttpRequest"),m.setRequestHeader("Content-type","application/x-www-form-urlencoded")),e&&(a.once("snap.ajax."+q+".0",e),a.once("snap.ajax."+q+".200",e),a.once("snap.ajax."+q+".304",e)),m.onreadystatechange=function(){4==m.readyState&&a("snap.ajax."+q+"."+m.status,h,m)},
4==m.readyState?m:(m.send(c),m)}};c.load=function(a,b,e){c.ajax(a,function(a){a=c.parse(a.responseText);e?b.call(e,a):b(a)})};return c.getElementByPoint=function(a,b){var c,e,f=(this.canvas,H.doc.elementFromPoint(a,b));if(H.win.opera&&"svg"==f.tagName){c=f;e=c.getBoundingClientRect();c=c.ownerDocument;var h=c.body,m=c.documentElement;c=e.top+(g.win.pageYOffset||m.scrollTop||h.scrollTop)-(m.clientTop||h.clientTop||0);e=e.left+(g.win.pageXOffset||m.scrollLeft||h.scrollLeft)-(m.clientLeft||h.clientLeft||
0);h=f.createSVGRect();h.x=a-e;h.y=b-c;h.width=h.height=1;c=f.getIntersectionList(h,null);c.length&&(f=c[c.length-1])}return f?F(f):null},c.plugin=function(a){a(c,z,I,H,E)},H.win.Snap=c,c}(b||this);return e.plugin(function(e,h,l,t,x){function f(a,b){if(null==b){var c=!0;if(b=a.node.getAttribute("linearGradient"==a.type||"radialGradient"==a.type?"gradientTransform":"pattern"==a.type?"patternTransform":"transform"),!b)return new e.Matrix;b=e._.svgTransform2string(b)}else b=e._.rgTransform.test(b)?z(b).replace(/\.{3}|\u2026/g,
a._.transform||""):e._.svgTransform2string(b),B(b,"array")&&(b=e.path?e.path.toString.call(b):z(b)),a._.transform=b;var f=e._.transform2matrix(b,a.getBBox(1));return c?f:void(a.matrix=f)}function m(a){function b(a,b){var c=G(a.node,b);(c=(c=c&&c.match(h))&&c[2])&&"#"==c.charAt()&&(c=c.substring(1),c&&(m[c]=(m[c]||[]).concat(function(c){var e={};e[b]=URL(c);G(a.node,e)})))}function c(a){var b=G(a.node,"xlink:href");b&&"#"==b.charAt()&&(b=b.substring(1),b&&(m[b]=(m[b]||[]).concat(function(b){a.attr("xlink:href",
"#"+b)})))}var e,f=a.selectAll("*"),h=/^\s*url\(("|'|)(.*)\1\)\s*$/;a=[];for(var m={},q=0,r=f.length;r>q;q++){e=f[q];b(e,"fill");b(e,"stroke");b(e,"filter");b(e,"mask");b(e,"clip-path");c(e);var l=G(e.node,"id");l&&(G(e.node,{id:e.id}),a.push({old:l,id:e.id}))}q=0;for(r=a.length;r>q;q++)if(e=m[a[q].old])for(f=0,l=e.length;l>f;f++)e[f](a[q].id)}function r(a,b,c){return function(e){e=e.slice(a,b);return 1==e.length&&(e=e[0]),c?c(e):e}}function y(a){return function(){var b=a?"<"+this.type:"",c=this.node.attributes,
e=this.node.childNodes;if(a)for(var f=0,h=c.length;h>f;f++)b+=" "+c[f].name+'="'+c[f].value.replace(/"/g,'\\"')+'"';if(e.length){a&&(b+=">");f=0;for(h=e.length;h>f;f++)3==e[f].nodeType?b+=e[f].nodeValue:1==e[f].nodeType&&(b+=D(e[f]).toString());a&&(b+="</"+this.type+">")}else a&&(b+="/>");return b}}h=h.prototype;var B=e.is,z=String,E=e._unit2px,G=e._.$,I=e._.make,F=e._.getSomeDefs,D=e._.wrap;h.getBBox=function(a){if(!e.Matrix||!e.path)return this.node.getBBox();var b=this,c=new e.Matrix;if(b.removed)return e._.box();
for(;"use"==b.type;)if(a||(c=c.add(b.transform().localMatrix.translate(b.attr("x")||0,b.attr("y")||0))),b.original)b=b.original;else var f=b.attr("xlink:href"),b=b.original=b.node.ownerDocument.getElementById(f.substring(f.indexOf("#")+1));var f=b._,h=e.path.get[b.type]||e.path.get.deflt;try{return a?(f.bboxwt=h?e.path.getBBox(b.realPath=h(b)):e._.box(b.node.getBBox()),e._.box(f.bboxwt)):(b.realPath=h(b),b.matrix=b.transform().localMatrix,f.bbox=e.path.getBBox(e.path.map(b.realPath,c.add(b.matrix))),
e._.box(f.bbox))}catch(W){return e._.box()}};var H=function(){return this.string};h.transform=function(a){var b=this._;if(null==a){var c;c=this;a=new e.Matrix(this.node.getCTM());for(var h=f(this),m=[h],q=new e.Matrix,r=h.toTransformString(),b=z(h)==z(this.matrix)?z(b.transform):r;"svg"!=c.type&&(c=c.parent());)m.push(f(c));for(c=m.length;c--;)q.add(m[c]);return{string:b,globalMatrix:a,totalMatrix:q,localMatrix:h,diffMatrix:a.clone().add(h.invert()),global:a.toTransformString(),total:q.toTransformString(),
local:r,toString:H}}return a instanceof e.Matrix?(this.matrix=a,this._.transform=a.toTransformString()):f(this,a),this.node&&("linearGradient"==this.type||"radialGradient"==this.type?G(this.node,{gradientTransform:this.matrix}):"pattern"==this.type?G(this.node,{patternTransform:this.matrix}):G(this.node,{transform:this.matrix})),this};h.parent=function(){return D(this.node.parentNode)};h.append=h.add=function(a){if(a){if("set"==a.type){var b=this;return a.forEach(function(a){b.add(a)}),this}a=D(a);
this.node.appendChild(a.node);a.paper=this.paper}return this};h.appendTo=function(a){return a&&(a=D(a),a.append(this)),this};h.prepend=function(a){if(a){if("set"==a.type){var b,c=this;return a.forEach(function(a){b?b.after(a):c.prepend(a);b=a}),this}a=D(a);var e=a.parent();this.node.insertBefore(a.node,this.node.firstChild);this.add&&this.add();a.paper=this.paper;this.parent()&&this.parent().add();e&&e.add()}return this};h.prependTo=function(a){return a=D(a),a.prepend(this),this};h.before=function(a){if("set"==
a.type){var b=this;return a.forEach(function(a){var c=a.parent();b.node.parentNode.insertBefore(a.node,b.node);c&&c.add()}),this.parent().add(),this}a=D(a);var c=a.parent();return this.node.parentNode.insertBefore(a.node,this.node),this.parent()&&this.parent().add(),c&&c.add(),a.paper=this.paper,this};h.after=function(a){a=D(a);var b=a.parent();return this.node.nextSibling?this.node.parentNode.insertBefore(a.node,this.node.nextSibling):this.node.parentNode.appendChild(a.node),this.parent()&&this.parent().add(),
b&&b.add(),a.paper=this.paper,this};h.insertBefore=function(a){a=D(a);var b=this.parent();return a.node.parentNode.insertBefore(this.node,a.node),this.paper=a.paper,b&&b.add(),a.parent()&&a.parent().add(),this};h.insertAfter=function(a){a=D(a);var b=this.parent();return a.node.parentNode.insertBefore(this.node,a.node.nextSibling),this.paper=a.paper,b&&b.add(),a.parent()&&a.parent().add(),this};h.remove=function(){var a=this.parent();return this.node.parentNode&&this.node.parentNode.removeChild(this.node),
delete this.paper,this.removed=!0,a&&a.add(),this};h.select=function(a){return D(this.node.querySelector(a))};h.selectAll=function(a){a=this.node.querySelectorAll(a);for(var b=(e.set||Array)(),c=0;c<a.length;c++)b.push(D(a[c]));return b};h.asPX=function(a,b){return null==b&&(b=this.attr(a)),+E(this,a,b)};h.use=function(){var a,b=this.node.id;return b||(b=this.id,G(this.node,{id:b})),a="linearGradient"==this.type||"radialGradient"==this.type||"pattern"==this.type?I(this.type,this.node.parentNode):
I("use",this.node.parentNode),G(a.node,{"xlink:href":"#"+b}),a.original=this,a};h.clone=function(){var a=D(this.node.cloneNode(!0));return G(a.node,"id")&&G(a.node,{id:a.id}),m(a),a.insertAfter(this),a};h.toDefs=function(){return F(this).appendChild(this.node),this};h.pattern=h.toPattern=function(a,b,c,e){var f=I("pattern",F(this));return null==a&&(a=this.getBBox()),B(a,"object")&&"x"in a&&(b=a.y,c=a.width,e=a.height,a=a.x),G(f.node,{x:a,y:b,width:c,height:e,patternUnits:"userSpaceOnUse",id:f.id,
viewBox:[a,b,c,e].join(" ")}),f.node.appendChild(this.node),f};h.marker=function(a,b,c,e,f,h){var m=I("marker",F(this));return null==a&&(a=this.getBBox()),B(a,"object")&&"x"in a&&(b=a.y,c=a.width,e=a.height,f=a.refX||a.cx,h=a.refY||a.cy,a=a.x),G(m.node,{viewBox:[a,b,c,e].join(" "),markerWidth:c,markerHeight:e,orient:"auto",refX:f||0,refY:h||0,id:m.id}),m.node.appendChild(this.node),m};var M=function(a,b,e,f){"function"!=typeof e||e.length||(f=e,e=c.linear);this.attr=a;this.dur=b;e&&(this.easing=e);
f&&(this.callback=f)};e._.Animation=M;e.animation=function(a,b,c,e){return new M(a,b,c,e)};h.inAnim=function(){var a=[],b;for(b in this.anims)this.anims.hasOwnProperty(b)&&!function(b){a.push({anim:new M(b._attrs,b.dur,b.easing,b._callback),mina:b,curStatus:b.status(),status:function(a){return b.status(a)},stop:function(){b.stop()}})}(this.anims[b]);return a};e.animate=function(b,e,f,h,m,q){"function"!=typeof m||m.length||(q=m,m=c.linear);var r=c.time();b=c(b,e,r,r+h,c.time,f,m);return q&&a.once("mina.finish."+
b.id,q),b};h.stop=function(){for(var a=this.inAnim(),b=0,c=a.length;c>b;b++)a[b].stop();return this};h.animate=function(b,e,f,h){"function"!=typeof f||f.length||(h=f,f=c.linear);b instanceof M&&(h=b.callback,f=b.easing,e=b.dur,b=b.attr);var m,q,l,y,t=[],x=[],D={},E=this,F;for(F in b)if(b.hasOwnProperty(F)){E.equal?(y=E.equal(F,z(b[F])),m=y.from,q=y.to,l=y.f):(m=+E.attr(F),q=+b[F]);var G=B(m,"array")?m.length:1;D[F]=r(t.length,t.length+G,l);t=t.concat(m);x=x.concat(q)}m=c.time();var H=c(t,x,m,m+e,
c.time,function(a){var b={},c;for(c in D)D.hasOwnProperty(c)&&(b[c]=D[c](a));E.attr(b)},f);return E.anims[H.id]=H,H._attrs=b,H._callback=h,a("snap.animcreated."+E.id,H),a.once("mina.finish."+H.id,function(){delete E.anims[H.id];h&&h.call(E)}),a.once("mina.stop."+H.id,function(){delete E.anims[H.id]}),E};var N={};h.data=function(b,c){var f=N[this.id]=N[this.id]||{};if(0==arguments.length)return a("snap.data.get."+this.id,this,f,null),f;if(1==arguments.length){if(e.is(b,"object")){for(var h in b)b.hasOwnProperty(h)&&
this.data(h,b[h]);return this}return a("snap.data.get."+this.id,this,f[b],b),f[b]}return f[b]=c,a("snap.data.set."+this.id,this,c,b),this};h.removeData=function(a){return null==a?N[this.id]={}:N[this.id]&&delete N[this.id][a],this};h.outerSVG=h.toString=y(1);h.innerSVG=y();h.toDataURL=function(){if(b&&b.btoa){var a=this.getBBox(),a=e.format('<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="{width}" height="{height}" viewBox="{x} {y} {width} {height}">{contents}</svg>',
{x:+a.x.toFixed(3),y:+a.y.toFixed(3),width:+a.width.toFixed(3),height:+a.height.toFixed(3),contents:this.outerSVG()});return"data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(a)))}};x.prototype.select=h.select;x.prototype.selectAll=h.selectAll}),e.plugin(function(a){function b(a,b,e,f,h,l){return null==b&&"[object SVGMatrix]"==c.call(a)?(this.a=a.a,this.b=a.b,this.c=a.c,this.d=a.d,this.e=a.e,void(this.f=a.f)):void(null!=a?(this.a=+a,this.b=+b,this.c=+e,this.d=+f,this.e=+h,this.f=+l):(this.a=
1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0))}var c=Object.prototype.toString,e=String,f=Math;!function(c){function h(a){return a[0]*a[0]+a[1]*a[1]}function r(a){var b=f.sqrt(h(a));a[0]&&(a[0]/=b);a[1]&&(a[1]/=b)}c.add=function(a,c,e,f,h,m){var r=[[],[],[]],q=[[this.a,this.c,this.e],[this.b,this.d,this.f],[0,0,1]];c=[[a,e,h],[c,f,m],[0,0,1]];a&&a instanceof b&&(c=[[a.a,a.c,a.e],[a.b,a.d,a.f],[0,0,1]]);for(a=0;3>a;a++)for(e=0;3>e;e++){for(f=h=0;3>f;f++)h+=q[a][f]*c[f][e];r[a][e]=h}return this.a=
r[0][0],this.b=r[1][0],this.c=r[0][1],this.d=r[1][1],this.e=r[0][2],this.f=r[1][2],this};c.invert=function(){var a=this.a*this.d-this.b*this.c;return new b(this.d/a,-this.b/a,-this.c/a,this.a/a,(this.c*this.f-this.d*this.e)/a,(this.b*this.e-this.a*this.f)/a)};c.clone=function(){return new b(this.a,this.b,this.c,this.d,this.e,this.f)};c.translate=function(a,b){return this.add(1,0,0,1,a,b)};c.scale=function(a,b,c,e){return null==b&&(b=a),(c||e)&&this.add(1,0,0,1,c,e),this.add(a,0,0,b,0,0),(c||e)&&this.add(1,
0,0,1,-c,-e),this};c.rotate=function(b,c,e){b=a.rad(b);c=c||0;e=e||0;var h=+f.cos(b).toFixed(9);b=+f.sin(b).toFixed(9);return this.add(h,b,-b,h,c,e),this.add(1,0,0,1,-c,-e)};c.x=function(a,b){return a*this.a+b*this.c+this.e};c.y=function(a,b){return a*this.b+b*this.d+this.f};c.get=function(a){return+this[e.fromCharCode(97+a)].toFixed(4)};c.toString=function(){return"matrix("+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)].join()+")"};c.offset=function(){return[this.e.toFixed(4),
this.f.toFixed(4)]};c.determinant=function(){return this.a*this.d-this.b*this.c};c.split=function(){var b={};b.dx=this.e;b.dy=this.f;var c=[[this.a,this.c],[this.b,this.d]];b.scalex=f.sqrt(h(c[0]));r(c[0]);b.shear=c[0][0]*c[1][0]+c[0][1]*c[1][1];c[1]=[c[1][0]-c[0][0]*b.shear,c[1][1]-c[0][1]*b.shear];b.scaley=f.sqrt(h(c[1]));r(c[1]);b.shear/=b.scaley;0>this.determinant()&&(b.scalex=-b.scalex);var e=-c[0][1],c=c[1][1];return 0>c?(b.rotate=a.deg(f.acos(c)),0>e&&(b.rotate=360-b.rotate)):b.rotate=a.deg(f.asin(e)),
b.isSimple=!(+b.shear.toFixed(9)||b.scalex.toFixed(9)!=b.scaley.toFixed(9)&&b.rotate),b.isSuperSimple=!+b.shear.toFixed(9)&&b.scalex.toFixed(9)==b.scaley.toFixed(9)&&!b.rotate,b.noRotation=!+b.shear.toFixed(9)&&!b.rotate,b};c.toTransformString=function(a){a=a||this.split();return+a.shear.toFixed(9)?"m"+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)]:(a.scalex=+a.scalex.toFixed(4),a.scaley=+a.scaley.toFixed(4),a.rotate=+a.rotate.toFixed(4),(a.dx||a.dy?"t"+[+a.dx.toFixed(4),
+a.dy.toFixed(4)]:"")+(1!=a.scalex||1!=a.scaley?"s"+[a.scalex,a.scaley,0,0]:"")+(a.rotate?"r"+[+a.rotate.toFixed(4),0,0]:""))}}(b.prototype);a.Matrix=b;a.matrix=function(a,c,e,f,h,l){return new b(a,c,e,f,h,l)}}),e.plugin(function(b,c,e,t,x){function f(e){return function(f){if(a.stop(),f instanceof x&&1==f.node.childNodes.length&&("radialGradient"==f.node.firstChild.tagName||"linearGradient"==f.node.firstChild.tagName||"pattern"==f.node.firstChild.tagName)&&(f=f.node.firstChild,G(this).appendChild(f),
f=z(f)),f instanceof c)if("radialGradient"==f.type||"linearGradient"==f.type||"pattern"==f.type){f.node.id||F(f.node,{id:f.id});var h=D(f.node.id)}else h=f.attr(e);else if(h=b.color(f),h.error){var m=b(G(this).ownerSVGElement).gradient(f);m?(m.node.id||F(m.node,{id:m.id}),h=D(m.node.id)):h=f}else h=H(h);f={};f[e]=h;F(this.node,f);this.node.style[e]=N}}function h(b){a.stop();b==+b&&(b+="px");this.node.style.fontSize=b}function r(a){var b=[];a=a.childNodes;for(var c=0,e=a.length;e>c;c++){var f=a[c];
3==f.nodeType&&b.push(f.nodeValue);"tspan"==f.tagName&&b.push(1==f.childNodes.length&&3==f.firstChild.nodeType?f.firstChild.nodeValue:r(f))}return b}function l(){return a.stop(),this.node.style.fontSize}var B=b._.make,z=b._.wrap,E=b.is,G=b._.getSomeDefs,I=/^url\(#?([^)]+)\)$/,F=b._.$,D=b.url,H=String,M=b._.separator,N="";a.on("snap.util.attr.mask",function(b){if(b instanceof c||b instanceof x){if(a.stop(),b instanceof x&&1==b.node.childNodes.length&&(b=b.node.firstChild,G(this).appendChild(b),b=z(b)),
"mask"==b.type)var e=b;else e=B("mask",G(this)),e.node.appendChild(b.node);!e.node.id&&F(e.node,{id:e.id});F(this.node,{mask:D(e.id)})}});(function(b){a.on("snap.util.attr.clip",b);a.on("snap.util.attr.clip-path",b);a.on("snap.util.attr.clipPath",b)})(function(b){if(b instanceof c||b instanceof x){if(a.stop(),"clipPath"==b.type)var e=b;else e=B("clipPath",G(this)),e.node.appendChild(b.node),!e.node.id&&F(e.node,{id:e.id});F(this.node,{"clip-path":D(e.node.id||e.id)})}});a.on("snap.util.attr.fill",
f("fill"));a.on("snap.util.attr.stroke",f("stroke"));var L=/^([lr])(?:\(([^)]*)\))?(.*)$/i;a.on("snap.util.grad.parse",function(a){a=H(a);var b=a.match(L);if(!b)return null;a=b[1];var c=b[2],b=b[3];return c=c.split(/\s*,\s*/).map(function(a){return+a==a?+a:a}),1==c.length&&0==c[0]&&(c=[]),b=b.split("-"),b=b.map(function(a){a=a.split(":");var b={color:a[0]};return a[1]&&(b.offset=parseFloat(a[1])),b}),{type:a,params:c,stops:b}});a.on("snap.util.attr.d",function(c){a.stop();E(c,"array")&&E(c[0],"array")&&
(c=b.path.toString.call(c));c=H(c);c.match(/[ruo]/i)&&(c=b.path.toAbsolute(c));F(this.node,{d:c})})(-1);a.on("snap.util.attr.#text",function(b){a.stop();b=H(b);for(b=t.doc.createTextNode(b);this.node.firstChild;)this.node.removeChild(this.node.firstChild);this.node.appendChild(b)})(-1);a.on("snap.util.attr.path",function(b){a.stop();this.attr({d:b})})(-1);a.on("snap.util.attr.class",function(b){a.stop();this.node.className.baseVal=b})(-1);a.on("snap.util.attr.viewBox",function(b){b=E(b,"object")&&
"x"in b?[b.x,b.y,b.width,b.height].join(" "):E(b,"array")?b.join(" "):b;F(this.node,{viewBox:b});a.stop()})(-1);a.on("snap.util.attr.transform",function(b){this.transform(b);a.stop()})(-1);a.on("snap.util.attr.r",function(b){"rect"==this.type&&(a.stop(),F(this.node,{rx:b,ry:b}))})(-1);a.on("snap.util.attr.textpath",function(b){if(a.stop(),"text"==this.type){var e,f;if(!b&&this.textPath){for(f=this.textPath;f.node.firstChild;)this.node.appendChild(f.node.firstChild);return f.remove(),void delete this.textPath}E(b,
"string")?(e=G(this),b=z(e.parentNode).path(b),e.appendChild(b.node),e=b.id,b.attr({id:e})):(b=z(b),b instanceof c&&(e=b.attr("id"),e||(e=b.id,b.attr({id:e}))));if(e)if(f=this.textPath,b=this.node,f)f.attr({"xlink:href":"#"+e});else{for(f=F("textPath",{"xlink:href":"#"+e});b.firstChild;)f.appendChild(b.firstChild);b.appendChild(f);this.textPath=z(f)}}})(-1);a.on("snap.util.attr.text",function(b){if("text"==this.type){for(var c=this.node,e=function(a){var b=F("tspan");if(E(a,"array"))for(var c=0;c<
a.length;c++)b.appendChild(e(a[c]));else b.appendChild(t.doc.createTextNode(a));return b.normalize&&b.normalize(),b};c.firstChild;)c.removeChild(c.firstChild);for(b=e(b);b.firstChild;)c.appendChild(b.firstChild)}a.stop()})(-1);a.on("snap.util.attr.fontSize",h)(-1);a.on("snap.util.attr.font-size",h)(-1);a.on("snap.util.getattr.transform",function(){return a.stop(),this.transform()})(-1);a.on("snap.util.getattr.textpath",function(){return a.stop(),this.textPath})(-1);(function(){function c(c){return function(){a.stop();
var e=t.doc.defaultView.getComputedStyle(this.node,null).getPropertyValue("marker-"+c);return"none"==e?e:b(t.doc.getElementById(e.match(I)[1]))}}function e(b){return function(c){a.stop();var e="marker"+b.charAt(0).toUpperCase()+b.substring(1);if(""==c||!c)return void(this.node.style[e]="none");if("marker"==c.type){var f=c.node.id;return f||F(c.node,{id:c.id}),void(this.node.style[e]=D(f))}}}a.on("snap.util.getattr.marker-end",c("end"))(-1);a.on("snap.util.getattr.markerEnd",c("end"))(-1);a.on("snap.util.getattr.marker-start",
c("start"))(-1);a.on("snap.util.getattr.markerStart",c("start"))(-1);a.on("snap.util.getattr.marker-mid",c("mid"))(-1);a.on("snap.util.getattr.markerMid",c("mid"))(-1);a.on("snap.util.attr.marker-end",e("end"))(-1);a.on("snap.util.attr.markerEnd",e("end"))(-1);a.on("snap.util.attr.marker-start",e("start"))(-1);a.on("snap.util.attr.markerStart",e("start"))(-1);a.on("snap.util.attr.marker-mid",e("mid"))(-1);a.on("snap.util.attr.markerMid",e("mid"))(-1)})();a.on("snap.util.getattr.r",function(){return"rect"==
this.type&&F(this.node,"rx")==F(this.node,"ry")?(a.stop(),F(this.node,"rx")):void 0})(-1);a.on("snap.util.getattr.text",function(){if("text"==this.type||"tspan"==this.type){a.stop();var b=r(this.node);return 1==b.length?b[0]:b}})(-1);a.on("snap.util.getattr.#text",function(){return this.node.textContent})(-1);a.on("snap.util.getattr.viewBox",function(){a.stop();var c=F(this.node,"viewBox");return c?(c=c.split(M),b._.box(+c[0],+c[1],+c[2],+c[3])):void 0})(-1);a.on("snap.util.getattr.points",function(){var b=
F(this.node,"points");return a.stop(),b?b.split(M):void 0})(-1);a.on("snap.util.getattr.path",function(){var b=F(this.node,"d");return a.stop(),b})(-1);a.on("snap.util.getattr.class",function(){return this.node.className.baseVal})(-1);a.on("snap.util.getattr.fontSize",l)(-1);a.on("snap.util.getattr.font-size",l)(-1)}),e.plugin(function(a,b){var c=/\S+/g,e=String,f=b.prototype;f.addClass=function(a){var b,f,h,q=e(a||"").match(c)||[];a=this.node;var l=a.className.baseVal,t=l.match(c)||[];if(q.length){for(b=
0;h=q[b++];)f=t.indexOf(h),~f||t.push(h);b=t.join(" ");l!=b&&(a.className.baseVal=b)}return this};f.removeClass=function(a){var b,f,h=e(a||"").match(c)||[];a=this.node;var q=a.className.baseVal,l=q.match(c)||[];if(l.length){for(b=0;f=h[b++];)f=l.indexOf(f),~f&&l.splice(f,1);b=l.join(" ");q!=b&&(a.className.baseVal=b)}return this};f.hasClass=function(a){return!!~(this.node.className.baseVal.match(c)||[]).indexOf(a)};f.toggleClass=function(a,b){if(null!=b)return b?this.addClass(a):this.removeClass(a);
var e,f,h,m,q=(a||"").match(c)||[],l=this.node,t=l.className.baseVal,x=t.match(c)||[];for(e=0;h=q[e++];)f=x.indexOf(h),~f?x.splice(f,1):x.push(h);return m=x.join(" "),t!=m&&(l.className.baseVal=m),this}}),e.plugin(function(){function b(a){return a}function c(a){return function(b){return+b.toFixed(3)+a}}var e={"+":function(a,b){return a+b},"-":function(a,b){return a-b},"/":function(a,b){return a/b},"*":function(a,b){return a*b}},t=String,x=/[a-z]+$/i,q=/^\s*([+\-\/*])\s*=\s*([\d.eE+\-]+)\s*([^\d\s]+)?\s*$/;
a.on("snap.util.attr",function(b){var c=t(b).match(q);if(c){var f=a.nt(),f=f.substring(f.lastIndexOf(".")+1),h=this.attr(f),m={};a.stop();var l=c[3]||"",G=h.match(x),I=e[c[1]];(G&&G==l?b=I(parseFloat(h),+c[2]):(h=this.asPX(f),b=I(this.asPX(f),this.asPX(f,c[2]+l))),isNaN(h)||isNaN(b))||(m[f]=b,this.attr(m))}})(-10);a.on("snap.util.equal",function(f,h){var m=t(this.attr(f)||""),r=t(h).match(q);if(r){a.stop();var l=r[3]||"",E=m.match(x),G=e[r[1]];return E&&E==l?{from:parseFloat(m),to:G(parseFloat(m),
+r[2]),f:c(E)}:(m=this.asPX(f),{from:m,to:G(m,this.asPX(f,r[2]+l)),f:b})}})(-10)}),e.plugin(function(c,e,l,t){var f=l.prototype,h=c.is;f.rect=function(a,b,c,e,f,m){var r;return null==m&&(m=f),h(a,"object")&&"[object Object]"==a?r=a:null!=a&&(r={x:a,y:b,width:c,height:e},null!=f&&(r.rx=f,r.ry=m)),this.el("rect",r)};f.circle=function(a,b,c){var e;return h(a,"object")&&"[object Object]"==a?e=a:null!=a&&(e={cx:a,cy:b,r:c}),this.el("circle",e)};var m=function(){function a(){this.parentNode.removeChild(this)}
return function(b,c){var e=t.doc.createElement("img"),f=t.doc.body;e.style.cssText="position:absolute;left:-9999em;top:-9999em";e.onload=function(){c.call(e);e.onload=e.onerror=null;f.removeChild(e)};e.onerror=a;f.appendChild(e);e.src=b}}();f.image=function(a,b,e,f,q){var r=this.el("image");if(h(a,"object")&&"src"in a)r.attr(a);else if(null!=a){var l={"xlink:href":a,preserveAspectRatio:"none"};null!=b&&null!=e&&(l.x=b,l.y=e);null!=f&&null!=q?(l.width=f,l.height=q):m(a,function(){c._.$(r.node,{width:this.offsetWidth,
height:this.offsetHeight})});c._.$(r.node,l)}return r};f.ellipse=function(a,b,c,e){var f;return h(a,"object")&&"[object Object]"==a?f=a:null!=a&&(f={cx:a,cy:b,rx:c,ry:e}),this.el("ellipse",f)};f.path=function(a){var b;return h(a,"object")&&!h(a,"array")?b=a:a&&(b={d:a}),this.el("path",b)};f.group=f.g=function(a){var b=this.el("g");return 1==arguments.length&&a&&!a.type?b.attr(a):arguments.length&&b.add(Array.prototype.slice.call(arguments,0)),b};f.svg=function(a,b,c,e,f,m,q,l){var r={};return h(a,
"object")&&null==b?r=a:(null!=a&&(r.x=a),null!=b&&(r.y=b),null!=c&&(r.width=c),null!=e&&(r.height=e),null!=f&&null!=m&&null!=q&&null!=l&&(r.viewBox=[f,m,q,l])),this.el("svg",r)};f.mask=function(a){var b=this.el("mask");return 1==arguments.length&&a&&!a.type?b.attr(a):arguments.length&&b.add(Array.prototype.slice.call(arguments,0)),b};f.ptrn=function(a,b,c,e,f,m,q,l){if(h(a,"object"))var r=a;else r={patternUnits:"userSpaceOnUse"},a&&(r.x=a),b&&(r.y=b),null!=c&&(r.width=c),null!=e&&(r.height=e),r.viewBox=
null!=f&&null!=m&&null!=q&&null!=l?[f,m,q,l]:[a||0,b||0,c||0,e||0];return this.el("pattern",r)};f.use=function(a){return null!=a?(a instanceof e&&(a.attr("id")||a.attr({id:c._.id(a)}),a=a.attr("id")),"#"==String(a).charAt()&&(a=a.substring(1)),this.el("use",{"xlink:href":"#"+a})):e.prototype.use.call(this)};f.symbol=function(a,b,c,e){var f={};return null!=a&&null!=b&&null!=c&&null!=e&&(f.viewBox=[a,b,c,e]),this.el("symbol",f)};f.text=function(a,b,c){var e={};return h(a,"object")?e=a:null!=a&&(e={x:a,
y:b,text:c||""}),this.el("text",e)};f.line=function(a,b,c,e){var f={};return h(a,"object")?f=a:null!=a&&(f={x1:a,x2:c,y1:b,y2:e}),this.el("line",f)};f.polyline=function(a){1<arguments.length&&(a=Array.prototype.slice.call(arguments,0));var b={};return h(a,"object")&&!h(a,"array")?b=a:null!=a&&(b={points:a}),this.el("polyline",b)};f.polygon=function(a){1<arguments.length&&(a=Array.prototype.slice.call(arguments,0));var b={};return h(a,"object")&&!h(a,"array")?b=a:null!=a&&(b={points:a}),this.el("polygon",
b)};(function(){function e(){return this.selectAll("stop")}function h(a,b){var e=x("stop"),f={offset:+b+"%"};return a=c.color(a),f["stop-color"]=a.hex,1>a.opacity&&(f["stop-opacity"]=a.opacity),x(e,f),this.node.appendChild(e),this}function m(){if("linearGradient"==this.type){var a=x(this.node,"x1")||0,b=x(this.node,"x2")||1,e=x(this.node,"y1")||0,f=x(this.node,"y2")||0;return c._.box(a,e,math.abs(b-a),math.abs(f-e))}a=this.node.r||0;return c._.box((this.node.cx||.5)-a,(this.node.cy||.5)-a,2*a,2*a)}
function q(b,c){function e(a,b){for(var c=(b-q)/(a-r),e=r;a>e;e++)m[e].offset=+(+q+c*(e-r)).toFixed(2);r=a;q=b}var f,h=a("snap.util.grad.parse",null,c).firstDefined();if(!h)return null;h.params.unshift(b);f="l"==h.type.toLowerCase()?l.apply(0,h.params):t.apply(0,h.params);h.type!=h.type.toLowerCase()&&x(f.node,{gradientUnits:"userSpaceOnUse"});var m=h.stops,h=m.length,q=0,r=0;h--;for(var y=0;h>y;y++)"offset"in m[y]&&e(y,m[y].offset);m[h].offset=m[h].offset||100;e(h,m[h].offset);for(y=0;h>=y;y++){var B=
m[y];f.addStop(B.color,B.offset)}return f}function l(a,b,f,q,r){a=c._.make("linearGradient",a);return a.stops=e,a.addStop=h,a.getBBox=m,null!=b&&x(a.node,{x1:b,y1:f,x2:q,y2:r}),a}function t(a,b,f,q,r,l){a=c._.make("radialGradient",a);return a.stops=e,a.addStop=h,a.getBBox=m,null!=b&&x(a.node,{cx:b,cy:f,r:q}),null!=r&&null!=l&&x(a.node,{fx:r,fy:l}),a}var x=c._.$;f.gradient=function(a){return q(this.defs,a)};f.gradientLinear=function(a,b,c,e){return l(this.defs,a,b,c,e)};f.gradientRadial=function(a,
b,c,e,f){return t(this.defs,a,b,c,e,f)};f.toString=function(){var a,b=this.node.ownerDocument,e=b.createDocumentFragment(),b=b.createElement("div"),f=this.node.cloneNode(!0);return e.appendChild(b),b.appendChild(f),c._.$(f,{xmlns:"http://www.w3.org/2000/svg"}),a=b.innerHTML,e.removeChild(e.firstChild),a};f.toDataURL=function(){return b&&b.btoa?"data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(this))):void 0};f.clear=function(){for(var a,b=this.node.firstChild;b;)a=b.nextSibling,"defs"!=
b.tagName?b.parentNode.removeChild(b):f.clear.call({node:b}),b=a}})()}),e.plugin(function(a,b){function c(a){var b=c.ps=c.ps||{};return b[a]?b[a].sleep=100:b[a]={sleep:100},setTimeout(function(){for(var c in b)b[fa](c)&&c!=a&&(b[c].sleep--,!b[c].sleep&&delete b[c])}),b[a]}function e(a,b,c,e){return null==a&&(a=b=c=e=0),null==b&&(b=a.y,c=a.width,e=a.height,a=a.x),{x:a,y:b,width:c,w:c,height:e,h:e,x2:a+c,y2:b+e,cx:a+c/2,cy:b+e/2,r1:J.min(c,e)/2,r2:J.max(c,e)/2,r0:J.sqrt(c*c+e*e)/2,path:D(a,b,c,e),vb:[a,
b,c,e].join(" ")}}function f(){return this.join(",").replace(ba,"$1")}function h(a){a=pa(a);return a.toString=f,a}function m(a,b,c,e,f,h,m,q,r){if(null==r)a=G(a,b,c,e,f,h,m,q);else{if(0>r||G(a,b,c,e,f,h,m,q)<r)r=void 0;else{var l,t=.5,x=1-t;for(l=G(a,b,c,e,f,h,m,q,x);.01<Ba(l-r);)t/=2,x+=(r>l?1:-1)*t,l=G(a,b,c,e,f,h,m,q,x);r=x}a=y(a,b,c,e,f,h,m,q,r)}return a}function r(c,e){function f(a){return+(+a).toFixed(3)}return a._.cacher(function(a,h,q){a instanceof b&&(a=a.attr("d"));a=ka(a);for(var r,l,t,
x,B,z="",D={},E=0,G=0,U=a.length;U>G;G++){if(t=a[G],"M"==t[0])r=+t[1],l=+t[2];else{if(x=m(r,l,t[1],t[2],t[3],t[4],t[5],t[6]),E+x>h){if(e&&!D.start){if(B=m(r,l,t[1],t[2],t[3],t[4],t[5],t[6],h-E),z+=["C"+f(B.start.x),f(B.start.y),f(B.m.x),f(B.m.y),f(B.x),f(B.y)],q)return z;D.start=z;z=["M"+f(B.x),f(B.y)+"C"+f(B.n.x),f(B.n.y),f(B.end.x),f(B.end.y),f(t[5]),f(t[6])].join();E+=x;r=+t[5];l=+t[6];continue}if(!c&&!e)return m(r,l,t[1],t[2],t[3],t[4],t[5],t[6],h-E)}E+=x;r=+t[5];l=+t[6]}z+=t.shift()+t}return D.end=
z,c?E:e?D:y(r,l,t[0],t[1],t[2],t[3],t[4],t[5],1)},null,a._.clone)}function y(a,b,c,e,f,h,m,q,r){var l=1-r,t=ta(l,3),y=ta(l,2),x=r*r,B=x*r,z=t*a+3*y*r*c+3*l*r*r*f+B*m,t=t*b+3*y*r*e+3*l*r*r*h+B*q,y=a+2*r*(c-a)+x*(f-2*c+a),B=b+2*r*(e-b)+x*(h-2*e+b),E=c+2*r*(f-c)+x*(m-2*f+c),x=e+2*r*(h-e)+x*(q-2*h+e);a=l*a+r*c;b=l*b+r*e;f=l*f+r*m;h=l*h+r*q;q=90-180*J.atan2(y-E,B-x)/R;return{x:z,y:t,m:{x:y,y:B},n:{x:E,y:x},start:{x:a,y:b},end:{x:f,y:h},alpha:q}}function B(b,c,f,h,m,q,r,l){a.is(b,"array")||(b=[b,c,f,h,
m,q,r,l]);b=S.apply(null,b);return e(b.min.x,b.min.y,b.max.x-b.min.x,b.max.y-b.min.y)}function z(a,b,c){return b>=a.x&&b<=a.x+a.width&&c>=a.y&&c<=a.y+a.height}function E(a,b){return a=e(a),b=e(b),z(b,a.x,a.y)||z(b,a.x2,a.y)||z(b,a.x,a.y2)||z(b,a.x2,a.y2)||z(a,b.x,b.y)||z(a,b.x2,b.y)||z(a,b.x,b.y2)||z(a,b.x2,b.y2)||(a.x<b.x2&&a.x>b.x||b.x<a.x2&&b.x>a.x)&&(a.y<b.y2&&a.y>b.y||b.y<a.y2&&b.y>a.y)}function G(a,b,c,e,f,h,m,q,r){null==r&&(r=1);r=(1<r?1:0>r?0:r)/2;for(var l=[-.1252,.1252,-.3678,.3678,-.5873,
.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],t=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],y=0,x=0;12>x;x++)var B=r*l[x]+r,z=B*(B*(-3*a+9*c-9*f+3*m)+6*a-12*c+6*f)-3*a+3*c,B=B*(B*(-3*b+9*e-9*h+3*q)+6*b-12*e+6*h)-3*b+3*e,y=y+t[x]*J.sqrt(z*z+B*B);return r*y}function I(a,b,c){a=ka(a);b=ka(b);for(var e,f,h,m,q,r,l,t,x,z,D=c?0:[],H=0,M=a.length;M>H;H++){var F=a[H];if("M"==F[0])e=q=F[1],f=r=F[2];else{"C"==F[0]?(x=[e,f].concat(F.slice(1)),e=x[6],f=x[7]):(x=[e,f,e,f,q,r,q,r],
e=q,f=r);for(var F=0,w=b.length;w>F;F++){var U=b[F];if("M"==U[0])h=l=U[1],m=t=U[2];else{"C"==U[0]?(z=[h,m].concat(U.slice(1)),h=z[6],m=z[7]):(z=[h,m,h,m,l,t,l,t],h=l,m=t);var I=x,L=z,U=c,N=B(I),O=B(L);if(E(N,O)){for(var N=G.apply(0,I),O=G.apply(0,L),N=~~(N/8),O=~~(O/8),S=[],Ga=[],Ma={},sa=U?0:[],J=0;N+1>J;J++){var W=y.apply(0,I.concat(J/N));S.push({x:W.x,y:W.y,t:J/N})}for(J=0;O+1>J;J++)W=y.apply(0,L.concat(J/O)),Ga.push({x:W.x,y:W.y,t:J/O});for(J=0;N>J;J++)for(I=0;O>I;I++){var ma=S[J],pa=S[J+1],L=
Ga[I],W=Ga[I+1],R=.001>Ba(pa.x-ma.x)?"y":"x",ba=.001>Ba(W.x-L.x)?"y":"x",la;b:{la=ma.x;var ca=ma.y,fa=pa.x,ea=pa.y,Q=L.x,ia=L.y,ha=W.x,ja=W.y;if(!(T(la,fa)<aa(Q,ha)||aa(la,fa)>T(Q,ha)||T(ca,ea)<aa(ia,ja)||aa(ca,ea)>T(ia,ja))){var ta=(la-fa)*(ia-ja)-(ca-ea)*(Q-ha);if(ta){var Na=((la*ea-ca*fa)*(Q-ha)-(la-fa)*(Q*ja-ia*ha))/ta,ta=((la*ea-ca*fa)*(ia-ja)-(ca-ea)*(Q*ja-ia*ha))/ta,wa=+Na.toFixed(2),Oa=+ta.toFixed(2);if(!(wa<+aa(la,fa).toFixed(2)||wa>+T(la,fa).toFixed(2)||wa<+aa(Q,ha).toFixed(2)||wa>+T(Q,
ha).toFixed(2)||Oa<+aa(ca,ea).toFixed(2)||Oa>+T(ca,ea).toFixed(2)||Oa<+aa(ia,ja).toFixed(2)||Oa>+T(ia,ja).toFixed(2))){la={x:Na,y:ta};break b}}}la=void 0}la&&Ma[la.x.toFixed(4)]!=la.y.toFixed(4)&&(Ma[la.x.toFixed(4)]=la.y.toFixed(4),ma=ma.t+Ba((la[R]-ma[R])/(pa[R]-ma[R]))*(pa.t-ma.t),L=L.t+Ba((la[ba]-L[ba])/(W[ba]-L[ba]))*(W.t-L.t),0<=ma&&1>=ma&&0<=L&&1>=L&&(U?sa++:sa.push({x:la.x,y:la.y,t1:ma,t2:L})))}U=sa}else U=U?0:[];if(c)D+=U;else{N=0;for(O=U.length;O>N;N++)U[N].segment1=H,U[N].segment2=F,U[N].bez1=
x,U[N].bez2=z;D=D.concat(U)}}}}}return D}function F(a){var b=c(a);if(b.bbox)return pa(b.bbox);if(!a)return e();a=ka(a);for(var f,h=0,m=0,q=[],r=[],l=0,t=a.length;t>l;l++)(f=a[l],"M"==f[0])?(h=f[1],m=f[2],q.push(h),r.push(m)):(h=S(h,m,f[1],f[2],f[3],f[4],f[5],f[6]),q=q.concat(h.min.x,h.max.x),r=r.concat(h.min.y,h.max.y),h=f[5],m=f[6]);a=aa.apply(0,q);f=aa.apply(0,r);q=T.apply(0,q);r=T.apply(0,r);r=e(a,f,q-a,r-f);return b.bbox=pa(r),r}function D(a,b,c,e,h){if(h)return[["M",+a+ +h,b],["l",c-2*h,0],["a",
h,h,0,0,1,h,h],["l",0,e-2*h],["a",h,h,0,0,1,-h,h],["l",2*h-c,0],["a",h,h,0,0,1,-h,-h],["l",0,2*h-e],["a",h,h,0,0,1,h,-h],["z"]];a=[["M",a,b],["l",c,0],["l",0,e],["l",-c,0],["z"]];return a.toString=f,a}function H(a,b,c,e,h){if(null==h&&null==e&&(e=c),a=+a,b=+b,c=+c,e=+e,null!=h){var m=Math.PI/180;a=[["M",a+c*Math.cos(-e*m),b+c*Math.sin(-e*m)],["A",c,c,0,+(180<h-e),0,a+c*Math.cos(-h*m),b+c*Math.sin(-h*m)]]}else a=[["M",a,b],["m",0,-e],["a",c,e,0,1,1,0,2*e],["a",c,e,0,1,1,0,-2*e],["z"]];return a.toString=
f,a}function M(b){var e=c(b);if(e.abs)return h(e.abs);if(ma(b,"array")&&ma(b&&b[0],"array")||(b=a.parsePathString(b)),!b||!b.length)return[["M",0,0]];var m,q=[],r=0,l=0,t=0,y=0,x=0;"M"==b[0][0]&&(r=+b[0][1],l=+b[0][2],t=r,y=l,x++,q[0]=["M",r,l]);for(var B,z=3==b.length&&"M"==b[0][0]&&"R"==b[1][0].toUpperCase()&&"Z"==b[2][0].toUpperCase(),D=x,E=b.length;E>D;D++){if(q.push(x=[]),B=b[D],m=B[0],m!=m.toUpperCase())switch(x[0]=m.toUpperCase(),x[0]){case "A":x[1]=B[1];x[2]=B[2];x[3]=B[3];x[4]=B[4];x[5]=
B[5];x[6]=+B[6]+r;x[7]=+B[7]+l;break;case "V":x[1]=+B[1]+l;break;case "H":x[1]=+B[1]+r;break;case "R":for(var G=[r,l].concat(B.slice(1)),F=2,M=G.length;M>F;F++)G[F]=+G[F]+r,G[++F]=+G[F]+l;q.pop();q=q.concat(sa(G,z));break;case "O":q.pop();G=H(r,l,B[1],B[2]);G.push(G[0]);q=q.concat(G);break;case "U":q.pop();q=q.concat(H(r,l,B[1],B[2],B[3]));x=["U"].concat(q[q.length-1].slice(-2));break;case "M":t=+B[1]+r,y=+B[2]+l;default:for(F=1,M=B.length;M>F;F++)x[F]=+B[F]+(F%2?r:l)}else if("R"==m)G=[r,l].concat(B.slice(1)),
q.pop(),q=q.concat(sa(G,z)),x=["R"].concat(B.slice(-2));else if("O"==m)q.pop(),G=H(r,l,B[1],B[2]),G.push(G[0]),q=q.concat(G);else if("U"==m)q.pop(),q=q.concat(H(r,l,B[1],B[2],B[3])),x=["U"].concat(q[q.length-1].slice(-2));else for(G=0,F=B.length;F>G;G++)x[G]=B[G];if(m=m.toUpperCase(),"O"!=m)switch(x[0]){case "Z":r=+t;l=+y;break;case "H":r=x[1];break;case "V":l=x[1];break;case "M":t=x[x.length-2],y=x[x.length-1];default:r=x[x.length-2],l=x[x.length-1]}}return q.toString=f,e.abs=h(q),q}function N(a,
b,c,e){return[a,b,c,e,c,e]}function L(a,b,c,e,f,h){var m=1/3,q=2/3;return[m*a+q*c,m*b+q*e,m*f+q*c,m*h+q*e,f,h]}function O(b,c,e,f,h,m,q,r,l,t){var y,x=120*R/180,B=R/180*(+h||0),z=[],D=a._.cacher(function(a,b,c){var e=a*J.cos(c)-b*J.sin(c);a=a*J.sin(c)+b*J.cos(c);return{x:e,y:a}});if(t)w=t[0],y=t[1],m=t[2],E=t[3];else{y=D(b,c,-B);b=y.x;c=y.y;y=D(r,l,-B);r=y.x;l=y.y;y=(J.cos(R/180*h),J.sin(R/180*h),(b-r)/2);w=(c-l)/2;E=y*y/(e*e)+w*w/(f*f);1<E&&(E=J.sqrt(E),e*=E,f*=E);var E=e*e,G=f*f,E=(m==q?-1:1)*J.sqrt(Ba((E*
G-E*w*w-G*y*y)/(E*w*w+G*y*y)));m=E*e*w/f+(b+r)/2;var E=E*-f*y/e+(c+l)/2,w=J.asin(((c-E)/f).toFixed(9));y=J.asin(((l-E)/f).toFixed(9));w=m>b?R-w:w;y=m>r?R-y:y;0>w&&(w=2*R+w);0>y&&(y=2*R+y);q&&w>y&&(w-=2*R);!q&&y>w&&(y-=2*R)}if(Ba(y-w)>x){var z=y,G=r,F=l;y=w+x*(q&&y>w?1:-1);r=m+e*J.cos(y);l=E+f*J.sin(y);z=O(r,l,e,f,h,0,q,G,F,[y,z,m,E])}m=y-w;h=J.cos(w);x=J.sin(w);q=J.cos(y);y=J.sin(y);m=J.tan(m/4);e=4/3*e*m;m*=4/3*f;f=[b,c];b=[b+e*x,c-m*h];c=[r+e*y,l-m*q];r=[r,l];if(b[0]=2*f[0]-b[0],b[1]=2*f[1]-b[1],
t)return[b,c,r].concat(z);z=[b,c,r].concat(z).join().split(",");t=[];r=0;for(l=z.length;l>r;r++)t[r]=r%2?D(z[r-1],z[r],B).y:D(z[r],z[r+1],B).x;return t}function S(a,b,c,e,f,h,m,q){for(var r,l,t,y,x,B,z,E=[],D=[[],[]],w=0;2>w;++w)(0==w?(l=6*a-12*c+6*f,r=-3*a+9*c-9*f+3*m,t=3*c-3*a):(l=6*b-12*e+6*h,r=-3*b+9*e-9*h+3*q,t=3*e-3*b),1E-12>Ba(r))?1E-12>Ba(l)||(y=-t/l,0<y&&1>y&&E.push(y)):(y=l*l-4*t*r,z=J.sqrt(y),0>y||(x=(-l+z)/(2*r),0<x&&1>x&&E.push(x),B=(-l-z)/(2*r),0<B&&1>B&&E.push(B)));for(t=l=E.length;l--;)y=
E[l],r=1-y,D[0][l]=r*r*r*a+3*r*r*y*c+3*r*y*y*f+y*y*y*m,D[1][l]=r*r*r*b+3*r*r*y*e+3*r*y*y*h+y*y*y*q;return D[0][t]=a,D[1][t]=b,D[0][t+1]=m,D[1][t+1]=q,D[0].length=D[1].length=t+2,{min:{x:aa.apply(0,D[0]),y:aa.apply(0,D[1])},max:{x:T.apply(0,D[0]),y:T.apply(0,D[1])}}}function ka(a,b){var e=!b&&c(a);if(!b&&e.curve)return h(e.curve);var f=M(a),m=b&&M(b),q={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},r={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},l=function(a,b,c){var e,f;if(!a)return["C",b.x,b.y,b.x,b.y,
b.x,b.y];switch(!(a[0]in{T:1,Q:1})&&(b.qx=b.qy=null),a[0]){case "M":b.X=a[1];b.Y=a[2];break;case "A":a=["C"].concat(O.apply(0,[b.x,b.y].concat(a.slice(1))));break;case "S":"C"==c||"S"==c?(e=2*b.x-b.bx,f=2*b.y-b.by):(e=b.x,f=b.y);a=["C",e,f].concat(a.slice(1));break;case "T":"Q"==c||"T"==c?(b.qx=2*b.x-b.qx,b.qy=2*b.y-b.qy):(b.qx=b.x,b.qy=b.y);a=["C"].concat(L(b.x,b.y,b.qx,b.qy,a[1],a[2]));break;case "Q":b.qx=a[1];b.qy=a[2];a=["C"].concat(L(b.x,b.y,a[1],a[2],a[3],a[4]));break;case "L":a=["C"].concat(N(b.x,
b.y,a[1],a[2]));break;case "H":a=["C"].concat(N(b.x,b.y,a[1],b.y));break;case "V":a=["C"].concat(N(b.x,b.y,b.x,a[1]));break;case "Z":a=["C"].concat(N(b.x,b.y,b.X,b.Y))}return a},t=function(a,b){if(7<a[b].length){a[b].shift();for(var c=a[b];c.length;)x[b]="A",m&&(B[b]="A"),a.splice(b++,0,["C"].concat(c.splice(0,6)));a.splice(b,1);G=T(f.length,m&&m.length||0)}},y=function(a,b,c,e,h){a&&b&&"M"==a[h][0]&&"M"!=b[h][0]&&(b.splice(h,0,["M",e.x,e.y]),c.bx=0,c.by=0,c.x=a[h][1],c.y=a[h][2],G=T(f.length,m&&
m.length||0))},x=[],B=[],z="",E="",D=0,G=T(f.length,m&&m.length||0);for(;G>D;D++){f[D]&&(z=f[D][0]);"C"!=z&&(x[D]=z,D&&(E=x[D-1]));f[D]=l(f[D],q,E);"A"!=x[D]&&"C"==z&&(x[D]="C");t(f,D);m&&(m[D]&&(z=m[D][0]),"C"!=z&&(B[D]=z,D&&(E=B[D-1])),m[D]=l(m[D],r,E),"A"!=B[D]&&"C"==z&&(B[D]="C"),t(m,D));y(f,m,q,r,D);y(m,f,r,q,D);var F=f[D],w=m&&m[D],H=F.length,I=m&&w.length;q.x=F[H-2];q.y=F[H-1];q.bx=ea(F[H-4])||q.x;q.by=ea(F[H-3])||q.y;r.bx=m&&(ea(w[I-4])||r.x);r.by=m&&(ea(w[I-3])||r.y);r.x=m&&w[I-2];r.y=m&&
w[I-1]}return m||(e.curve=h(f)),m?[f,m]:f}function sa(a,b){for(var c=[],e=0,f=a.length;f-2*!b>e;e+=2){var h=[{x:+a[e-2],y:+a[e-1]},{x:+a[e],y:+a[e+1]},{x:+a[e+2],y:+a[e+3]},{x:+a[e+4],y:+a[e+5]}];b?e?f-4==e?h[3]={x:+a[0],y:+a[1]}:f-2==e&&(h[2]={x:+a[0],y:+a[1]},h[3]={x:+a[2],y:+a[3]}):h[0]={x:+a[f-2],y:+a[f-1]}:f-4==e?h[3]=h[2]:e||(h[0]={x:+a[e],y:+a[e+1]});c.push(["C",(-h[0].x+6*h[1].x+h[2].x)/6,(-h[0].y+6*h[1].y+h[2].y)/6,(h[1].x+6*h[2].x-h[3].x)/6,(h[1].y+6*h[2].y-h[3].y)/6,h[2].x,h[2].y])}return c}
var W=b.prototype,ma=a.is,pa=a._.clone,fa="hasOwnProperty",ba=/,?([a-z]),?/gi,ea=parseFloat,J=Math,R=J.PI,aa=J.min,T=J.max,ta=J.pow,Ba=J.abs,ha=r(1),ca=r(),ja=r(0,1),ia=a._unit2px;a.path=c;a.path.getTotalLength=ha;a.path.getPointAtLength=ca;a.path.getSubpath=function(a,b,c){if(1E-6>this.getTotalLength(a)-c)return ja(a,b).end;a=ja(a,c,1);return b?ja(a,b).end:a};W.getTotalLength=function(){return this.node.getTotalLength?this.node.getTotalLength():void 0};W.getPointAtLength=function(a){return ca(this.attr("d"),
a)};W.getSubpath=function(b,c){return a.path.getSubpath(this.attr("d"),b,c)};a._.box=e;a.path.findDotsAtSegment=y;a.path.bezierBBox=B;a.path.isPointInsideBBox=z;a.closest=function(b,c,f,h){for(var m=100,q=e(b-m/2,c-m/2,m,m),r=[],l=f[0].hasOwnProperty("x")?function(a){return{x:f[a].x,y:f[a].y}}:function(a){return{x:f[a],y:h[a]}},t=0;1E6>=m&&!t;){for(var y=0,x=f.length;x>y;y++){var B=l(y);if(z(q,B.x,B.y)){t++;r.push(B);break}}t||(m*=2,q=e(b-m/2,c-m/2,m,m))}if(1E6!=m){for(var D,m=1/0,y=0,x=r.length;x>
y;y++)q=a.len(b,c,r[y].x,r[y].y),m>q&&(m=q,r[y].len=q,D=r[y]);return D}};a.path.isBBoxIntersect=E;a.path.intersection=function(a,b){return I(a,b)};a.path.intersectionNumber=function(a,b){return I(a,b,1)};a.path.isPointInside=function(a,b,c){var e=F(a);return z(e,b,c)&&1==I(a,[["M",b,c],["H",e.x2+10]],1)%2};a.path.getBBox=F;a.path.get={path:function(a){return a.attr("path")},circle:function(a){a=ia(a);return H(a.cx,a.cy,a.r)},ellipse:function(a){a=ia(a);return H(a.cx||0,a.cy||0,a.rx,a.ry)},rect:function(a){a=
ia(a);return D(a.x||0,a.y||0,a.width,a.height,a.rx,a.ry)},image:function(a){a=ia(a);return D(a.x||0,a.y||0,a.width,a.height)},line:function(a){return"M"+[a.attr("x1")||0,a.attr("y1")||0,a.attr("x2"),a.attr("y2")]},polyline:function(a){return"M"+a.attr("points")},polygon:function(a){return"M"+a.attr("points")+"z"},deflt:function(a){a=a.node.getBBox();return D(a.x,a.y,a.width,a.height)}};a.path.toRelative=function(b){var e=c(b),m=String.prototype.toLowerCase;if(e.rel)return h(e.rel);a.is(b,"array")&&
a.is(b&&b[0],"array")||(b=a.parsePathString(b));var q=[],r=0,l=0,t=0,y=0,x=0;"M"==b[0][0]&&(r=b[0][1],l=b[0][2],t=r,y=l,x++,q.push(["M",r,l]));for(var B=b.length;B>x;x++){var z=q[x]=[],D=b[x];if(D[0]!=m.call(D[0]))switch(z[0]=m.call(D[0]),z[0]){case "a":z[1]=D[1];z[2]=D[2];z[3]=D[3];z[4]=D[4];z[5]=D[5];z[6]=+(D[6]-r).toFixed(3);z[7]=+(D[7]-l).toFixed(3);break;case "v":z[1]=+(D[1]-l).toFixed(3);break;case "m":t=D[1],y=D[2];default:for(var E=1,G=D.length;G>E;E++)z[E]=+(D[E]-(E%2?r:l)).toFixed(3)}else for(q[x]=
[],"m"==D[0]&&(t=D[1]+r,y=D[2]+l),z=0,E=D.length;E>z;z++)q[x][z]=D[z];D=q[x].length;switch(q[x][0]){case "z":r=t;l=y;break;case "h":r+=+q[x][D-1];break;case "v":l+=+q[x][D-1];break;default:r+=+q[x][D-2],l+=+q[x][D-1]}}return q.toString=f,e.rel=h(q),q};a.path.toAbsolute=M;a.path.toCubic=ka;a.path.map=function(a,b){if(!b)return a;var c,e,f,h,m,q,r;a=ka(a);f=0;for(m=a.length;m>f;f++)for(r=a[f],h=1,q=r.length;q>h;h+=2)c=b.x(r[h],r[h+1]),e=b.y(r[h],r[h+1]),r[h]=c,r[h+1]=e;return a};a.path.toString=f;a.path.clone=
h}),e.plugin(function(b){var e=Math.max,f=Math.min,t=function(a){if(this.items=[],this.bindings={},this.length=0,this.type="set",a)for(var b=0,c=a.length;c>b;b++)a[b]&&(this[this.items.length]=this.items[this.items.length]=a[b],this.length++)},x=t.prototype;x.push=function(){for(var a,b,c=0,e=arguments.length;e>c;c++)(a=arguments[c])&&(b=this.items.length,this[b]=this.items[b]=a,this.length++);return this};x.pop=function(){return this.length&&delete this[this.length--],this.items.pop()};x.forEach=
function(a,b){for(var c=0,e=this.items.length;e>c&&!1!==a.call(b,this.items[c],c);c++);return this};x.animate=function(e,f,h,l){"function"!=typeof h||h.length||(l=h,h=c.linear);e instanceof b._.Animation&&(l=e.callback,h=e.easing,f=h.dur,e=e.attr);var m=arguments;if(b.is(e,"array")&&b.is(m[m.length-1],"array"))var q=!0;var r,t=function(){r?this.b=r:r=this.b},y=0,x=this,D=l&&function(){++y==x.length&&l.call(this)};return this.forEach(function(b,c){a.once("snap.animcreated."+b.id,t);q?m[c]&&b.animate.apply(b,
m[c]):b.animate(e,f,h,D)})};x.remove=function(){for(;this.length;)this.pop().remove();return this};x.bind=function(a,b,c){var e={};if("function"==typeof b)this.bindings[a]=b;else{var f=c||a;this.bindings[a]=function(a){e[f]=a;b.attr(e)}}return this};x.attr=function(a){var b={},c;for(c in a)this.bindings[c]?this.bindings[c](a[c]):b[c]=a[c];a=0;for(c=this.items.length;c>a;a++)this.items[a].attr(b);return this};x.clear=function(){for(;this.length;)this.pop()};x.splice=function(a,b){a=0>a?e(this.length+
a,0):a;b=e(0,f(this.length-a,b));var c,h=[],m=[],q=[];for(c=2;c<arguments.length;c++)q.push(arguments[c]);for(c=0;b>c;c++)m.push(this[a+c]);for(;c<this.length-a;c++)h.push(this[a+c]);var l=q.length;for(c=0;c<l+h.length;c++)this.items[a+c]=this[a+c]=l>c?q[c]:h[c-l];for(c=this.items.length=this.length-=b-l;this[c];)delete this[c++];return new t(m)};x.exclude=function(a){for(var b=0,c=this.length;c>b;b++)if(this[b]==a)return this.splice(b,1),!0;return!1};x.insertAfter=function(a){for(var b=this.items.length;b--;)this.items[b].insertAfter(a);
return this};x.getBBox=function(){for(var a=[],b=[],c=[],h=[],l=this.items.length;l--;)if(!this.items[l].removed){var t=this.items[l].getBBox();a.push(t.x);b.push(t.y);c.push(t.x+t.width);h.push(t.y+t.height)}return a=f.apply(0,a),b=f.apply(0,b),c=e.apply(0,c),h=e.apply(0,h),{x:a,y:b,x2:c,y2:h,width:c-a,height:h-b,cx:a+(c-a)/2,cy:b+(h-b)/2}};x.clone=function(a){a=new t;for(var b=0,c=this.items.length;c>b;b++)a.push(this.items[b].clone());return a};x.toString=function(){return"Snap\u2018s set"};x.type=
"set";b.Set=t;b.set=function(){var a=new t;return arguments.length&&a.push.apply(a,Array.prototype.slice.call(arguments,0)),a}}),e.plugin(function(b,c){function e(a){var b=a[0];switch(b.toLowerCase()){case "t":return[b,0,0];case "m":return[b,1,0,0,1,0,0];case "r":return 4==a.length?[b,0,a[2],a[3]]:[b,0];case "s":return 5==a.length?[b,1,1,a[3],a[4]]:3==a.length?[b,1,1]:[b,1]}}function f(a,c,f){c=I(c).replace(/\.{3}|\u2026/g,a);a=b.parseTransformString(a)||[];c=b.parseTransformString(c)||[];for(var h,
m,q,r,l=Math.max(a.length,c.length),t=[],x=[],z=0;l>z;z++){if(q=a[z]||e(c[z]),r=c[z]||e(q),q[0]!=r[0]||"r"==q[0].toLowerCase()&&(q[2]!=r[2]||q[3]!=r[3])||"s"==q[0].toLowerCase()&&(q[3]!=r[3]||q[4]!=r[4])){a=b._.transform2matrix(a,f());c=b._.transform2matrix(c,f());t=[["m",a.a,a.b,a.c,a.d,a.e,a.f]];x=[["m",c.a,c.b,c.c,c.d,c.e,c.f]];break}t[z]=[];x[z]=[];h=0;for(m=Math.max(q.length,r.length);m>h;h++)h in q&&(t[z][h]=q[h]),h in r&&(x[z][h]=r[h])}return{from:B(t),to:B(x),f:y(t)}}function h(a){return a}
function q(a){return function(b){return+b.toFixed(3)+a}}function m(a){return a.join(" ")}function r(a){return b.rgb(a[0],a[1],a[2])}function y(a){var b,c,e,f,h,m,q=0,r=[];b=0;for(c=a.length;c>b;b++){h="[";m=['"'+a[b][0]+'"'];e=1;for(f=a[b].length;f>e;e++)m[e]="val["+q++ +"]";h+=m+"]";r[b]=h}return Function("val","return Snap.path.toString.call(["+r+"])")}function B(a){for(var b=[],c=0,e=a.length;e>c;c++)for(var f=1,h=a[c].length;h>f;f++)b.push(a[c][f]);return b}function z(a,c){return b.is(a,"array")&&
b.is(c,"array")?a.toString()==c.toString():!1}var E={},G=/[a-z]+$/i,I=String;E.stroke=E.fill="colour";c.prototype.equal=function(b,c){return a("snap.util.equal",this,b,c).firstDefined()};a.on("snap.util.equal",function(a,c){var e,l,t=I(this.attr(a)||""),x=this;if(isFinite(parseFloat(t))&&isFinite(parseFloat(c)))return{from:parseFloat(t),to:parseFloat(c),f:h};if("colour"==E[a])return e=b.color(t),l=b.color(c),{from:[e.r,e.g,e.b,e.opacity],to:[l.r,l.g,l.b,l.opacity],f:r};if("viewBox"==a)return e=this.attr(a).vb.split(" ").map(Number),
l=c.split(" ").map(Number),{from:e,to:l,f:m};if("transform"==a||"gradientTransform"==a||"patternTransform"==a)return c instanceof b.Matrix&&(c=c.toTransformString()),b._.rgTransform.test(c)||(c=b._.svgTransform2string(c)),f(t,c,function(){return x.getBBox(1)});if("d"==a||"path"==a)return e=b.path.toCubic(t,c),{from:B(e[0]),to:B(e[1]),f:y(e[0])};if("points"==a)return e=I(t).split(b._.separator),l=I(c).split(b._.separator),{from:e,to:l,f:function(a){return a}};e=t.match(G);l=I(c).match(G);return e&&
z(e,l)?{from:parseFloat(t),to:parseFloat(c),f:q(e)}:{from:this.asPX(a),to:this.asPX(a,c),f:h}})}),e.plugin(function(b,c,e,t){var f=c.prototype,h="createTouch"in t.doc;c="click dblclick mousedown mousemove mouseout mouseover mouseup touchstart touchmove touchend touchcancel".split(" ");var m={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},r=function(a,b){var c="y"==a?"scrollTop":"scrollLeft",e=b&&b.node?b.node.ownerDocument:t.doc;return e[c in e.documentElement?"documentElement":
"body"][c]},l=function(){return this.originalEvent.preventDefault()},B=function(){return this.originalEvent.stopPropagation()},z=function(a,b,c,e){var f=h&&m[b]?m[b]:b,q=function(f){var q=r("y",e),t=r("x",e);if(h&&m.hasOwnProperty(b))for(var y=0,x=f.targetTouches&&f.targetTouches.length;x>y;y++)if(f.targetTouches[y].target==a||a.contains(f.targetTouches[y].target)){x=f;f=f.targetTouches[y];f.originalEvent=x;f.preventDefault=l;f.stopPropagation=B;break}return c.call(e,f,f.clientX+t,f.clientY+q)};return b!==
f&&a.addEventListener(b,q,!1),a.addEventListener(f,q,!1),function(){return b!==f&&a.removeEventListener(b,q,!1),a.removeEventListener(f,q,!1),!0}},E=[],G=function(b){for(var c,e=b.clientX,f=b.clientY,m=r("y"),q=r("x"),l=E.length;l--;){if(c=E[l],h)for(var t,y=b.touches&&b.touches.length;y--;){if(t=b.touches[y],t.identifier==c.el._drag.id||c.el.node.contains(t.target)){e=t.clientX;f=t.clientY;(b.originalEvent?b.originalEvent:b).preventDefault();break}}else b.preventDefault();y=c.el.node;y.nextSibling;
y.parentNode;y.style.display;e+=q;f+=m;a("snap.drag.move."+c.el.id,c.move_scope||c.el,e-c.el._drag.x,f-c.el._drag.y,e,f,b)}},I=function(c){b.unmousemove(G).unmouseup(I);for(var e,f=E.length;f--;)e=E[f],e.el._drag={},a("snap.drag.end."+e.el.id,e.end_scope||e.start_scope||e.move_scope||e.el,c),a.off("snap.drag.*."+e.el.id);E=[]};for(e=c.length;e--;)!function(a){b[a]=f[a]=function(c,e){if(b.is(c,"function"))this.events=this.events||[],this.events.push({name:a,f:c,unbind:z(this.node||document,a,c,e||
this)});else for(var f=0,h=this.events.length;h>f;f++)if(this.events[f].name==a)try{this.events[f].f.call(this)}catch(O){}return this};b["un"+a]=f["un"+a]=function(b){for(var c=this.events||[],e=c.length;e--;)if(c[e].name==a&&(c[e].f==b||!b))return c[e].unbind(),c.splice(e,1),!c.length&&delete this.events,this;return this}}(c[e]);f.hover=function(a,b,c,e){return this.mouseover(a,c).mouseout(b,e||c)};f.unhover=function(a,b){return this.unmouseover(a).unmouseout(b)};var F=[];f.drag=function(c,e,f,h,
m,q){function r(r,l,y){(r.originalEvent||r).preventDefault();t._drag.x=l;t._drag.y=y;t._drag.id=r.identifier;!E.length&&b.mousemove(G).mouseup(I);E.push({el:t,move_scope:h,start_scope:m,end_scope:q});e&&a.on("snap.drag.start."+t.id,e);c&&a.on("snap.drag.move."+t.id,c);f&&a.on("snap.drag.end."+t.id,f);a("snap.drag.start."+t.id,m||h||t,l,y,r)}function l(b,c,e){a("snap.draginit."+t.id,t,b,c,e)}var t=this;if(!arguments.length){var y;return t.drag(function(a,b){this.attr({transform:y+(y?"T":"t")+[a,b]})},
function(){y=this.transform().local})}return a.on("snap.draginit."+t.id,r),t._drag={},F.push({el:t,start:r,init:l}),t.mousedown(l),t};f.undrag=function(){for(var c=F.length;c--;)F[c].el==this&&(this.unmousedown(F[c].init),F.splice(c,1),a.unbind("snap.drag.*."+this.id),a.unbind("snap.draginit."+this.id));return!F.length&&b.unmousemove(G).unmouseup(I),this}}),e.plugin(function(b,c,e){e=(c.prototype,e.prototype);var f=/^\s*url\((.+)\)/,h=String,q=b._.$;b.filter={};e.filter=function(a){var e=this;"svg"!=
e.type&&(e=e.paper);a=b.parse(h(a));var f=b._.id(),m=(e.node.offsetWidth,e.node.offsetHeight,q("filter"));return q(m,{id:f,filterUnits:"userSpaceOnUse"}),m.appendChild(a.node),e.defs.appendChild(m),new c(m)};a.on("snap.util.getattr.filter",function(){a.stop();var c=q(this.node,"filter");if(c)return(c=h(c).match(f))&&b.select(c[1])});a.on("snap.util.attr.filter",function(e){if(e instanceof c&&"filter"==e.type){a.stop();var f=e.node.id;f||(q(e.node,{id:e.id}),f=e.id);q(this.node,{filter:b.url(f)})}e&&
"none"!=e||(a.stop(),this.node.removeAttribute("filter"))});b.filter.blur=function(a,c){null==a&&(a=2);return b.format('<feGaussianBlur stdDeviation="{def}"/>',{def:null==c?a:[a,c]})};b.filter.blur.toString=function(){return this()};b.filter.shadow=function(a,c,e,f,h){return"string"==typeof e&&(f=e,h=f,e=4),"string"!=typeof f&&(h=f,f="#000"),f=f||"#000",null==e&&(e=4),null==h&&(h=1),null==a&&(a=0,c=2),null==c&&(c=a),f=b.color(f),b.format('<feGaussianBlur in="SourceAlpha" stdDeviation="{blur}"/><feOffset dx="{dx}" dy="{dy}" result="offsetblur"/><feFlood flood-color="{color}"/><feComposite in2="offsetblur" operator="in"/><feComponentTransfer><feFuncA type="linear" slope="{opacity}"/></feComponentTransfer><feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge>',
{color:f,dx:a,dy:c,blur:e,opacity:h})};b.filter.shadow.toString=function(){return this()};b.filter.grayscale=function(a){return null==a&&(a=1),b.format('<feColorMatrix type="matrix" values="{a} {b} {c} 0 0 {d} {e} {f} 0 0 {g} {b} {h} 0 0 0 0 0 1 0"/>',{a:.2126+.7874*(1-a),b:.7152-.7152*(1-a),c:.0722-.0722*(1-a),d:.2126-.2126*(1-a),e:.7152+.2848*(1-a),f:.0722-.0722*(1-a),g:.2126-.2126*(1-a),h:.0722+.9278*(1-a)})};b.filter.grayscale.toString=function(){return this()};b.filter.sepia=function(a){return null==
a&&(a=1),b.format('<feColorMatrix type="matrix" values="{a} {b} {c} 0 0 {d} {e} {f} 0 0 {g} {h} {i} 0 0 0 0 0 1 0"/>',{a:.393+.607*(1-a),b:.769-.769*(1-a),c:.189-.189*(1-a),d:.349-.349*(1-a),e:.686+.314*(1-a),f:.168-.168*(1-a),g:.272-.272*(1-a),h:.534-.534*(1-a),i:.131+.869*(1-a)})};b.filter.sepia.toString=function(){return this()};b.filter.saturate=function(a){return null==a&&(a=1),b.format('<feColorMatrix type="saturate" values="{amount}"/>',{amount:1-a})};b.filter.saturate.toString=function(){return this()};
b.filter.hueRotate=function(a){return a=a||0,b.format('<feColorMatrix type="hueRotate" values="{angle}"/>',{angle:a})};b.filter.hueRotate.toString=function(){return this()};b.filter.invert=function(a){return null==a&&(a=1),b.format('<feComponentTransfer><feFuncR type="table" tableValues="{amount} {amount2}"/><feFuncG type="table" tableValues="{amount} {amount2}"/><feFuncB type="table" tableValues="{amount} {amount2}"/></feComponentTransfer>',{amount:a,amount2:1-a})};b.filter.invert.toString=function(){return this()};
b.filter.brightness=function(a){return null==a&&(a=1),b.format('<feComponentTransfer><feFuncR type="linear" slope="{amount}"/><feFuncG type="linear" slope="{amount}"/><feFuncB type="linear" slope="{amount}"/></feComponentTransfer>',{amount:a})};b.filter.brightness.toString=function(){return this()};b.filter.contrast=function(a){return null==a&&(a=1),b.format('<feComponentTransfer><feFuncR type="linear" slope="{amount}" intercept="{amount2}"/><feFuncG type="linear" slope="{amount}" intercept="{amount2}"/><feFuncB type="linear" slope="{amount}" intercept="{amount2}"/></feComponentTransfer>',
{amount:a,amount2:.5-a/2})};b.filter.contrast.toString=function(){return this()}}),e.plugin(function(a,b){var c=a._.box,e=a.is,f=/^[^a-z]*([tbmlrc])/i,h=function(){return"T"+this.dx+","+this.dy};b.prototype.getAlign=function(a,b){null==b&&e(a,"string")&&(b=a,a=null);a=a||this.paper;var m=a.getBBox?a.getBBox():c(a),q=this.getBBox(),r={};switch(b=b&&b.match(f),b?b[1].toLowerCase():"c"){case "t":r.dx=0;r.dy=m.y-q.y;break;case "b":r.dx=0;r.dy=m.y2-q.y2;break;case "m":r.dx=0;r.dy=m.cy-q.cy;break;case "l":r.dx=
m.x-q.x;r.dy=0;break;case "r":r.dx=m.x2-q.x2;r.dy=0;break;default:r.dx=m.cx-q.cx,r.dy=0}return r.toString=h,r};b.prototype.align=function(a,b){return this.transform("..."+this.getAlign(a,b))}}),e});(function(b,a){function c(a){if("function"==typeof require&&"undefined"!==typeof module&&module.exports)try{return require(a.toLowerCase())}catch(I){}else return b[a]}function e(a,b){return null===a?"null"===b:void 0===a?"undefined"===b:a.is&&a instanceof l?"element"===b:7<Object.prototype.toString.call(a).toLowerCase().indexOf(b)}function f(a){var b,c,h,m,q,l,t,x;if(a instanceof f)return a;e(a,"array")||(a=String(a).replace(/\s/g,"").toLowerCase().match(/(?:\+,|[^,])+/g));b=0;for(c=a.length;b<c;++b){e(a[b],
"array")||(a[b]=String(a[b]).match(/(?:\+\/|[^\/])+/g));l=[];for(h=a[b].length;h--;){t=a[b][h];q={jwertyCombo:String(t),shiftKey:!1,ctrlKey:!1,altKey:!1,metaKey:!1};e(t,"array")||(t=String(t).toLowerCase().match(/(?:(?:[^\+])+|\+\+|^\+$)/g));for(m=t.length;m--;)"++"===t[m]&&(t[m]="+"),t[m]in y.mods?q[r[y.mods[t[m]]]]=!0:t[m]in y.keys?q.keyCode=y.keys[t[m]]:x=t[m].match(/^\[([^-]+\-?[^-]*)-([^-]+\-?[^-]*)\]$/);if(e(q.keyCode,"undefined"))if(x&&x[1]in y.keys&&x[2]in y.keys){x[2]=y.keys[x[2]];x[1]=y.keys[x[1]];
for(m=x[1];m<x[2];++m)l.push({altKey:q.altKey,shiftKey:q.shiftKey,metaKey:q.metaKey,ctrlKey:q.ctrlKey,keyCode:m,jwertyCombo:String(t)});q.keyCode=m}else q.keyCode=0;l.push(q)}this[b]=l}this.length=b;return this}var h=b.document,l=c("jquery")||c("zepto")||c("ender")||h,t,x,q,m;l===h?(t=function(a,b){return a?l.querySelector(a,b||l):l},x=function(a,b){a.addEventListener("keydown",b,!1)},q=function(a,b){a.removeEventListener("keydown",b,!1)},m=function(a,b){var c=h.createEvent("Event"),e;c.initEvent("keydown",
!0,!0);for(e in b)c[e]=b[e];return(a||l).dispatchEvent(c)}):(t=function(a,b){return l(a||h,b)},x=function(a,b){l(a).bind("keydown.jwerty",b)},q=function(a,b){l(a).unbind("keydown.jwerty",b)},m=function(a,b){l(a||h).trigger(l.Event("keydown",b))});for(var r={16:"shiftKey",17:"ctrlKey",18:"altKey",91:"metaKey"},y={mods:{"\u21e7":16,shift:16,"\u2303":17,ctrl:17,"\u2325":18,alt:18,option:18,"\u2318":91,meta:91,cmd:91,"super":91,win:91},keys:{"\u232b":8,backspace:8,"\u21e5":9,"\u21c6":9,tab:9,"\u21a9":13,
"return":13,enter:13,"\u2305":13,pause:19,"pause-break":19,"\u21ea":20,caps:20,"caps-lock":20,"\u238b":27,escape:27,esc:27,space:32,"\u2196":33,pgup:33,"page-up":33,"\u2198":34,pgdown:34,"page-down":34,"\u21df":35,end:35,"\u21de":36,home:36,ins:45,insert:45,del:46,"delete":46,"\u2190":37,left:37,"arrow-left":37,"\u2191":38,up:38,"arrow-up":38,"\u2192":39,right:39,"arrow-right":39,"\u2193":40,down:40,"arrow-down":40,"*":106,star:106,asterisk:106,multiply:106,"+":107,plus:107,"-":109,subtract:109,"num-.":110,
"num-period":110,"num-dot":110,"num-full-stop":110,"num-delete":110,";":186,semicolon:186,"=":187,equals:187,",":188,comma:188,".":190,period:190,"full-stop":190,"/":191,slash:191,"forward-slash":191,"`":192,tick:192,"back-quote":192,"[":219,"open-bracket":219,"\\":220,"back-slash":220,"]":221,"close-bracket":221,"'":222,quote:222,apostraphe:222}},B=47,z=0;106>++B;)y.keys[z]=B,y.keys["num-"+z]=B+48,++z;B=111;for(z=1;136>++B;)y.keys["f"+z]=B,++z;for(B=64;91>++B;)y.keys[String.fromCharCode(B).toLowerCase()]=
B;var E=a.jwerty={event:function(a,b,c){if(e(b,"boolean")){var h=b;b=function(){return h}}a=new f(a);var m=0,q=a.length-1,r,l;return function(e){(l=E.is(a,e,m))?m<q?++m:(r=b.call(c||this,e,l),!1===r&&e.preventDefault(),m=0):m=E.is(a,e)?1:0}},is:function(a,b,c){a=new f(a);a=a[c||0];b=b.originalEvent||b;c=a.length;for(var e=!1;c--;){var e=a[c].jwertyCombo,h;for(h in a[c])"jwertyCombo"!==h&&b[h]!=a[c][h]&&(e=!1);if(!1!==e)break}return e},key:function(a,c,f,h,m){var r=e(f,"element")||e(f,"string")?f:
h,l=r===f?b:f;f=r===f?h:m;var y=e(r,"element")?r:t(r,f),B=E.event(a,c,l);x(y,B);return{unbind:function(){q(y,B)}}},fire:function(a,b,c,h){a=new f(a);h=e(c,"number")?c:h;m(e(b,"element")?b:t(b,c),a[h||0][0])},KEYS:y}})("undefined"!==typeof global&&global.window||this,"undefined"!==typeof module&&module.exports?module.exports:this);(function(b,a){"object"===typeof exports&&exports&&"string"!==typeof exports.nodeName?a(exports):"function"===typeof define&&define.amd?define(["exports"],a):(b.Mustache={},a(b.Mustache))})(this,function(b){function a(a){return"function"===typeof a}function c(a){return a.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function e(a,b){return null!=a&&"object"===typeof a&&b in a}function f(a,e){function f(a){"string"===typeof a&&(a=a.split(G,2));if(!r(a)||2!==a.length)throw Error("Invalid tags: "+a);
H=new RegExp(c(a[0])+"\\s*");N=new RegExp("\\s*"+c(a[1]));fa=new RegExp("\\s*"+c("}"+a[1]))}if(!a)return[];var m=[],q=[],x=[],z=!1,M=!1,H,N,fa;f(e||b.tags);for(var ba=new t(a),ea,J,R,aa;!ba.eos();){ea=ba.pos;if(R=ba.scanUntil(H)){aa=0;for(var T=R.length;aa<T;++aa)if(J=R.charAt(aa),y.call(B,J)?M=!0:x.push(q.length),q.push(["text",J,ea,ea+1]),ea+=1,"\n"===J){if(z&&!M)for(;x.length;)delete q[x.pop()];else x=[];M=z=!1}}if(!ba.scan(H))break;z=!0;J=ba.scan(D)||"name";ba.scan(E);"="===J?(R=ba.scanUntil(I),
ba.scan(I),ba.scanUntil(N)):"{"===J?(R=ba.scanUntil(fa),ba.scan(F),ba.scanUntil(N),J="&"):R=ba.scanUntil(N);if(!ba.scan(N))throw Error("Unclosed tag at "+ba.pos);aa=[J,R,ea,ba.pos];q.push(aa);if("#"===J||"^"===J)m.push(aa);else if("/"===J){J=m.pop();if(!J)throw Error('Unopened section "'+R+'" at '+ea);if(J[1]!==R)throw Error('Unclosed section "'+J[1]+'" at '+ea);}else"name"===J||"{"===J||"&"===J?M=!0:"="===J&&f(R)}if(J=m.pop())throw Error('Unclosed section "'+J[1]+'" at '+ba.pos);return l(h(q))}function h(a){for(var b=
[],c,e,f=0,h=a.length;f<h;++f)if(c=a[f])"text"===c[0]&&e&&"text"===e[0]?(e[1]+=c[1],e[3]=c[3]):(b.push(c),e=c);return b}function l(a){for(var b=[],c=b,e=[],f,h=0,m=a.length;h<m;++h)switch(f=a[h],f[0]){case "#":case "^":c.push(f);e.push(f);c=f[4]=[];break;case "/":c=e.pop();c[5]=f[2];c=0<e.length?e[e.length-1][4]:b;break;default:c.push(f)}return b}function t(a){this.tail=this.string=a;this.pos=0}function x(a,b){this.view=a;this.cache={".":this.view};this.parent=b}function q(){this.cache={}}var m=Object.prototype.toString,
r=Array.isArray||function(a){return"[object Array]"===m.call(a)},y=RegExp.prototype.test,B=/\S/,z={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},E=/\s*/,G=/\s+/,I=/\s*=/,F=/\s*\}/,D=/#|\^|\/|>|\{|&|=|!/;t.prototype.eos=function(){return""===this.tail};t.prototype.scan=function(a){a=this.tail.match(a);if(!a||0!==a.index)return"";a=a[0];this.tail=this.tail.substring(a.length);this.pos+=a.length;return a};t.prototype.scanUntil=function(a){a=this.tail.search(a);
var b;switch(a){case -1:b=this.tail;this.tail="";break;case 0:b="";break;default:b=this.tail.substring(0,a),this.tail=this.tail.substring(a)}this.pos+=b.length;return b};x.prototype.push=function(a){return new x(a,this)};x.prototype.lookup=function(b){var c=this.cache,f;if(c.hasOwnProperty(b))f=c[b];else{for(var h=this,m,q,r=!1;h;){if(0<b.indexOf("."))for(f=h.view,m=b.split("."),q=0;null!=f&&q<m.length;)q===m.length-1&&(r=e(f,m[q])),f=f[m[q++]];else f=h.view[b],r=e(h.view,b);if(r)break;h=h.parent}c[b]=
f}a(f)&&(f=f.call(this.view));return f};q.prototype.clearCache=function(){this.cache={}};q.prototype.parse=function(a,b){var c=this.cache,e=c[a];null==e&&(e=c[a]=f(a,b));return e};q.prototype.render=function(a,b,c){var e=this.parse(a);b=b instanceof x?b:new x(b);return this.renderTokens(e,b,c,a)};q.prototype.renderTokens=function(a,b,c,e){for(var f="",h,m,q,r=0,l=a.length;r<l;++r)q=void 0,h=a[r],m=h[0],"#"===m?q=this.renderSection(h,b,c,e):"^"===m?q=this.renderInverted(h,b,c,e):">"===m?q=this.renderPartial(h,
b,c,e):"&"===m?q=this.unescapedValue(h,b):"name"===m?q=this.escapedValue(h,b):"text"===m&&(q=this.rawValue(h)),void 0!==q&&(f+=q);return f};q.prototype.renderSection=function(b,c,e,f){function h(a){return m.render(a,c,e)}var m=this,q="",l=c.lookup(b[1]);if(l){if(r(l))for(var t=0,y=l.length;t<y;++t)q+=this.renderTokens(b[4],c.push(l[t]),e,f);else if("object"===typeof l||"string"===typeof l||"number"===typeof l)q+=this.renderTokens(b[4],c.push(l),e,f);else if(a(l)){if("string"!==typeof f)throw Error("Cannot use higher-order sections without the original template");
l=l.call(c.view,f.slice(b[3],b[5]),h);null!=l&&(q+=l)}else q+=this.renderTokens(b[4],c,e,f);return q}};q.prototype.renderInverted=function(a,b,c,e){var f=b.lookup(a[1]);if(!f||r(f)&&0===f.length)return this.renderTokens(a[4],b,c,e)};q.prototype.renderPartial=function(b,c,e){if(e&&(b=a(e)?e(b[1]):e[b[1]],null!=b))return this.renderTokens(this.parse(b),c,e,b)};q.prototype.unescapedValue=function(a,b){var c=b.lookup(a[1]);if(null!=c)return c};q.prototype.escapedValue=function(a,c){var e=c.lookup(a[1]);
if(null!=e)return b.escape(e)};q.prototype.rawValue=function(a){return a[1]};b.name="mustache.js";b.version="2.2.1";b.tags=["{{","}}"];var H=new q;b.clearCache=function(){return H.clearCache()};b.parse=function(a,b){return H.parse(a,b)};b.render=function(a,b,c){if("string"!==typeof a)throw b=TypeError,a=r(a)?"array":typeof a,new b('Invalid template! Template should be a "string" but "'+a+'" was given as the first argument for mustache#render(template, view, partials)');return H.render(a,b,c)};b.to_html=
function(c,e,f,h){c=b.render(c,e,f);if(a(h))h(c);else return c};b.escape=function(a){return String(a).replace(/[&<>"'`=\/]/g,function(a){return z[a]})};b.Scanner=t;b.Context=x;b.Writer=q});/*
 jQuery v3.1.1 | (c) jQuery Foundation | jquery.org/license */
!function(b,a){"object"==typeof module&&"object"==typeof module.exports?module.exports=b.document?a(b,!0):function(b){if(!b.document)throw Error("jQuery requires a window with a document");return a(b)}:a(b)}("undefined"!=typeof window?window:this,function(b,a){function c(a,b){b=b||V;var c=b.createElement("script");c.text=a;b.head.appendChild(c).parentNode.removeChild(c)}function e(a){var b=!!a&&"length"in a&&a.length,c=w.type(a);return"function"!==c&&!w.isWindow(a)&&("array"===c||0===b||"number"==
typeof b&&0<b&&b-1 in a)}function f(a,b,c){return w.isFunction(b)?w.grep(a,function(a,e){return!!b.call(a,e,a)!==c}):b.nodeType?w.grep(a,function(a){return a===b!==c}):"string"!=typeof b?w.grep(a,function(a){return-1<Za.call(b,a)!==c}):ib.test(b)?w.filter(b,a,c):(b=w.filter(b,a),w.grep(a,function(a){return-1<Za.call(b,a)!==c&&1===a.nodeType}))}function h(a,b){for(;(a=a[b])&&1!==a.nodeType;);return a}function l(a){var b={};return w.each(a.match(va)||[],function(a,c){b[c]=!0}),b}function t(a){return a}
function x(a){throw a;}function q(a,b,c){var e;try{a&&w.isFunction(e=a.promise)?e.call(a).done(b).fail(c):a&&w.isFunction(e=a.then)?e.call(a,b,c):b.call(void 0,a)}catch(Nb){c.call(void 0,Nb)}}function m(){V.removeEventListener("DOMContentLoaded",m);b.removeEventListener("load",m);w.ready()}function r(){this.expando=w.expando+r.uid++}function y(a,b,c){var e;if(void 0===c&&1===a.nodeType)if(e="data-"+b.replace(Fb,"-$&").toLowerCase(),c=a.getAttribute(e),"string"==typeof c){try{e=c,c="true"===e||"false"!==
e&&("null"===e?null:e===+e+""?+e:Eb.test(e)?JSON.parse(e):e)}catch(Nb){}Ca.set(a,b,c)}else c=void 0;return c}function B(a,b,c,e){var f,h=1,m=20,q=e?function(){return e.cur()}:function(){return w.css(a,b,"")},r=q(),l=c&&c[3]||(w.cssNumber[b]?"":"px"),K=(w.cssNumber[b]||"px"!==l&&+r)&&Na.exec(w.css(a,b));if(K&&K[3]!==l){l=l||K[3];c=c||[];K=+r||1;do h=h||".5",K/=h,w.style(a,b,K+l);while(h!==(h=q()/r)&&1!==h&&--m)}return c&&(K=+K||+r||0,f=c[1]?K+(c[1]+1)*c[2]:+c[2],e&&(e.unit=l,e.start=K,e.end=f)),f}
function z(a,b){for(var c,e,f=[],h=0,m=a.length;h<m;h++)if(e=a[h],e.style)if(c=e.style.display,b){if("none"===c&&(f[h]=Q.get(e,"display")||null,f[h]||(e.style.display="")),""===e.style.display&&Oa(e)){c=h;var q,r=void 0;q=e.ownerDocument;var l=e.nodeName;q=(e=wb[l])?e:(r=q.body.appendChild(q.createElement(l)),e=w.css(r,"display"),r.parentNode.removeChild(r),"none"===e&&(e="block"),wb[l]=e,e);f[c]=q}}else"none"!==c&&(f[h]="none",Q.set(e,"display",c));for(h=0;h<m;h++)null!=f[h]&&(a[h].style.display=
f[h]);return a}function E(a,b){var c;return c="undefined"!=typeof a.getElementsByTagName?a.getElementsByTagName(b||"*"):"undefined"!=typeof a.querySelectorAll?a.querySelectorAll(b||"*"):[],void 0===b||b&&w.nodeName(a,b)?w.merge([a],c):c}function G(a,b){for(var c=0,e=a.length;c<e;c++)Q.set(a[c],"globalEval",!b||Q.get(b[c],"globalEval"))}function I(a,b,c,e,f){for(var h,m,q,r,l=b.createDocumentFragment(),K=[],t=0,y=a.length;t<y;t++)if(h=a[t],h||0===h)if("object"===w.type(h))w.merge(K,h.nodeType?[h]:
h);else if(xb.test(h)){m=m||l.appendChild(b.createElement("div"));q=(yb.exec(h)||["",""])[1].toLowerCase();q=xa[q]||xa._default;m.innerHTML=q[1]+w.htmlPrefilter(h)+q[2];for(q=q[0];q--;)m=m.lastChild;w.merge(K,m.childNodes);m=l.firstChild;m.textContent=""}else K.push(b.createTextNode(h));l.textContent="";for(t=0;h=K[t++];)if(e&&-1<w.inArray(h,e))f&&f.push(h);else if(r=w.contains(h.ownerDocument,h),m=E(l.appendChild(h),"script"),r&&G(m),c)for(q=0;h=m[q++];)zb.test(h.type||"")&&c.push(h);return l}function F(){return!0}
function D(){return!1}function H(){try{return V.activeElement}catch(K){}}function M(a,b,c,e,f,h){var m,q;if("object"==typeof b){"string"!=typeof c&&(e=e||c,c=void 0);for(q in b)M(a,q,c,e,b[q],h);return a}if(null==e&&null==f?(f=c,e=c=void 0):null==f&&("string"==typeof c?(f=e,e=void 0):(f=e,e=c,c=void 0)),!1===f)f=D;else if(!f)return a;return 1===h&&(m=f,f=function(a){return w().off(a),m.apply(this,arguments)},f.guid=m.guid||(m.guid=w.guid++)),a.each(function(){w.event.add(this,b,f,e,c)})}function N(a,
b){return w.nodeName(a,"table")&&w.nodeName(11!==b.nodeType?b:b.firstChild,"tr")?a.getElementsByTagName("tbody")[0]||a:a}function L(a){return a.type=(null!==a.getAttribute("type"))+"/"+a.type,a}function O(a){var b=Fa.exec(a.type);return b?a.type=b[1]:a.removeAttribute("type"),a}function S(a,b){var c,e,f,h,m,q;if(1===b.nodeType){if(Q.hasData(a)&&(c=Q.access(a),e=Q.set(b,c),q=c.events))for(f in delete e.handle,e.events={},q)for(c=0,e=q[f].length;c<e;c++)w.event.add(b,f,q[f][c]);Ca.hasData(a)&&(h=Ca.access(a),
m=w.extend({},h),Ca.set(b,m))}}function ka(a,b,e,f){b=na.apply([],b);var h,m,q,r,l=0,K=a.length,t=K-1,y=b[0],x=w.isFunction(y);if(x||1<K&&"string"==typeof y&&!oa.checkClone&&mb.test(y))return a.each(function(c){var h=a.eq(c);x&&(b[0]=y.call(this,c,h.html()));ka(h,b,e,f)});if(K&&(h=I(b,a[0].ownerDocument,!1,a,f),m=h.firstChild,1===h.childNodes.length&&(h=m),m||f)){m=w.map(E(h,"script"),L);for(q=m.length;l<K;l++)r=h,l!==t&&(r=w.clone(r,!0,!0),q&&w.merge(m,E(r,"script"))),e.call(a[l],r,l);if(q)for(h=
m[m.length-1].ownerDocument,w.map(m,O),l=0;l<q;l++)r=m[l],zb.test(r.type||"")&&!Q.access(r,"globalEval")&&w.contains(h,r)&&(r.src?w._evalUrl&&w._evalUrl(r.src):c(r.textContent.replace(Xa,""),h))}return a}function sa(a,b,c){for(var e=b?w.filter(b,a):a,f=0;null!=(b=e[f]);f++)c||1!==b.nodeType||w.cleanData(E(b)),b.parentNode&&(c&&w.contains(b.ownerDocument,b)&&G(E(b,"script")),b.parentNode.removeChild(b));return a}function W(a,b,c){var e,f,h,m,q=a.style;return c=c||Ra(a),c&&(m=c.getPropertyValue(b)||
c[b],""!==m||w.contains(a.ownerDocument,a)||(m=w.style(a,b)),!oa.pixelMarginRight()&&Ha.test(m)&&Pa.test(b)&&(e=q.width,f=q.minWidth,h=q.maxWidth,q.minWidth=q.maxWidth=q.width=m,m=c.width,q.width=e,q.minWidth=f,q.maxWidth=h)),void 0!==m?m+"":m}function ma(a,b){return{get:function(){return a()?void delete this.get:(this.get=b).apply(this,arguments)}}}function pa(a){if(a in Aa)return a;for(var b=a[0].toUpperCase()+a.slice(1),c=Y.length;c--;)if(a=Y[c]+b,a in Aa)return a}function fa(a,b,c){return(a=Na.exec(b))?
Math.max(0,a[2]-(c||0))+(a[3]||"px"):b}function ba(a,b,c,e,f){var h=0;for(b=c===(e?"border":"content")?4:"width"===b?1:0;4>b;b+=2)"margin"===c&&(h+=w.css(a,c+wa[b],!0,f)),e?("content"===c&&(h-=w.css(a,"padding"+wa[b],!0,f)),"margin"!==c&&(h-=w.css(a,"border"+wa[b]+"Width",!0,f))):(h+=w.css(a,"padding"+wa[b],!0,f),"padding"!==c&&(h+=w.css(a,"border"+wa[b]+"Width",!0,f)));return h}function ea(a,b,c){var e,f=!0,h=Ra(a),m="border-box"===w.css(a,"boxSizing",!1,h);if(a.getClientRects().length&&(e=a.getBoundingClientRect()[b]),
0>=e||null==e){if(e=W(a,b,h),(0>e||null==e)&&(e=a.style[b]),Ha.test(e))return e;f=m&&(oa.boxSizingReliable()||e===a.style[b]);e=parseFloat(e)||0}return e+ba(a,b,c||(m?"border":"content"),f,h)+"px"}function J(a,b,c,e,f){return new J.prototype.init(a,b,c,e,f)}function R(){Ia&&(b.requestAnimationFrame(R),w.fx.tick())}function aa(){return b.setTimeout(function(){X=void 0}),X=w.now()}function T(a,b){var c,e=0,f={height:a};for(b=b?1:0;4>e;e+=2-b)c=wa[e],f["margin"+c]=f["padding"+c]=a;return b&&(f.opacity=
f.width=a),f}function ta(a,b,c){for(var e,f=(ha.tweeners[b]||[]).concat(ha.tweeners["*"]),h=0,m=f.length;h<m;h++)if(e=f[h].call(c,b,a))return e}function Ba(a,b){var c,e,f,h,m;for(c in a)if(e=w.camelCase(c),f=b[e],h=a[c],w.isArray(h)&&(f=h[1],h=a[c]=h[0]),c!==e&&(a[e]=h,delete a[c]),m=w.cssHooks[e],m&&"expand"in m)for(c in h=m.expand(h),delete a[e],h)c in a||(a[c]=h[c],b[c]=f);else b[e]=f}function ha(a,b,c){var e,f=0,h=ha.prefilters.length,m=w.Deferred().always(function(){delete q.elem}),q=function(){if(e)return!1;
for(var b=X||aa(),b=Math.max(0,r.startTime+r.duration-b),c=1-(b/r.duration||0),f=0,h=r.tweens.length;f<h;f++)r.tweens[f].run(c);return m.notifyWith(a,[r,c,b]),1>c&&h?b:(m.resolveWith(a,[r]),!1)},r=m.promise({elem:a,props:w.extend({},b),opts:w.extend(!0,{specialEasing:{},easing:w.easing._default},c),originalProperties:b,originalOptions:c,startTime:X||aa(),duration:c.duration,tweens:[],createTween:function(b,c){var e=w.Tween(a,r.opts,b,c,r.opts.specialEasing[b]||r.opts.easing);return r.tweens.push(e),
e},stop:function(b){var c=0,f=b?r.tweens.length:0;if(e)return this;for(e=!0;c<f;c++)r.tweens[c].run(1);return b?(m.notifyWith(a,[r,1,0]),m.resolveWith(a,[r,b])):m.rejectWith(a,[r,b]),this}});c=r.props;for(Ba(c,r.opts.specialEasing);f<h;f++)if(b=ha.prefilters[f].call(r,a,c,r.opts))return w.isFunction(b.stop)&&(w._queueHooks(r.elem,r.opts.queue).stop=w.proxy(b.stop,b)),b;return w.map(c,ta,r),w.isFunction(r.opts.start)&&r.opts.start.call(a,r),w.fx.timer(w.extend(q,{elem:a,anim:r,queue:r.opts.queue})),
r.progress(r.opts.progress).done(r.opts.done,r.opts.complete).fail(r.opts.fail).always(r.opts.always)}function ca(a){return(a.match(va)||[]).join(" ")}function ja(a){return a.getAttribute&&a.getAttribute("class")||""}function ia(a,b,c,e){var f;if(w.isArray(b))w.each(b,function(b,f){c||Yb.test(a)?e(a,f):ia(a+"["+("object"==typeof f&&null!=f?b:"")+"]",f,c,e)});else if(c||"object"!==w.type(b))e(a,b);else for(f in b)ia(a+"["+f+"]",b[f],c,e)}function U(a){return function(b,c){"string"!=typeof b&&(c=b,
b="*");var e,f=0,h=b.toLowerCase().match(va)||[];if(w.isFunction(c))for(;e=h[f++];)"+"===e[0]?(e=e.slice(1)||"*",(a[e]=a[e]||[]).unshift(c)):(a[e]=a[e]||[]).push(c)}}function Ma(a,b,c,e){function f(q){var r;return h[q]=!0,w.each(a[q]||[],function(a,q){var l=q(b,c,e);return"string"!=typeof l||m||h[l]?m?!(r=l):void 0:(b.dataTypes.unshift(l),f(l),!1)}),r}var h={},m=a===Gb;return f(b.dataTypes[0])||!h["*"]&&f("*")}function Ga(a,b){var c,e,f=w.ajaxSettings.flatOptions||{};for(c in b)void 0!==b[c]&&((f[c]?
a:e||(e={}))[c]=b[c]);return e&&w.extend(!0,a,e),a}function ya(a){return w.isWindow(a)?a:9===a.nodeType&&a.defaultView}var za=[],V=b.document,fb=Object.getPrototypeOf,Ja=za.slice,na=za.concat,gb=za.push,Za=za.indexOf,$a={},Sa=$a.toString,Ka=$a.hasOwnProperty,hb=Ka.toString,ub=hb.call(Object),oa={},w=function(a,b){return new w.fn.init(a,b)},ob=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,tb=/^-ms-/,Cb=/-([a-z])/g,Db=function(a,b){return b.toUpperCase()};w.fn=w.prototype={jquery:"3.1.1",constructor:w,length:0,
toArray:function(){return Ja.call(this)},get:function(a){return null==a?Ja.call(this):0>a?this[a+this.length]:this[a]},pushStack:function(a){a=w.merge(this.constructor(),a);return a.prevObject=this,a},each:function(a){return w.each(this,a)},map:function(a){return this.pushStack(w.map(this,function(b,c){return a.call(b,c,b)}))},slice:function(){return this.pushStack(Ja.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length;a=
+a+(0>a?b:0);return this.pushStack(0<=a&&a<b?[this[a]]:[])},end:function(){return this.prevObject||this.constructor()},push:gb,sort:za.sort,splice:za.splice};w.extend=w.fn.extend=function(){var a,b,c,e,f,h,m=arguments[0]||{},q=1,r=arguments.length,l=!1;"boolean"==typeof m&&(l=m,m=arguments[q]||{},q++);"object"==typeof m||w.isFunction(m)||(m={});for(q===r&&(m=this,q--);q<r;q++)if(null!=(a=arguments[q]))for(b in a)c=m[b],e=a[b],m!==e&&(l&&e&&(w.isPlainObject(e)||(f=w.isArray(e)))?(f?(f=!1,h=c&&w.isArray(c)?
c:[]):h=c&&w.isPlainObject(c)?c:{},m[b]=w.extend(l,h,e)):void 0!==e&&(m[b]=e));return m};w.extend({expando:"jQuery"+("3.1.1"+Math.random()).replace(/\D/g,""),isReady:!0,error:function(a){throw Error(a);},noop:function(){},isFunction:function(a){return"function"===w.type(a)},isArray:Array.isArray,isWindow:function(a){return null!=a&&a===a.window},isNumeric:function(a){var b=w.type(a);return("number"===b||"string"===b)&&!isNaN(a-parseFloat(a))},isPlainObject:function(a){var b,c;return!(!a||"[object Object]"!==
Sa.call(a))&&(!(b=fb(a))||(c=Ka.call(b,"constructor")&&b.constructor,"function"==typeof c&&hb.call(c)===ub))},isEmptyObject:function(a){for(var b in a)return!1;return!0},type:function(a){return null==a?a+"":"object"==typeof a||"function"==typeof a?$a[Sa.call(a)]||"object":typeof a},globalEval:function(a){c(a)},camelCase:function(a){return a.replace(tb,"ms-").replace(Cb,Db)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,b){var c,f=0;if(e(a))for(c=
a.length;f<c&&!1!==b.call(a[f],f,a[f]);f++);else for(f in a)if(!1===b.call(a[f],f,a[f]))break;return a},trim:function(a){return null==a?"":(a+"").replace(ob,"")},makeArray:function(a,b){var c=b||[];return null!=a&&(e(Object(a))?w.merge(c,"string"==typeof a?[a]:a):gb.call(c,a)),c},inArray:function(a,b,c){return null==b?-1:Za.call(b,a,c)},merge:function(a,b){for(var c=+b.length,e=0,f=a.length;e<c;e++)a[f++]=b[e];return a.length=f,a},grep:function(a,b,c){for(var e=[],f=0,h=a.length,m=!c;f<h;f++)c=!b(a[f],
f),c!==m&&e.push(a[f]);return e},map:function(a,b,c){var f,h,m=0,q=[];if(e(a))for(f=a.length;m<f;m++)h=b(a[m],m,c),null!=h&&q.push(h);else for(m in a)h=b(a[m],m,c),null!=h&&q.push(h);return na.apply([],q)},guid:1,proxy:function(a,b){var c,e,f;if("string"==typeof b&&(c=a[b],b=a,a=c),w.isFunction(a))return e=Ja.call(arguments,2),f=function(){return a.apply(b||this,e.concat(Ja.call(arguments)))},f.guid=a.guid=a.guid||w.guid++,f},now:Date.now,support:oa});"function"==typeof Symbol&&(w.fn[Symbol.iterator]=
za[Symbol.iterator]);w.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(a,b){$a["[object "+b+"]"]=b.toLowerCase()});var Ta=function(a){function b(a,b,c,e){var f,h,m,q,r,l=b&&b.ownerDocument,t=b?b.nodeType:9;if(c=c||[],"string"!=typeof a||!a||1!==t&&9!==t&&11!==t)return c;if(!e&&((b?b.ownerDocument||b:T)!==X&&N(b),b=b||X,Q)){if(11!==t&&(q=Da.exec(a)))if(f=q[1])if(9===t){if(!(h=b.getElementById(f)))return c;if(h.id===f)return c.push(h),c}else{if(l&&(h=
l.getElementById(f))&&V(b,h)&&h.id===f)return c.push(h),c}else{if(q[2])return fa.apply(c,b.getElementsByTagName(a)),c;if((f=q[3])&&G.getElementsByClassName&&b.getElementsByClassName)return fa.apply(c,b.getElementsByClassName(f)),c}if(!(!G.qsa||ba[a+" "]||O&&O.test(a))){if(1!==t)l=b,r=a;else if("object"!==b.nodeName.toLowerCase()){(m=b.getAttribute("id"))?m=m.replace(Fa,Ga):b.setAttribute("id",m=R);h=Y(a);for(f=h.length;f--;)h[f]="#"+m+" "+x(h[f]);r=h.join(",");l=Ca.test(a)&&K(b.parentNode)||b}if(r)try{return fa.apply(c,
l.querySelectorAll(r)),c}catch(rc){}finally{m===R&&b.removeAttribute("id")}}}return Aa(a.replace(na,"$1"),b,c,e)}function c(){function a(c,e){return b.push(c+" ")>Z.cacheLength&&delete a[b.shift()],a[c+" "]=e}var b=[];return a}function e(a){return a[R]=!0,a}function f(a){var b=X.createElement("fieldset");try{return!!a(b)}catch(pc){return!1}finally{b.parentNode&&b.parentNode.removeChild(b)}}function h(a,b){for(var c=a.split("|"),e=c.length;e--;)Z.attrHandle[c[e]]=b}function m(a,b){var c=b&&a,e=c&&
1===a.nodeType&&1===b.nodeType&&a.sourceIndex-b.sourceIndex;if(e)return e;if(c)for(;c=c.nextSibling;)if(c===b)return-1;return a?1:-1}function q(a){return function(b){return"input"===b.nodeName.toLowerCase()&&b.type===a}}function r(a){return function(b){var c=b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}}function l(a){return function(b){return"form"in b?b.parentNode&&!1===b.disabled?"label"in b?"label"in b.parentNode?b.parentNode.disabled===a:b.disabled===a:b.isDisabled===
a||b.isDisabled!==!a&&Jb(b)===a:b.disabled===a:"label"in b&&b.disabled===a}}function t(a){return e(function(b){return b=+b,e(function(c,e){for(var f,h=a([],c.length,b),m=h.length;m--;)c[f=h[m]]&&(c[f]=!(e[f]=c[f]))})})}function K(a){return a&&"undefined"!=typeof a.getElementsByTagName&&a}function y(){}function x(a){for(var b=0,c=a.length,e="";b<c;b++)e+=a[b].value;return e}function w(a,b,c){var e=b.dir,f=b.next,h=f||e,m=c&&"parentNode"===h,q=ca++;return b.first?function(b,c,f){for(;b=b[e];)if(1===
b.nodeType||m)return a(b,c,f);return!1}:function(b,c,r){var l,t,K,y=[W,q];if(r)for(;b=b[e];){if((1===b.nodeType||m)&&a(b,c,r))return!0}else for(;b=b[e];)if(1===b.nodeType||m)if(K=b[R]||(b[R]={}),t=K[b.uniqueID]||(K[b.uniqueID]={}),f&&f===b.nodeName.toLowerCase())b=b[e]||b;else{if((l=t[h])&&l[0]===W&&l[1]===q)return y[2]=l[2];if(t[h]=y,y[2]=a(b,c,r))return!0}return!1}}function B(a){return 1<a.length?function(b,c,e){for(var f=a.length;f--;)if(!a[f](b,c,e))return!1;return!0}:a[0]}function z(a,b,c,e,
f){for(var h,m=[],q=0,r=a.length,l=null!=b;q<r;q++)(h=a[q])&&(c&&!c(h,e,f)||(m.push(h),l&&b.push(q)));return m}function ra(a,c,f,h,m,q){return h&&!h[R]&&(h=ra(h)),m&&!m[R]&&(m=ra(m,q)),e(function(e,q,r,l){var t,K,y=[],x=[],w=q.length,da;if(!(da=e)){da=c||"*";for(var B=r.nodeType?[r]:r,kb=[],lb=0,ra=B.length;lb<ra;lb++)b(da,B[lb],kb);da=kb}da=!a||!e&&c?da:z(da,y,a,r,l);B=f?m||(e?a:w||h)?[]:q:da;if(f&&f(da,B,r,l),h)for(t=z(B,x),h(t,[],r,l),r=t.length;r--;)(K=t[r])&&(B[x[r]]=!(da[x[r]]=K));if(e){if(m||
a){if(m){t=[];for(r=B.length;r--;)(K=B[r])&&t.push(da[r]=K);m(null,B=[],t,l)}for(r=B.length;r--;)(K=B[r])&&-1<(t=m?ka(e,K):y[r])&&(e[t]=!(q[t]=K))}}else B=z(B===q?B.splice(w,B.length):B),m?m(null,q,B,l):fa.apply(q,B)})}function E(a){var b,c,e,f=a.length,h=Z.relative[a[0].type];c=h||Z.relative[" "];for(var m=h?1:0,q=w(function(a){return a===b},c,!0),r=w(function(a){return-1<ka(b,a)},c,!0),l=[function(a,c,e){a=!h&&(e||c!==J)||((b=c).nodeType?q(a,c,e):r(a,c,e));return b=null,a}];m<f;m++)if(c=Z.relative[a[m].type])l=
[w(B(l),c)];else{if(c=Z.filter[a[m].type].apply(null,a[m].matches),c[R]){for(e=++m;e<f&&!Z.relative[a[e].type];e++);return ra(1<m&&B(l),1<m&&x(a.slice(0,m-1).concat({value:" "===a[m-2].type?"*":""})).replace(na,"$1"),c,m<e&&E(a.slice(m,e)),e<f&&E(a=a.slice(e)),e<f&&x(a))}l.push(c)}return B(l)}function D(a,c){var f=0<c.length,h=0<a.length,m=function(e,m,q,r,l){var t,K,y,x=0,w="0",da=e&&[],B=[],kb=J,lb=e||h&&Z.find.TAG("*",l),ra=W+=null==kb?1:Math.random()||.1,E=lb.length;for(l&&(J=m===X||m||l);w!==
E&&null!=(t=lb[w]);w++){if(h&&t){K=0;for(m||t.ownerDocument===X||(N(t),q=!Q);y=a[K++];)if(y(t,m||X,q)){r.push(t);break}l&&(W=ra)}f&&((t=!y&&t)&&x--,e&&da.push(t))}if(x+=w,f&&w!==x){for(K=0;y=c[K++];)y(da,B,m,q);if(e){if(0<x)for(;w--;)da[w]||B[w]||(B[w]=la.call(r));B=z(B)}fa.apply(r,B);l&&!e&&0<B.length&&1<x+c.length&&b.uniqueSort(r)}return l&&(W=ra,J=kb),da};return f?e(m):m}var Ea,G,Z,F,H,Y,I,Aa,J,M,L,N,X,S,Q,O,Ia,U,V,R="sizzle"+1*new Date,T=a.document,W=0,ca=0,ea=c(),ia=c(),ba=c(),ha=function(a,
b){return a===b&&(L=!0),0},ja={}.hasOwnProperty,aa=[],la=aa.pop,ma=aa.push,fa=aa.push,oa=aa.slice,ka=function(a,b){for(var c=0,e=a.length;c<e;c++)if(a[c]===b)return c;return-1},pa=RegExp("[\\x20\\t\\r\\n\\f]+","g"),na=RegExp("^[\\x20\\t\\r\\n\\f]+|((?:^|[^\\\\])(?:\\\\.)*)[\\x20\\t\\r\\n\\f]+$","g"),sa=/^[\x20\t\r\n\f]*,[\x20\t\r\n\f]*/,ua=/^[\x20\t\r\n\f]*([>+~]|[\x20\t\r\n\f])[\x20\t\r\n\f]*/,va=RegExp("=[\\x20\\t\\r\\n\\f]*([^\\]'\"]*?)[\\x20\\t\\r\\n\\f]*\\]","g"),Ib=/:((?:\\.|[\w-]|[^\x00-\xa0])+)(?:\((('((?:\\.|[^\\'])*)'|"((?:\\.|[^\\"])*)")|((?:\\.|[^\\()[\]]|\[[\x20\t\r\n\f]*((?:\\.|[\w-]|[^\x00-\xa0])+)(?:[\x20\t\r\n\f]*([*^$|!~]?=)[\x20\t\r\n\f]*(?:'((?:\\.|[^\\'])*)'|"((?:\\.|[^\\"])*)"|((?:\\.|[\w-]|[^\x00-\xa0])+))|)[\x20\t\r\n\f]*\])*)|.*)\)|)/,
ya=/^(?:\\.|[\w-]|[^\x00-\xa0])+$/,qa={ID:/^#((?:\\.|[\w-]|[^\x00-\xa0])+)/,CLASS:/^\.((?:\\.|[\w-]|[^\x00-\xa0])+)/,TAG:/^((?:\\.|[\w-]|[^\x00-\xa0])+|[*])/,ATTR:/^\[[\x20\t\r\n\f]*((?:\\.|[\w-]|[^\x00-\xa0])+)(?:[\x20\t\r\n\f]*([*^$|!~]?=)[\x20\t\r\n\f]*(?:'((?:\\.|[^\\'])*)'|"((?:\\.|[^\\"])*)"|((?:\\.|[\w-]|[^\x00-\xa0])+))|)[\x20\t\r\n\f]*\]/,PSEUDO:/^:((?:\\.|[\w-]|[^\x00-\xa0])+)(?:\((('((?:\\.|[^\\'])*)'|"((?:\\.|[^\\"])*)")|((?:\\.|[^\\()[\]]|\[[\x20\t\r\n\f]*((?:\\.|[\w-]|[^\x00-\xa0])+)(?:[\x20\t\r\n\f]*([*^$|!~]?=)[\x20\t\r\n\f]*(?:'((?:\\.|[^\\'])*)'|"((?:\\.|[^\\"])*)"|((?:\\.|[\w-]|[^\x00-\xa0])+))|)[\x20\t\r\n\f]*\])*)|.*)\)|)/,
CHILD:/^:(only|first|last|nth|nth-last)-(child|of-type)(?:\([\x20\t\r\n\f]*(even|odd|(([+-]|)(\d*)n|)[\x20\t\r\n\f]*(?:([+-]|)[\x20\t\r\n\f]*(\d+)|))[\x20\t\r\n\f]*\)|)/i,bool:/^(?:checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped)$/i,needsContext:/^[\x20\t\r\n\f]*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\([\x20\t\r\n\f]*((?:-\d)?\d*)[\x20\t\r\n\f]*\)|)(?=[^-]|$)/i},za=/^(?:input|select|textarea|button)$/i,Ba=/^h\d$/i,ta=
/^[^{]+\{\s*\[native \w/,Da=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,Ca=/[+~]/,wa=RegExp("\\\\([\\da-f]{1,6}[\\x20\\t\\r\\n\\f]?|([\\x20\\t\\r\\n\\f])|.)","ig"),xa=function(a,b,c){a="0x"+b-65536;return a!==a||c?b:0>a?String.fromCharCode(a+65536):String.fromCharCode(a>>10|55296,1023&a|56320)},Fa=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,Ga=function(a,b){return b?"\x00"===a?"\ufffd":a.slice(0,-1)+"\\"+a.charCodeAt(a.length-1).toString(16)+" ":"\\"+a},Ha=function(){N()},Jb=w(function(a){return!0===
a.disabled&&("form"in a||"label"in a)},{dir:"parentNode",next:"legend"});try{fa.apply(aa=oa.call(T.childNodes),T.childNodes),aa[T.childNodes.length].nodeType}catch(oc){fa={apply:aa.length?function(a,b){ma.apply(a,oa.call(b))}:function(a,b){for(var c=a.length,e=0;a[c++]=b[e++];);a.length=c-1}}}G=b.support={};H=b.isXML=function(a){a=a&&(a.ownerDocument||a).documentElement;return!!a&&"HTML"!==a.nodeName};N=b.setDocument=function(a){var b,c;a=a?a.ownerDocument||a:T;return a!==X&&9===a.nodeType&&a.documentElement?
(X=a,S=X.documentElement,Q=!H(X),T!==X&&(c=X.defaultView)&&c.top!==c&&(c.addEventListener?c.addEventListener("unload",Ha,!1):c.attachEvent&&c.attachEvent("onunload",Ha)),G.attributes=f(function(a){return a.className="i",!a.getAttribute("className")}),G.getElementsByTagName=f(function(a){return a.appendChild(X.createComment("")),!a.getElementsByTagName("*").length}),G.getElementsByClassName=ta.test(X.getElementsByClassName),G.getById=f(function(a){return S.appendChild(a).id=R,!X.getElementsByName||
!X.getElementsByName(R).length}),G.getById?(Z.filter.ID=function(a){var b=a.replace(wa,xa);return function(a){return a.getAttribute("id")===b}},Z.find.ID=function(a,b){if("undefined"!=typeof b.getElementById&&Q){var c=b.getElementById(a);return c?[c]:[]}}):(Z.filter.ID=function(a){var b=a.replace(wa,xa);return function(a){return(a="undefined"!=typeof a.getAttributeNode&&a.getAttributeNode("id"))&&a.value===b}},Z.find.ID=function(a,b){if("undefined"!=typeof b.getElementById&&Q){var c,e,f,h=b.getElementById(a);
if(h){if(c=h.getAttributeNode("id"),c&&c.value===a)return[h];f=b.getElementsByName(a);for(e=0;h=f[e++];)if(c=h.getAttributeNode("id"),c&&c.value===a)return[h]}return[]}}),Z.find.TAG=G.getElementsByTagName?function(a,b){return"undefined"!=typeof b.getElementsByTagName?b.getElementsByTagName(a):G.qsa?b.querySelectorAll(a):void 0}:function(a,b){var c,e=[],f=0,h=b.getElementsByTagName(a);if("*"===a){for(;c=h[f++];)1===c.nodeType&&e.push(c);return e}return h},Z.find.CLASS=G.getElementsByClassName&&function(a,
b){if("undefined"!=typeof b.getElementsByClassName&&Q)return b.getElementsByClassName(a)},Ia=[],O=[],(G.qsa=ta.test(X.querySelectorAll))&&(f(function(a){S.appendChild(a).innerHTML="<a id='"+R+"'></a><select id='"+R+"-\r\\' msallowcapture=''><option selected=''></option></select>";a.querySelectorAll("[msallowcapture^='']").length&&O.push("[*^$]=[\\x20\\t\\r\\n\\f]*(?:''|\"\")");a.querySelectorAll("[selected]").length||O.push("\\[[\\x20\\t\\r\\n\\f]*(?:value|checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped)");
a.querySelectorAll("[id~="+R+"-]").length||O.push("~=");a.querySelectorAll(":checked").length||O.push(":checked");a.querySelectorAll("a#"+R+"+*").length||O.push(".#.+[+~]")}),f(function(a){a.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var b=X.createElement("input");b.setAttribute("type","hidden");a.appendChild(b).setAttribute("name","D");a.querySelectorAll("[name=d]").length&&O.push("name[\\x20\\t\\r\\n\\f]*[*^$|!~]?=");2!==a.querySelectorAll(":enabled").length&&
O.push(":enabled",":disabled");S.appendChild(a).disabled=!0;2!==a.querySelectorAll(":disabled").length&&O.push(":enabled",":disabled");a.querySelectorAll("*,:x");O.push(",.*:")})),(G.matchesSelector=ta.test(U=S.matches||S.webkitMatchesSelector||S.mozMatchesSelector||S.oMatchesSelector||S.msMatchesSelector))&&f(function(a){G.disconnectedMatch=U.call(a,"*");U.call(a,"[s!='']:x");Ia.push("!=",":((?:\\\\.|[\\w-]|[^\x00-\\xa0])+)(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|\\[[\\x20\\t\\r\\n\\f]*((?:\\\\.|[\\w-]|[^\x00-\\xa0])+)(?:[\\x20\\t\\r\\n\\f]*([*^$|!~]?=)[\\x20\\t\\r\\n\\f]*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|((?:\\\\.|[\\w-]|[^\x00-\\xa0])+))|)[\\x20\\t\\r\\n\\f]*\\])*)|.*)\\)|)")}),
O=O.length&&new RegExp(O.join("|")),Ia=Ia.length&&new RegExp(Ia.join("|")),b=ta.test(S.compareDocumentPosition),V=b||ta.test(S.contains)?function(a,b){var c=9===a.nodeType?a.documentElement:a,e=b&&b.parentNode;return a===e||!(!e||1!==e.nodeType||!(c.contains?c.contains(e):a.compareDocumentPosition&&16&a.compareDocumentPosition(e)))}:function(a,b){if(b)for(;b=b.parentNode;)if(b===a)return!0;return!1},ha=b?function(a,b){if(a===b)return L=!0,0;var c=!a.compareDocumentPosition-!b.compareDocumentPosition;
return c?c:(c=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1,1&c||!G.sortDetached&&b.compareDocumentPosition(a)===c?a===X||a.ownerDocument===T&&V(T,a)?-1:b===X||b.ownerDocument===T&&V(T,b)?1:M?ka(M,a)-ka(M,b):0:4&c?-1:1)}:function(a,b){if(a===b)return L=!0,0;var c,e=0;c=a.parentNode;var f=b.parentNode,h=[a],q=[b];if(!c||!f)return a===X?-1:b===X?1:c?-1:f?1:M?ka(M,a)-ka(M,b):0;if(c===f)return m(a,b);for(c=a;c=c.parentNode;)h.unshift(c);for(c=b;c=c.parentNode;)q.unshift(c);
for(;h[e]===q[e];)e++;return e?m(h[e],q[e]):h[e]===T?-1:q[e]===T?1:0},X):X};b.matches=function(a,c){return b(a,null,null,c)};b.matchesSelector=function(a,c){if((a.ownerDocument||a)!==X&&N(a),c=c.replace(va,"='$1']"),!(!G.matchesSelector||!Q||ba[c+" "]||Ia&&Ia.test(c)||O&&O.test(c)))try{var e=U.call(a,c);if(e||G.disconnectedMatch||a.document&&11!==a.document.nodeType)return e}catch(qc){}return 0<b(c,X,null,[a]).length};b.contains=function(a,b){return(a.ownerDocument||a)!==X&&N(a),V(a,b)};b.attr=function(a,
b){(a.ownerDocument||a)!==X&&N(a);var c=Z.attrHandle[b.toLowerCase()],c=c&&ja.call(Z.attrHandle,b.toLowerCase())?c(a,b,!Q):void 0;return void 0!==c?c:G.attributes||!Q?a.getAttribute(b):(c=a.getAttributeNode(b))&&c.specified?c.value:null};b.escape=function(a){return(a+"").replace(Fa,Ga)};b.error=function(a){throw Error("Syntax error, unrecognized expression: "+a);};b.uniqueSort=function(a){var b,c=[],e=0,f=0;if(L=!G.detectDuplicates,M=!G.sortStable&&a.slice(0),a.sort(ha),L){for(;b=a[f++];)b===a[f]&&
(e=c.push(f));for(;e--;)a.splice(c[e],1)}return M=null,a};F=b.getText=function(a){var b,c="",e=0;if(b=a.nodeType)if(1===b||9===b||11===b){if("string"==typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=F(a)}else{if(3===b||4===b)return a.nodeValue}else for(;b=a[e++];)c+=F(b);return c};Z=b.selectors={cacheLength:50,createPseudo:e,match:qa,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},
preFilter:{ATTR:function(a){return a[1]=a[1].replace(wa,xa),a[3]=(a[3]||a[4]||a[5]||"").replace(wa,xa),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),"nth"===a[1].slice(0,3)?(a[3]||b.error(a[0]),a[4]=+(a[4]?a[5]+(a[6]||1):2*("even"===a[3]||"odd"===a[3])),a[5]=+(a[7]+a[8]||"odd"===a[3])):a[3]&&b.error(a[0]),a},PSEUDO:function(a){var b,c=!a[6]&&a[2];return qa.CHILD.test(a[0])?null:(a[3]?a[2]=a[4]||a[5]||"":c&&Ib.test(c)&&(b=Y(c,!0))&&(b=c.indexOf(")",
c.length-b)-c.length)&&(a[0]=a[0].slice(0,b),a[2]=c.slice(0,b)),a.slice(0,3))}},filter:{TAG:function(a){var b=a.replace(wa,xa).toLowerCase();return"*"===a?function(){return!0}:function(a){return a.nodeName&&a.nodeName.toLowerCase()===b}},CLASS:function(a){var b=ea[a+" "];return b||(b=new RegExp("(^|[\\x20\\t\\r\\n\\f])"+a+"([\\x20\\t\\r\\n\\f]|$)"),ea(a,function(a){return b.test("string"==typeof a.className&&a.className||"undefined"!=typeof a.getAttribute&&a.getAttribute("class")||"")}))},ATTR:function(a,
c,e){return function(f){f=b.attr(f,a);return null==f?"!="===c:!c||(f+="","="===c?f===e:"!="===c?f!==e:"^="===c?e&&0===f.indexOf(e):"*="===c?e&&-1<f.indexOf(e):"$="===c?e&&f.slice(-e.length)===e:"~="===c?-1<(" "+f.replace(pa," ")+" ").indexOf(e):"|="===c&&(f===e||f.slice(0,e.length+1)===e+"-"))}},CHILD:function(a,b,c,e,f){var h="nth"!==a.slice(0,3),m="last"!==a.slice(-4),q="of-type"===b;return 1===e&&0===f?function(a){return!!a.parentNode}:function(b,c,r){var l,t,K,y,x,w;c=h!==m?"nextSibling":"previousSibling";
var da=b.parentNode,B=q&&b.nodeName.toLowerCase();r=!r&&!q;var z=!1;if(da){if(h){for(;c;){for(y=b;y=y[c];)if(q?y.nodeName.toLowerCase()===B:1===y.nodeType)return!1;w=c="only"===a&&!w&&"nextSibling"}return!0}if(w=[m?da.firstChild:da.lastChild],m&&r)for(y=da,K=y[R]||(y[R]={}),t=K[y.uniqueID]||(K[y.uniqueID]={}),l=t[a]||[],z=(x=l[0]===W&&l[1])&&l[2],y=x&&da.childNodes[x];y=++x&&y&&y[c]||(z=x=0)||w.pop();){if(1===y.nodeType&&++z&&y===b){t[a]=[W,x,z];break}}else if(r&&(y=b,K=y[R]||(y[R]={}),t=K[y.uniqueID]||
(K[y.uniqueID]={}),l=t[a]||[],x=l[0]===W&&l[1],z=x),!1===z)for(;(y=++x&&y&&y[c]||(z=x=0)||w.pop())&&((q?y.nodeName.toLowerCase()!==B:1!==y.nodeType)||!++z||(r&&(K=y[R]||(y[R]={}),t=K[y.uniqueID]||(K[y.uniqueID]={}),t[a]=[W,z]),y!==b)););return z-=f,z===e||0===z%e&&0<=z/e}}},PSEUDO:function(a,c){var f,h=Z.pseudos[a]||Z.setFilters[a.toLowerCase()]||b.error("unsupported pseudo: "+a);return h[R]?h(c):1<h.length?(f=[a,a,"",c],Z.setFilters.hasOwnProperty(a.toLowerCase())?e(function(a,b){for(var e,f=h(a,
c),m=f.length;m--;)e=ka(a,f[m]),a[e]=!(b[e]=f[m])}):function(a){return h(a,0,f)}):h}},pseudos:{not:e(function(a){var b=[],c=[],f=I(a.replace(na,"$1"));return f[R]?e(function(a,b,c,e){var h;c=f(a,null,e,[]);for(e=a.length;e--;)(h=c[e])&&(a[e]=!(b[e]=h))}):function(a,e,h){return b[0]=a,f(b,null,h,c),b[0]=null,!c.pop()}}),has:e(function(a){return function(c){return 0<b(a,c).length}}),contains:e(function(a){return a=a.replace(wa,xa),function(b){return-1<(b.textContent||b.innerText||F(b)).indexOf(a)}}),
lang:e(function(a){return ya.test(a||"")||b.error("unsupported lang: "+a),a=a.replace(wa,xa).toLowerCase(),function(b){var c;do if(c=Q?b.lang:b.getAttribute("xml:lang")||b.getAttribute("lang"))return c=c.toLowerCase(),c===a||0===c.indexOf(a+"-");while((b=b.parentNode)&&1===b.nodeType);return!1}}),target:function(b){var c=a.location&&a.location.hash;return c&&c.slice(1)===b.id},root:function(a){return a===S},focus:function(a){return a===X.activeElement&&(!X.hasFocus||X.hasFocus())&&!!(a.type||a.href||
~a.tabIndex)},enabled:l(!1),disabled:l(!0),checked:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,!0===a.selected},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling)if(6>a.nodeType)return!1;return!0},parent:function(a){return!Z.pseudos.empty(a)},header:function(a){return Ba.test(a.nodeName)},input:function(a){return za.test(a.nodeName)},button:function(a){var b=a.nodeName.toLowerCase();
return"input"===b&&"button"===a.type||"button"===b},text:function(a){var b;return"input"===a.nodeName.toLowerCase()&&"text"===a.type&&(null==(b=a.getAttribute("type"))||"text"===b.toLowerCase())},first:t(function(){return[0]}),last:t(function(a,b){return[b-1]}),eq:t(function(a,b,c){return[0>c?c+b:c]}),even:t(function(a,b){for(var c=0;c<b;c+=2)a.push(c);return a}),odd:t(function(a,b){for(var c=1;c<b;c+=2)a.push(c);return a}),lt:t(function(a,b,c){for(b=0>c?c+b:c;0<=--b;)a.push(b);return a}),gt:t(function(a,
b,c){for(c=0>c?c+b:c;++c<b;)a.push(c);return a})}};Z.pseudos.nth=Z.pseudos.eq;for(Ea in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})Z.pseudos[Ea]=q(Ea);for(Ea in{submit:!0,reset:!0})Z.pseudos[Ea]=r(Ea);y.prototype=Z.filters=Z.pseudos;Z.setFilters=new y;Y=b.tokenize=function(a,c){var e,f,h,m,q,r,l;if(q=ia[a+" "])return c?0:q.slice(0);q=a;r=[];for(l=Z.preFilter;q;){e&&!(f=sa.exec(q))||(f&&(q=q.slice(f[0].length)||q),r.push(h=[]));e=!1;(f=ua.exec(q))&&(e=f.shift(),h.push({value:e,type:f[0].replace(na,
" ")}),q=q.slice(e.length));for(m in Z.filter)!(f=qa[m].exec(q))||l[m]&&!(f=l[m](f))||(e=f.shift(),h.push({value:e,type:m,matches:f}),q=q.slice(e.length));if(!e)break}return c?q.length:q?b.error(a):ia(a,r).slice(0)};return I=b.compile=function(a,b){var c,e=[],f=[],h=ba[a+" "];if(!h){b||(b=Y(a));for(c=b.length;c--;)h=E(b[c]),h[R]?e.push(h):f.push(h);h=ba(a,D(f,e));h.selector=a}return h},Aa=b.select=function(a,b,c,e){var f,h,m,q,r,l="function"==typeof a&&a,t=!e&&Y(a=l.selector||a);if(c=c||[],1===t.length){if(h=
t[0]=t[0].slice(0),2<h.length&&"ID"===(m=h[0]).type&&9===b.nodeType&&Q&&Z.relative[h[1].type]){if(b=(Z.find.ID(m.matches[0].replace(wa,xa),b)||[])[0],!b)return c;l&&(b=b.parentNode);a=a.slice(h.shift().value.length)}for(f=qa.needsContext.test(a)?0:h.length;f--&&(m=h[f],!Z.relative[q=m.type]);)if((r=Z.find[q])&&(e=r(m.matches[0].replace(wa,xa),Ca.test(h[0].type)&&K(b.parentNode)||b))){if(h.splice(f,1),a=e.length&&x(h),!a)return fa.apply(c,e),c;break}}return(l||I(a,t))(e,b,!Q,c,!b||Ca.test(a)&&K(b.parentNode)||
b),c},G.sortStable=R.split("").sort(ha).join("")===R,G.detectDuplicates=!!L,N(),G.sortDetached=f(function(a){return 1&a.compareDocumentPosition(X.createElement("fieldset"))}),f(function(a){return a.innerHTML="<a href='#'></a>","#"===a.firstChild.getAttribute("href")})||h("type|href|height|width",function(a,b,c){if(!c)return a.getAttribute(b,"type"===b.toLowerCase()?1:2)}),G.attributes&&f(function(a){return a.innerHTML="<input/>",a.firstChild.setAttribute("value",""),""===a.firstChild.getAttribute("value")})||
h("value",function(a,b,c){if(!c&&"input"===a.nodeName.toLowerCase())return a.defaultValue}),f(function(a){return null==a.getAttribute("disabled")})||h("checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",function(a,b,c){var e;if(!c)return!0===a[b]?b.toLowerCase():(e=a.getAttributeNode(b))&&e.specified?e.value:null}),b}(b);w.find=Ta;w.expr=Ta.selectors;w.expr[":"]=w.expr.pseudos;w.uniqueSort=w.unique=Ta.uniqueSort;w.text=Ta.getText;
w.isXMLDoc=Ta.isXML;w.contains=Ta.contains;w.escapeSelector=Ta.escape;var qa=function(a,b,c){for(var e=[],f=void 0!==c;(a=a[b])&&9!==a.nodeType;)if(1===a.nodeType){if(f&&w(a).is(c))break;e.push(a)}return e},Qa=function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c},ua=w.expr.match.needsContext,Da=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i,ib=/^.[^:#\[\.,]*$/;w.filter=function(a,b,c){var e=b[0];return c&&(a=":not("+a+")"),1===b.length&&1===e.nodeType?
w.find.matchesSelector(e,a)?[e]:[]:w.find.matches(a,w.grep(b,function(a){return 1===a.nodeType}))};w.fn.extend({find:function(a){var b,c,e=this.length,f=this;if("string"!=typeof a)return this.pushStack(w(a).filter(function(){for(b=0;b<e;b++)if(w.contains(f[b],this))return!0}));c=this.pushStack([]);for(b=0;b<e;b++)w.find(a,f[b],c);return 1<e?w.uniqueSort(c):c},filter:function(a){return this.pushStack(f(this,a||[],!1))},not:function(a){return this.pushStack(f(this,a||[],!0))},is:function(a){return!!f(this,
"string"==typeof a&&ua.test(a)?w(a):a||[],!1).length}});var Wa,ab=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(w.fn.init=function(a,b,c){var e,f;if(!a)return this;if(c=c||Wa,"string"==typeof a){if(e="<"===a[0]&&">"===a[a.length-1]&&3<=a.length?[null,a,null]:ab.exec(a),!e||!e[1]&&b)return!b||b.jquery?(b||c).find(a):this.constructor(b).find(a);if(e[1]){if(b=b instanceof w?b[0]:b,w.merge(this,w.parseHTML(e[1],b&&b.nodeType?b.ownerDocument||b:V,!0)),Da.test(e[1])&&w.isPlainObject(b))for(e in b)w.isFunction(this[e])?
this[e](b[e]):this.attr(e,b[e]);return this}return f=V.getElementById(e[2]),f&&(this[0]=f,this.length=1),this}return a.nodeType?(this[0]=a,this.length=1,this):w.isFunction(a)?void 0!==c.ready?c.ready(a):a(w):w.makeArray(a,this)}).prototype=w.fn;Wa=w(V);var bb=/^(?:parents|prev(?:Until|All))/,cb={children:!0,contents:!0,next:!0,prev:!0};w.fn.extend({has:function(a){var b=w(a,this),c=b.length;return this.filter(function(){for(var a=0;a<c;a++)if(w.contains(this,b[a]))return!0})},closest:function(a,b){var c,
e=0,f=this.length,h=[],m="string"!=typeof a&&w(a);if(!ua.test(a))for(;e<f;e++)for(c=this[e];c&&c!==b;c=c.parentNode)if(11>c.nodeType&&(m?-1<m.index(c):1===c.nodeType&&w.find.matchesSelector(c,a))){h.push(c);break}return this.pushStack(1<h.length?w.uniqueSort(h):h)},index:function(a){return a?"string"==typeof a?Za.call(w(a),this[0]):Za.call(this,a.jquery?a[0]:a):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,b){return this.pushStack(w.uniqueSort(w.merge(this.get(),w(a,
b))))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}});w.each({parent:function(a){return(a=a.parentNode)&&11!==a.nodeType?a:null},parents:function(a){return qa(a,"parentNode")},parentsUntil:function(a,b,c){return qa(a,"parentNode",c)},next:function(a){return h(a,"nextSibling")},prev:function(a){return h(a,"previousSibling")},nextAll:function(a){return qa(a,"nextSibling")},prevAll:function(a){return qa(a,"previousSibling")},nextUntil:function(a,b,c){return qa(a,
"nextSibling",c)},prevUntil:function(a,b,c){return qa(a,"previousSibling",c)},siblings:function(a){return Qa((a.parentNode||{}).firstChild,a)},children:function(a){return Qa(a.firstChild)},contents:function(a){return a.contentDocument||w.merge([],a.childNodes)}},function(a,b){w.fn[a]=function(c,e){var f=w.map(this,b,c);return"Until"!==a.slice(-5)&&(e=c),e&&"string"==typeof e&&(f=w.filter(e,f)),1<this.length&&(cb[a]||w.uniqueSort(f),bb.test(a)&&f.reverse()),this.pushStack(f)}});var va=/[^\x20\t\r\n\f]+/g;
w.Callbacks=function(a){a="string"==typeof a?l(a):w.extend({},a);var b,c,e,f,h=[],m=[],q=-1,r=function(){f=a.once;for(e=b=!0;m.length;q=-1)for(c=m.shift();++q<h.length;)!1===h[q].apply(c[0],c[1])&&a.stopOnFalse&&(q=h.length,c=!1);a.memory||(c=!1);b=!1;f&&(h=c?[]:"")},t={add:function(){return h&&(c&&!b&&(q=h.length-1,m.push(c)),function Xb(b){w.each(b,function(b,c){w.isFunction(c)?a.unique&&t.has(c)||h.push(c):c&&c.length&&"string"!==w.type(c)&&Xb(c)})}(arguments),c&&!b&&r()),this},remove:function(){return w.each(arguments,
function(a,b){for(var c;-1<(c=w.inArray(b,h,c));)h.splice(c,1),c<=q&&q--}),this},has:function(a){return a?-1<w.inArray(a,h):0<h.length},empty:function(){return h&&(h=[]),this},disable:function(){return f=m=[],h=c="",this},disabled:function(){return!h},lock:function(){return f=m=[],c||b||(h=c=""),this},locked:function(){return!!f},fireWith:function(a,c){return f||(c=c||[],c=[a,c.slice?c.slice():c],m.push(c),b||r()),this},fire:function(){return t.fireWith(this,arguments),this},fired:function(){return!!e}};
return t};w.extend({Deferred:function(a){var c=[["notify","progress",w.Callbacks("memory"),w.Callbacks("memory"),2],["resolve","done",w.Callbacks("once memory"),w.Callbacks("once memory"),0,"resolved"],["reject","fail",w.Callbacks("once memory"),w.Callbacks("once memory"),1,"rejected"]],e="pending",f={state:function(){return e},always:function(){return h.done(arguments).fail(arguments),this},"catch":function(a){return f.then(null,a)},pipe:function(){var a=arguments;return w.Deferred(function(b){w.each(c,
function(c,e){var f=w.isFunction(a[e[4]])&&a[e[4]];h[e[1]](function(){var a=f&&f.apply(this,arguments);a&&w.isFunction(a.promise)?a.promise().progress(b.notify).done(b.resolve).fail(b.reject):b[e[0]+"With"](this,f?[a]:arguments)})});a=null}).promise()},then:function(a,e,f){function h(a,c,e,f){return function(){var q=this,r=arguments,l=function(){var b,l;if(!(a<m)){if(b=e.apply(q,r),b===c.promise())throw new TypeError("Thenable self-resolution");l=b&&("object"==typeof b||"function"==typeof b)&&b.then;
w.isFunction(l)?f?l.call(b,h(m,c,t,f),h(m,c,x,f)):(m++,l.call(b,h(m,c,t,f),h(m,c,x,f),h(m,c,t,c.notifyWith))):(e!==t&&(q=void 0,r=[b]),(f||c.resolveWith)(q,r))}},y=f?l:function(){try{l()}catch(Ob){w.Deferred.exceptionHook&&w.Deferred.exceptionHook(Ob,y.stackTrace),a+1>=m&&(e!==x&&(q=void 0,r=[Ob]),c.rejectWith(q,r))}};a?y():(w.Deferred.getStackHook&&(y.stackTrace=w.Deferred.getStackHook()),b.setTimeout(y))}}var m=0;return w.Deferred(function(b){c[0][3].add(h(0,b,w.isFunction(f)?f:t,b.notifyWith));
c[1][3].add(h(0,b,w.isFunction(a)?a:t));c[2][3].add(h(0,b,w.isFunction(e)?e:x))}).promise()},promise:function(a){return null!=a?w.extend(a,f):f}},h={};return w.each(c,function(a,b){var m=b[2],q=b[5];f[b[1]]=m.add;q&&m.add(function(){e=q},c[3-a][2].disable,c[0][2].lock);m.add(b[3].fire);h[b[0]]=function(){return h[b[0]+"With"](this===h?void 0:this,arguments),this};h[b[0]+"With"]=m.fireWith}),f.promise(h),a&&a.call(h,h),h},when:function(a){var b=arguments.length,c=b,e=Array(c),f=Ja.call(arguments),
h=w.Deferred(),m=function(a){return function(c){e[a]=this;f[a]=1<arguments.length?Ja.call(arguments):c;--b||h.resolveWith(e,f)}};if(1>=b&&(q(a,h.done(m(c)).resolve,h.reject),"pending"===h.state()||w.isFunction(f[c]&&f[c].then)))return h.then();for(;c--;)q(f[c],m(c),h.reject);return h.promise()}});var la=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;w.Deferred.exceptionHook=function(a,c){b.console&&b.console.warn&&a&&la.test(a.name)&&b.console.warn("jQuery.Deferred exception: "+a.message,
a.stack,c)};w.readyException=function(a){b.setTimeout(function(){throw a;})};var jb=w.Deferred();w.fn.ready=function(a){return jb.then(a)["catch"](function(a){w.readyException(a)}),this};w.extend({isReady:!1,readyWait:1,holdReady:function(a){a?w.readyWait++:w.ready(!0)},ready:function(a){(!0===a?--w.readyWait:w.isReady)||(w.isReady=!0,!0!==a&&0<--w.readyWait||jb.resolveWith(V,[w]))}});w.ready.then=jb.then;"complete"===V.readyState||"loading"!==V.readyState&&!V.documentElement.doScroll?b.setTimeout(w.ready):
(V.addEventListener("DOMContentLoaded",m),b.addEventListener("load",m));var La=function(a,b,c,e,f,h,m){var q=0,r=a.length,l=null==c;if("object"===w.type(c))for(q in f=!0,c)La(a,b,q,c[q],!0,h,m);else if(void 0!==e&&(f=!0,w.isFunction(e)||(m=!0),l&&(m?(b.call(a,e),b=null):(l=b,b=function(a,b,c){return l.call(w(a),c)})),b))for(;q<r;q++)b(a[q],c,m?e:e.call(a[q],q,b(a[q],c)));return f?a:l?b.call(a):r?b(a[0],c):h},Ua=function(a){return 1===a.nodeType||9===a.nodeType||!+a.nodeType};r.uid=1;r.prototype={cache:function(a){var b=
a[this.expando];return b||(b={},Ua(a)&&(a.nodeType?a[this.expando]=b:Object.defineProperty(a,this.expando,{value:b,configurable:!0}))),b},set:function(a,b,c){var e;a=this.cache(a);if("string"==typeof b)a[w.camelCase(b)]=c;else for(e in b)a[w.camelCase(e)]=b[e];return a},get:function(a,b){return void 0===b?this.cache(a):a[this.expando]&&a[this.expando][w.camelCase(b)]},access:function(a,b,c){return void 0===b||b&&"string"==typeof b&&void 0===c?this.get(a,b):(this.set(a,b,c),void 0!==c?c:b)},remove:function(a,
b){var c,e=a[this.expando];if(void 0!==e){if(void 0!==b)for(w.isArray(b)?b=b.map(w.camelCase):(b=w.camelCase(b),b=b in e?[b]:b.match(va)||[]),c=b.length;c--;)delete e[b[c]];(void 0===b||w.isEmptyObject(e))&&(a.nodeType?a[this.expando]=void 0:delete a[this.expando])}},hasData:function(a){a=a[this.expando];return void 0!==a&&!w.isEmptyObject(a)}};var Q=new r,Ca=new r,Eb=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Fb=/[A-Z]/g;w.extend({hasData:function(a){return Ca.hasData(a)||Q.hasData(a)},data:function(a,b,c){return Ca.access(a,
b,c)},removeData:function(a,b){Ca.remove(a,b)},_data:function(a,b,c){return Q.access(a,b,c)},_removeData:function(a,b){Q.remove(a,b)}});w.fn.extend({data:function(a,b){var c,e,f,h=this[0],m=h&&h.attributes;if(void 0===a){if(this.length&&(f=Ca.get(h),1===h.nodeType&&!Q.get(h,"hasDataAttrs"))){for(c=m.length;c--;)m[c]&&(e=m[c].name,0===e.indexOf("data-")&&(e=w.camelCase(e.slice(5)),y(h,e,f[e])));Q.set(h,"hasDataAttrs",!0)}return f}return"object"==typeof a?this.each(function(){Ca.set(this,a)}):La(this,
function(b){var c;if(h&&void 0===b){if((c=Ca.get(h,a),void 0!==c)||(c=y(h,a),void 0!==c))return c}else this.each(function(){Ca.set(this,a,b)})},null,b,1<arguments.length,null,!0)},removeData:function(a){return this.each(function(){Ca.remove(this,a)})}});w.extend({queue:function(a,b,c){var e;if(a)return b=(b||"fx")+"queue",e=Q.get(a,b),c&&(!e||w.isArray(c)?e=Q.access(a,b,w.makeArray(c)):e.push(c)),e||[]},dequeue:function(a,b){b=b||"fx";var c=w.queue(a,b),e=c.length,f=c.shift(),h=w._queueHooks(a,b),
m=function(){w.dequeue(a,b)};"inprogress"===f&&(f=c.shift(),e--);f&&("fx"===b&&c.unshift("inprogress"),delete h.stop,f.call(a,m,h));!e&&h&&h.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return Q.get(a,c)||Q.access(a,c,{empty:w.Callbacks("once memory").add(function(){Q.remove(a,[b+"queue",c])})})}});w.fn.extend({queue:function(a,b){var c=2;return"string"!=typeof a&&(b=a,a="fx",c--),arguments.length<c?w.queue(this[0],a):void 0===b?this:this.each(function(){var c=w.queue(this,a,b);w._queueHooks(this,
a);"fx"===a&&"inprogress"!==c[0]&&w.dequeue(this,a)})},dequeue:function(a){return this.each(function(){w.dequeue(this,a)})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,b){var c,e=1,f=w.Deferred(),h=this,m=this.length,q=function(){--e||f.resolveWith(h,[h])};"string"!=typeof a&&(b=a,a=void 0);for(a=a||"fx";m--;)(c=Q.get(h[m],a+"queueHooks"))&&c.empty&&(e++,c.empty.add(q));return q(),f.promise(b)}});var vb=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,Na=new RegExp("^(?:([+-])=|)("+
vb+")([a-z%]*)$","i"),wa=["Top","Right","Bottom","Left"],Oa=function(a,b){return a=b||a,"none"===a.style.display||""===a.style.display&&w.contains(a.ownerDocument,a)&&"none"===w.css(a,"display")},Ab=function(a,b,c,e){var f,h={};for(f in b)h[f]=a.style[f],a.style[f]=b[f];c=c.apply(a,e||[]);for(f in b)a.style[f]=h[f];return c},wb={};w.fn.extend({show:function(){return z(this,!0)},hide:function(){return z(this)},toggle:function(a){return"boolean"==typeof a?a?this.show():this.hide():this.each(function(){Oa(this)?
w(this).show():w(this).hide()})}});var Bb=/^(?:checkbox|radio)$/i,yb=/<([a-z][^\/\0>\x20\t\r\n\f]+)/i,zb=/^$|\/(?:java|ecma)script/i,xa={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};xa.optgroup=xa.option;xa.tbody=xa.tfoot=xa.colgroup=xa.caption=xa.thead;xa.th=xa.td;var xb=/<|&#?\w+;/;!function(){var a=
V.createDocumentFragment().appendChild(V.createElement("div")),b=V.createElement("input");b.setAttribute("type","radio");b.setAttribute("checked","checked");b.setAttribute("name","t");a.appendChild(b);oa.checkClone=a.cloneNode(!0).cloneNode(!0).lastChild.checked;a.innerHTML="<textarea>x</textarea>";oa.noCloneChecked=!!a.cloneNode(!0).lastChild.defaultValue}();var db=V.documentElement,pb=/^key/,Va=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,Ya=/^([^.]*)(?:\.(.+)|)/;w.event={global:{},add:function(a,
b,c,e,f){var h,m,q,r,l,t,y,x,K,B;if(l=Q.get(a))for(c.handler&&(h=c,c=h.handler,f=h.selector),f&&w.find.matchesSelector(db,f),c.guid||(c.guid=w.guid++),(r=l.events)||(r=l.events={}),(m=l.handle)||(m=l.handle=function(b){return"undefined"!=typeof w&&w.event.triggered!==b.type?w.event.dispatch.apply(a,arguments):void 0}),b=(b||"").match(va)||[""],l=b.length;l--;)q=Ya.exec(b[l])||[],K=B=q[1],q=(q[2]||"").split(".").sort(),K&&(y=w.event.special[K]||{},K=(f?y.delegateType:y.bindType)||K,y=w.event.special[K]||
{},t=w.extend({type:K,origType:B,data:e,handler:c,guid:c.guid,selector:f,needsContext:f&&w.expr.match.needsContext.test(f),namespace:q.join(".")},h),(x=r[K])||(x=r[K]=[],x.delegateCount=0,y.setup&&!1!==y.setup.call(a,e,q,m)||a.addEventListener&&a.addEventListener(K,m)),y.add&&(y.add.call(a,t),t.handler.guid||(t.handler.guid=c.guid)),f?x.splice(x.delegateCount++,0,t):x.push(t),w.event.global[K]=!0)},remove:function(a,b,c,e,f){var h,m,q,r,l,t,y,x,K,B,z,da=Q.hasData(a)&&Q.get(a);if(da&&(r=da.events)){b=
(b||"").match(va)||[""];for(l=b.length;l--;)if(q=Ya.exec(b[l])||[],K=z=q[1],B=(q[2]||"").split(".").sort(),K){y=w.event.special[K]||{};K=(e?y.delegateType:y.bindType)||K;x=r[K]||[];q=q[2]&&new RegExp("(^|\\.)"+B.join("\\.(?:.*\\.|)")+"(\\.|$)");for(m=h=x.length;h--;)t=x[h],!f&&z!==t.origType||c&&c.guid!==t.guid||q&&!q.test(t.namespace)||e&&e!==t.selector&&("**"!==e||!t.selector)||(x.splice(h,1),t.selector&&x.delegateCount--,y.remove&&y.remove.call(a,t));m&&!x.length&&(y.teardown&&!1!==y.teardown.call(a,
B,da.handle)||w.removeEvent(a,K,da.handle),delete r[K])}else for(K in r)w.event.remove(a,K+b[l],c,e,!0);w.isEmptyObject(r)&&Q.remove(a,"handle events")}},dispatch:function(a){var b=w.event.fix(a),c,e,f,h,m,q,r=Array(arguments.length);e=(Q.get(this,"events")||{})[b.type]||[];var l=w.event.special[b.type]||{};r[0]=b;for(c=1;c<arguments.length;c++)r[c]=arguments[c];if(b.delegateTarget=this,!l.preDispatch||!1!==l.preDispatch.call(this,b)){q=w.event.handlers.call(this,b,e);for(c=0;(h=q[c++])&&!b.isPropagationStopped();)for(b.currentTarget=
h.elem,e=0;(m=h.handlers[e++])&&!b.isImmediatePropagationStopped();)b.rnamespace&&!b.rnamespace.test(m.namespace)||(b.handleObj=m,b.data=m.data,f=((w.event.special[m.origType]||{}).handle||m.handler).apply(h.elem,r),void 0!==f&&!1===(b.result=f)&&(b.preventDefault(),b.stopPropagation()));return l.postDispatch&&l.postDispatch.call(this,b),b.result}},handlers:function(a,b){var c,e,f,h,m,q=[],r=b.delegateCount,l=a.target;if(r&&l.nodeType&&!("click"===a.type&&1<=a.button))for(;l!==this;l=l.parentNode||
this)if(1===l.nodeType&&("click"!==a.type||!0!==l.disabled)){h=[];m={};for(c=0;c<r;c++)e=b[c],f=e.selector+" ",void 0===m[f]&&(m[f]=e.needsContext?-1<w(f,this).index(l):w.find(f,this,null,[l]).length),m[f]&&h.push(e);h.length&&q.push({elem:l,handlers:h})}return l=this,r<b.length&&q.push({elem:l,handlers:b.slice(r)}),q},addProp:function(a,b){Object.defineProperty(w.Event.prototype,a,{enumerable:!0,configurable:!0,get:w.isFunction(b)?function(){if(this.originalEvent)return b(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[a]},
set:function(b){Object.defineProperty(this,a,{enumerable:!0,configurable:!0,writable:!0,value:b})}})},fix:function(a){return a[w.expando]?a:new w.Event(a)},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==H()&&this.focus)return this.focus(),!1},delegateType:"focusin"},blur:{trigger:function(){if(this===H()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if("checkbox"===this.type&&this.click&&w.nodeName(this,"input"))return this.click(),!1},_default:function(a){return w.nodeName(a.target,
"a")}},beforeunload:{postDispatch:function(a){void 0!==a.result&&a.originalEvent&&(a.originalEvent.returnValue=a.result)}}}};w.removeEvent=function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c)};w.Event=function(a,b){return this instanceof w.Event?(a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||void 0===a.defaultPrevented&&!1===a.returnValue?F:D,this.target=a.target&&3===a.target.nodeType?a.target.parentNode:a.target,this.currentTarget=a.currentTarget,
this.relatedTarget=a.relatedTarget):this.type=a,b&&w.extend(this,b),this.timeStamp=a&&a.timeStamp||w.now(),void(this[w.expando]=!0)):new w.Event(a,b)};w.Event.prototype={constructor:w.Event,isDefaultPrevented:D,isPropagationStopped:D,isImmediatePropagationStopped:D,isSimulated:!1,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=F;a&&!this.isSimulated&&a.preventDefault()},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=F;a&&!this.isSimulated&&
a.stopPropagation()},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=F;a&&!this.isSimulated&&a.stopImmediatePropagation();this.stopPropagation()}};w.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,"char":!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,
toElement:!0,touches:!0,which:function(a){var b=a.button;return null==a.which&&pb.test(a.type)?null!=a.charCode?a.charCode:a.keyCode:!a.which&&void 0!==b&&Va.test(a.type)?1&b?1:2&b?3:4&b?2:0:a.which}},w.event.addProp);w.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(a,b){w.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,e=a.relatedTarget,f=a.handleObj;return e&&(e===this||w.contains(this,e))||(a.type=f.origType,
c=f.handler.apply(this,arguments),a.type=b),c}}});w.fn.extend({on:function(a,b,c,e){return M(this,a,b,c,e)},one:function(a,b,c,e){return M(this,a,b,c,e,1)},off:function(a,b,c){var e,f;if(a&&a.preventDefault&&a.handleObj)return e=a.handleObj,w(a.delegateTarget).off(e.namespace?e.origType+"."+e.namespace:e.origType,e.selector,e.handler),this;if("object"==typeof a){for(f in a)this.off(f,b,a[f]);return this}return!1!==b&&"function"!=typeof b||(c=b,b=void 0),!1===c&&(c=D),this.each(function(){w.event.remove(this,
a,c,b)})}});var eb=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi,nb=/<script|<style|<link/i,mb=/checked\s*(?:[^=]|=\s*.checked.)/i,Fa=/^true\/(.*)/,Xa=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;w.extend({htmlPrefilter:function(a){return a.replace(eb,"<$1></$2>")},clone:function(a,b,c){var e,f,h,m,q=a.cloneNode(!0),r=w.contains(a.ownerDocument,a);if(!(oa.noCloneChecked||1!==a.nodeType&&11!==a.nodeType||w.isXMLDoc(a)))for(m=E(q),h=E(a),e=0,f=h.length;e<
f;e++){var l=h[e],t=m[e],y=t.nodeName.toLowerCase();"input"===y&&Bb.test(l.type)?t.checked=l.checked:"input"!==y&&"textarea"!==y||(t.defaultValue=l.defaultValue)}if(b)if(c)for(h=h||E(a),m=m||E(q),e=0,f=h.length;e<f;e++)S(h[e],m[e]);else S(a,q);return m=E(q,"script"),0<m.length&&G(m,!r&&E(a,"script")),q},cleanData:function(a){for(var b,c,e,f=w.event.special,h=0;void 0!==(c=a[h]);h++)if(Ua(c)){if(b=c[Q.expando]){if(b.events)for(e in b.events)f[e]?w.event.remove(c,e):w.removeEvent(c,e,b.handle);c[Q.expando]=
void 0}c[Ca.expando]&&(c[Ca.expando]=void 0)}}});w.fn.extend({detach:function(a){return sa(this,a,!0)},remove:function(a){return sa(this,a)},text:function(a){return La(this,function(a){return void 0===a?w.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=a)})},null,a,arguments.length)},append:function(){return ka(this,arguments,function(a){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||N(this,a).appendChild(a)})},prepend:function(){return ka(this,
arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=N(this,a);b.insertBefore(a,b.firstChild)}})},before:function(){return ka(this,arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return ka(this,arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},empty:function(){for(var a,b=0;null!=(a=this[b]);b++)1===a.nodeType&&(w.cleanData(E(a,!1)),a.textContent="");return this},clone:function(a,
b){return a=null!=a&&a,b=null==b?a:b,this.map(function(){return w.clone(this,a,b)})},html:function(a){return La(this,function(a){var b=this[0]||{},c=0,e=this.length;if(void 0===a&&1===b.nodeType)return b.innerHTML;if("string"==typeof a&&!nb.test(a)&&!xa[(yb.exec(a)||["",""])[1].toLowerCase()]){a=w.htmlPrefilter(a);try{for(;c<e;c++)b=this[c]||{},1===b.nodeType&&(w.cleanData(E(b,!1)),b.innerHTML=a);b=0}catch(nc){}}b&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(){var a=[];
return ka(this,arguments,function(b){var c=this.parentNode;0>w.inArray(this,a)&&(w.cleanData(E(this)),c&&c.replaceChild(b,this))},a)}});w.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){w.fn[a]=function(a){for(var c=[],e=w(a),f=e.length-1,h=0;h<=f;h++)a=h===f?this:this.clone(!0),w(e[h])[b](a),gb.apply(c,a.get());return this.pushStack(c)}});var Pa=/^margin/,Ha=new RegExp("^("+vb+")(?!px)[a-z%]+$","i"),Ra=function(a){var c=
a.ownerDocument.defaultView;return c&&c.opener||(c=b),c.getComputedStyle(a)};!function(){function a(){if(q){q.style.cssText="box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%";q.innerHTML="";db.appendChild(m);var a=b.getComputedStyle(q);c="1%"!==a.top;h="2px"===a.marginLeft;e="4px"===a.width;q.style.marginRight="50%";f="4px"===a.marginRight;db.removeChild(m);q=null}}var c,e,f,h,m=V.createElement("div"),q=V.createElement("div");q.style&&(q.style.backgroundClip=
"content-box",q.cloneNode(!0).style.backgroundClip="",oa.clearCloneStyle="content-box"===q.style.backgroundClip,m.style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute",m.appendChild(q),w.extend(oa,{pixelPosition:function(){return a(),c},boxSizingReliable:function(){return a(),e},pixelMarginRight:function(){return a(),f},reliableMarginLeft:function(){return a(),h}}))}();var ra=/^(none|table(?!-c[ea]).+)/,Ea={position:"absolute",visibility:"hidden",
display:"block"},Z={letterSpacing:"0",fontWeight:"400"},Y=["Webkit","Moz","ms"],Aa=V.createElement("div").style;w.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=W(a,"opacity");return""===c?"1":c}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(a,b,c,e){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var f,h,m,
q=w.camelCase(b),r=a.style;return b=w.cssProps[q]||(w.cssProps[q]=pa(q)||q),m=w.cssHooks[b]||w.cssHooks[q],void 0===c?m&&"get"in m&&void 0!==(f=m.get(a,!1,e))?f:r[b]:(h=typeof c,"string"===h&&(f=Na.exec(c))&&f[1]&&(c=B(a,b,f),h="number"),null!=c&&c===c&&("number"===h&&(c+=f&&f[3]||(w.cssNumber[q]?"":"px")),oa.clearCloneStyle||""!==c||0!==b.indexOf("background")||(r[b]="inherit"),m&&"set"in m&&void 0===(c=m.set(a,c,e))||(r[b]=c)),void 0)}},css:function(a,b,c,e){var f,h,m,q=w.camelCase(b);return b=
w.cssProps[q]||(w.cssProps[q]=pa(q)||q),m=w.cssHooks[b]||w.cssHooks[q],m&&"get"in m&&(f=m.get(a,!0,c)),void 0===f&&(f=W(a,b,e)),"normal"===f&&b in Z&&(f=Z[b]),""===c||c?(h=parseFloat(f),!0===c||isFinite(h)?h||0:f):f}});w.each(["height","width"],function(a,b){w.cssHooks[b]={get:function(a,c,e){if(c)return!ra.test(w.css(a,"display"))||a.getClientRects().length&&a.getBoundingClientRect().width?ea(a,b,e):Ab(a,Ea,function(){return ea(a,b,e)})},set:function(a,c,e){var f,h=e&&Ra(a);e=e&&ba(a,b,e,"border-box"===
w.css(a,"boxSizing",!1,h),h);return e&&(f=Na.exec(c))&&"px"!==(f[3]||"px")&&(a.style[b]=c,c=w.css(a,b)),fa(a,c,e)}}});w.cssHooks.marginLeft=ma(oa.reliableMarginLeft,function(a,b){if(b)return(parseFloat(W(a,"marginLeft"))||a.getBoundingClientRect().left-Ab(a,{marginLeft:0},function(){return a.getBoundingClientRect().left}))+"px"});w.each({margin:"",padding:"",border:"Width"},function(a,b){w.cssHooks[a+b]={expand:function(c){var e=0,f={};for(c="string"==typeof c?c.split(" "):[c];4>e;e++)f[a+wa[e]+b]=
c[e]||c[e-2]||c[0];return f}};Pa.test(a)||(w.cssHooks[a+b].set=fa)});w.fn.extend({css:function(a,b){return La(this,function(a,b,c){var e,f={},h=0;if(w.isArray(b)){c=Ra(a);for(e=b.length;h<e;h++)f[b[h]]=w.css(a,b[h],!1,c);return f}return void 0!==c?w.style(a,b,c):w.css(a,b)},a,b,1<arguments.length)}});w.Tween=J;J.prototype={constructor:J,init:function(a,b,c,e,f,h){this.elem=a;this.prop=c;this.easing=f||w.easing._default;this.options=b;this.start=this.now=this.cur();this.end=e;this.unit=h||(w.cssNumber[c]?
"":"px")},cur:function(){var a=J.propHooks[this.prop];return a&&a.get?a.get(this):J.propHooks._default.get(this)},run:function(a){var b,c=J.propHooks[this.prop];return this.options.duration?this.pos=b=w.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):this.pos=b=a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):J.propHooks._default.set(this),this}};J.prototype.init.prototype=J.prototype;J.propHooks=
{_default:{get:function(a){var b;return 1!==a.elem.nodeType||null!=a.elem[a.prop]&&null==a.elem.style[a.prop]?a.elem[a.prop]:(b=w.css(a.elem,a.prop,""),b&&"auto"!==b?b:0)},set:function(a){w.fx.step[a.prop]?w.fx.step[a.prop](a):1!==a.elem.nodeType||null==a.elem.style[w.cssProps[a.prop]]&&!w.cssHooks[a.prop]?a.elem[a.prop]=a.now:w.style(a.elem,a.prop,a.now+a.unit)}}};J.propHooks.scrollTop=J.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}};w.easing={linear:function(a){return a},
swing:function(a){return.5-Math.cos(a*Math.PI)/2},_default:"swing"};w.fx=J.prototype.init;w.fx.step={};var X,Ia,Ib=/^(?:toggle|show|hide)$/,Jb=/queueHooks$/;w.Animation=w.extend(ha,{tweeners:{"*":[function(a,b){var c=this.createTween(a,b);return B(c.elem,a,Na.exec(b),c),c}]},tweener:function(a,b){w.isFunction(a)?(b=a,a=["*"]):a=a.match(va);for(var c,e=0,f=a.length;e<f;e++)c=a[e],ha.tweeners[c]=ha.tweeners[c]||[],ha.tweeners[c].unshift(b)},prefilters:[function(a,b,c){var e,f,h,m,q,r,l,t,y="width"in
b||"height"in b,x=this,B={},K=a.style,ra=a.nodeType&&Oa(a),E=Q.get(a,"fxshow");c.queue||(m=w._queueHooks(a,"fx"),null==m.unqueued&&(m.unqueued=0,q=m.empty.fire,m.empty.fire=function(){m.unqueued||q()}),m.unqueued++,x.always(function(){x.always(function(){m.unqueued--;w.queue(a,"fx").length||m.empty.fire()})}));for(e in b)if(f=b[e],Ib.test(f)){if(delete b[e],h=h||"toggle"===f,f===(ra?"hide":"show")){if("show"!==f||!E||void 0===E[e])continue;ra=!0}B[e]=E&&E[e]||w.style(a,e)}if(r=!w.isEmptyObject(b),
r||!w.isEmptyObject(B))for(e in y&&1===a.nodeType&&(c.overflow=[K.overflow,K.overflowX,K.overflowY],l=E&&E.display,null==l&&(l=Q.get(a,"display")),t=w.css(a,"display"),"none"===t&&(l?t=l:(z([a],!0),l=a.style.display||l,t=w.css(a,"display"),z([a]))),("inline"===t||"inline-block"===t&&null!=l)&&"none"===w.css(a,"float")&&(r||(x.done(function(){K.display=l}),null==l&&(t=K.display,l="none"===t?"":t)),K.display="inline-block")),c.overflow&&(K.overflow="hidden",x.always(function(){K.overflow=c.overflow[0];
K.overflowX=c.overflow[1];K.overflowY=c.overflow[2]})),r=!1,B)r||(E?"hidden"in E&&(ra=E.hidden):E=Q.access(a,"fxshow",{display:l}),h&&(E.hidden=!ra),ra&&z([a],!0),x.done(function(){ra||z([a]);Q.remove(a,"fxshow");for(e in B)w.style(a,e,B[e])})),r=ta(ra?E[e]:0,e,x),e in E||(E[e]=r.start,ra&&(r.end=r.start,r.start=0))}],prefilter:function(a,b){b?ha.prefilters.unshift(a):ha.prefilters.push(a)}});w.speed=function(a,b,c){var e=a&&"object"==typeof a?w.extend({},a):{complete:c||!c&&b||w.isFunction(a)&&a,
duration:a,easing:c&&b||b&&!w.isFunction(b)&&b};return w.fx.off||V.hidden?e.duration=0:"number"!=typeof e.duration&&(e.duration in w.fx.speeds?e.duration=w.fx.speeds[e.duration]:e.duration=w.fx.speeds._default),null!=e.queue&&!0!==e.queue||(e.queue="fx"),e.old=e.complete,e.complete=function(){w.isFunction(e.old)&&e.old.call(this);e.queue&&w.dequeue(this,e.queue)},e};w.fn.extend({fadeTo:function(a,b,c,e){return this.filter(Oa).css("opacity",0).show().end().animate({opacity:b},a,c,e)},animate:function(a,
b,c,e){var f=w.isEmptyObject(a),h=w.speed(b,c,e);b=function(){var b=ha(this,w.extend({},a),h);(f||Q.get(this,"finish"))&&b.stop(!0)};return b.finish=b,f||!1===h.queue?this.each(b):this.queue(h.queue,b)},stop:function(a,b,c){var e=function(a){var b=a.stop;delete a.stop;b(c)};return"string"!=typeof a&&(c=b,b=a,a=void 0),b&&!1!==a&&this.queue(a||"fx",[]),this.each(function(){var b=!0,f=null!=a&&a+"queueHooks",h=w.timers,m=Q.get(this);if(f)m[f]&&m[f].stop&&e(m[f]);else for(f in m)m[f]&&m[f].stop&&Jb.test(f)&&
e(m[f]);for(f=h.length;f--;)h[f].elem!==this||null!=a&&h[f].queue!==a||(h[f].anim.stop(c),b=!1,h.splice(f,1));!b&&c||w.dequeue(this,a)})},finish:function(a){return!1!==a&&(a=a||"fx"),this.each(function(){var b,c=Q.get(this),e=c[a+"queue"];b=c[a+"queueHooks"];var f=w.timers,h=e?e.length:0;c.finish=!0;w.queue(this,a,[]);b&&b.stop&&b.stop.call(this,!0);for(b=f.length;b--;)f[b].elem===this&&f[b].queue===a&&(f[b].anim.stop(!0),f.splice(b,1));for(b=0;b<h;b++)e[b]&&e[b].finish&&e[b].finish.call(this);delete c.finish})}});
w.each(["toggle","show","hide"],function(a,b){var c=w.fn[b];w.fn[b]=function(a,e,f){return null==a||"boolean"==typeof a?c.apply(this,arguments):this.animate(T(b,!0),a,e,f)}});w.each({slideDown:T("show"),slideUp:T("hide"),slideToggle:T("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){w.fn[a]=function(a,c,e){return this.animate(b,a,c,e)}});w.timers=[];w.fx.tick=function(){var a,b=0,c=w.timers;for(X=w.now();b<c.length;b++)a=c[b],a()||c[b]!==a||c.splice(b--,
1);c.length||w.fx.stop();X=void 0};w.fx.timer=function(a){w.timers.push(a);a()?w.fx.start():w.timers.pop()};w.fx.interval=13;w.fx.start=function(){Ia||(Ia=b.requestAnimationFrame?b.requestAnimationFrame(R):b.setInterval(w.fx.tick,w.fx.interval))};w.fx.stop=function(){b.cancelAnimationFrame?b.cancelAnimationFrame(Ia):b.clearInterval(Ia);Ia=null};w.fx.speeds={slow:600,fast:200,_default:400};w.fn.delay=function(a,c){return a=w.fx?w.fx.speeds[a]||a:a,c=c||"fx",this.queue(c,function(c,e){var f=b.setTimeout(c,
a);e.stop=function(){b.clearTimeout(f)}})};(function(){var a=V.createElement("input"),b=V.createElement("select").appendChild(V.createElement("option"));a.type="checkbox";oa.checkOn=""!==a.value;oa.optSelected=b.selected;a=V.createElement("input");a.value="t";a.type="radio";oa.radioValue="t"===a.value})();var Pb,qb=w.expr.attrHandle;w.fn.extend({attr:function(a,b){return La(this,w.attr,a,b,1<arguments.length)},removeAttr:function(a){return this.each(function(){w.removeAttr(this,a)})}});w.extend({attr:function(a,
b,c){var e,f,h=a.nodeType;if(3!==h&&8!==h&&2!==h)return"undefined"==typeof a.getAttribute?w.prop(a,b,c):(1===h&&w.isXMLDoc(a)||(f=w.attrHooks[b.toLowerCase()]||(w.expr.match.bool.test(b)?Pb:void 0)),void 0!==c?null===c?void w.removeAttr(a,b):f&&"set"in f&&void 0!==(e=f.set(a,c,b))?e:(a.setAttribute(b,c+""),c):f&&"get"in f&&null!==(e=f.get(a,b))?e:(e=w.find.attr(a,b),null==e?void 0:e))},attrHooks:{type:{set:function(a,b){if(!oa.radioValue&&"radio"===b&&w.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",
b),c&&(a.value=c),b}}}},removeAttr:function(a,b){var c,e=0,f=b&&b.match(va);if(f&&1===a.nodeType)for(;c=f[e++];)a.removeAttribute(c)}});Pb={set:function(a,b,c){return!1===b?w.removeAttr(a,c):a.setAttribute(c,c),c}};w.each(w.expr.match.bool.source.match(/\w+/g),function(a,b){var c=qb[b]||w.find.attr;qb[b]=function(a,b,e){var f,h,m=b.toLowerCase();return e||(h=qb[m],qb[m]=f,f=null!=c(a,b,e)?m:null,qb[m]=h),f}});var $b=/^(?:input|select|textarea|button)$/i,ac=/^(?:a|area)$/i;w.fn.extend({prop:function(a,
b){return La(this,w.prop,a,b,1<arguments.length)},removeProp:function(a){return this.each(function(){delete this[w.propFix[a]||a]})}});w.extend({prop:function(a,b,c){var e,f,h=a.nodeType;if(3!==h&&8!==h&&2!==h)return 1===h&&w.isXMLDoc(a)||(b=w.propFix[b]||b,f=w.propHooks[b]),void 0!==c?f&&"set"in f&&void 0!==(e=f.set(a,c,b))?e:a[b]=c:f&&"get"in f&&null!==(e=f.get(a,b))?e:a[b]},propHooks:{tabIndex:{get:function(a){var b=w.find.attr(a,"tabindex");return b?parseInt(b,10):$b.test(a.nodeName)||ac.test(a.nodeName)&&
a.href?0:-1}}},propFix:{"for":"htmlFor","class":"className"}});oa.optSelected||(w.propHooks.selected={get:function(a){a=a.parentNode;return a&&a.parentNode&&a.parentNode.selectedIndex,null},set:function(a){a=a.parentNode;a&&(a.selectedIndex,a.parentNode&&a.parentNode.selectedIndex)}});w.each("tabIndex readOnly maxLength cellSpacing cellPadding rowSpan colSpan useMap frameBorder contentEditable".split(" "),function(){w.propFix[this.toLowerCase()]=this});w.fn.extend({addClass:function(a){var b,c,e,
f,h,m,q=0;if(w.isFunction(a))return this.each(function(b){w(this).addClass(a.call(this,b,ja(this)))});if("string"==typeof a&&a)for(b=a.match(va)||[];c=this[q++];)if(f=ja(c),e=1===c.nodeType&&" "+ca(f)+" "){for(m=0;h=b[m++];)0>e.indexOf(" "+h+" ")&&(e+=h+" ");e=ca(e);f!==e&&c.setAttribute("class",e)}return this},removeClass:function(a){var b,c,e,f,h,m,q=0;if(w.isFunction(a))return this.each(function(b){w(this).removeClass(a.call(this,b,ja(this)))});if(!arguments.length)return this.attr("class","");
if("string"==typeof a&&a)for(b=a.match(va)||[];c=this[q++];)if(f=ja(c),e=1===c.nodeType&&" "+ca(f)+" "){for(m=0;h=b[m++];)for(;-1<e.indexOf(" "+h+" ");)e=e.replace(" "+h+" "," ");e=ca(e);f!==e&&c.setAttribute("class",e)}return this},toggleClass:function(a,b){var c=typeof a;return"boolean"==typeof b&&"string"===c?b?this.addClass(a):this.removeClass(a):w.isFunction(a)?this.each(function(c){w(this).toggleClass(a.call(this,c,ja(this),b),b)}):this.each(function(){var b,e,f,h;if("string"===c)for(e=0,f=
w(this),h=a.match(va)||[];b=h[e++];)f.hasClass(b)?f.removeClass(b):f.addClass(b);else void 0!==a&&"boolean"!==c||(b=ja(this),b&&Q.set(this,"__className__",b),this.setAttribute&&this.setAttribute("class",b||!1===a?"":Q.get(this,"__className__")||""))})},hasClass:function(a){var b,c=0;for(a=" "+a+" ";b=this[c++];)if(1===b.nodeType&&-1<(" "+ca(ja(b))+" ").indexOf(a))return!0;return!1}});var bc=/\r/g;w.fn.extend({val:function(a){var b,c,e,f=this[0];if(arguments.length)return e=w.isFunction(a),this.each(function(c){var f;
1===this.nodeType&&(f=e?a.call(this,c,w(this).val()):a,null==f?f="":"number"==typeof f?f+="":w.isArray(f)&&(f=w.map(f,function(a){return null==a?"":a+""})),b=w.valHooks[this.type]||w.valHooks[this.nodeName.toLowerCase()],b&&"set"in b&&void 0!==b.set(this,f,"value")||(this.value=f))});if(f)return b=w.valHooks[f.type]||w.valHooks[f.nodeName.toLowerCase()],b&&"get"in b&&void 0!==(c=b.get(f,"value"))?c:(c=f.value,"string"==typeof c?c.replace(bc,""):null==c?"":c)}});w.extend({valHooks:{option:{get:function(a){var b=
w.find.attr(a,"value");return null!=b?b:ca(w.text(a))}},select:{get:function(a){var b,c,e=a.options,f=a.selectedIndex,h="select-one"===a.type,m=h?null:[],q=h?f+1:e.length;for(c=0>f?q:h?f:0;c<q;c++)if(b=e[c],!(!b.selected&&c!==f||b.disabled||b.parentNode.disabled&&w.nodeName(b.parentNode,"optgroup"))){if(a=w(b).val(),h)return a;m.push(a)}return m},set:function(a,b){for(var c,e,f=a.options,h=w.makeArray(b),m=f.length;m--;)e=f[m],(e.selected=-1<w.inArray(w.valHooks.option.get(e),h))&&(c=!0);return c||
(a.selectedIndex=-1),h}}}});w.each(["radio","checkbox"],function(){w.valHooks[this]={set:function(a,b){if(w.isArray(b))return a.checked=-1<w.inArray(w(a).val(),b)}};oa.checkOn||(w.valHooks[this].get=function(a){return null===a.getAttribute("value")?"on":a.value})});var Qb=/^(?:focusinfocus|focusoutblur)$/;w.extend(w.event,{trigger:function(a,c,e,f){var h,m,q,r,l,t,y,x=[e||V],B=Ka.call(a,"type")?a.type:a;h=Ka.call(a,"namespace")?a.namespace.split("."):[];if(m=q=e=e||V,3!==e.nodeType&&8!==e.nodeType&&
!Qb.test(B+w.event.triggered)&&(-1<B.indexOf(".")&&(h=B.split("."),B=h.shift(),h.sort()),l=0>B.indexOf(":")&&"on"+B,a=a[w.expando]?a:new w.Event(B,"object"==typeof a&&a),a.isTrigger=f?2:3,a.namespace=h.join("."),a.rnamespace=a.namespace?new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,a.result=void 0,a.target||(a.target=e),c=null==c?[a]:w.makeArray(c,[a]),y=w.event.special[B]||{},f||!y.trigger||!1!==y.trigger.apply(e,c))){if(!f&&!y.noBubble&&!w.isWindow(e)){r=y.delegateType||B;for(Qb.test(r+
B)||(m=m.parentNode);m;m=m.parentNode)x.push(m),q=m;q===(e.ownerDocument||V)&&x.push(q.defaultView||q.parentWindow||b)}for(h=0;(m=x[h++])&&!a.isPropagationStopped();)a.type=1<h?r:y.bindType||B,(t=(Q.get(m,"events")||{})[a.type]&&Q.get(m,"handle"))&&t.apply(m,c),(t=l&&m[l])&&t.apply&&Ua(m)&&(a.result=t.apply(m,c),!1===a.result&&a.preventDefault());return a.type=B,f||a.isDefaultPrevented()||y._default&&!1!==y._default.apply(x.pop(),c)||!Ua(e)||l&&w.isFunction(e[B])&&!w.isWindow(e)&&(q=e[l],q&&(e[l]=
null),w.event.triggered=B,e[B](),w.event.triggered=void 0,q&&(e[l]=q)),a.result}},simulate:function(a,b,c){a=w.extend(new w.Event,c,{type:a,isSimulated:!0});w.event.trigger(a,null,b)}});w.fn.extend({trigger:function(a,b){return this.each(function(){w.event.trigger(a,b,this)})},triggerHandler:function(a,b){var c=this[0];if(c)return w.event.trigger(a,b,c,!0)}});w.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),
function(a,b){w.fn[b]=function(a,c){return 0<arguments.length?this.on(b,null,a,c):this.trigger(b)}});w.fn.extend({hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}});oa.focusin="onfocusin"in b;oa.focusin||w.each({focus:"focusin",blur:"focusout"},function(a,b){var c=function(a){w.event.simulate(b,a.target,w.event.fix(a))};w.event.special[b]={setup:function(){var e=this.ownerDocument||this,f=Q.access(e,b);f||e.addEventListener(a,c,!0);Q.access(e,b,(f||0)+1)},teardown:function(){var e=
this.ownerDocument||this,f=Q.access(e,b)-1;f?Q.access(e,b,f):(e.removeEventListener(a,c,!0),Q.remove(e,b))}}});var rb=b.location,Rb=w.now(),Kb=/\?/;w.parseXML=function(a){var c;if(!a||"string"!=typeof a)return null;try{c=(new b.DOMParser).parseFromString(a,"text/xml")}catch(kb){c=void 0}return c&&!c.getElementsByTagName("parsererror").length||w.error("Invalid XML: "+a),c};var Yb=/\[\]$/,Sb=/\r?\n/g,cc=/^(?:submit|button|image|reset|file)$/i,dc=/^(?:input|select|textarea|keygen)/i;w.param=function(a,
b){var c,e=[],f=function(a,b){var c=w.isFunction(b)?b():b;e[e.length]=encodeURIComponent(a)+"="+encodeURIComponent(null==c?"":c)};if(w.isArray(a)||a.jquery&&!w.isPlainObject(a))w.each(a,function(){f(this.name,this.value)});else for(c in a)ia(c,a[c],b,f);return e.join("&")};w.fn.extend({serialize:function(){return w.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=w.prop(this,"elements");return a?w.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&
!w(this).is(":disabled")&&dc.test(this.nodeName)&&!cc.test(a)&&(this.checked||!Bb.test(a))}).map(function(a,b){var c=w(this).val();return null==c?null:w.isArray(c)?w.map(c,function(a){return{name:b.name,value:a.replace(Sb,"\r\n")}}):{name:b.name,value:c.replace(Sb,"\r\n")}}).get()}});var ec=/%20/g,fc=/#.*$/,gc=/([?&])_=[^&]*/,hc=/^(.*?):[ \t]*([^\r\n]*)$/gm,ic=/^(?:GET|HEAD)$/,jc=/^\/\//,Tb={},Gb={},Ub="*/".concat("*"),Lb=V.createElement("a");Lb.href=rb.href;w.extend({active:0,lastModified:{},etag:{},
ajaxSettings:{url:rb.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(rb.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Ub,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,
"text html":!0,"text json":JSON.parse,"text xml":w.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,b){return b?Ga(Ga(a,w.ajaxSettings),b):Ga(w.ajaxSettings,a)},ajaxPrefilter:U(Tb),ajaxTransport:U(Gb),ajax:function(a,c){function e(a,c,e,q){var l,x,B,Ea,K=c;if(!t){t=!0;r&&b.clearTimeout(r);f=void 0;m=q||"";Y.readyState=0<a?4:0;q=200<=a&&300>a||304===a;if(e){B=z;for(var F=Y,H,I,da,Aa,X=B.contents,J=B.dataTypes;"*"===J[0];)J.shift(),void 0===H&&(H=B.mimeType||F.getResponseHeader("Content-Type"));
if(H)for(I in X)if(X[I]&&X[I].test(H)){J.unshift(I);break}if(J[0]in e)da=J[0];else{for(I in e){if(!J[0]||B.converters[I+" "+J[0]]){da=I;break}Aa||(Aa=I)}da=da||Aa}e=da?(da!==J[0]&&J.unshift(da),e[da]):void 0;B=e}var M;a:{e=z;H=B;I=Y;da=q;var L,N,O;B={};F=e.dataTypes.slice();if(F[1])for(L in e.converters)B[L.toLowerCase()]=e.converters[L];for(Aa=F.shift();Aa;)if(e.responseFields[Aa]&&(I[e.responseFields[Aa]]=H),!O&&da&&e.dataFilter&&(H=e.dataFilter(H,e.dataType)),O=Aa,Aa=F.shift())if("*"===Aa)Aa=O;
else if("*"!==O&&O!==Aa){if(L=B[O+" "+Aa]||B["* "+Aa],!L)for(M in B)if(N=M.split(" "),N[1]===Aa&&(L=B[O+" "+N[0]]||B["* "+N[0]])){!0===L?L=B[M]:!0!==B[M]&&(Aa=N[0],F.unshift(N[1]));break}if(!0!==L)if(L&&e["throws"])H=L(H);else try{H=L(H)}catch(Zb){M={state:"parsererror",error:L?Zb:"No conversion from "+O+" to "+Aa};break a}}M={state:"success",data:H}}B=M;q?(z.ifModified&&(Ea=Y.getResponseHeader("Last-Modified"),Ea&&(w.lastModified[h]=Ea),Ea=Y.getResponseHeader("etag"),Ea&&(w.etag[h]=Ea)),204===a||
"HEAD"===z.type?K="nocontent":304===a?K="notmodified":(K=B.state,l=B.data,x=B.error,q=!x)):(x=K,!a&&K||(K="error",0>a&&(a=0)));Y.status=a;Y.statusText=(c||K)+"";q?Z.resolveWith(ra,[l,K,Y]):Z.rejectWith(ra,[Y,K,x]);Y.statusCode(D);D=void 0;y&&E.trigger(q?"ajaxSuccess":"ajaxError",[Y,z,q?l:x]);G.fireWith(ra,[Y,K]);y&&(E.trigger("ajaxComplete",[Y,z]),--w.active||w.event.trigger("ajaxStop"))}}"object"==typeof a&&(c=a,a=void 0);c=c||{};var f,h,m,q,r,l,t,y,x,B,z=w.ajaxSetup({},c),ra=z.context||z,E=z.context&&
(ra.nodeType||ra.jquery)?w(ra):w.event,Z=w.Deferred(),G=w.Callbacks("once memory"),D=z.statusCode||{},Ea={},K={},F="canceled",Y={readyState:0,getResponseHeader:function(a){var b;if(t){if(!q)for(q={};b=hc.exec(m);)q[b[1].toLowerCase()]=b[2];b=q[a.toLowerCase()]}return null==b?null:b},getAllResponseHeaders:function(){return t?m:null},setRequestHeader:function(a,b){return null==t&&(a=K[a.toLowerCase()]=K[a.toLowerCase()]||a,Ea[a]=b),this},overrideMimeType:function(a){return null==t&&(z.mimeType=a),this},
statusCode:function(a){var b;if(a)if(t)Y.always(a[Y.status]);else for(b in a)D[b]=[D[b],a[b]];return this},abort:function(a){a=a||F;return f&&f.abort(a),e(0,a),this}};if(Z.promise(Y),z.url=((a||z.url||rb.href)+"").replace(jc,rb.protocol+"//"),z.type=c.method||c.type||z.method||z.type,z.dataTypes=(z.dataType||"*").toLowerCase().match(va)||[""],null==z.crossDomain){l=V.createElement("a");try{l.href=z.url,l.href=l.href,z.crossDomain=Lb.protocol+"//"+Lb.host!=l.protocol+"//"+l.host}catch(Hb){z.crossDomain=
!0}}if(z.data&&z.processData&&"string"!=typeof z.data&&(z.data=w.param(z.data,z.traditional)),Ma(Tb,z,c,Y),t)return Y;(y=w.event&&z.global)&&0===w.active++&&w.event.trigger("ajaxStart");z.type=z.type.toUpperCase();z.hasContent=!ic.test(z.type);h=z.url.replace(fc,"");z.hasContent?z.data&&z.processData&&0===(z.contentType||"").indexOf("application/x-www-form-urlencoded")&&(z.data=z.data.replace(ec,"+")):(B=z.url.slice(h.length),z.data&&(h+=(Kb.test(h)?"&":"?")+z.data,delete z.data),!1===z.cache&&(h=
h.replace(gc,"$1"),B=(Kb.test(h)?"&":"?")+"_="+Rb++ +B),z.url=h+B);z.ifModified&&(w.lastModified[h]&&Y.setRequestHeader("If-Modified-Since",w.lastModified[h]),w.etag[h]&&Y.setRequestHeader("If-None-Match",w.etag[h]));(z.data&&z.hasContent&&!1!==z.contentType||c.contentType)&&Y.setRequestHeader("Content-Type",z.contentType);Y.setRequestHeader("Accept",z.dataTypes[0]&&z.accepts[z.dataTypes[0]]?z.accepts[z.dataTypes[0]]+("*"!==z.dataTypes[0]?", "+Ub+"; q=0.01":""):z.accepts["*"]);for(x in z.headers)Y.setRequestHeader(x,
z.headers[x]);if(z.beforeSend&&(!1===z.beforeSend.call(ra,Y,z)||t))return Y.abort();if(F="abort",G.add(z.complete),Y.done(z.success),Y.fail(z.error),f=Ma(Gb,z,c,Y)){if(Y.readyState=1,y&&E.trigger("ajaxSend",[Y,z]),t)return Y;z.async&&0<z.timeout&&(r=b.setTimeout(function(){Y.abort("timeout")},z.timeout));try{t=!1,f.send(Ea,e)}catch(Hb){if(t)throw Hb;e(-1,Hb)}}else e(-1,"No Transport");return Y},getJSON:function(a,b,c){return w.get(a,b,c,"json")},getScript:function(a,b){return w.get(a,void 0,b,"script")}});
w.each(["get","post"],function(a,b){w[b]=function(a,c,e,f){return w.isFunction(c)&&(f=f||e,e=c,c=void 0),w.ajax(w.extend({url:a,type:b,dataType:f,data:c,success:e},w.isPlainObject(a)&&a))}});w._evalUrl=function(a){return w.ajax({url:a,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,"throws":!0})};w.fn.extend({wrapAll:function(a){var b;return this[0]&&(w.isFunction(a)&&(a=a.call(this[0])),b=w(a,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){for(var a=
this;a.firstElementChild;)a=a.firstElementChild;return a}).append(this)),this},wrapInner:function(a){return w.isFunction(a)?this.each(function(b){w(this).wrapInner(a.call(this,b))}):this.each(function(){var b=w(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=w.isFunction(a);return this.each(function(c){w(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(a){return this.parent(a).not("body").each(function(){w(this).replaceWith(this.childNodes)}),this}});w.expr.pseudos.hidden=
function(a){return!w.expr.pseudos.visible(a)};w.expr.pseudos.visible=function(a){return!!(a.offsetWidth||a.offsetHeight||a.getClientRects().length)};w.ajaxSettings.xhr=function(){try{return new b.XMLHttpRequest}catch(K){}};var kc={0:200,1223:204},sb=w.ajaxSettings.xhr();oa.cors=!!sb&&"withCredentials"in sb;oa.ajax=sb=!!sb;w.ajaxTransport(function(a){var c,e;if(oa.cors||sb&&!a.crossDomain)return{send:function(f,h){var m,q=a.xhr();if(q.open(a.type,a.url,a.async,a.username,a.password),a.xhrFields)for(m in a.xhrFields)q[m]=
a.xhrFields[m];a.mimeType&&q.overrideMimeType&&q.overrideMimeType(a.mimeType);a.crossDomain||f["X-Requested-With"]||(f["X-Requested-With"]="XMLHttpRequest");for(m in f)q.setRequestHeader(m,f[m]);c=function(a){return function(){c&&(c=e=q.onload=q.onerror=q.onabort=q.onreadystatechange=null,"abort"===a?q.abort():"error"===a?"number"!=typeof q.status?h(0,"error"):h(q.status,q.statusText):h(kc[q.status]||q.status,q.statusText,"text"!==(q.responseType||"text")||"string"!=typeof q.responseText?{binary:q.response}:
{text:q.responseText},q.getAllResponseHeaders()))}};q.onload=c();e=q.onerror=c("error");void 0!==q.onabort?q.onabort=e:q.onreadystatechange=function(){4===q.readyState&&b.setTimeout(function(){c&&e()})};c=c("abort");try{q.send(a.hasContent&&a.data||null)}catch(Wb){if(c)throw Wb;}},abort:function(){c&&c()}}});w.ajaxPrefilter(function(a){a.crossDomain&&(a.contents.script=!1)});w.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},
converters:{"text script":function(a){return w.globalEval(a),a}}});w.ajaxPrefilter("script",function(a){void 0===a.cache&&(a.cache=!1);a.crossDomain&&(a.type="GET")});w.ajaxTransport("script",function(a){if(a.crossDomain){var b,c;return{send:function(e,f){b=w("<script>").prop({charset:a.scriptCharset,src:a.url}).on("load error",c=function(a){b.remove();c=null;a&&f("error"===a.type?404:200,a.type)});V.head.appendChild(b[0])},abort:function(){c&&c()}}}});var Vb=[],Mb=/(=)\?(?=&|$)|\?\?/;w.ajaxSetup({jsonp:"callback",
jsonpCallback:function(){var a=Vb.pop()||w.expando+"_"+Rb++;return this[a]=!0,a}});w.ajaxPrefilter("json jsonp",function(a,c,e){var f,h,m,q=!1!==a.jsonp&&(Mb.test(a.url)?"url":"string"==typeof a.data&&0===(a.contentType||"").indexOf("application/x-www-form-urlencoded")&&Mb.test(a.data)&&"data");if(q||"jsonp"===a.dataTypes[0])return f=a.jsonpCallback=w.isFunction(a.jsonpCallback)?a.jsonpCallback():a.jsonpCallback,q?a[q]=a[q].replace(Mb,"$1"+f):!1!==a.jsonp&&(a.url+=(Kb.test(a.url)?"&":"?")+a.jsonp+
"="+f),a.converters["script json"]=function(){return m||w.error(f+" was not called"),m[0]},a.dataTypes[0]="json",h=b[f],b[f]=function(){m=arguments},e.always(function(){void 0===h?w(b).removeProp(f):b[f]=h;a[f]&&(a.jsonpCallback=c.jsonpCallback,Vb.push(f));m&&w.isFunction(h)&&h(m[0]);m=h=void 0}),"script"});oa.createHTMLDocument=function(){var a=V.implementation.createHTMLDocument("").body;return a.innerHTML="<form></form><form></form>",2===a.childNodes.length}();w.parseHTML=function(a,b,c){if("string"!=
typeof a)return[];"boolean"==typeof b&&(c=b,b=!1);var e,f,h;return b||(oa.createHTMLDocument?(b=V.implementation.createHTMLDocument(""),e=b.createElement("base"),e.href=V.location.href,b.head.appendChild(e)):b=V),f=Da.exec(a),h=!c&&[],f?[b.createElement(f[1])]:(f=I([a],b,h),h&&h.length&&w(h).remove(),w.merge([],f.childNodes))};w.fn.load=function(a,b,c){var e,f,h,m=this,q=a.indexOf(" ");return-1<q&&(e=ca(a.slice(q)),a=a.slice(0,q)),w.isFunction(b)?(c=b,b=void 0):b&&"object"==typeof b&&(f="POST"),0<
m.length&&w.ajax({url:a,type:f||"GET",dataType:"html",data:b}).done(function(a){h=arguments;m.html(e?w("<div>").append(w.parseHTML(a)).find(e):a)}).always(c&&function(a,b){m.each(function(){c.apply(this,h||[a.responseText,b,a])})}),this};w.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(a,b){w.fn[b]=function(a){return this.on(b,a)}});w.expr.pseudos.animated=function(a){return w.grep(w.timers,function(b){return a===b.elem}).length};w.offset={setOffset:function(a,
b,c){var e,f,h,m,q,r,l=w.css(a,"position"),t=w(a),y={};"static"===l&&(a.style.position="relative");q=t.offset();h=w.css(a,"top");r=w.css(a,"left");("absolute"===l||"fixed"===l)&&-1<(h+r).indexOf("auto")?(e=t.position(),m=e.top,f=e.left):(m=parseFloat(h)||0,f=parseFloat(r)||0);w.isFunction(b)&&(b=b.call(a,c,w.extend({},q)));null!=b.top&&(y.top=b.top-q.top+m);null!=b.left&&(y.left=b.left-q.left+f);"using"in b?b.using.call(a,y):t.css(y)}};w.fn.extend({offset:function(a){if(arguments.length)return void 0===
a?this:this.each(function(b){w.offset.setOffset(this,a,b)});var b,c,e,f,h=this[0];if(h)return h.getClientRects().length?(e=h.getBoundingClientRect(),e.width||e.height?(f=h.ownerDocument,c=ya(f),b=f.documentElement,{top:e.top+c.pageYOffset-b.clientTop,left:e.left+c.pageXOffset-b.clientLeft}):e):{top:0,left:0}},position:function(){if(this[0]){var a,b,c=this[0],e={top:0,left:0};return"fixed"===w.css(c,"position")?b=c.getBoundingClientRect():(a=this.offsetParent(),b=this.offset(),w.nodeName(a[0],"html")||
(e=a.offset()),e={top:e.top+w.css(a[0],"borderTopWidth",!0),left:e.left+w.css(a[0],"borderLeftWidth",!0)}),{top:b.top-e.top-w.css(c,"marginTop",!0),left:b.left-e.left-w.css(c,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var a=this.offsetParent;a&&"static"===w.css(a,"position");)a=a.offsetParent;return a||db})}});w.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(a,b){var c="pageYOffset"===b;w.fn[a]=function(e){return La(this,function(a,e,f){var h=ya(a);
return void 0===f?h?h[b]:a[e]:void(h?h.scrollTo(c?h.pageXOffset:f,c?f:h.pageYOffset):a[e]=f)},a,e,arguments.length)}});w.each(["top","left"],function(a,b){w.cssHooks[b]=ma(oa.pixelPosition,function(a,c){if(c)return c=W(a,b),Ha.test(c)?w(a).position()[b]+"px":c})});w.each({Height:"height",Width:"width"},function(a,b){w.each({padding:"inner"+a,content:b,"":"outer"+a},function(c,e){w.fn[e]=function(f,h){var m=arguments.length&&(c||"boolean"!=typeof f),q=c||(!0===f||!0===h?"margin":"border");return La(this,
function(b,c,f){var h;return w.isWindow(b)?0===e.indexOf("outer")?b["inner"+a]:b.document.documentElement["client"+a]:9===b.nodeType?(h=b.documentElement,Math.max(b.body["scroll"+a],h["scroll"+a],b.body["offset"+a],h["offset"+a],h["client"+a])):void 0===f?w.css(b,c,q):w.style(b,c,f,q)},b,m?f:void 0,m)}})});w.fn.extend({bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},delegate:function(a,b,c,e){return this.on(b,a,c,e)},undelegate:function(a,b,c){return 1===
arguments.length?this.off(a,"**"):this.off(b,a||"**",c)}});w.parseJSON=JSON.parse;"function"==typeof define&&define.amd&&define("jquery",[],function(){return w});var lc=b.jQuery,mc=b.$;return w.noConflict=function(a){return b.$===w&&(b.$=mc),a&&b.jQuery===w&&(b.jQuery=lc),w},a||(b.jQuery=b.$=w),w});var caretPositionAmp;
jQuery.fn.extend({getSelection:function(){var b=this.jquery?this[0]:this,a,c,e,f=0;b.onmousedown=function(){document.selection&&"number"!=typeof b.selectionStart?document.selection.empty():window.getSelection().removeAllRanges()};if(document.selection){var h=document.selection.createRange(),l=0,t=0,x=0;null!=b.value.match(/\n/g)&&(f=b.value.match(/\n/g).length);if(h.text){e=h.text;if("number"==typeof b.selectionStart){if(a=b.selectionStart,c=b.selectionEnd,a==c)return{start:a,end:c,text:h.text,length:c-
a}}else{var q;a=b.createTextRange();c=a.duplicate();e=a.text;a.moveToBookmark(h.getBookmark());q=a.text;c.setEndPoint("EndToStart",a);if(e==q&&e!=h.text)return this;a=c.text.length;c=c.text.length+h.text.length}if(0<f)for(e=0;e<=f;e++)q=b.value.indexOf("\n",t),-1!=q&&q<a?(t=q+1,l++,x=l):-1!=q&&q>=a&&q<=c?q==a+1?(l--,x--,t=q+1):(t=q+1,x++):e=f;1==h.text.indexOf("\n",0)&&(x+=2);a-=l;c-=x;return{start:a,end:c,text:h.text,length:c-a}}b.focus();"number"==typeof b.selectionStart?a=b.selectionStart:(h=document.selection.createRange(),
a=b.createTextRange(),c=a.duplicate(),a.moveToBookmark(h.getBookmark()),c.setEndPoint("EndToStart",a),a=c.text.length);if(0<f)for(e=0;e<=f;e++)q=b.value.indexOf("\n",t),-1!=q&&q<a?(t=q+1,l++):e=f;a-=l;return{start:a,end:a,text:h.text,length:0}}return"number"==typeof b.selectionStart?(a=b.selectionStart,c=b.selectionEnd,e=b.value.substring(b.selectionStart,b.selectionEnd),{start:a,end:c,text:e,length:c-a}):{start:void 0,end:void 0,text:void 0,length:void 0}},replaceSelection:function(b){var a=this.jquery?
this[0]:this,c,e;e=0;var f,h,l=0,t=0,x=void 0==a.scrollTop?0:a.scrollTop;if(document.selection&&"number"!=typeof a.selectionStart){x=document.selection.createRange();if("number"!=typeof a.selectionStart){var q;h=a.createTextRange();f=h.duplicate();c=h.text;h.moveToBookmark(x.getBookmark());q=h.text;f.setEndPoint("EndToStart",h);if(c==q&&c!=x.text)return this}if(x.text){part=x.text;null!=a.value.match(/\n/g)&&(l=a.value.match(/\n/g).length);c=f.text.length;if(0<l)for(q=0;q<=l;q++){var m=a.value.indexOf("\n",
e);-1!=m&&m<c?(e=m+1,t++):q=l}x.text=b;caretPositionAmp=f.text.length+b.length;h.move("character",caretPositionAmp);document.selection.empty();a.blur()}}else"number"==typeof a.selectionStart&&a.selectionStart!=a.selectionEnd&&(c=a.selectionStart,e=a.selectionEnd,a.value=a.value.substr(0,c)+b+a.value.substr(e),e=c+b.length,a.setSelectionRange(e,e),a.scrollTop=x);return this},setSelection:function(b,a){b=parseInt(b);a=parseInt(a);var c=this.jquery?this[0]:this;c.focus();"number"!=typeof c.selectionStart&&
(re=c.createTextRange(),re.text.length<a&&(a=re.text.length+1));if(a<b)return this;if(document.selection){var e=0,f=0,h=0,l=0;if("number"!=typeof c.selectionStart)re.collapse(!0),re.moveEnd("character",a),re.moveStart("character",b),re.select();else if("number"==typeof c.selectionStart){null!=c.value.match(/\n/g)&&(e=c.value.match(/\n/g).length);if(0<e)for(var t=0;t<=e;t++){var x=c.value.indexOf("\n",h);-1!=x&&x<b?(h=x+1,f++,l=f):-1!=x&&x>=b&&x<=a?x==b+1?(f--,l--,h=x+1):(h=x+1,l++):t=e}c.selectionStart=
b+f;c.selectionEnd=a+l}return this}if(c.selectionStart)return c.focus(),c.selectionStart=b,c.selectionEnd=a,this},insertAtCaretPos:function(b){var a=this.jquery?this[0]:this,c,e,f,h,l,t,x=e=0,q=void 0==a.scrollTop?0:a.scrollTop;a.focus();if(document.selection&&"number"!=typeof a.selectionStart&&(null!=a.value.match(/\n/g)&&(x=a.value.match(/\n/g).length),c=parseInt(caretPositionAmp),0<x))for(var m=0;m<=x;m++){var r=a.value.indexOf("\n",f);-1!=r&&r<=c&&(f=r+1,--c,e++)}caretPositionAmp=parseInt(caretPositionAmp);
a.onmouseup=function(){document.selection&&"number"!=typeof a.selectionStart&&(a.focus(),h=document.selection.createRange(),l=a.createTextRange(),t=l.duplicate(),l.moveToBookmark(h.getBookmark()),t.setEndPoint("EndToStart",l),caretPositionAmp=t.text.length)};if(document.selection&&"number"!=typeof a.selectionStart){h=document.selection.createRange();if(0!=h.text.length)return this;l=a.createTextRange();textLength=l.text.length;t=l.duplicate();l.moveToBookmark(h.getBookmark());t.setEndPoint("EndToStart",
l);c=t.text.length;0<caretPositionAmp&&0==c?(e=caretPositionAmp-e,l.move("character",e),l.select(),h=document.selection.createRange(),caretPositionAmp+=b.length):0<=caretPositionAmp||0!=textLength?0<=caretPositionAmp||0!=c?!(0<=caretPositionAmp)&&0<c?(l.move("character",0),document.selection.empty(),l.select(),h=document.selection.createRange(),caretPositionAmp=c+b.length):0<=caretPositionAmp&&caretPositionAmp==textLength?(0!=textLength?(l.move("character",textLength),l.select()):l.move("character",
0),h=document.selection.createRange(),caretPositionAmp=b.length+textLength):(0<=caretPositionAmp&&0!=c&&caretPositionAmp>=c?(e=caretPositionAmp-c,l.move("character",e)):0<=caretPositionAmp&&0!=c&&caretPositionAmp<c&&l.move("character",0),document.selection.empty(),l.select(),h=document.selection.createRange(),caretPositionAmp+=b.length):(l.move("character",textLength),l.select(),h=document.selection.createRange(),caretPositionAmp=b.length+textLength):(h=document.selection.createRange(),caretPositionAmp=
b.length+textLength);h.text=b;a.focus()}else"number"==typeof a.selectionStart&&a.selectionStart==a.selectionEnd&&(f=a.selectionStart+b.length,c=a.selectionStart,e=a.selectionEnd,a.value=a.value.substr(0,c)+b+a.value.substr(e),a.setSelectionRange(f,f),a.scrollTop=q);return this},setCaretPos:function(b){var a=this.jquery?this[0]:this,c,e=0,f=0,h;a.focus();if(0==parseInt(b))return this;if(0<parseInt(b)){if(b=parseInt(b)-1,document.selection&&"number"==typeof a.selectionStart&&a.selectionStart==a.selectionEnd&&
(null!=a.value.match(/\n/g)&&(e=a.value.match(/\n/g).length),0<e))for(var l=0;l<=e;l++)h=a.value.indexOf("\n",c),-1!=h&&h<=b&&(c=h+1,b=parseInt(b)+1)}else if(0>parseInt(b))if(b=parseInt(b)+1,document.selection&&"number"!=typeof a.selectionStart){if(b=a.value.length+parseInt(b),null!=a.value.match(/\n/g)&&(e=a.value.match(/\n/g).length),0<e){for(l=0;l<=e;l++)h=a.value.indexOf("\n",c),-1!=h&&h<=b&&(c=h+1,b=parseInt(b)-1,f+=1);b=b+f-e}}else if(document.selection&&"number"==typeof a.selectionStart){if(b=
a.value.length+parseInt(b),null!=a.value.match(/\n/g)&&(e=a.value.match(/\n/g).length),0<e)for(b=parseInt(b)-e,l=0;l<=e;l++)h=a.value.indexOf("\n",c),-1!=h&&h<=b&&(c=h+1,b=parseInt(b)+1,f+=1)}else b=a.value.length+parseInt(b);else return this;if(document.selection&&"number"!=typeof a.selectionStart){c=document.selection.createRange();if(0!=c.text)return this;a=a.createTextRange();a.collapse(!0);a.moveEnd("character",b);a.moveStart("character",b);a.select();caretPositionAmp=b}else"number"==typeof a.selectionStart&&
a.selectionStart==a.selectionEnd&&a.setSelectionRange(b,b);return this},countCharacters:function(b){b=this.jquery?this[0]:this;return null!=b.value.match(/\r/g)?b.value.length-b.value.match(/\r/g).length:b.value.length},setMaxLength:function(b,a){this.each(function(){var c=this.jquery?this[0]:this,e=c.type,f,h;0>parseInt(b)&&(b=1E8);"text"==e&&(c.maxLength=b);if("textarea"==e||"text"==e)c.onkeypress=function(e){var l=c.value.match(/\r/g);h=b;null!=l&&(h=parseInt(h)+l.length);e=e||event;l=e.keyCode;
f=document.selection?0<document.selection.createRange().text.length:c.selectionStart!=c.selectionEnd;if(c.value.length>=h&&(47<l||32==l||0==l||13==l)&&!e.ctrlKey&&!e.altKey&&!f)return c.value=c.value.substring(0,h),"function"==typeof a&&a(),!1},c.onkeyup=function(){var e=c.value.match(/\r/g),f=0,x=0;h=b;if(null!=e){for(var q=0;q<=e.length;q++)c.value.indexOf("\n",x)<=parseInt(b)&&(f++,x=c.value.indexOf("\n",x)+1);h=parseInt(b)+f}if(c.value.length>h)return c.value=c.value.substring(0,h),"function"==
typeof a&&a(),this};else return this});return this}});(function(b){b.asuggestKeys={UNKNOWN:0,SHIFT:16,CTRL:17,ALT:18,LEFT:37,UP:38,RIGHT:39,DOWN:40,DEL:46,TAB:9,RETURN:13,ESC:27,COMMA:188,PAGEUP:33,PAGEDOWN:34,BACKSPACE:8,SPACE:32};b.asuggestFocused=null;b.fn.asuggest=function(a,c){return this.each(function(){b.makeSuggest(this,a,c)})};b.fn.asuggest.defaults={delimiters:"\n ",minChunkSize:1,cycleOnTab:!0,autoComplete:!0,endingSymbols:" ",stopSuggestionKeys:[b.asuggestKeys.RETURN,b.asuggestKeys.SPACE]};b.makeSuggest=function(a,c,e){e=b.extend({},b.fn.asuggest.defaults,
e);var f=b.asuggestKeys,h=b(a);h.suggests=c;h.options=e;h.getChunk=function(){var a=this.options.delimiters.split(""),b=this.val().substr(0,this.getSelection().start),c=-1,e;for(e in a){var f=b.lastIndexOf(a[e]);f>c&&(c=f)}return 0>c?b:b.substr(c+1)};h.getCompletion=function(a){for(var b=this.getChunk(),c=this.getSelection().text,e=this.suggests,f=!1,h=null,l=0;l<e.length;l++){var B=e[l];if(0==B.indexOf(b))if(a)if(b+c==B)f=!0;else{if(f)return B.substr(b.length);null==h&&(h=B)}else return B.substr(b.length)}return a&&
h?h.substr(b.length):null};h.updateSelection=function(a){if(a){var b=h.getSelection().start,c=b+a.length;""==h.getSelection().text?(h.val().length==b&&h.setCaretPos(b+1E4),h.insertAtCaretPos(a)):h.replaceSelection(a);h.setSelection(b,c)}};h.keydown(function(a){if(a.keyCode==f.TAB&&h.options.cycleOnTab)return h.getChunk().length>=h.options.minChunkSize&&h.updateSelection(h.getCompletion(performCycle=!0)),a.preventDefault(),a.stopPropagation(),h.focus(),b.asuggestFocused=this,!1;if(h.getSelection().length&&
-1!=b.inArray(a.keyCode,h.options.stopSuggestionKeys)){var c=h.getSelection().end+h.options.endingSymbols.length,e=h.getSelection().text+h.options.endingSymbols;h.replaceSelection(e);h.setSelection(c,c);a.preventDefault();a.stopPropagation();this.focus();b.asuggestFocused=this;return!1}});h.keyup(function(a){var b=a.altKey||a.metaKey||a.ctrlKey,c=b||a.shiftKey;switch(a.keyCode){case f.UNKNOWN:case f.SHIFT:case f.CTRL:case f.ALT:case f.RETURN:break;case f.TAB:if(!c&&h.options.cycleOnTab)break;case f.ESC:case f.BACKSPACE:case f.DEL:case f.UP:case f.DOWN:case f.LEFT:case f.RIGHT:!c&&
h.options.autoComplete&&h.replaceSelection("");break;default:!b&&h.options.autoComplete&&h.getChunk().length>=h.options.minChunkSize&&h.updateSelection(h.getCompletion(performCycle=!1))}});return h}})(jQuery);var LZString=function(){function b(a,b){if(!c[a]){c[a]={};for(var e=0;e<a.length;e++)c[a][a.charAt(e)]=e}return c[a][b]}var a=String.fromCharCode,c={},e={compressToBase64:function(a){if(null==a)return"";a=e._compress(a,6,function(a){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(a)});switch(a.length%4){default:case 0:return a;case 1:return a+"===";case 2:return a+"==";case 3:return a+"="}},decompressFromBase64:function(a){return null==a?"":""==a?null:e._decompress(a.length,
32,function(c){return b("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",a.charAt(c))})},compressToUTF16:function(b){return null==b?"":e._compress(b,15,function(b){return a(b+32)})+" "},decompressFromUTF16:function(a){return null==a?"":""==a?null:e._decompress(a.length,16384,function(b){return a.charCodeAt(b)-32})},compressToUint8Array:function(a){a=e.compress(a);for(var b=new Uint8Array(2*a.length),c=0,f=a.length;f>c;c++){var x=a.charCodeAt(c);b[2*c]=x>>>8;b[2*c+1]=x%256}return b},
decompressFromUint8Array:function(b){if(null===b||void 0===b)return e.decompress(b);for(var c=Array(b.length/2),f=0,t=c.length;t>f;f++)c[f]=256*b[2*f]+b[2*f+1];var x=[];return c.forEach(function(b){x.push(a(b))}),e.decompress(x.join(""))},compressToEncodedURIComponent:function(a){return null==a?"":e._compress(a,6,function(a){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$".charAt(a)})},decompressFromEncodedURIComponent:function(a){return null==a?"":""==a?null:(a=a.replace(/ /g,
"+"),e._decompress(a.length,32,function(c){return b("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",a.charAt(c))}))},compress:function(b){return e._compress(b,16,function(b){return a(b)})},_compress:function(a,b,c){if(null==a)return"";var e,f,h,m={},r={},l="",B="",z="",E=2,G=3,I=2,F=[],D=0,H=0;for(h=0;h<a.length;h+=1)if(l=a.charAt(h),Object.prototype.hasOwnProperty.call(m,l)||(m[l]=G++,r[l]=!0),B=z+l,Object.prototype.hasOwnProperty.call(m,B))z=B;else{if(Object.prototype.hasOwnProperty.call(r,
z)){if(256>z.charCodeAt(0)){for(e=0;I>e;e++)D<<=1,H==b-1?(H=0,F.push(c(D)),D=0):H++;f=z.charCodeAt(0);for(e=0;8>e;e++)D=D<<1|1&f,H==b-1?(H=0,F.push(c(D)),D=0):H++,f>>=1}else{f=1;for(e=0;I>e;e++)D=D<<1|f,H==b-1?(H=0,F.push(c(D)),D=0):H++,f=0;f=z.charCodeAt(0);for(e=0;16>e;e++)D=D<<1|1&f,H==b-1?(H=0,F.push(c(D)),D=0):H++,f>>=1}E--;0==E&&(E=Math.pow(2,I),I++);delete r[z]}else for(f=m[z],e=0;I>e;e++)D=D<<1|1&f,H==b-1?(H=0,F.push(c(D)),D=0):H++,f>>=1;E--;0==E&&(E=Math.pow(2,I),I++);m[B]=G++;z=String(l)}if(""!==
z){if(Object.prototype.hasOwnProperty.call(r,z)){if(256>z.charCodeAt(0)){for(e=0;I>e;e++)D<<=1,H==b-1?(H=0,F.push(c(D)),D=0):H++;f=z.charCodeAt(0);for(e=0;8>e;e++)D=D<<1|1&f,H==b-1?(H=0,F.push(c(D)),D=0):H++,f>>=1}else{f=1;for(e=0;I>e;e++)D=D<<1|f,H==b-1?(H=0,F.push(c(D)),D=0):H++,f=0;f=z.charCodeAt(0);for(e=0;16>e;e++)D=D<<1|1&f,H==b-1?(H=0,F.push(c(D)),D=0):H++,f>>=1}E--;0==E&&(E=Math.pow(2,I),I++);delete r[z]}else for(f=m[z],e=0;I>e;e++)D=D<<1|1&f,H==b-1?(H=0,F.push(c(D)),D=0):H++,f>>=1;E--;0==
E&&I++}f=2;for(e=0;I>e;e++)D=D<<1|1&f,H==b-1?(H=0,F.push(c(D)),D=0):H++,f>>=1;for(;;){if(D<<=1,H==b-1){F.push(c(D));break}H++}return F.join("")},decompress:function(a){return null==a?"":""==a?null:e._decompress(a.length,32768,function(b){return a.charCodeAt(b)})},_decompress:function(b,c,e){var f,h,q,m,r,l,B=[],z=4,E=4,G=3,I=[],F=e(0),D=c,H=1;for(f=0;3>f;f+=1)B[f]=f;h=0;m=Math.pow(2,2);for(r=1;r!=m;)q=F&D,D>>=1,0==D&&(D=c,F=e(H++)),h|=(0<q?1:0)*r,r<<=1;switch(h){case 0:h=0;m=Math.pow(2,8);for(r=1;r!=
m;)q=F&D,D>>=1,0==D&&(D=c,F=e(H++)),h|=(0<q?1:0)*r,r<<=1;l=a(h);break;case 1:h=0;m=Math.pow(2,16);for(r=1;r!=m;)q=F&D,D>>=1,0==D&&(D=c,F=e(H++)),h|=(0<q?1:0)*r,r<<=1;l=a(h);break;case 2:return""}f=B[3]=l;for(I.push(l);;){if(H>b)return"";h=0;m=Math.pow(2,G);for(r=1;r!=m;)q=F&D,D>>=1,0==D&&(D=c,F=e(H++)),h|=(0<q?1:0)*r,r<<=1;switch(l=h){case 0:h=0;m=Math.pow(2,8);for(r=1;r!=m;)q=F&D,D>>=1,0==D&&(D=c,F=e(H++)),h|=(0<q?1:0)*r,r<<=1;B[E++]=a(h);l=E-1;z--;break;case 1:h=0;m=Math.pow(2,16);for(r=1;r!=m;)q=
F&D,D>>=1,0==D&&(D=c,F=e(H++)),h|=(0<q?1:0)*r,r<<=1;B[E++]=a(h);l=E-1;z--;break;case 2:return I.join("")}if(0==z&&(z=Math.pow(2,G),G++),B[l])l=B[l];else{if(l!==E)return null;l=f+f.charAt(0)}I.push(l);B[E++]=f+l.charAt(0);z--;f=l;0==z&&(z=Math.pow(2,G),G++)}}};return e}();"function"==typeof define&&define.amd?define(function(){return LZString}):"undefined"!=typeof module&&null!=module&&(module.exports=LZString);/*
 howler.js v2.0.2 | (c) 2013-2016, James Simpson of GoldFire Studios | MIT License | howlerjs.com  Spatial Plugin */
!function(){var b=function(){this.init()};b.prototype={init:function(){var b=this||a;return b._codecs={},b._howls=[],b._muted=!1,b._volume=1,b._canPlayEvent="canplaythrough",b._navigator="undefined"!=typeof window&&window.navigator?window.navigator:null,b.masterGain=null,b.noAudio=!1,b.usingWebAudio=!0,b.autoSuspend=!0,b.ctx=null,b.mobileAutoEnable=!0,b._setup(),b},volume:function(b){var c=this||a;if(b=parseFloat(b),c.ctx||q(),"undefined"!=typeof b&&0<=b&&1>=b){if(c._volume=b,c._muted)return c;c.usingWebAudio&&
(c.masterGain.gain.value=b);for(var e=0;e<c._howls.length;e++)if(!c._howls[e]._webAudio)for(var f=c._howls[e]._getSoundIds(),h=0;h<f.length;h++){var m=c._howls[e]._soundById(f[h]);m&&m._node&&(m._node.volume=m._volume*b)}return c}return c._volume},mute:function(b){var c=this||a;c.ctx||q();c._muted=b;c.usingWebAudio&&(c.masterGain.gain.value=b?0:c._volume);for(var e=0;e<c._howls.length;e++)if(!c._howls[e]._webAudio)for(var f=c._howls[e]._getSoundIds(),h=0;h<f.length;h++){var m=c._howls[e]._soundById(f[h]);
m&&m._node&&(m._node.muted=!!b||m._muted)}return c},unload:function(){for(var b=this||a,c=b._howls.length-1;0<=c;c--)b._howls[c].unload();return b.usingWebAudio&&b.ctx&&"undefined"!=typeof b.ctx.close&&(b.ctx.close(),b.ctx=null,q()),b},codecs:function(b){return(this||a)._codecs[b.replace(/^x-/,"")]},_setup:function(){var b=this||a;if(b.state=b.ctx?b.ctx.state||"running":"running",b._autoSuspend(),!b.usingWebAudio)if("undefined"!=typeof Audio)try{var c=new Audio;"undefined"==typeof c.oncanplaythrough&&
(b._canPlayEvent="canplay")}catch(y){b.noAudio=!0}else b.noAudio=!0;try{c=new Audio,c.muted&&(b.noAudio=!0)}catch(y){}return b.noAudio||b._setupCodecs(),b},_setupCodecs:function(){var b=this||a,c=null;try{c="undefined"!=typeof Audio?new Audio:null}catch(z){return b}if(!c||"function"!=typeof c.canPlayType)return b;var e=c.canPlayType("audio/mpeg;").replace(/^no$/,""),f=b._navigator&&b._navigator.userAgent.match(/OPR\/([0-6].)/g),f=f&&33>parseInt(f[0].split("/")[1],10);return b._codecs={mp3:!(f||!e&&
!c.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!e,opus:!!c.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!c.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!c.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!c.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),aac:!!c.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!c.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(c.canPlayType("audio/x-m4a;")||c.canPlayType("audio/m4a;")||
c.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(c.canPlayType("audio/x-mp4;")||c.canPlayType("audio/mp4;")||c.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!c.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),webm:!!c.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),dolby:!!c.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(c.canPlayType("audio/x-flac;")||c.canPlayType("audio/flac;")).replace(/^no$/,"")},b},_enableMobileAudio:function(){var b=
this||a,c=/iPhone|iPad|iPod|Android|BlackBerry|BB10|Silk|Mobi/i.test(b._navigator&&b._navigator.userAgent),e=!!("ontouchend"in window||b._navigator&&0<b._navigator.maxTouchPoints||b._navigator&&0<b._navigator.msMaxTouchPoints);if(!b._mobileEnabled&&b.ctx&&(c||e)){b._mobileEnabled=!1;b._mobileUnloaded||44100===b.ctx.sampleRate||(b._mobileUnloaded=!0,b.unload());b._scratchBuffer=b.ctx.createBuffer(1,1,22050);var f=function(){var a=b.ctx.createBufferSource();a.buffer=b._scratchBuffer;a.connect(b.ctx.destination);
"undefined"==typeof a.start?a.noteOn(0):a.start(0);a.onended=function(){a.disconnect(0);b._mobileEnabled=!0;b.mobileAutoEnable=!1;document.removeEventListener("touchend",f,!0)}};return document.addEventListener("touchend",f,!0),b}},_autoSuspend:function(){var b=this;if(b.autoSuspend&&b.ctx&&"undefined"!=typeof b.ctx.suspend&&a.usingWebAudio){for(var c=0;c<b._howls.length;c++)if(b._howls[c]._webAudio)for(var e=0;e<b._howls[c]._sounds.length;e++)if(!b._howls[c]._sounds[e]._paused)return b;return b._suspendTimer&&
clearTimeout(b._suspendTimer),b._suspendTimer=setTimeout(function(){b.autoSuspend&&(b._suspendTimer=null,b.state="suspending",b.ctx.suspend().then(function(){b.state="suspended";b._resumeAfterSuspend&&(delete b._resumeAfterSuspend,b._autoResume())}))},3E4),b}},_autoResume:function(){var b=this;if(b.ctx&&"undefined"!=typeof b.ctx.resume&&a.usingWebAudio)return"running"===b.state&&b._suspendTimer?(clearTimeout(b._suspendTimer),b._suspendTimer=null):"suspended"===b.state?(b.state="resuming",b.ctx.resume().then(function(){b.state=
"running";for(var a=0;a<b._howls.length;a++)b._howls[a]._emit("resume")}),b._suspendTimer&&(clearTimeout(b._suspendTimer),b._suspendTimer=null)):"suspending"===b.state&&(b._resumeAfterSuspend=!0),b}};var a=new b,c=function(a){return a.src&&0!==a.src.length?void this.init(a):void console.error("An array of source files must be passed with any new Howl.")};c.prototype={init:function(b){var c=this;return a.ctx||q(),c._autoplay=b.autoplay||!1,c._format="string"!=typeof b.format?b.format:[b.format],c._html5=
b.html5||!1,c._muted=b.mute||!1,c._loop=b.loop||!1,c._pool=b.pool||5,c._preload="boolean"!=typeof b.preload||b.preload,c._rate=b.rate||1,c._sprite=b.sprite||{},c._src="string"!=typeof b.src?b.src:[b.src],c._volume=void 0!==b.volume?b.volume:1,c._duration=0,c._state="unloaded",c._sounds=[],c._endTimers={},c._queue=[],c._onend=b.onend?[{fn:b.onend}]:[],c._onfade=b.onfade?[{fn:b.onfade}]:[],c._onload=b.onload?[{fn:b.onload}]:[],c._onloaderror=b.onloaderror?[{fn:b.onloaderror}]:[],c._onpause=b.onpause?
[{fn:b.onpause}]:[],c._onplay=b.onplay?[{fn:b.onplay}]:[],c._onstop=b.onstop?[{fn:b.onstop}]:[],c._onmute=b.onmute?[{fn:b.onmute}]:[],c._onvolume=b.onvolume?[{fn:b.onvolume}]:[],c._onrate=b.onrate?[{fn:b.onrate}]:[],c._onseek=b.onseek?[{fn:b.onseek}]:[],c._onresume=[],c._webAudio=a.usingWebAudio&&!c._html5,"undefined"!=typeof a.ctx&&a.ctx&&a.mobileAutoEnable&&a._enableMobileAudio(),a._howls.push(c),c._autoplay&&c._queue.push({event:"play",action:function(){c.play()}}),c._preload&&c.load(),c},load:function(){var b=
null;if(a.noAudio)return void this._emit("loaderror",null,"No audio support.");"string"==typeof this._src&&(this._src=[this._src]);for(var c=0;c<this._src.length;c++){var f,q;if(this._format&&this._format[c])f=this._format[c];else{if(q=this._src[c],"string"!=typeof q){this._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}(f=/^data:audio\/([^;,]+);/i.exec(q))||(f=/\.([^.]+)$/.exec(q.split("?",1)[0]));f&&(f=f[1].toLowerCase())}if(a.codecs(f)){b=this._src[c];
break}}return b?(this._src=b,this._state="loading","https:"===window.location.protocol&&"http:"===b.slice(0,5)&&(this._html5=!0,this._webAudio=!1),new e(this),this._webAudio&&h(this),this):void this._emit("loaderror",null,"No codec support for selected audio sources.")},play:function(b,c){var e=this,f=null;if("number"==typeof b)f=b,b=null;else{if("string"==typeof b&&"loaded"===e._state&&!e._sprite[b])return null;if("undefined"==typeof b){b="__default";for(var h=0,m=0;m<e._sounds.length;m++)e._sounds[m]._paused&&
!e._sounds[m]._ended&&(h++,f=e._sounds[m]._id);1===h?b=null:f=null}}var q=f?e._soundById(f):e._inactiveSound();if(!q)return null;if(f&&!b&&(b=q._sprite||"__default"),"loaded"!==e._state&&!e._sprite[b])return e._queue.push({event:"play",action:function(){e.play(e._soundById(q._id)?q._id:void 0)}}),q._id;if(f&&!q._paused)return c||setTimeout(function(){e._emit("play",q._id)},0),q._id;e._webAudio&&a._autoResume();var r=Math.max(0,0<q._seek?q._seek:e._sprite[b][0]/1E3),l=Math.max(0,(e._sprite[b][0]+e._sprite[b][1])/
1E3-r),t=1E3*l/Math.abs(q._rate);q._paused=!1;q._ended=!1;q._sprite=b;q._seek=r;q._start=e._sprite[b][0]/1E3;q._stop=(e._sprite[b][0]+e._sprite[b][1])/1E3;q._loop=!(!q._loop&&!e._sprite[b][2]);var x=q._node;if(e._webAudio)f=function(){e._refreshBuffer(q);x.gain.setValueAtTime(q._muted||e._muted?0:q._volume,a.ctx.currentTime);q._playStart=a.ctx.currentTime;"undefined"==typeof x.bufferSource.start?q._loop?x.bufferSource.noteGrainOn(0,r,86400):x.bufferSource.noteGrainOn(0,r,l):q._loop?x.bufferSource.start(0,
r,86400):x.bufferSource.start(0,r,l);t!==1/0&&(e._endTimers[q._id]=setTimeout(e._ended.bind(e,q),t));c||setTimeout(function(){e._emit("play",q._id)},0)},h="running"===a.state,"loaded"===e._state&&h?f():(e.once(h?"load":"resume",f,h?q._id:null),e._clearTimer(q._id));else{var M=function(){x.currentTime=r;x.muted=q._muted||e._muted||a._muted||x.muted;x.volume=q._volume*a.volume();x.playbackRate=q._rate;setTimeout(function(){x.play();t!==1/0&&(e._endTimers[q._id]=setTimeout(e._ended.bind(e,q),t));c||
e._emit("play",q._id)},0)},f="loaded"===e._state&&(window&&window.ejecta||!x.readyState&&a._navigator.isCocoonJS);if(4===x.readyState||f)M();else{var N=function(){M();x.removeEventListener(a._canPlayEvent,N,!1)};x.addEventListener(a._canPlayEvent,N,!1);e._clearTimer(q._id)}}return q._id},pause:function(a,b){var c=this;if("loaded"!==c._state)return c._queue.push({event:"pause",action:function(){c.pause(a)}}),c;for(var e=c._getSoundIds(a),f=0;f<e.length;f++){c._clearTimer(e[f]);var h=c._soundById(e[f]);
if(h&&!h._paused&&(h._seek=c.seek(e[f]),h._rateSeek=0,h._paused=!0,c._stopFade(e[f]),h._node))if(c._webAudio){if(!h._node.bufferSource)break;"undefined"==typeof h._node.bufferSource.stop?h._node.bufferSource.noteOff(0):h._node.bufferSource.stop(0);c._cleanBuffer(h._node)}else isNaN(h._node.duration)&&h._node.duration!==1/0||h._node.pause();b||c._emit("pause",h?h._id:null)}return c},stop:function(a,b){var c=this;if("loaded"!==c._state)return c._queue.push({event:"stop",action:function(){c.stop(a)}}),
c;for(var e=c._getSoundIds(a),f=0;f<e.length;f++){c._clearTimer(e[f]);var h=c._soundById(e[f]);if(h&&(h._seek=h._start||0,h._rateSeek=0,h._paused=!0,h._ended=!0,c._stopFade(e[f]),h._node))if(c._webAudio){if(!h._node.bufferSource)return b||c._emit("stop",h._id),c;"undefined"==typeof h._node.bufferSource.stop?h._node.bufferSource.noteOff(0):h._node.bufferSource.stop(0);c._cleanBuffer(h._node)}else isNaN(h._node.duration)&&h._node.duration!==1/0||(h._node.currentTime=h._start||0,h._node.pause());h&&
!b&&c._emit("stop",h._id)}return c},mute:function(b,c){var e=this;if("loaded"!==e._state)return e._queue.push({event:"mute",action:function(){e.mute(b,c)}}),e;if("undefined"==typeof c){if("boolean"!=typeof b)return e._muted;e._muted=b}for(var f=e._getSoundIds(c),h=0;h<f.length;h++){var m=e._soundById(f[h]);m&&(m._muted=b,e._webAudio&&m._node?m._node.gain.setValueAtTime(b?0:m._volume,a.ctx.currentTime):m._node&&(m._node.muted=!!a._muted||b),e._emit("mute",m._id))}return e},volume:function(){var b,
c,e=this,f=arguments;if(0===f.length)return e._volume;1===f.length||2===f.length&&"undefined"==typeof f[1]?0<=e._getSoundIds().indexOf(f[0])?c=parseInt(f[0],10):b=parseFloat(f[0]):2<=f.length&&(b=parseFloat(f[0]),c=parseInt(f[1],10));var h;if(!("undefined"!=typeof b&&0<=b&&1>=b))return h=c?e._soundById(c):e._sounds[0],h?h._volume:0;if("loaded"!==e._state)return e._queue.push({event:"volume",action:function(){e.volume.apply(e,f)}}),e;"undefined"==typeof c&&(e._volume=b);c=e._getSoundIds(c);for(var q=
0;q<c.length;q++)(h=e._soundById(c[q]))&&(h._volume=b,f[2]||e._stopFade(c[q]),e._webAudio&&h._node&&!h._muted?h._node.gain.setValueAtTime(b,a.ctx.currentTime):h._node&&!h._muted&&(h._node.volume=b*a.volume()),e._emit("volume",h._id));return e},fade:function(b,c,e,f){var h=this,m=b>c?"out":"in",q=Math.abs(b-c)/.01,r=0<q?e/q:e;if(4>r&&(q=Math.ceil(q/(4/r)),r=4),"loaded"!==h._state)return h._queue.push({event:"fade",action:function(){h.fade(b,c,e,f)}}),h;h.volume(b,f);for(var l=h._getSoundIds(f),t=0;t<
l.length;t++){var x=h._soundById(l[t]);if(x){if(f||h._stopFade(l[t]),h._webAudio&&!x._muted){var y=a.ctx.currentTime,B=y+e/1E3;x._volume=b;x._node.gain.setValueAtTime(b,y);x._node.gain.linearRampToValueAtTime(c,B)}var L=b;x._interval=setInterval(function(a,b){0<q&&(L+="in"===m?.01:-.01);L=Math.max(0,L);L=Math.min(1,L);L=Math.round(100*L)/100;h._webAudio?("undefined"==typeof f&&(h._volume=L),b._volume=L):h.volume(L,a,!0);L===c&&(clearInterval(b._interval),b._interval=null,h.volume(L,a),h._emit("fade",
a))}.bind(h,l[t],x),r)}}return h},_stopFade:function(b){var c=this._soundById(b);return c&&c._interval&&(this._webAudio&&c._node.gain.cancelScheduledValues(a.ctx.currentTime),clearInterval(c._interval),c._interval=null,this._emit("fade",b)),this},loop:function(){var a,b,c,e=arguments;if(0===e.length)return this._loop;if(1===e.length){if("boolean"!=typeof e[0])return c=this._soundById(parseInt(e[0],10)),!!c&&c._loop;this._loop=a=e[0]}else 2===e.length&&(a=e[0],b=parseInt(e[1],10));b=this._getSoundIds(b);
for(e=0;e<b.length;e++)(c=this._soundById(b[e]))&&(c._loop=a,this._webAudio&&c._node&&c._node.bufferSource&&(c._node.bufferSource.loop=a,a&&(c._node.bufferSource.loopStart=c._start||0,c._node.bufferSource.loopEnd=c._stop)));return this},rate:function(){var b,c,e=this,f=arguments;0===f.length?c=e._sounds[0]._id:1===f.length?0<=e._getSoundIds().indexOf(f[0])?c=parseInt(f[0],10):b=parseFloat(f[0]):2===f.length&&(b=parseFloat(f[0]),c=parseInt(f[1],10));var h;if("number"!=typeof b)return h=e._soundById(c),
h?h._rate:e._rate;if("loaded"!==e._state)return e._queue.push({event:"rate",action:function(){e.rate.apply(e,f)}}),e;"undefined"==typeof c&&(e._rate=b);c=e._getSoundIds(c);for(var q=0;q<c.length;q++)if(h=e._soundById(c[q])){h._rateSeek=e.seek(c[q]);h._playStart=e._webAudio?a.ctx.currentTime:h._playStart;h._rate=b;e._webAudio&&h._node&&h._node.bufferSource?h._node.bufferSource.playbackRate.value=b:h._node&&(h._node.playbackRate=b);var l=e.seek(c[q]),l=1E3*((e._sprite[h._sprite][0]+e._sprite[h._sprite][1])/
1E3-l)/Math.abs(h._rate);!e._endTimers[c[q]]&&h._paused||(e._clearTimer(c[q]),e._endTimers[c[q]]=setTimeout(e._ended.bind(e,h),l));e._emit("rate",h._id)}return e},seek:function(){var b,c,e=this,f=arguments;0===f.length?c=e._sounds[0]._id:1===f.length?0<=e._getSoundIds().indexOf(f[0])?c=parseInt(f[0],10):(c=e._sounds[0]._id,b=parseFloat(f[0])):2===f.length&&(b=parseFloat(f[0]),c=parseInt(f[1],10));if("undefined"==typeof c)return e;if("loaded"!==e._state)return e._queue.push({event:"seek",action:function(){e.seek.apply(e,
f)}}),e;var h=e._soundById(c);if(h){if(!("number"==typeof b&&0<=b))return e._webAudio?(b=e.playing(c)?a.ctx.currentTime-h._playStart:0,h._seek+((h._rateSeek?h._rateSeek-h._seek:0)+b*Math.abs(h._rate))):h._node.currentTime;var q=e.playing(c);q&&e.pause(c,!0);h._seek=b;h._ended=!1;e._clearTimer(c);q&&e.play(c,!0);!e._webAudio&&h._node&&(h._node.currentTime=b);e._emit("seek",c)}return e},playing:function(a){if("number"==typeof a)return a=this._soundById(a),!!a&&!a._paused;for(a=0;a<this._sounds.length;a++)if(!this._sounds[a]._paused)return!0;
return!1},duration:function(a){var b=this._duration;a=this._soundById(a);return a&&(b=this._sprite[a._sprite][1]/1E3),b},state:function(){return this._state},unload:function(){for(var b=this._sounds,c=0;c<b.length;c++){b[c]._paused||(this.stop(b[c]._id),this._emit("end",b[c]._id));this._webAudio||(b[c]._node.src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQAAAAA=",b[c]._node.removeEventListener("error",b[c]._errorFn,!1),b[c]._node.removeEventListener(a._canPlayEvent,
b[c]._loadFn,!1));delete b[c]._node;this._clearTimer(b[c]._id);var e=a._howls.indexOf(this);0<=e&&a._howls.splice(e,1)}b=!0;for(c=0;c<a._howls.length;c++)if(a._howls[c]._src===this._src){b=!1;break}return f&&b&&delete f[this._src],a.noAudio=!1,this._state="unloaded",this._sounds=[],null},on:function(a,b,c,e){a=this["_on"+a];return"function"==typeof b&&a.push(e?{id:c,fn:b,once:e}:{id:c,fn:b}),this},off:function(a,b,c){var e=this["_on"+a];if(b)for(a=0;a<e.length;a++){if(b===e[a].fn&&c===e[a].id){e.splice(a,
1);break}}else if(a)this["_on"+a]=[];else for(b=Object.keys(this),a=0;a<b.length;a++)0===b[a].indexOf("_on")&&Array.isArray(this[b[a]])&&(this[b[a]]=[]);return this},once:function(a,b,c){return this.on(a,b,c,1),this},_emit:function(a,b,c){for(var e=this["_on"+a],f=e.length-1;0<=f;f--)e[f].id&&e[f].id!==b&&"load"!==a||(setTimeout(function(a){a.call(this,b,c)}.bind(this,e[f].fn),0),e[f].once&&this.off(a,e[f].fn,e[f].id));return this},_loadQueue:function(){var a=this;if(0<a._queue.length){var b=a._queue[0];
a.once(b.event,function(){a._queue.shift();a._loadQueue()});b.action()}return a},_ended:function(b){var c=b._sprite,c=!(!b._loop&&!this._sprite[c][2]);if(this._emit("end",b._id),!this._webAudio&&c&&this.stop(b._id,!0).play(b._id),this._webAudio&&c){this._emit("play",b._id);b._seek=b._start||0;b._rateSeek=0;b._playStart=a.ctx.currentTime;var e=1E3*(b._stop-b._start)/Math.abs(b._rate);this._endTimers[b._id]=setTimeout(this._ended.bind(this,b),e)}return this._webAudio&&!c&&(b._paused=!0,b._ended=!0,
b._seek=b._start||0,b._rateSeek=0,this._clearTimer(b._id),this._cleanBuffer(b._node),a._autoSuspend()),this._webAudio||c||this.stop(b._id),this},_clearTimer:function(a){return this._endTimers[a]&&(clearTimeout(this._endTimers[a]),delete this._endTimers[a]),this},_soundById:function(a){for(var b=0;b<this._sounds.length;b++)if(a===this._sounds[b]._id)return this._sounds[b];return null},_inactiveSound:function(){this._drain();for(var a=0;a<this._sounds.length;a++)if(this._sounds[a]._ended)return this._sounds[a].reset();
return new e(this)},_drain:function(){var a=this._pool,b=0,c;if(!(this._sounds.length<a)){for(c=0;c<this._sounds.length;c++)this._sounds[c]._ended&&b++;for(c=this._sounds.length-1;0<=c&&!(b<=a);c--)this._sounds[c]._ended&&(this._webAudio&&this._sounds[c]._node&&this._sounds[c]._node.disconnect(0),this._sounds.splice(c,1),b--)}},_getSoundIds:function(a){if("undefined"==typeof a){a=[];for(var b=0;b<this._sounds.length;b++)a.push(this._sounds[b]._id);return a}return[a]},_refreshBuffer:function(b){return b._node.bufferSource=
a.ctx.createBufferSource(),b._node.bufferSource.buffer=f[this._src],b._panner?b._node.bufferSource.connect(b._panner):b._node.bufferSource.connect(b._node),b._node.bufferSource.loop=b._loop,b._loop&&(b._node.bufferSource.loopStart=b._start||0,b._node.bufferSource.loopEnd=b._stop),b._node.bufferSource.playbackRate.value=b._rate,this},_cleanBuffer:function(a){if(this._scratchBuffer){a.bufferSource.onended=null;a.bufferSource.disconnect(0);try{a.bufferSource.buffer=this._scratchBuffer}catch(r){}}return a.bufferSource=
null,this}};var e=function(a){this._parent=a;this.init()};e.prototype={init:function(){var a=this._parent;return this._muted=a._muted,this._loop=a._loop,this._volume=a._volume,this._muted=a._muted,this._rate=a._rate,this._seek=0,this._paused=!0,this._ended=!0,this._sprite="__default",this._id=Math.round(Date.now()*Math.random()),a._sounds.push(this),this.create(),this},create:function(){var b=this._parent,c=a._muted||this._muted||this._parent._muted?0:this._volume;return b._webAudio?(this._node="undefined"==
typeof a.ctx.createGain?a.ctx.createGainNode():a.ctx.createGain(),this._node.gain.setValueAtTime(c,a.ctx.currentTime),this._node.paused=!0,this._node.connect(a.masterGain)):(this._node=new Audio,this._errorFn=this._errorListener.bind(this),this._node.addEventListener("error",this._errorFn,!1),this._loadFn=this._loadListener.bind(this),this._node.addEventListener(a._canPlayEvent,this._loadFn,!1),this._node.src=b._src,this._node.preload="auto",this._node.volume=c*a.volume(),this._node.load()),this},
reset:function(){var a=this._parent;return this._muted=a._muted,this._loop=a._loop,this._volume=a._volume,this._muted=a._muted,this._rate=a._rate,this._seek=0,this._rateSeek=0,this._paused=!0,this._ended=!0,this._sprite="__default",this._id=Math.round(Date.now()*Math.random()),this},_errorListener:function(){this._parent._emit("loaderror",this._id,this._node.error?this._node.error.code:0);this._node.removeEventListener("error",this._errorListener,!1)},_loadListener:function(){var b=this._parent;b._duration=
Math.ceil(10*this._node.duration)/10;0===Object.keys(b._sprite).length&&(b._sprite={__default:[0,1E3*b._duration]});"loaded"!==b._state&&(b._state="loaded",b._emit("load"),b._loadQueue());this._node.removeEventListener(a._canPlayEvent,this._loadFn,!1)}};var f={},h=function(a){var b=a._src;if(f[b])return a._duration=f[b].duration,void x(a);if(/^data:[^;]+;base64,/.test(b)){for(var c=atob(b.split(",")[1]),e=new Uint8Array(c.length),h=0;h<c.length;++h)e[h]=c.charCodeAt(h);t(e.buffer,a)}else{var q=new XMLHttpRequest;
q.open("GET",b,!0);q.responseType="arraybuffer";q.onload=function(){var b=(q.status+"")[0];return"0"!==b&&"2"!==b&&"3"!==b?void a._emit("loaderror",null,"Failed loading audio file with status: "+q.status+"."):void t(q.response,a)};q.onerror=function(){a._webAudio&&(a._html5=!0,a._webAudio=!1,a._sounds=[],delete f[b],a.load())};l(q)}},l=function(a){try{a.send()}catch(r){a.onerror()}},t=function(b,c){a.ctx.decodeAudioData(b,function(a){a&&0<c._sounds.length&&(f[c._src]=a,x(c,a))},function(){c._emit("loaderror",
null,"Decoding audio data failed.")})},x=function(a,b){b&&!a._duration&&(a._duration=b.duration);0===Object.keys(a._sprite).length&&(a._sprite={__default:[0,1E3*a._duration]});"loaded"!==a._state&&(a._state="loaded",a._emit("load"),a._loadQueue())},q=function(){try{"undefined"!=typeof AudioContext?a.ctx=new AudioContext:"undefined"!=typeof webkitAudioContext?a.ctx=new webkitAudioContext:a.usingWebAudio=!1}catch(y){a.usingWebAudio=!1}var b=/iP(hone|od|ad)/.test(a._navigator&&a._navigator.platform),
c=a._navigator&&a._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),c=c?parseInt(c[1],10):null;b&&c&&9>c&&(b=/safari/.test(a._navigator&&a._navigator.userAgent.toLowerCase()),(a._navigator&&a._navigator.standalone&&!b||a._navigator&&!a._navigator.standalone&&!b)&&(a.usingWebAudio=!1));a.usingWebAudio&&(a.masterGain="undefined"==typeof a.ctx.createGain?a.ctx.createGainNode():a.ctx.createGain(),a.masterGain.gain.value=1,a.masterGain.connect(a.ctx.destination));a._setup()};"function"==typeof define&&
define.amd&&define([],function(){return{Howler:a,Howl:c}});"undefined"!=typeof exports&&(exports.Howler=a,exports.Howl=c);"undefined"!=typeof window?(window.HowlerGlobal=b,window.Howler=a,window.Howl=c,window.Sound=e):"undefined"!=typeof global&&(global.HowlerGlobal=b,global.Howler=a,global.Howl=c,global.Sound=e)}();
!function(){HowlerGlobal.prototype._pos=[0,0,0];HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0];HowlerGlobal.prototype.stereo=function(a){if(!this.ctx||!this.ctx.listener)return this;for(var b=this._howls.length-1;0<=b;b--)this._howls[b].stereo(a);return this};HowlerGlobal.prototype.pos=function(a,b,e){return this.ctx&&this.ctx.listener?(b="number"!=typeof b?this._pos[1]:b,e="number"!=typeof e?this._pos[2]:e,"number"!=typeof a?this._pos:(this._pos=[a,b,e],this.ctx.listener.setPosition(this._pos[0],
this._pos[1],this._pos[2]),this)):this};HowlerGlobal.prototype.orientation=function(a,b,e,f,h,l){if(!this.ctx||!this.ctx.listener)return this;var c=this._orientation;return b="number"!=typeof b?c[1]:b,e="number"!=typeof e?c[2]:e,f="number"!=typeof f?c[3]:f,h="number"!=typeof h?c[4]:h,l="number"!=typeof l?c[5]:l,"number"!=typeof a?c:(this._orientation=[a,b,e,f,h,l],this.ctx.listener.setOrientation(a,b,e,f,h,l),this)};Howl.prototype.init=function(a){return function(b){return this._orientation=b.orientation||
[1,0,0],this._stereo=b.stereo||null,this._pos=b.pos||null,this._pannerAttr={coneInnerAngle:"undefined"!=typeof b.coneInnerAngle?b.coneInnerAngle:360,coneOuterAngle:"undefined"!=typeof b.coneOuterAngle?b.coneOuterAngle:360,coneOuterGain:"undefined"!=typeof b.coneOuterGain?b.coneOuterGain:0,distanceModel:"undefined"!=typeof b.distanceModel?b.distanceModel:"inverse",maxDistance:"undefined"!=typeof b.maxDistance?b.maxDistance:1E4,panningModel:"undefined"!=typeof b.panningModel?b.panningModel:"HRTF",refDistance:"undefined"!=
typeof b.refDistance?b.refDistance:1,rolloffFactor:"undefined"!=typeof b.rolloffFactor?b.rolloffFactor:1},this._onstereo=b.onstereo?[{fn:b.onstereo}]:[],this._onpos=b.onpos?[{fn:b.onpos}]:[],this._onorientation=b.onorientation?[{fn:b.onorientation}]:[],a.call(this,b)}}(Howl.prototype.init);Howl.prototype.stereo=function(a,c){var e=this;if(!e._webAudio)return e;if("loaded"!==e._state)return e._queue.push({event:"stereo",action:function(){e.stereo(a,c)}}),e;var f="undefined"==typeof Howler.ctx.createStereoPanner?
"spatial":"stereo";if("undefined"==typeof c){if("number"!=typeof a)return e._stereo;e._stereo=a;e._pos=[a,0,0]}for(var h=e._getSoundIds(c),l=0;l<h.length;l++){var t=e._soundById(h[l]);if(t){if("number"!=typeof a)return t._stereo;t._stereo=a;t._pos=[a,0,0];t._node&&(t._pannerAttr.panningModel="equalpower",t._panner&&t._panner.pan||b(t,f),"spatial"===f?t._panner.setPosition(a,0,0):t._panner.pan.value=a);e._emit("stereo",t._id)}}return e};Howl.prototype.pos=function(a,c,e,f){var h=this;if(!h._webAudio)return h;
if("loaded"!==h._state)return h._queue.push({event:"pos",action:function(){h.pos(a,c,e,f)}}),h;if(c="number"!=typeof c?0:c,e="number"!=typeof e?-.5:e,"undefined"==typeof f){if("number"!=typeof a)return h._pos;h._pos=[a,c,e]}for(var l=h._getSoundIds(f),t=0;t<l.length;t++){var x=h._soundById(l[t]);if(x){if("number"!=typeof a)return x._pos;x._pos=[a,c,e];x._node&&(x._panner&&!x._panner.pan||b(x,"spatial"),x._panner.setPosition(a,c,e));h._emit("pos",x._id)}}return h};Howl.prototype.orientation=function(a,
c,e,f){var h=this;if(!h._webAudio)return h;if("loaded"!==h._state)return h._queue.push({event:"orientation",action:function(){h.orientation(a,c,e,f)}}),h;if(c="number"!=typeof c?h._orientation[1]:c,e="number"!=typeof e?h._orientation[2]:e,"undefined"==typeof f){if("number"!=typeof a)return h._orientation;h._orientation=[a,c,e]}for(var l=h._getSoundIds(f),t=0;t<l.length;t++){var x=h._soundById(l[t]);if(x){if("number"!=typeof a)return x._orientation;x._orientation=[a,c,e];x._node&&(x._panner||(x._pos||
(x._pos=h._pos||[0,0,-.5]),b(x,"spatial")),x._panner.setOrientation(a,c,e));h._emit("orientation",x._id)}}return h};Howl.prototype.pannerAttr=function(){var a,c,e,f=arguments;if(!this._webAudio)return this;if(0===f.length)return this._pannerAttr;if(1===f.length){if("object"!=typeof f[0])return e=this._soundById(parseInt(f[0],10)),e?e._pannerAttr:this._pannerAttr;a=f[0];"undefined"==typeof c&&(this._pannerAttr={coneInnerAngle:"undefined"!=typeof a.coneInnerAngle?a.coneInnerAngle:this._coneInnerAngle,
coneOuterAngle:"undefined"!=typeof a.coneOuterAngle?a.coneOuterAngle:this._coneOuterAngle,coneOuterGain:"undefined"!=typeof a.coneOuterGain?a.coneOuterGain:this._coneOuterGain,distanceModel:"undefined"!=typeof a.distanceModel?a.distanceModel:this._distanceModel,maxDistance:"undefined"!=typeof a.maxDistance?a.maxDistance:this._maxDistance,panningModel:"undefined"!=typeof a.panningModel?a.panningModel:this._panningModel,refDistance:"undefined"!=typeof a.refDistance?a.refDistance:this._refDistance,rolloffFactor:"undefined"!=
typeof a.rolloffFactor?a.rolloffFactor:this._rolloffFactor})}else 2===f.length&&(a=f[0],c=parseInt(f[1],10));c=this._getSoundIds(c);for(f=0;f<c.length;f++)if(e=this._soundById(c[f])){var h=e._pannerAttr,h={coneInnerAngle:"undefined"!=typeof a.coneInnerAngle?a.coneInnerAngle:h.coneInnerAngle,coneOuterAngle:"undefined"!=typeof a.coneOuterAngle?a.coneOuterAngle:h.coneOuterAngle,coneOuterGain:"undefined"!=typeof a.coneOuterGain?a.coneOuterGain:h.coneOuterGain,distanceModel:"undefined"!=typeof a.distanceModel?
a.distanceModel:h.distanceModel,maxDistance:"undefined"!=typeof a.maxDistance?a.maxDistance:h.maxDistance,panningModel:"undefined"!=typeof a.panningModel?a.panningModel:h.panningModel,refDistance:"undefined"!=typeof a.refDistance?a.refDistance:h.refDistance,rolloffFactor:"undefined"!=typeof a.rolloffFactor?a.rolloffFactor:h.rolloffFactor},l=e._panner;l?(l.coneInnerAngle=h.coneInnerAngle,l.coneOuterAngle=h.coneOuterAngle,l.coneOuterGain=h.coneOuterGain,l.distanceModel=h.distanceModel,l.maxDistance=
h.maxDistance,l.panningModel=h.panningModel,l.refDistance=h.refDistance,l.rolloffFactor=h.rolloffFactor):(e._pos||(e._pos=this._pos||[0,0,-.5]),b(e,"spatial"))}return this};Sound.prototype.init=function(a){return function(){var b=this._parent;this._orientation=b._orientation;this._stereo=b._stereo;this._pos=b._pos;this._pannerAttr=b._pannerAttr;a.call(this);this._stereo?b.stereo(this._stereo):this._pos&&b.pos(this._pos[0],this._pos[1],this._pos[2],this._id)}}(Sound.prototype.init);Sound.prototype.reset=
function(a){return function(){var b=this._parent;return this._orientation=b._orientation,this._pos=b._pos,this._pannerAttr=b._pannerAttr,a.call(this)}}(Sound.prototype.reset);var b=function(a,b){"spatial"===(b||"spatial")?(a._panner=Howler.ctx.createPanner(),a._panner.coneInnerAngle=a._pannerAttr.coneInnerAngle,a._panner.coneOuterAngle=a._pannerAttr.coneOuterAngle,a._panner.coneOuterGain=a._pannerAttr.coneOuterGain,a._panner.distanceModel=a._pannerAttr.distanceModel,a._panner.maxDistance=a._pannerAttr.maxDistance,
a._panner.panningModel=a._pannerAttr.panningModel,a._panner.refDistance=a._pannerAttr.refDistance,a._panner.rolloffFactor=a._pannerAttr.rolloffFactor,a._panner.setPosition(a._pos[0],a._pos[1],a._pos[2]),a._panner.setOrientation(a._orientation[0],a._orientation[1],a._orientation[2])):(a._panner=Howler.ctx.createStereoPanner(),a._panner.pan.value=a._stereo);a._panner.connect(a._node);a._paused||a._parent.pause(a._id,!0).play(a._id)}}();!function(b,a,c,e){function f(a,b,c){return setTimeout(q(a,c),b)}function h(a,b,c){return Array.isArray(a)?(l(a,c[b],c),!0):!1}function l(a,b,c){var f;if(a)if(a.forEach)a.forEach(b,c);else if(a.length!==e)for(f=0;f<a.length;)b.call(c,a[f],f,a),f++;else for(f in a)a.hasOwnProperty(f)&&b.call(c,a[f],f,a)}function t(a,c,e){var f="DEPRECATED METHOD: "+c+"\n"+e+" AT \n";return function(){var c=Error("get-stack-trace"),c=c&&c.stack?c.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,
"{anonymous}()@"):"Unknown Stack Trace",e=b.console&&(b.console.warn||b.console.log);return e&&e.call(b.console,f,c),a.apply(this,arguments)}}function x(a,b,c){var e=b.prototype;b=a.prototype=Object.create(e);b.constructor=a;b._super=e;c&&na(b,c)}function q(a,b){return function(){return a.apply(b,arguments)}}function m(a,b){return typeof a==$a?a.apply(b?b[0]||e:e,b):a}function r(a,b,c){l(z(b),function(b){a.addEventListener(b,c,!1)})}function y(a,b,c){l(z(b),function(b){a.removeEventListener(b,c,!1)})}
function B(a,b){for(;a;){if(a==b)return!0;a=a.parentNode}return!1}function z(a){return a.trim().split(/\s+/g)}function E(a,b,c){if(a.indexOf&&!c)return a.indexOf(b);for(var e=0;e<a.length;){if(c&&a[e][c]==b||!c&&a[e]===b)return e;e++}return-1}function G(a){return Array.prototype.slice.call(a,0)}function I(a,b,c){for(var e=[],f=[],h=0;h<a.length;){var q=b?a[h][b]:a[h];0>E(f,q)&&e.push(a[h]);f[h]=q;h++}return c&&(e=b?e.sort(function(a,c){return a[b]>c[b]}):e.sort()),e}function F(a,b){for(var c,f,h=
b[0].toUpperCase()+b.slice(1),q=0;q<gb.length;){if(c=gb[q],f=c?c+h:b,f in a)return f;q++}return e}function D(a){a=a.ownerDocument||a;return a.defaultView||a.parentWindow||b}function H(a,b){var c=this;this.manager=a;this.callback=b;this.element=a.element;this.target=a.options.inputTarget;this.domHandler=function(b){m(a.options.enable,[a])&&c.handler(b)};this.init()}function M(a){var b=a.options.inputClass;return new (b?b:Cb?ma:Db?fa:tb?ea:W)(a,N)}function N(a,b,c){var f,h,q=c.pointers.length;f=c.changedPointers.length;
var m=b&qa&&0===q-f,q=b&(ua|Da)&&0===q-f;c.isFirst=!!m;c.isFinal=!!q;m&&(a.session={});c.eventType=b;b=a.session;m=c.pointers;q=m.length;b.firstInput||(b.firstInput=L(c));1<q&&!b.firstMultiple?b.firstMultiple=L(c):1===q&&(b.firstMultiple=!1);f=b.firstInput;h=(q=b.firstMultiple)?q.center:f.center;var l=c.center=O(m);c.timeStamp=hb();c.deltaTime=c.timeStamp-f.timeStamp;c.angle=sa(h,l);c.distance=ka(h,l);f=c.center;h=b.offsetDelta||{};var l=b.prevDelta||{},r=b.prevInput||{};c.eventType!==qa&&r.eventType!==
ua||(l=b.prevDelta={x:r.deltaX||0,y:r.deltaY||0},h=b.offsetDelta={x:f.x,y:f.y});c.deltaX=l.x+(f.x-h.x);c.deltaY=l.y+(f.y-h.y);c.offsetDirection=S(c.deltaX,c.deltaY);h=c.deltaTime;f=c.deltaX/h||0;h=c.deltaY/h||0;c.overallVelocityX=f;c.overallVelocityY=h;c.overallVelocity=Ka(f)>Ka(h)?f:h;q?(f=q.pointers,f=ka(m[0],m[1],Ua)/ka(f[0],f[1],Ua)):f=1;c.scale=f;q?(q=q.pointers,m=sa(m[1],m[0],Ua)+sa(q[1],q[0],Ua)):m=0;c.rotation=m;c.maxPointers=b.prevInput?c.pointers.length>b.prevInput.maxPointers?c.pointers.length:
b.prevInput.maxPointers:c.pointers.length;h=b.lastInterval||c;m=c.timeStamp-h.timeStamp;c.eventType!=Da&&(m>Ta||h.velocity===e)?(f=c.deltaX-h.deltaX,h=c.deltaY-h.deltaY,l=f/m||0,r=h/m||0,m=l,q=r,l=Ka(l)>Ka(r)?l:r,f=S(f,h),b.lastInterval=c):(l=h.velocity,m=h.velocityX,q=h.velocityY,f=h.direction);c.velocity=l;c.velocityX=m;c.velocityY=q;c.direction=f;b=a.element;B(c.srcEvent.target,b)&&(b=c.srcEvent.target);c.target=b;a.emit("hammer.input",c);a.recognize(c);a.session.prevInput=c}function L(a){for(var b=
[],c=0;c<a.pointers.length;)b[c]={clientX:Sa(a.pointers[c].clientX),clientY:Sa(a.pointers[c].clientY)},c++;return{timeStamp:hb(),pointers:b,center:O(b),deltaX:a.deltaX,deltaY:a.deltaY}}function O(a){var b=a.length;if(1===b)return{x:Sa(a[0].clientX),y:Sa(a[0].clientY)};for(var c=0,e=0,f=0;b>f;)c+=a[f].clientX,e+=a[f].clientY,f++;return{x:Sa(c/b),y:Sa(e/b)}}function S(a,b){return a===b?ib:Ka(a)>=Ka(b)?0>a?Wa:ab:0>b?bb:cb}function ka(a,b,c){c||(c=La);var e=b[c[0]]-a[c[0]];a=b[c[1]]-a[c[1]];return Math.sqrt(e*
e+a*a)}function sa(a,b,c){c||(c=La);return 180*Math.atan2(b[c[1]]-a[c[1]],b[c[0]]-a[c[0]])/Math.PI}function W(){this.evEl=Ca;this.evWin=Eb;this.pressed=!1;H.apply(this,arguments)}function ma(){this.evEl=Na;this.evWin=wa;H.apply(this,arguments);this.store=this.manager.session.pointerEvents=[]}function pa(){this.evTarget=Ab;this.evWin=wb;this.started=!1;H.apply(this,arguments)}function fa(){this.evTarget=yb;this.targetIds={};H.apply(this,arguments)}function ba(a,b){var c=G(a.touches),e=this.targetIds;
if(b&(qa|Qa)&&1===c.length)return e[c[0].identifier]=!0,[c,c];var f,h=G(a.changedTouches),q=[],m=this.target;if(f=c.filter(function(a){return B(a.target,m)}),b===qa)for(c=0;c<f.length;)e[f[c].identifier]=!0,c++;for(c=0;c<h.length;)e[h[c].identifier]&&q.push(h[c]),b&(ua|Da)&&delete e[h[c].identifier],c++;return q.length?[I(f.concat(q),"identifier",!0),q]:void 0}function ea(){H.apply(this,arguments);var a=q(this.handler,this);this.touch=new fa(this.manager,a);this.mouse=new W(this.manager,a);this.primaryTouch=
null;this.lastTouches=[]}function J(a){a=a.changedPointers[0];if(a.identifier===this.primaryTouch){var b={x:a.clientX,y:a.clientY};this.lastTouches.push(b);var c=this.lastTouches;setTimeout(function(){var a=c.indexOf(b);-1<a&&c.splice(a,1)},zb)}}function R(a,b){this.manager=a;this.set(b)}function aa(a){if(-1<a.indexOf(Va))return Va;var b=-1<a.indexOf(Ya),c=-1<a.indexOf(eb);return b&&c?Va:b||c?b?Ya:eb:-1<a.indexOf(pb)?pb:db}function T(a){this.options=na({},this.defaults,a||{});this.id=w++;this.manager=
null;a=this.options.enable;this.options.enable=a===e?!0:a;this.state=mb;this.simultaneous={};this.requireFail=[]}function ta(a){return a&Ra?"cancel":a&Pa?"end":a&Xa?"move":a&Fa?"start":""}function Ba(a){return a==cb?"down":a==bb?"up":a==Wa?"left":a==ab?"right":""}function ha(a,b){var c=b.manager;return c?c.get(a):a}function ca(){T.apply(this,arguments)}function ja(){ca.apply(this,arguments);this.pY=this.pX=null}function ia(){ca.apply(this,arguments)}function U(){T.apply(this,arguments);this._input=
this._timer=null}function Ma(){ca.apply(this,arguments)}function Ga(){ca.apply(this,arguments)}function ya(){T.apply(this,arguments);this.pCenter=this.pTime=!1;this._input=this._timer=null;this.count=0}function za(a,b){b=b||{};var c=b.recognizers;return b.recognizers=c===e?za.defaults.preset:c,new V(a,b)}function V(a,b){this.options=na({},za.defaults,b||{});this.options.inputTarget=this.options.inputTarget||a;this.handlers={};this.session={};this.recognizers=[];this.oldCssProps={};this.element=a;
this.input=M(this);this.touchAction=new R(this,this.options.touchAction);fb(this,!0);l(this.options.recognizers,function(a){var b=this.add(new a[0](a[1]));a[2]&&b.recognizeWith(a[2]);a[3]&&b.requireFailure(a[3])},this)}function fb(a,b){var c=a.element;if(c.style){var e;l(a.options.cssProps,function(f,h){e=F(c.style,h);b?(a.oldCssProps[e]=c.style[e],c.style[e]=f):c.style[e]=a.oldCssProps[e]||""});b||(a.oldCssProps={})}}function Ja(b,c){var e=a.createEvent("Event");e.initEvent(b,!0,!0);e.gesture=c;
c.target.dispatchEvent(e)}var na,gb=" webkit Moz MS ms o".split(" "),Za=a.createElement("div"),$a="function",Sa=Math.round,Ka=Math.abs,hb=Date.now;na="function"!=typeof Object.assign?function(a){if(a===e||null===a)throw new TypeError("Cannot convert undefined or null to object");for(var b=Object(a),c=1;c<arguments.length;c++){var f=arguments[c];if(f!==e&&null!==f)for(var h in f)f.hasOwnProperty(h)&&(b[h]=f[h])}return b}:Object.assign;var ub=t(function(a,b,c){for(var f=Object.keys(b),h=0;h<f.length;)(!c||
c&&a[f[h]]===e)&&(a[f[h]]=b[f[h]]),h++;return a},"extend","Use `assign`."),oa=t(function(a,b){return ub(a,b,!0)},"merge","Use `assign`."),w=1,ob=/mobile|tablet|ip(ad|hone|od)|android/i,tb="ontouchstart"in b,Cb=F(b,"PointerEvent")!==e,Db=tb&&ob.test(navigator.userAgent),Ta=25,qa=1,Qa=2,ua=4,Da=8,ib=1,Wa=2,ab=4,bb=8,cb=16,va=Wa|ab,la=bb|cb,jb=va|la,La=["x","y"],Ua=["clientX","clientY"];H.prototype={handler:function(){},init:function(){this.evEl&&r(this.element,this.evEl,this.domHandler);this.evTarget&&
r(this.target,this.evTarget,this.domHandler);this.evWin&&r(D(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&y(this.element,this.evEl,this.domHandler);this.evTarget&&y(this.target,this.evTarget,this.domHandler);this.evWin&&y(D(this.element),this.evWin,this.domHandler)}};var Q={mousedown:qa,mousemove:Qa,mouseup:ua},Ca="mousedown",Eb="mousemove mouseup";x(W,H,{handler:function(a){var b=Q[a.type];b&qa&&0===a.button&&(this.pressed=!0);b&Qa&&1!==a.which&&(b=ua);this.pressed&&(b&
ua&&(this.pressed=!1),this.callback(this.manager,b,{pointers:[a],changedPointers:[a],pointerType:"mouse",srcEvent:a}))}});var Fb={pointerdown:qa,pointermove:Qa,pointerup:ua,pointercancel:Da,pointerout:Da},vb={2:"touch",3:"pen",4:"mouse",5:"kinect"},Na="pointerdown",wa="pointermove pointerup pointercancel";b.MSPointerEvent&&!b.PointerEvent&&(Na="MSPointerDown",wa="MSPointerMove MSPointerUp MSPointerCancel");x(ma,H,{handler:function(a){var b=this.store,c=!1,e=a.type.toLowerCase().replace("ms",""),e=
Fb[e],f=vb[a.pointerType]||a.pointerType,h="touch"==f,q=E(b,a.pointerId,"pointerId");e&qa&&(0===a.button||h)?0>q&&(b.push(a),q=b.length-1):e&(ua|Da)&&(c=!0);0>q||(b[q]=a,this.callback(this.manager,e,{pointers:b,changedPointers:[a],pointerType:f,srcEvent:a}),c&&b.splice(q,1))}});var Oa={touchstart:qa,touchmove:Qa,touchend:ua,touchcancel:Da},Ab="touchstart",wb="touchstart touchmove touchend touchcancel";x(pa,H,{handler:function(a){var b=Oa[a.type];if(b===qa&&(this.started=!0),this.started){var c,e=
G(a.touches);c=G(a.changedTouches);c=(b&(ua|Da)&&(e=I(e.concat(c),"identifier",!0)),[e,c]);b&(ua|Da)&&0===c[0].length-c[1].length&&(this.started=!1);this.callback(this.manager,b,{pointers:c[0],changedPointers:c[1],pointerType:"touch",srcEvent:a})}}});var Bb={touchstart:qa,touchmove:Qa,touchend:ua,touchcancel:Da},yb="touchstart touchmove touchend touchcancel";x(fa,H,{handler:function(a){var b=Bb[a.type],c=ba.call(this,a,b);c&&this.callback(this.manager,b,{pointers:c[0],changedPointers:c[1],pointerType:"touch",
srcEvent:a})}});var zb=2500;x(ea,H,{handler:function(a,b,c){var e="touch"==c.pointerType,f="mouse"==c.pointerType;if(!(f&&c.sourceCapabilities&&c.sourceCapabilities.firesTouchEvents)){if(e)b&qa?(this.primaryTouch=c.changedPointers[0].identifier,J.call(this,c)):b&(ua|Da)&&J.call(this,c);else{if(e=f)a:{for(var e=c.srcEvent.clientX,f=c.srcEvent.clientY,h=0;h<this.lastTouches.length;h++){var q=this.lastTouches[h],m=Math.abs(f-q.y);if(25>=Math.abs(e-q.x)&&25>=m){e=!0;break a}}e=!1}if(e)return}this.callback(a,
b,c)}},destroy:function(){this.touch.destroy();this.mouse.destroy()}});var xa=F(Za.style,"touchAction"),xb=xa!==e,db="auto",pb="manipulation",Va="none",Ya="pan-x",eb="pan-y",nb=function(){if(!xb)return!1;var a={},c=b.CSS&&b.CSS.supports;return"auto;manipulation;pan-y;pan-x;pan-x pan-y;none".split(";").forEach(function(e){a[e]=c?b.CSS.supports("touch-action",e):!0}),a}();R.prototype={set:function(a){"compute"==a&&(a=this.compute());xb&&this.manager.element.style&&nb[a]&&(this.manager.element.style[xa]=
a);this.actions=a.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var a=[];return l(this.manager.recognizers,function(b){m(b.options.enable,[b])&&(a=a.concat(b.getTouchAction()))}),aa(a.join(" "))},preventDefaults:function(a){var b=a.srcEvent,c=a.offsetDirection;if(this.manager.session.prevented)return void b.preventDefault();var e=this.actions,f=-1<e.indexOf(Va)&&!nb[Va],h=-1<e.indexOf(eb)&&!nb[eb],e=-1<e.indexOf(Ya)&&!nb[Ya];if(f){var q=2>a.distance,
m=250>a.deltaTime;if(1===a.pointers.length&&q&&m)return}return e&&h?void 0:f||h&&c&va||e&&c&la?this.preventSrc(b):void 0},preventSrc:function(a){this.manager.session.prevented=!0;a.preventDefault()}};var mb=1,Fa=2,Xa=4,Pa=8,Ha=Pa,Ra=16;T.prototype={defaults:{},set:function(a){return na(this.options,a),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(a){if(h(a,"recognizeWith",this))return this;var b=this.simultaneous;return a=ha(a,this),b[a.id]||(b[a.id]=a,a.recognizeWith(this)),
this},dropRecognizeWith:function(a){return h(a,"dropRecognizeWith",this)?this:(a=ha(a,this),delete this.simultaneous[a.id],this)},requireFailure:function(a){if(h(a,"requireFailure",this))return this;var b=this.requireFail;return a=ha(a,this),-1===E(b,a)&&(b.push(a),a.requireFailure(this)),this},dropRequireFailure:function(a){if(h(a,"dropRequireFailure",this))return this;a=ha(a,this);a=E(this.requireFail,a);return-1<a&&this.requireFail.splice(a,1),this},hasRequireFailures:function(){return 0<this.requireFail.length},
canRecognizeWith:function(a){return!!this.simultaneous[a.id]},emit:function(a){function b(b){c.manager.emit(b,a)}var c=this,e=this.state;Pa>e&&b(c.options.event+ta(e));b(c.options.event);a.additionalEvent&&b(a.additionalEvent);e>=Pa&&b(c.options.event+ta(e))},tryEmit:function(a){return this.canEmit()?this.emit(a):void(this.state=32)},canEmit:function(){for(var a=0;a<this.requireFail.length;){if(!(this.requireFail[a].state&(32|mb)))return!1;a++}return!0},recognize:function(a){a=na({},a);return m(this.options.enable,
[this,a])?(this.state&(Ha|Ra|32)&&(this.state=mb),this.state=this.process(a),void(this.state&(Fa|Xa|Pa|Ra)&&this.tryEmit(a))):(this.reset(),void(this.state=32))},process:function(a){},getTouchAction:function(){},reset:function(){}};x(ca,T,{defaults:{pointers:1},attrTest:function(a){var b=this.options.pointers;return 0===b||a.pointers.length===b},process:function(a){var b=this.state,c=a.eventType,e=b&(Fa|Xa);a=this.attrTest(a);return e&&(c&Da||!a)?b|Ra:e||a?c&ua?b|Pa:b&Fa?b|Xa:Fa:32}});x(ja,ca,{defaults:{event:"pan",
threshold:10,pointers:1,direction:jb},getTouchAction:function(){var a=this.options.direction,b=[];return a&va&&b.push(eb),a&la&&b.push(Ya),b},directionTest:function(a){var b=this.options,c=!0,e=a.distance,f=a.direction,h=a.deltaX,q=a.deltaY;return f&b.direction||(b.direction&va?(f=0===h?ib:0>h?Wa:ab,c=h!=this.pX,e=Math.abs(a.deltaX)):(f=0===q?ib:0>q?bb:cb,c=q!=this.pY,e=Math.abs(a.deltaY))),a.direction=f,c&&e>b.threshold&&f&b.direction},attrTest:function(a){return ca.prototype.attrTest.call(this,
a)&&(this.state&Fa||!(this.state&Fa)&&this.directionTest(a))},emit:function(a){this.pX=a.deltaX;this.pY=a.deltaY;var b=Ba(a.direction);b&&(a.additionalEvent=this.options.event+b);this._super.emit.call(this,a)}});x(ia,ca,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Va]},attrTest:function(a){return this._super.attrTest.call(this,a)&&(Math.abs(a.scale-1)>this.options.threshold||this.state&Fa)},emit:function(a){1!==a.scale&&(a.additionalEvent=this.options.event+(1>
a.scale?"in":"out"));this._super.emit.call(this,a)}});x(U,T,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[db]},process:function(a){var b=this.options,c=a.pointers.length===b.pointers,e=a.distance<b.threshold,h=a.deltaTime>b.time;if(this._input=a,!e||!c||a.eventType&(ua|Da)&&!h)this.reset();else if(a.eventType&qa)this.reset(),this._timer=f(function(){this.state=Ha;this.tryEmit()},b.time,this);else if(a.eventType&ua)return Ha;return 32},reset:function(){clearTimeout(this._timer)},
emit:function(a){this.state===Ha&&(a&&a.eventType&ua?this.manager.emit(this.options.event+"up",a):(this._input.timeStamp=hb(),this.manager.emit(this.options.event,this._input)))}});x(Ma,ca,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Va]},attrTest:function(a){return this._super.attrTest.call(this,a)&&(Math.abs(a.rotation)>this.options.threshold||this.state&Fa)}});x(Ga,ca,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:va|la,pointers:1},getTouchAction:function(){return ja.prototype.getTouchAction.call(this)},
attrTest:function(a){var b,c=this.options.direction;return c&(va|la)?b=a.overallVelocity:c&va?b=a.overallVelocityX:c&la&&(b=a.overallVelocityY),this._super.attrTest.call(this,a)&&c&a.offsetDirection&&a.distance>this.options.threshold&&a.maxPointers==this.options.pointers&&Ka(b)>this.options.velocity&&a.eventType&ua},emit:function(a){var b=Ba(a.offsetDirection);b&&this.manager.emit(this.options.event+b,a);this.manager.emit(this.options.event,a)}});x(ya,T,{defaults:{event:"tap",pointers:1,taps:1,interval:300,
time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[pb]},process:function(a){var b=this.options,c=a.pointers.length===b.pointers,e=a.distance<b.threshold,h=a.deltaTime<b.time;if(this.reset(),a.eventType&qa&&0===this.count)return this.failTimeout();if(e&&h&&c){if(a.eventType!=ua)return this.failTimeout();c=this.pTime?a.timeStamp-this.pTime<b.interval:!0;e=!this.pCenter||ka(this.pCenter,a.center)<b.posThreshold;this.pTime=a.timeStamp;this.pCenter=a.center;e&&c?this.count+=1:this.count=
1;this._input=a;if(0===this.count%b.taps)return this.hasRequireFailures()?(this._timer=f(function(){this.state=Ha;this.tryEmit()},b.interval,this),Fa):Ha}return 32},failTimeout:function(){return this._timer=f(function(){this.state=32},this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Ha&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});za.VERSION="2.0.8";za.defaults={domEvents:!1,touchAction:"compute",enable:!0,
inputTarget:null,inputClass:null,preset:[[Ma,{enable:!1}],[ia,{enable:!1},["rotate"]],[Ga,{direction:va}],[ja,{direction:va},["swipe"]],[ya],[ya,{event:"doubletap",taps:2},["tap"]],[U]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};V.prototype={set:function(a){return na(this.options,a),a.touchAction&&this.touchAction.update(),a.inputTarget&&(this.input.destroy(),this.input.target=a.inputTarget,this.input.init()),
this},stop:function(a){this.session.stopped=a?2:1},recognize:function(a){var b=this.session;if(!b.stopped){this.touchAction.preventDefaults(a);var c,e=this.recognizers,f=b.curRecognizer;(!f||f&&f.state&Ha)&&(f=b.curRecognizer=null);for(var h=0;h<e.length;)c=e[h],2===b.stopped||f&&c!=f&&!c.canRecognizeWith(f)?c.reset():c.recognize(a),!f&&c.state&(Fa|Xa|Pa)&&(f=b.curRecognizer=c),h++}},get:function(a){if(a instanceof T)return a;for(var b=this.recognizers,c=0;c<b.length;c++)if(b[c].options.event==a)return b[c];
return null},add:function(a){if(h(a,"add",this))return this;var b=this.get(a.options.event);return b&&this.remove(b),this.recognizers.push(a),a.manager=this,this.touchAction.update(),a},remove:function(a){if(h(a,"remove",this))return this;if(a=this.get(a)){var b=this.recognizers;a=E(b,a);-1!==a&&(b.splice(a,1),this.touchAction.update())}return this},on:function(a,b){if(a!==e&&b!==e){var c=this.handlers;return l(z(a),function(a){c[a]=c[a]||[];c[a].push(b)}),this}},off:function(a,b){if(a!==e){var c=
this.handlers;return l(z(a),function(a){b?c[a]&&c[a].splice(E(c[a],b),1):delete c[a]}),this}},emit:function(a,b){this.options.domEvents&&Ja(a,b);var c=this.handlers[a]&&this.handlers[a].slice();if(c&&c.length){b.type=a;b.preventDefault=function(){b.srcEvent.preventDefault()};for(var e=0;e<c.length;)c[e](b),e++}},destroy:function(){this.element&&fb(this,!1);this.handlers={};this.session={};this.input.destroy();this.element=null}};na(za,{INPUT_START:qa,INPUT_MOVE:Qa,INPUT_END:ua,INPUT_CANCEL:Da,STATE_POSSIBLE:mb,
STATE_BEGAN:Fa,STATE_CHANGED:Xa,STATE_ENDED:Pa,STATE_RECOGNIZED:Ha,STATE_CANCELLED:Ra,STATE_FAILED:32,DIRECTION_NONE:ib,DIRECTION_LEFT:Wa,DIRECTION_RIGHT:ab,DIRECTION_UP:bb,DIRECTION_DOWN:cb,DIRECTION_HORIZONTAL:va,DIRECTION_VERTICAL:la,DIRECTION_ALL:jb,Manager:V,Input:H,TouchAction:R,TouchInput:fa,MouseInput:W,PointerEventInput:ma,TouchMouseInput:ea,SingleTouchInput:pa,Recognizer:T,AttrRecognizer:ca,Tap:ya,Pan:ja,Swipe:Ga,Pinch:ia,Rotate:Ma,Press:U,on:r,off:y,each:l,merge:oa,extend:ub,assign:na,
inherit:x,bindFn:q,prefixed:F});("undefined"!=typeof b?b:"undefined"!=typeof self?self:{}).Hammer=za;"function"==typeof define&&define.amd?define(function(){return za}):"undefined"!=typeof module&&module.exports?module.exports=za:b[c]=za}(window,document,"Hammer");!function(b,a){"object"==typeof exports&&"object"==typeof module?module.exports=a():"function"==typeof define&&define.amd?define("sheetrock",[],a):"object"==typeof exports?exports.sheetrock=a():b.sheetrock=a()}(this,function(){return function(b){function a(e){if(c[e])return c[e].exports;var f=c[e]={exports:{},id:e,loaded:!1};return b[e].call(f.exports,f,f.exports,a),f.loaded=!0,f.exports}var c={};return a.m=b,a.c=c,a.p="",a(0)}([function(b,a,c){function e(a){return a&&a.__esModule?a:{"default":a}}
function f(){function a(a){if(a&&"SheetrockError"===a.name&&f&&f.update&&f.update({failed:!0}),b.callback)return void b.callback(a,e,l);if(a)throw a;}var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,e=null,f=null,l=null;try{e=new t["default"](h({target:this},b),!!c),f=new x["default"](e),l=new q["default"](f)}catch(I){a(I)}return c?l.loadData(c,a):e&&f&&l&&(0,m["default"])(l,a),this}Object.defineProperty(a,"__esModule",{value:!0});
var h=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b],e;for(e in c)Object.prototype.hasOwnProperty.call(c,e)&&(a[e]=c[e])}return a},l=c(1),t=e(l),l=c(5),x=e(l),l=c(6),q=e(l),l=c(2);c=c(8);var m=e(c);h(f,{defaults:l.defaults,version:"1.1.4"});try{window.jQuery.fn.sheetrock=f}catch(r){}a["default"]=f;b.exports=a["default"]},function(b,a,c){function e(a){var b={};return Object.keys(a).forEach(function(c){({}).hasOwnProperty.call(l.legacyOptions,c)?b[l.legacyOptions[c]]=
a[c]:b[c]=a[c]}),b}function f(a,b){if(b)return{data:b};var c=null;if(Object.keys(l.sheetTypes).forEach(function(b){b=l.sheetTypes[b];b.keyFormat.test(a.url)&&b.gidFormat.test(a.url)&&(c=b)}),c){var e=a.url.match(c.keyFormat)[1];return{key:e,gid:a.url.match(c.gidFormat)[1],apiEndpoint:c.apiEndpoint.replace("%key%",e)}}throw new x["default"]("No key/gid in the provided URL.");}Object.defineProperty(a,"__esModule",{value:!0});var h=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=
arguments[b],e;for(e in c)Object.prototype.hasOwnProperty.call(c,e)&&(a[e]=c[e])}return a},l=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}(c(2)),t=c(3),x=(c=c(4))&&c.__esModule?c:{"default":c};a["default"]=function m(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},b=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(!(this instanceof m))throw new TypeError("Cannot call a class as a function");
var a=e(a),c={};if(c.target=(0,t.extractElement)(a.target),c.fetchSize=Math.max(0,parseInt(a.fetchSize,10)||0),!c.target&&!a.callback&&!l.defaults.callback)throw new x["default"]("No element targeted or callback provided.");this.user=h({},l.defaults,a,c);this.request=f(this.user,b);this.requestIndex=this.request.key+"_"+this.request.gid+"_"+this.user.query};b.exports=a["default"]},function(b,a){Object.defineProperty(a,"__esModule",{value:!0});a.defaults={url:"",query:"",target:null,fetchSize:0,labels:[],
rowTemplate:null,callback:null,reset:!1};a.legacyOptions={sql:"query",resetStatus:"reset",chunkSize:"fetchSize",rowHandler:"rowTemplate"};a.sheetTypes={2014:{apiEndpoint:"https://docs.google.com/spreadsheets/d/%key%/gviz/tq?",keyFormat:/spreadsheets\/d\/([^/#]+)/i,gidFormat:/gid=([^/&#]+)/i},2010:{apiEndpoint:"https://spreadsheets.google.com/tq?key=%key%&",keyFormat:/key=([^&#]+)/i,gidFormat:/gid=([^/&#]+)/i}}},function(b,a){function c(a,b){return"<"+b+">"+a+"</"+b+">"}Object.defineProperty(a,"__esModule",
{value:!0});var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};a.append=function(a,b){a&&a.insertAdjacentHTML&&a.insertAdjacentHTML("beforeEnd",b)};a.extractElement=function(a){return"object"===("undefined"==typeof a?"undefined":e(a))&&a.jquery&&a.length&&(a=a[0]),a&&a.nodeType&&1===a.nodeType?a:null};a.getCellValue=function(a){a=a?a.f||a.v||
a:"";return a instanceof Array&&(a=a.join("")),"object"===("undefined"==typeof a?"undefined":e(a))?"":(""+a).replace(/^\s+|\s+$/,"")};a.hasClass=function(a,b){return-1!==(" "+a.className+" ").indexOf(" "+b+" ")};a.isTable=function(a){return a&&"TABLE"===a.tagName};a.toHTML=function(a){var b=a.num?"td":"th",e="";return Object.keys(a.cells).forEach(function(f){e+=c(a.cells[f],b)}),c(e,"tr")};a.wrapTag=c},function(b,a){function c(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+
typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(a,"__esModule",{value:!0});var e=function(a){function b(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");var e;e=(b.__proto__||Object.getPrototypeOf(b)).call(this);
if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");e=!e||"object"!=typeof e&&"function"!=typeof e?this:e;return e.name="SheetrockError",e.code=c,e.message=a,e}return c(b,a),b}(Error);a["default"]=e;b.exports=a["default"]},function(b,a,c){Object.defineProperty(a,"__esModule",{value:!0});var e=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b],e;for(e in c)Object.prototype.hasOwnProperty.call(c,e)&&(a[e]=c[e])}return a},f=function(){function a(a,
b){for(var c=0;c<b.length;c++){var e=b[c];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(b,c,e){return c&&a(b.prototype,c),e&&a(b,e),b}}(),h=(c=c(4))&&c.__esModule?c:{"default":c},l={failed:!1,header:0,labels:null,loaded:!1,offset:0},t={};c=function(){function a(b){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");if(this.options=b,this.index=b.requestIndex,this.state.failed)throw new h["default"]("A previous request for this resource failed.");
if(this.state.loaded)throw new h["default"]("No more rows to load!");}return f(a,[{key:"update",value:function(){t[this.index]=e(this.state,0<arguments.length&&void 0!==arguments[0]?arguments[0]:{})}},{key:"state",get:function(){var a={}.hasOwnProperty.call(t,this.index),b=this.options.user.reset||this.options.request.data;if(!a||b)t[this.index]=e({},l,{labels:a?t[this.index].labels:null});return t[this.index]}},{key:"url",get:function(){var a=this.options.user.fetchSize,a=a?" limit "+(a+1)+" offset "+
this.state.offset:"",a=["gid="+encodeURIComponent(this.options.request.gid),"tq="+encodeURIComponent(this.options.user.query+a)];return this.options.request.apiEndpoint+a.join("&")}}]),a}();a["default"]=c;b.exports=a["default"]},function(b,a,c){Object.defineProperty(a,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var e=b[c];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(b,c,e){return c&&
a(b.prototype,c),e&&a(b,e),b}}(),f=c(7),h=f&&f.__esModule?f:{"default":f},l=(f=c(4))&&f.__esModule?f:{"default":f},t=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}(c(3));c=function(){function a(b){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");this.request=b;this.options=b.options}return e(a,[{key:"setAttributes",value:function(){var a=this.options.user.fetchSize,
b=this.raw.table.rows,c=this.raw.table.cols,e={last:b.length-1,rowNumberOffset:this.request.state.header||0},f=this.request.state.labels;this.request.state.offset||(f=c.map(function(a,c){return a.label?a.label.replace(/\s/g,""):(e.last+=1,e.rowNumberOffset=1,t.getCellValue(b[0].c[c])||a.id)}),this.request.update({header:e.rowNumberOffset,labels:f,offset:this.request.state.offset+e.rowNumberOffset}));(!a||b.length-e.rowNumberOffset<a)&&(e.last+=1,this.request.update({loaded:!0}));a=this.options.user.labels;
e.labels=a&&a.length===f.length?a:f;this.attributes=e}},{key:"setOutput",value:function(){var a=this;this.rows=[];this.request.state.offset||this.attributes.rowNumberOffset||this.rows.push(new h["default"](0,this.attributes.labels,this.attributes.labels));this.raw.table.rows.forEach(function(b,c){b.c&&c<a.attributes.last&&a.rows.push(new h["default"](a.request.state.offset+c+1-a.attributes.rowNumberOffset,b.c,a.attributes.labels))});this.request.update({offset:this.request.state.offset+this.options.user.fetchSize})}},
{key:"setHTML",value:function(){var a=this.options.user.target,b=this.options.user.rowTemplate||t.toHTML,c=t.isTable(a),e=a&&t.hasClass(a,"sheetrock-header"),f="",h="";this.rows.forEach(function(a){a.num?h+=b(a):(c||e)&&(f+=b(a))});c&&(f=t.wrapTag(f,"thead"),h=t.wrapTag(h,"tbody"));t.append(a,f+h);this.html=f+h}},{key:"loadData",value:function(a,b){this.raw=a;try{this.setAttributes(),this.setOutput()}catch(r){return void b(new l["default"]("Unexpected API response format."))}this.setHTML();b(null)}}]),
a}();a["default"]=c;b.exports=a["default"]},function(b,a,c){Object.defineProperty(a,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var e=b[c];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(b,c,e){return c&&a(b.prototype,c),e&&a(b,e),b}}(),f=c(3);c=function(){function a(b,c,e){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");this.num=b;this.cellsArray=
c.map(f.getCellValue);this.labels=e}return e(a,[{key:"cells",get:function(){var a=this,b={};return this.labels.forEach(function(c,e){b[c]=a.cellsArray[e]}),b}}]),a}();a["default"]=c;b.exports=a["default"]},function(b,a,c){Object.defineProperty(a,"__esModule",{value:!0});var e=(c=c(4))&&c.__esModule?c:{"default":c},f=window.document.getElementsByTagName("head")[0],h=0;a["default"]=function(a,b){function c(){f.removeChild(q);delete window[m];b(new e["default"]("Request failed."))}var q=window.document.createElement("script"),
m="_sheetrock_callback_"+h;h+=1;window[m]=function(c){f.removeChild(q);delete window[m];a.loadData(c,b)};q.addEventListener&&(q.addEventListener("error",c,!1),q.addEventListener("abort",c,!1));q.type="text/javascript";q.src=a.request.url+"&tqx=responseHandler:"+m;f.appendChild(q)};b.exports=a["default"]}])});var ROCKIMG="png/asteroid3.jpeg",DEBRISIMG="png/debris.png",OBSTACLES=[],PX=[300,500,300,500,300,500],PY=[250,250,400,400,550,550],id=0,MAXROCKS=20,MOVING_ASTER=!1,ROCKS="m 104,7.69 c 23.68645,6.788715 36.31832,32.149873 60.26972,38.343289 22.5828,-0.437523 44.66378,16.533927 47.0145,39.571574 1.7824,16.350067 17.58775,28.375637 19.42957,45.557037 4.62232,16.14295 -3.063,34.92477 -18.79084,41.60093 -19.22063,12.27219 -23.97348,36.29633 -26.3595,57.32031 -11.7719,24.5963 -39.77913,35.95058 -65.41883,39.06789 -22.440402,-6.18345 -41.283826,10.88352 -61.241176,17.63584 -16.76045,5.45152 -33.113233,-7.47894 -38.530882,-22.80759 C 17.176622,247.87625 8.1464261,234.3236 4.0567839,218.40819 -1.7438181,195.92883 0.63774097,172.45364 4.606828,149.91669 6.1331829,124.03728 -5.926177,97.8685 3.3319943,72.406886 13.558278,40.415571 42.544211,19.463551 70.611984,3.7855478 81.374827,-1.0770344 94.740584,0.18536967 104,7.69 Z;m 74,7.61 c 7.753759,10.858255 23.659647,10.35574 34.20385,4.142701 9.03128,-4.0534436 19.21494,-1.9401962 28.52161,-5.0910648 10.92015,-2.154159 21.76622,-6.83507944 32.99101,-6.11838415 11.23296,2.00017155 13.66436,15.68926995 8.03436,24.21865495 -4.25358,10.809597 -16.56604,13.981888 -22.0997,23.735597 -7.53509,10.764739 -16.34633,24.503225 -31.127,24.468428 C 106.27572,72.548533 92.950913,91.727866 74.194294,88.144844 53.667818,82.293086 47.847944,55.910483 26.797923,50.69776 17.185894,50.719378 7.3060035,46.218346 3.1175923,37.113415 -2.8694247,26.930094 1.5394187,12.37286 13.030969,8.3968377 31.259956,1.4461437 53.349301,-4.6053888 71.463354,5.9051033 L 72.744026,6.7252875 74,7.61 Z;m 138.53,10.01 c 5.40626,19.802152 28.87853,18.911256 43.83272,26.459905 11.82989,11.386765 31.17305,17.630966 36.42803,33.950779 2.76543,19.624152 -17.99639,27.262955 -31.52942,35.447526 -20.56062,12.50938 -15.67798,41.22927 -31.85977,56.80308 -24.38514,18.96463 -57.192913,8.68832 -83.266997,-0.73605 C 52.576398,152.8614 28.041486,160.65945 11.190678,145.71557 -10.095375,129.9042 5.6556381,104.78632 23.486247,94.500663 41.288608,78.919071 45.241114,53.068768 63.439939,37.518779 81.853911,28.422426 88.100324,1.9971094 110.1991,-0.04794856 120.29646,0.14465668 131.88206,1.3566358 138.53,10.01 Z;m 72,0.6 c 14.992071,11.950867 27.356734,30.835777 49.0539,29.052927 22.54799,4.831198 11.23093,26.179505 10.66804,40.712681 1.29041,14.474071 22.7749,29.284722 9.00205,42.809722 -13.17549,7.38011 -25.84477,-13.04589 -39.91957,-2.56419 -15.021143,8.78534 -32.001234,23.92033 -50.515361,15.66927 C 35.997216,113.15938 16.127851,106.79857 2.1855691,94.383884 -1.9388697,76.898501 4.7466217,58.441952 0.18438048,40.73882 5.806309,19.339462 29.633649,12.251672 47.490222,3.9936009 55.293323,1.1777068 63.69706,-0.47426763 72,0.6 Z;m 92,3.55 c 13.35095,8.210786 30.00977,12.329972 45.29538,7.505902 14.45246,-1.6753573 32.50637,7.379137 33.3896,23.277674 -1.16698,9.619667 0.66069,19.077557 3.44222,28.233278 2.93882,9.916384 -2.53869,19.612559 -10.66892,25.090369 -8.67744,6.76962 -19.58996,11.562362 -25.09186,21.625407 C 122.19669,126.15279 96.416289,137.714 73.363004,129.22379 55.525476,120.88068 36.083637,114.55994 21.716964,100.47179 9.4202131,92.882312 -3.2620408,80.742356 -0.20756142,64.830795 2.5853742,21.920143 51.014336,-12.142371 92,3.55 Z;m 88,2.74 c 14.89109,15.864469 2.110781,42.020731 18.2397,57.227029 14.57912,9.438869 32.69928,18.10007 37.81781,36.219188 2.33267,12.551883 -4.98332,24.138463 -6.42804,36.406793 -5.71592,28.56302 -10.66403,58.58523 -28.18426,82.73461 C 98.325691,232.46357 84.01503,250.5467 63.256996,255.54156 49.213713,255.38464 40.958093,241.00245 40.126977,228.3937 37.959362,214.06608 35.463141,199.2234 26.80698,187.16906 15.184733,168.07566 -0.3727357,148.86285 0.4410242,125.2403 -0.82700464,113.95211 0.519549,101.14315 10.224845,93.729596 20.701913,83.99428 34.545443,79.406559 46.583369,72.066911 53.792512,51.74081 50.415478,26.382572 67.670781,10.611651 73.195023,5.947624 80.084933,-1.5559468 88,2.74 Z;m 70,4.85 c 42.89941,11.006942 88.6401,43.28005 90.08216,91.521071 4.22874,32.066519 -25.2289,52.095309 -32.77045,79.371239 3.64366,27.24689 -21.21346,30.54811 -41.778085,30.6541 -21.372431,4.1684 -46.503427,26.35806 -65.567673,4.77976 C 3.3962995,181.86073 43.409531,166.1283 54.968858,144.61803 66.594281,121.17951 24.886107,110.63839 36.541486,85.749591 36.788718,57.106427 1.9022922,43.643872 0.13121547,16.51475 11.628065,-9.165748 48.972608,0.09541228 70,4.85 Z;m 96,7.07 c 22.21936,-1.2748503 43.42137,10.625131 53.9089,30.272432 8.69197,19.332889 29.14037,36.901754 25.83445,59.413289 -7.95029,18.940209 -35.1644,24.545899 -28.70496,50.351999 -1.28406,21.10408 -27.33498,25.04775 -44.12503,26.41517 C 70.449544,167.8654 53.977736,135.08707 36.549008,110.65576 24.184423,92.2867 -4.119229,80.15006 -0.04494536,54.336438 2.2215288,30.459903 28.930966,27.401092 43.204026,13.183848 57.854593,-1.7401486 77.888088,-2.5989637 96,7.07 Z;m 22.83,10.14 c 36.381764,-7.5182231 75.332367,38.705706 106.91598,1.085856 31.19487,-26.154371 64.93771,4.569675 55.83452,40.417752 1.71024,59.468512 22.98507,123.885752 -7.35227,179.631272 -25.41621,20.31663 -58.99436,-0.0606 -86.820718,-3.84368 C 51.742324,218.90308 20.026502,183.63753 28.77643,141.9493 30.362924,107.69434 -3.8628827,84.245955 1.6335787,49.436507 3.2882936,34.68249 8.8431709,17.52641 22.83,10.14 Z;m 73.35,7.1 c 0.742924,12.833017 9.807449,30.172841 25.048008,26.528143 12.599832,-3.585974 26.310422,0.221493 34.295202,10.888176 7.73658,9.139649 12.54536,20.89596 23.4449,27.005137 11.57532,7.821056 24.58954,16.721939 27.19873,31.558114 5.2342,14.71903 7.51038,37.09103 -9.77698,44.67607 -13.80015,7.13307 -29.14257,-1.25293 -43.31614,3.72193 -15.15132,5.75741 -29.03507,-4.44612 -42.634543,-9.54349 -12.876028,-7.03738 -23.708035,3.30735 -33.940389,9.99189 -10.952691,7.628 -28.068654,3.85643 -32.543364,-9.34957 C 17.241811,131.38836 19.162764,117.59989 9.6636371,108.86755 0.15964236,94.112038 1.7097107,75.919244 1.8103437,59.24479 -0.3116275,44.692966 -3.0568617,24.567133 12.428846,16.257076 26.141799,8.6801814 39.824977,-3.1474859 56.644493,-0.08206564 62.578526,1.0293171 69.0122,2.5858262 73.35,7.1 Z;m 102,0.21 c 23.61326,-4.7742217 51.16121,11.73593 53.54307,36.69987 21.13119,18.005513 53.25206,4.662235 74.55944,23.311004 22.65735,16.804037 21.00815,47.485046 21.62736,72.671856 0.43306,30.01726 26.25312,58.22 12.89012,88.29914 -18.75656,25.83353 -53.60122,25.96862 -81.62681,34.04374 C 135.5408,265.27781 81.577228,270.66209 38.232192,244.33067 6.9293937,226.26954 -10.189513,184.12625 6.784637,150.71849 17.122164,118.96541 34.809642,84.588051 21.694586,50.963708 14.927939,28.153412 35.951375,8.3332141 57.118388,5.0589238 71.860142,2.3204637 86.957794,-0.28888751 102,0.21 Z;m 89.32,24.66 c 7.9625,5.588282 18.11069,11.432752 19.47608,22.040464 0.0713,11.380458 -5.26314,22.564982 -12.989602,30.768455 -7.782536,8.131695 -21.20007,14.120957 -31.758821,7.709676 C 57.730916,81.320978 51.834067,76.247376 44.226347,75.243966 32.970122,71.801274 22.789116,63.602609 18.590866,52.405008 13.675682,45.204443 1.8028657,40.50528 4.1280348,30.087205 6.0641439,21.282435 15.670301,17.787489 23.781595,18.047675 32.363214,18.899333 39.762362,14.27495 47.323866,11.057853 54.036138,10.011348 60.080345,6.7869695 66.94239,6.5239514 73.827745,6.2832858 79.992573,10.600531 83.027632,16.625433 84.923397,19.450903 86.872053,22.276379 89.32,24.66 Z".split(";"),
DEBRISCLOUD="M 304.95954,64.376304 C 277.49277,82.276003 241.66827,69.454477 211.41731,79.85341 182.94785,87.482512 151.97474,94.154867 123.11879,83.943747 95.48938,75.99336 66.651738,70.398968 37.484081,73.398842 18.970572,78.061107 -14.137683,61.027612 8.1795392,44.831273 35.781402,29.89724 66.869667,20.316467 97.592631,11.657888 162.57714,-6.6090419 236.65056,-0.9763699 294.31725,32.566319 c 15.15677,5.196271 26.61381,20.160102 10.64229,31.809985 z;m 342.60305,45.386961 c -7.29191,22.348261 -9.66643,46.973239 -30.70022,65.744569 -9.56291,8.46772 -25.11789,12.92218 -40.59786,11.98244 C 220.12739,123.1282 171.21545,103.90824 119.65346,111.45169 79.932518,115.72011 39.481042,104.62899 9.8413502,86.727358 -3.629765,72.850491 5.3001906,54.56609 20.913419,43.453167 39.272225,29.821382 66.622062,19.233063 94.387958,22.827131 144.87655,25.920022 198.72655,22.705697 242.49463,3.6247875 c 38.9784,-6.1384604 84.97751,7.9784805 98.78833,34.5910935 0.92712,2.352947 1.12743,4.748359 1.32009,7.17108 z M 98.348381,22.576575 l 0.55403,-0.173574 -0.55403,0.173574 z m 24.424669,1.147571 0.55403,-0.173574 -0.55403,0.173574 z m 28.00812,0.08717 0.55403,-0.173574 -0.55403,0.173574 z m 22.30992,-1.125739 0.55404,-0.173574 -0.55404,0.173574 z m 2.17138,-0.213036 0.55402,-0.173574 -0.55402,0.173574 z m 0.62445,-0.238469 0.55403,-0.173575 -0.55403,0.173575 z m 1.54695,0.02544 0.55403,-0.173574 -0.55403,0.173574 z m 14.92991,-3.236843 0.55404,-0.173569 -0.55404,0.173569 z m 6.37929,-1.511898 0.55401,-0.173565 -0.55401,0.173565 z M 237.86298,5.344172 238.417,5.1706024 237.86298,5.344172 Z;M 8.6920869,121.16887 C -4.1927589,98.966912 0.90898033,72.55157 8.7041909,49.662049 14.372638,35.476035 16.326584,18.502785 30.338869,8.681508 45.825701,-3.4131758 72.656091,-5.7614358 86.844372,9.2566296 97.590533,22.345836 117.873,25.584085 134.01661,19.956304 c 11.08514,-3.247312 20.45186,-9.79416 30.54262,-14.8525666 14.11297,-5.1505053 26.8782,7.2472106 29.23156,19.2600866 4.21484,11.498886 -1.06379,24.192355 6.41451,34.874819 7.62632,15.290163 20.05159,31.543452 14.34819,49.165577 -3.03505,13.5232 -12.4538,26.30757 -27.13751,30.91577 -13.91592,5.06137 -29.79779,3.4131 -43.10475,-2.40379 -17.36813,-4.34952 -33.14526,6.4165 -46.726747,14.86036 -14.840207,9.32885 -35.077152,16.24822 -52.087702,7.44298 -16.955592,-7.9194 -28.150179,-23.00607 -36.8043201,-38.05067 z;m 91.923226,127.78997 c 5.513731,11.3981 10.972854,25.51358 4.351499,37.62239 -7.54852,11.28418 -25.767729,9.59278 -33.334473,-0.81802 C 55.622193,157.05053 54.513378,146.07813 49.726705,137.18449 41.653771,125.15429 24.823594,120.63855 20.32487,105.94528 19.390228,97.039845 28.352819,92.306256 34.653598,88.093208 45.592211,81.790657 47.006891,67.243399 43.146197,56.335555 40.153404,45.98415 32.61561,38.046886 25.958609,29.920187 21.014609,18.807726 32.47462,6.8789866 43.555566,7.023595 52.328844,7.0126986 62.046398,10.741411 69.897324,4.9841051 78.99616,-0.10794813 86.373887,-10.091033 97.644393,-9.976946 c 13.469977,1.6211714 21.001927,14.9780158 24.779587,26.68591 4.09484,12.671839 4.09866,26.180141 7.02758,39.110388 1.46634,10.045348 -1.9205,22.178303 -12.13367,26.284736 -14.87769,7.426397 -27.334214,22.427262 -27.509921,39.622562 0.182575,2.25508 -0.171998,4.82307 2.115257,6.06332 z m -4.240826,-5.7236 c -2.796123,0.46537 0.642581,1.50828 0.72337,0.29222 l -0.72337,-0.29222 z;m 53.39,17 c 8.857468,18.680274 35.638969,29.655166 53.26768,16.552682 9.4851,-13.02633 29.26144,-21.688691 42.23907,-8.10085 13.3583,12.578881 11.1836,35.187026 -1.51894,47.443912 -9.14919,9.666576 -13.28816,23.915425 -6.58545,36.100486 5.44133,14.24364 14.35173,28.50153 11.97365,44.38173 5.07893,15.66617 -15.68191,32.3177 -29.44475,22.33028 C 110.6022,169.06652 93.829496,166.42587 87.217235,151.92188 78.379044,137.89166 83.963593,119.73027 74.402737,106.12243 65.827752,92.01835 48.203264,82.689295 31.783423,87.523944 18.33036,88.28596 11.389874,73.121866 13.520578,61.502437 15.481591,47.172531 -2.1632982,36.550726 4.0544615,21.982665 9.0812944,2.1611127 40.629477,-6.3421749 51.54838,12.953159 52.291692,14.237963 52.912978,15.594107 53.39,17 Z;m 53,28.01 c 17.264267,-0.215909 32.661816,-13.369626 50.21866,-9.082602 7.22749,2.514502 14.01831,10.390153 22.24021,5.672311 11.30763,-5.596745 17.32705,-20.2041726 30.88327,-21.3792418 11.63112,0.9015139 18.09339,12.3581728 24.16953,20.9111348 8.18578,10.112096 3.95736,25.007478 -5.15698,32.980017 -6.99113,8.003235 -17.51071,9.445625 -26.92735,12.360189 -14.16502,8.412284 -13.3072,30.629892 -29.93155,36.224342 -14.8311,-2.26076 -20.970578,-21.014783 -36.475878,-21.444488 -17.53188,0.713857 -29.193332,17.645528 -32.013793,33.593988 -1.961796,8.81551 0.354193,19.03046 -6.246545,26.36422 -5.430599,7.83687 -17.165422,10.68299 -24.881498,4.42654 C 4.9530851,138.95257 4.5896229,118.11427 12.893511,104.63532 19.137393,89.506979 26.037539,72.290072 19.933499,55.997969 17.518418,48.114476 9.4615578,44.674169 5.3905151,37.988065 -0.63100116,29.32318 -1.2186853,14.692506 9.3842495,9.2505971 18.552531,3.804272 28.646946,10.231493 35.097662,16.846668 40.328121,21.512442 45.748065,26.928689 53,28.01 Z;m 168.96,92 c -18.50703,19.38046 -3.01703,54.1903 23.95617,52.99453 19.19731,4.43402 27.75181,29.62521 13.24594,43.78213 -13.678,13.91986 -28.60684,33.36373 -50.94777,25.56722 C 132.89847,209.53592 117.2191,188.40609 92.738599,190.39623 73.511926,192.25447 46.474831,188.69238 45.221174,164.12611 47.858658,139.29003 19.45257,136.80785 5.4202307,126.69731 -4.7122326,101.49779 26.120786,90.455869 44.41309,85.144865 71.708322,72.249234 58.921776,45.204494 56.456307,23.773578 65.305726,5.2763567 90.435503,10.848472 106.49066,2.9345145 133.66834,-7.4060996 133.72447,31.035544 147.59229,43.624972 161.10873,55.504323 178.34631,72.281842 168.96,92 Z;m 183.99,21 c -5.56101,14.774238 -10.2477,33.563429 0.63641,47.120851 9.17136,8.95922 24.20153,3.674604 33.84782,12.312651 17.7844,11.961888 26.62799,33.887568 27.46098,54.728648 -0.88728,13.54567 -15.82829,20.54396 -28.00934,18.62906 -12.52223,-0.58085 -23.82537,-6.85871 -33.46056,-14.40887 -23.36253,-12.84254 -51.25219,-5.20342 -74.25967,4.51817 -14.904768,6.77899 -30.771017,14.6877 -47.650424,11.46214 C 50.281769,153.28514 41.539746,142.6497 29.150367,140.78095 18.214439,137.6825 4.4568112,135.09631 -0.33046599,123.26948 -2.0525657,107.0685 14.467061,96.197332 28.643924,93.886155 c 19.97782,-4.24195 40.661561,2.422228 60.514619,-2.233597 20.492967,-8.00363 29.015007,-30.475583 35.045477,-49.885401 2.45271,-13.03661 8.61197,-25.547868 19.48849,-33.5363126 9.51432,-8.26542468 25.89966,-12.0039348 35.33904,-1.6198311 C 182.64496,10.400522 184.68305,15.755864 183.99,21 Z;m 167,10.03 c 8.61332,11.733364 24.83887,11.186348 37.52164,7.864768 11.43633,-2.298219 24.04442,-5.736899 35.00002,0.08332 12.67268,14.243207 4.59387,35.94259 -7.70045,47.589028 -7.26252,9.015314 -19.05552,9.440288 -28.61213,14.415579 -15.38504,7.593175 -28.19142,23.270189 -46.67795,22.424269 -12.57735,-0.37299 -21.05597,-12.961046 -33.9889,-11.75122 -19.17926,-0.06631 -35.334555,22.20865 -26.387033,40.00049 4.126283,9.2659 17.003503,15.67229 13.998643,27.27996 -6.45663,11.01615 -21.675732,10.64774 -32.92803,11.22868 -10.935349,-0.9392 -16.018548,16.25838 -29.314738,13.65383 -21.53893,0.66305 -36.824707,-22.96858 -31.944453,-42.86518 2.364129,-13.52708 12.077562,-28.58683 3.573383,-41.761378 C 12.106522,91.199521 3.1288265,85.121422 1.7167286,73.903193 -4.6401612,48.365802 12.28966,16.672837 39.900312,13.991916 49.325716,12.840211 57.436875,19.235805 66.624607,20.478449 87.461898,25.968426 111.74653,22.670227 127.35394,6.7895446 138.74069,-3.5031337 156.70439,-0.14037568 167,10.03 Z;M 45.017141,207.88249 C 40.489055,195.9527 25.827599,206.13858 21.94712,198.49629 19.632225,187.57903 12.847701,179.62497 6.1210952,172.45416 -2.1013702,162.80832 0.58802524,147.44145 5.4357312,136.54149 10.206078,124.65819 7.3245454,111.15212 7.3158644,98.512143 6.4050751,86.653353 5.8944066,74.363257 2.9866746,63.025517 -3.0945957,50.158376 4.6572881,34.454161 14.459331,28.196862 23.163632,22.64584 33.648155,21.461042 41.110104,13.073868 47.272935,5.5331831 57.13929,-4.6636044 64.819173,6.2087031 c 8.451474,6.9186479 19.730211,8.0459719 26.251344,18.4169699 5.623554,7.368098 10.589753,16.766842 19.405613,18.641368 8.45283,2.011794 11.72519,12.513564 17.96635,18.41878 4.74183,5.325133 10.27373,9.616207 15.91481,13.264365 1.40106,5.623733 0.31403,11.884034 0.65112,17.787681 0,16.944073 0,33.888153 0,50.832233 -10.60566,6.85851 -22.89864,11.25864 -30.94326,22.71309 -3.05232,11.23343 -8.47523,22.82921 -19.248128,23.52228 -13.193897,6.68059 -23.291218,20.29593 -36.864647,25.89708 -5.13592,0.53934 -9.196334,-4.2949 -12.935234,-7.82006 z".split(";");
function loadrock(b,a){var c,e,f=[],h;id=0;if("undefined"==typeof TEAMS[1].rocks||-1==TEAMS[1].rocks[2])TEAMS[1].rocks=[0,1,2];if("undefined"==typeof TEAMS[2].rocks||-1==TEAMS[2].rocks[2])TEAMS[2].rocks=[3,4,5];if(""!=a)for(e=a.split(";"),c=0;6>c;c++)h=e[c].split(","),f[c]=[parseInt(h[0],10),parseInt(h[1],10),parseInt(h[2],10)],4==h.length&&(3>c?TEAMS[1].rocks[c]=parseInt(h[3],10):TEAMS[2].rocks[c-3]=parseInt(h[3],10));else for(c=0;6>c;c++){do for(h=!0,f[c]=[450*Math.random()+175,450*Math.random()+
175,45*Math.random()],e=0;e<c;e++){var l=f[c][0]-f[e][0],t=f[c][1]-f[e][1];if(3E4>l*l+t*t){h=!1;break}}while(!h)}for(c=0;3>c;c++)OBSTACLES[c]=new Rock(TEAMS[1].rocks[c],f[c],1,c),OBSTACLES[c+3]=new Rock(TEAMS[2].rocks[c],f[c+3],2,c)}function saverock(){if(0==OBSTACLES.length)return"";for(var b=OBSTACLES[0].toASCII(),a=1;6>a;a++)b+=";"+OBSTACLES[a].toASCII();return b}
var Rock=function(b,a,c,e){this.o=[];this.type=b>=MAXROCKS?DEBRIS:ROCK;this.id=b;this.name=(b>=MAXROCKS?"Debris #":"Asteroid #")+(3*(c-1)+e);this.arraypts=[];this.dragged=!1;this.tx=a[0];this.ty=a[1];this.team=c;this.alpha=a[2];this.moving=MOVING_ASTER;PATTERN=s.image(b>=MAXROCKS?DEBRISIMG:ROCKIMG,0,0,256,256).pattern(0,0,256,256);e=b>=MAXROCKS?DEBRISCLOUD:ROCKS;this.inside=s.path(e[b%MAXROCKS]).attr({fill:PATTERN,strokeWidth:0,stroke:"#888","class":"ASTEROID"+c});this.outline=s.path(e[b%MAXROCKS]).attr({fill:"rgba(0,0,0,0)",
strokeWidth:2,stroke:"#888"});this.g=s.group(this.inside,this.outline);for(c=0;c<this.outline.getTotalLength();c+=5)this.arraypts.push(this.outline.getPointAtLength(c));0==REPLAY.length&&this.addDrag();this.path="";this.outlinepts=[];this.g.hover(function(){this.outline.attr({strokeWidth:6,stroke:"#F00"})}.bind(this),function(){this.outline.attr({strokeWidth:2,stroke:"#888"})}.bind(this));this.g.addClass("unit");e=this.g.getBBox();this.o=[];var f=.27;b>=MAXROCKS&&(f=.4);b%=MAXROCKS;for(c=1;4>c;c++)this.o[c]=
s.ellipse(e.x+e.width/2,e.y+e.height/2,200/f/2*c+e.width/2,200/f/2*c+e.height/2).attr({pointerEvents:"none",display:"none",fill:WHITE,opacity:.3,strokeWidth:2});this.m=(new Snap.Matrix).translate(a[0],a[1]).rotate(a[2],0,0).scale(f,f);this.getOutlineString();this.g.transform(this.m);this.g.appendTo(VIEWPORT);this.show()};Rock.prototype.addDrag=function(){this.g.drag(this.dragmove.bind(this),this.dragstart.bind(this),this.dragstop.bind(this))};Rock.prototype.unDrag=function(){this.g.undrag()};
Rock.prototype.getBall=function(){var b=this.g.getBBox();return{x:b.x+b.width/2,y:b.y+b.height/2,diam:Math.max(b.width/2,b.height/2)}};Rock.prototype.toASCII=function(){return Math.floor(this.tx)+","+Math.floor(this.ty)+","+Math.floor(this.alpha)+","+this.id};Rock.prototype.getrangeallunits=function(){return Unit.prototype.getrangeallunits.call(this)};Rock.prototype.getrange=function(b){return Unit.prototype.getrange.call(this,b)};Rock.prototype.gethitrangeallunits=function(){return[[],[],[],[]]};
Rock.prototype.togglehitsector=function(){};Rock.prototype.togglerange=function(){};Rock.prototype.getOutlinePoints=function(){var b;this.outlinepts=[];for(b=0;b<this.arraypts.length;b+=5)this.outlinepts.push(transformPoint(this.m,{x:this.arraypts[b].x,y:this.arraypts[b].y}));return this.outlinepts};Rock.prototype.getBox=function(){};Rock.prototype.getOutline=function(){var b=s.path(this.path);b.appendTo(s);return b};
Rock.prototype.getOutlineString=function(){var b;this.getOutlinePoints();this.path="M ";for(b=0;b<this.outlinepts.length;b++){var a=this.outlinepts[b];this.path+=a.x+" "+a.y+" ";0==b&&(this.path+="L ")}this.path+="Z";return{s:this.path,p:this.outlinepts}};Rock.prototype.turn=function(b){this.m.add(MR(b,0,0));this.alpha+=b;this.show()};Rock.prototype.unselect=function(){};Rock.prototype.select=function(){if(phase==SETUP_PHASE){var b=activeunit;activeunit=this;b.unselect();this.showpanel()}};
Rock.prototype.showpanel=function(){Unit.prototype.showpanel.call(this);$("#positiondial button").show()};Rock.prototype.dragmove=function(b,a,c,e){Unit.prototype.dragmove.call(this,b,a,c,e)};Rock.prototype.dragstart=function(b,a,c){activeunit.unselect();activeunit=this;Unit.prototype.dragstart.call(this,b,a,c);Unit.prototype.showpanel.call(this);$("#positiondial button").show();this.dragshow()};
Rock.prototype.dragshow=function(){for(var b=1;4>b;b++)this.o[b].transform(this.dragMatrix).attr({display:"block"}).appendTo(VIEWPORT);this.g.transform(this.dragMatrix)};Rock.prototype.showhitsector=function(){};Rock.prototype.dragstop=function(b){for(var a=1;4>a;a++)this.o[a].attr({display:"none"});Unit.prototype.dragstop.call(this,b)};
Rock.prototype.endphase=function(){if(this.moving){var b=P.F4.path,a=b.getTotalLength(),c=this.m,e;Snap.animate(0,a,function(a){e=Unit.prototype.getmatrixwithmove(c,b,a);this.g.transform(e)}.bind(this),TIMEANIM*a/200,mina.linear,function(){this.m=Unit.prototype.getmatrixwithmove(c,b,a);this.g.transform(this.m)}.bind(this))}};Rock.prototype.show=function(){this.g.transform(this.m)};Rock.prototype.setclickhandler=function(b){this.g.unmousedown();this.g.mousedown(b)};
Rock.prototype.setdefaultclickhandler=function(){this.g.unmousedown();this.g.mousedown(function(){this.select()}.bind(this))};
Rock.prototype.selectrocks=function(){$(".aster").empty();for(var b=Snap(".aster"),a=[],c=TEAMS[this.team].rocks,e=b.g(),f=0,h,l=0,t=0,x=this,q=c.indexOf(this.id),m=[this.tx,this.ty,this.alpha],r=b.image(DEBRISIMG,0,0,256,256).pattern(0,0,256,256),y=b.image(ROCKIMG,0,0,256,256).pattern(0,0,256,256),B=OBSTACLES.indexOf(this),z=0;z<ROCKS.length+DEBRISCLOUD.length;z++){z<ROCKS.length?(h=.27,a[f]=b.path(ROCKS[z]).attr({strokeWidth:3}),a[f].attr({fill:y,stroke:"#a00",id:"aster"+z,idk:f}).click(function(){var a=
parseInt(this.attr("id").match(/\d+/)[0],10);c[q]=a;OBSTACLES[B].g.remove();OBSTACLES[B]=new Rock(a,m,x.team,q);console.log("change for rock "+this.attr("id")+" "+m[0]+" "+m[1]+" "+m[2]);activeunit=OBSTACLES[B];window.location="#"}).hover(function(){a[parseInt(this.attr("idk"),10)].attr({fill:"#a00"})},function(){a[parseInt(this.attr("idk"),10)].attr({fill:y})})):(h=.4,a[f]=b.path(DEBRISCLOUD[z-ROCKS.length]).attr({strokeWidth:3}),a[f].attr({fill:r,stroke:"#a00",id:"deb"+(z-ROCKS.length),idk:f}).click(function(){var a=
parseInt(this.attr("id").match(/\d+/)[0],10)+MAXROCKS;c[q]=a;OBSTACLES[B].g.remove();OBSTACLES[B]=new Rock(a,m,x.team,q);console.log("change for debris "+this.attr("id")+" "+z);activeunit=OBSTACLES[B];window.location="#"}).hover(function(){a[parseInt(this.attr("idk"),10)].attr({fill:"#a00"})},function(){a[parseInt(this.attr("idk"),10)].attr({fill:r})}));var E=0,G=0;if(13==f||12==f)E=45,G=-40;h=MT(80*t+10,10+G+80*l).rotate(E,0,0).scale(h,h);a[f].transform(h);a[f].appendTo(e);f++;t+=1;5<t&&(t=0,l+=
1)}};var V1="v1",V2="v2",CURRENT_DECK=V2;function Critical(b,a){this.lethal=!1;$.extend(this,CRITICAL_DECK[a]);this.no=this.name+a;b.criticals.push(this);this.isactive=!1;this.unit=b}Critical.FACEUP=1;Critical.FACEDOWN=2;Critical.DISCARD=0;Critical.V1="v1";Critical.V2="v2";
Critical.prototype={toString:function(){var b,a;if(!this.isactive)return"";a=this.name;"undefined"!=typeof CRIT_translation[this.name].name&&(a=CRIT_translation[this.name].name);b="<td class='tdstat'>"+a+"</td>";a="";"undefined"!=typeof CRIT_translation[this.name].text&&(a=formatstring(CRIT_translation[this.name].text));a="<td class='tooltip outoverflow'>"+a+"</td>";return 1==this.unit.team?"<tr >"+b+"<td><code class='Criticalupg upgrades'></code></td>"+a+"</tr>":"<tr ><td><code class='Criticalupg upgrades'></code></td>"+
b+a+"</tr>"},log:function(){this.unit.log("Critical: %0",this.name);var b;"undefined"!=typeof CRIT_translation[this.name].text?(b=formatstring(CRIT_translation[this.name].text),log("<ul><li>"+b+"</li></ul>")):log("no translation:"+this.name)}};
var CRITICAL_DECK=[{type:"ship",count:2,init:2,name:"Structural Damage",version:[V2],faceup:function(){this.log();this.isactive=!0;this.unit.wrap_after("getagility",this,function(b){return 0<b?b-1:b})},facedown:function(){this.isactive&&(this.unit.getagility.unwrap(this),this.unit.log("%0 repaired",this.name),this.unit.showstats());this.isactive=!1},action:function(b){var a=this.unit.rollattackdie(1,this,"hit")[0];"hit"==a||"critical"==a?this.facedown():this.unit.log("%0 not repaired",this.name);
this.unit.endaction(b,"CRITICAL")}},{type:"ship",count:2,init:2,name:"Structural Damage (original)",version:[V1],faceup:function(){this.log();this.isactive=!0;this.unit.wrap_after("getagility",this,function(b){return 0<b?b-1:b})},facedown:function(){this.isactive&&(this.unit.getagility.unwrap(this),this.unit.log("%0 repaired",this.name),this.unit.showstats());this.isactive=!1},action:function(b){"hit"==this.unit.rollattackdie(1,this,"hit")[0]?this.facedown():this.unit.log("%0 not repaired",this.name);
this.unit.endaction(b,"CRITICAL")}},{type:"ship",name:"Damaged Engine",version:[V1,V2],count:2,init:2,faceup:function(){this.log();this.isactive=!0;var b=[];this.unit.wrap_after("getdial",this,function(a){if(0===b.length)for(var c=0;c<a.length;c++)b[c]={move:a[c].move,difficulty:a[c].difficulty},a[c].move.match(/TL\d|TR\d/)&&(b[c].difficulty="RED");return b})},facedown:function(){this.isactive&&this.unit.getdial.unwrap(this);this.isactive=!1}},{type:"ship",name:"Console Fire",count:2,init:2,version:[V1,
V2],lethal:!0,faceup:function(){var b=this;this.log();this.isactive=!0;this.unit.wrap_before("begincombatphase",this,function(){"hit"==this.rollattackdie(1,b,"blank")[0]&&(this.log("+1 %HIT% [%0]",this.name),this.resolvehit(1),this.checkdead())})},action:function(b){this.facedown();this.unit.endaction(b,"CRITICAL")},facedown:function(){this.isactive&&(this.unit.log("%0 repaired",this.name),this.unit.begincombatphase.unwrap(this));this.isactive=!1}},{type:"ship",count:2,name:"Weapon Malfunction",version:[V1],
faceup:function(){this.log();this.isactive=!0;for(var b=0;b<this.unit.weapons.length&&!this.unit.weapons[b].isprimary;b++);this.w=b;this.unit.weapons[b].wrap_after("getattack",this,function(a){return 0<a?a-1:a})},facedown:function(){this.isactive&&(this.unit.weapons[this.w].getattack.unwrap(this),this.unit.log("%0 repaired",this.unit.weapons[this.w].name),this.isactive=!1)},action:function(b){var a=this.unit.rollattackdie(1,this,"hit")[0];"critical"==a||"hit"==a?this.facedown():this.unit.log("%0 not repaired",
this.name);this.unit.endaction(b,"CRITICAL")}},{type:"ship",count:2,init:2,name:"Damaged Sensor Array (original)",version:[V1],faceup:function(){this.log();this.isactive=!0;this.unit.wrap_after("getactionbarlist",this,function(){return[]})},facedown:function(){this.isactive&&(this.unit.getactionbarlist.unwrap(this),this.unit.log("%0 repaired",this.name),this.isactive=!1)},action:function(b){"hit"==this.unit.rollattackdie(1,this,"hit")[0]?this.facedown():this.unit.log("%0 not repaired",this.name);
this.unit.endaction(b,"CRITICAL")}},{type:"ship",count:2,init:2,name:"Damaged Sensor Array",version:[V2],faceup:function(){this.log();this.isactive=!0;this.unit.wrap_after("getactionbarlist",this,function(){return[]})},facedown:function(){this.isactive&&(this.unit.getactionbarlist.unwrap(this),this.unit.log("%0 repaired",this.name),this.isactive=!1)},action:function(b){var a=this.unit.rollattackdie(1,this,"hit")[0];"hit"==a||"critical"==a?this.facedown():this.unit.log("%0 not repaired",this.name);
this.unit.endaction(b,"CRITICAL")}},{name:"Minor Explosion",count:2,init:2,type:"ship",lethal:!0,version:[V1],faceup:function(){this.log();var b=this.unit.rollattackdie(1,this,"blank")[0];this.isactive=!1;"hit"==b&&this.unit.removehull(1)},facedown:function(){this.isactive=!1}},{name:"Thrust Control Fire",count:2,init:2,version:[V1,V2],type:"ship",faceup:function(){this.log();this.unit.addstress();this.isactive=!1},facedown:function(){this.isactive=!1}},{name:"Direct Hit!",count:7,init:2,version:[V1,
V2],type:"ship",lethal:!0,faceup:function(){this.log();this.unit.removehull(1)},facedown:function(){this.isactive=!1;this.unit.hull++}},{name:"Munitions Failure",count:2,init:2,type:"ship",version:[V1],lethal:!0,faceup:function(){this.log();for(var b=[],a=0;a<this.unit.weapons.length;a++)this.unit.weapons[a].issecondary&&b.push(this.unit.weapons[a]);this.isactive=!1;0!==b.length&&(a=this.unit.rand(b.length),this.wp=b[a],this.wp.isactive=!1,this.unit.log(this.wp.name+" not functioning anymore"),this.unit.show())},
facedown:function(){this.isactive=!1}},{name:"Minor Hull Breach",count:2,init:2,type:"ship",lethal:!0,version:[V1],faceup:function(){var b=this;this.log();this.isactive=!0;this.hd=this.unit.handledifficulty;this.unit.wrap_after("handledifficulty",this,function(a){"hit"==this.rollattackdie(1,b,"blank")[0]&&"RED"==a&&(this.log("+1 %HIT% [%0]",b.name),this.removehull(1))})},facedown:function(){this.isactive&&(this.unit.handledifficulty.unwrap(this),this.isactive=!1,this.unit.log("%0 repaired",this.name))}},
{name:"Damaged Cockpit",count:2,init:2,type:"pilot",version:[V1,V2],faceup:function(){var b=this;this.log();this.isactive=!0;this.unit.wrap_before("endround",this,function(){this.wrap_after("getskill",b,function(){return 0});filltabskill();this.showstats()}.bind(this.unit))},facedown:function(){this.isactive&&(this.isactive=!1,this.unit.getskill.unwrap(this),filltabskill(),this.unit.showstats())}},{name:"Blinded Pilot",count:2,init:2,version:[V1,V2],type:"pilot",faceup:function(){var b=this;this.log();
this.isactive=!0;this.unit.wrap_after("getattackstrength",this,function(a,c,e){this.getattackstrength.unwrap(b);b.isactive=!1;return 0})},facedown:function(){this.isactive=!1}},{name:"Injured Pilot",count:2,init:2,type:"pilot",lethal:!0,version:[V1],faceup:function(){this.log();var b;this.isactive=!0;for(b=0;b<this.unit.upgrades.length;b++){var a=this.unit.upgrades[b];a.type==Unit.ELITE&&a.desactivate()}this.unit.desactivate();this.unit.show()},facedown:function(){if(this.isactive){var b;"undefined"!=
typeof this.unit.init&&this.unit.init();for(b=0;b<this.unit.upgrades.length;b++){var a=this.unit.upgrades[b];a.type==Unit.ELITE&&(a.isactive=!0,"undefined"!=typeof a.init&&a.init(this.unit))}this.unit.show()}this.isactive=!1}},{name:"Stunned Pilot",count:2,init:2,version:[V1,V2],type:"pilot",lethal:!0,faceup:function(){var b=this;this.log();this.isactive=!0;this.unit.wrap_before("resolvecollision",this,function(){this.log("+1 %HIT% [%0]",b.name);this.resolvehit(1)});this.unit.wrap_before("resolveocollision",
this,function(){this.log("+1 %HIT% [%0]",b.name);this.resolvehit(1)})},facedown:function(){this.isactive&&(this.unit.resolvecollision.unwrap(this),this.unit.resolveocollision.unwrap(this),this.unit.log("no longer stunned"));this.isactive=!1}},{name:"Loose Stabilizer",count:2,init:2,type:"ship",faceup:function(){this.log();this.isactive=!0;this.unit.wrap_after("handledifficulty",this,function(b){"WHITE"==b&&this.addstress()})},action:function(b){this.facedown();this.unit.endaction(b,"CRITICAL")},facedown:function(){this.isactive&&
(this.unit.handledifficulty.unwrap(this),this.unit.log("%0 repaired",this.name));this.isactive=!1},version:[V2]},{name:"Major Explosion",count:2,init:2,type:"ship",lethal:!0,faceup:function(){this.log();"hit"==this.unit.rollattackdie(1,this,"blank")[0]&&(this.unit.log("+1 %CRIT% [%0]",this.name),this.unit.resolvecritical(1));this.isactive=!1},facedown:function(){},version:[V2]},{name:"Major Hull Breach",count:2,init:2,type:"ship",lethal:!0,version:[V2],faceup:function(){var b=round;this.log();this.isactive=
!0;this.unit.wrap_after("deal",this,function(a,c,e){if(round==b)return e;var f=$.Deferred();e.done(function(a){a.face=Critical.FACEUP;f.resolve(a)});return f.promise()})},facedown:function(){this.isactive&&this.unit.deal.unwrap(this);this.isactive=!1},action:function(b){this.facedown();this.unit.endaction(b,"CRITICAL")}},{name:"Shaken Pilot",count:2,init:2,type:"pilot",faceup:function(){this.log();this.isactive=!0;var b=[],a=this;this.unit.wrap_after("getdial",this,function(a){if(this.hasionizationeffect())return a;
if(0===b.length)for(var c=0;c<a.length;c++)a[c].move.match(/F1|F2|F3|F4|F5/)||b.push({move:a[c].move,difficulty:a[c].difficulty});return b});this.unit.wrap_after("timeformaneuver",this,function(b){b&&!this.hasionizationeffect()&&a.facedown();return b})},facedown:function(){this.isactive&&(this.isactive=!1,this.unit.getdial.unwrap(this),this.unit.timeformaneuver.unwrap(this))},version:[V2]},{name:"Weapons Failure",count:2,init:2,type:"ship",faceup:function(){for(var b in this.weapons)this.weapons[b].wrap_after("getattack",
this,function(a){return 0<a?a-1:a})},facedown:function(){for(var b in this.weapons)this.weapons[b].getattack.unwrap(this)},action:function(b){var a=this.unit.rollattackdie(1,this,"hit")[0];"hit"==a||"critical"==a?this.facedown():this.unit.log("%0 not repaired",this.name);this.unit.endaction(b,"CRITICAL")},version:[V2]}];Critical.CRITICAL_DECK=CRITICAL_DECK;var Unit=window.Unit||{},Mustache=window.Mustache||{},Critical=window.Critical||{};function Condition(b,a,c){this.name=c;this.org=a;for(var e=null,f=0;f<CONDITIONS.length;f++)if(CONDITIONS[f].name==c){e=CONDITIONS[f];break}$.extend(this,e);console.log("new condition: "+c+" to "+b.name+" from "+this.org.name);b.conditions.push(this);TEAMS[b.team].conditions.push(this);this.unit=b;this.isactive=!0;this.assign(b);activeunit=b;b.show();activeunit=a}
Condition.prototype={toString:function(){if(!this.isactive)return"";this.tooltip=formatstring(getupgtxttranslation(this.name,this.type));this.trname=translate(this.name).replace(/\'/g,"&#39;");this.left=1==this.unit.team;return Mustache.render(TEMPLATES.condition,this)},remove:function(){var b=this.unit;Unit.prototype.desactivate.call(this);b.conditions.pop[this];TEAMS[b.team].conditions.pop[this];b.show()}};
var CONDITIONS=[{name:"I'll Show You The Dark Side",assign:function(b){for(var a=this,c=[],e=0;e<Critical.CRITICAL_DECK.length;e++)-1<Critical.CRITICAL_DECK[e].version.indexOf(CURRENT_DECK)&&"pilot"==Critical.CRITICAL_DECK[e].type&&0<Critical.CRITICAL_DECK[e].count&&c.push(e);this.org.selectcritical(c,function(c){Critical.CRITICAL_DECK[c].count--;b.darkside=new Critical(b,c);c=Critical.CRITICAL_DECK[c].name;"undefined"!=typeof CRIT_translation[c].name&&(c=CRIT_translation[c].name);a.name+=" ["+c+
"]"});b.wrap_after("deal",this,function(b,c,e){return c==Critical.FACEUP?(b=$.Deferred(),a.remove(),b.resolve({crit:this.darkside,face:c})):e}).unwrapper("deal")}},{name:"Suppressive Fire",assign:function(b){var a=this;b.wrap_after("getattackstrength",this,function(b,e,f){return e.name!=a.org.name&&a.isactive&&a.unit==this?f-1:f});b.wrap_after("declareattack",this,function(b,e,f){f&&e.name==a.org.name&&a.isactive&&a.unit==this&&a.remove();return f});this.org.wrap_before("dies",this,function(){a.remove()});
this.org.wrap_before("endcombatphase",this,function(){0==this.hasfired&&a.remove()})}},{name:"A Debt To Pay",assign:function(b){var a=this;b.adebttopay=a;b.adddicemodifier(Unit.ATTACK_M,Unit.MOD_M,Unit.ATTACK_M,this,{req:function(a,b){return"undefined"!=typeof targetunit.ascoretosettle?targetunit.ascoretosettle.isactive:!1},f:function(b,e){this.log("1 %FOCUS% -> 1 %CRIT% [%0]",a.name);return b=b-Unit.FCH_FOCUS+Unit.FCH_CRIT}.bind(b),str:"elite"})}},{name:"Fanatical Devotion",assign:function(b){var a=
this;b.wrap_before("isattackedby",this,function(){this.wrap_after("canusefocus",a,function(){return!1}).unwrapper("endbeingattacked")});b.wrap_before("endround",this,function(){a.remove()});b.wrap_after("declareattack",this,function(b,e,f){f&&this.wrap_after("removefocustoken",a,function(){Unit.prototype.wrap_after("cancelcritical",a,function(a,b,c){return{ch:c.ch+Unit.FCH_HIT,e:c.e}}).unwrap("endbeingattacked")}).unwrap("endattack");return f}).unwrap("endattack")}},{name:"Shadowed",assign:function(b){this.org.skill=
b.getskill(b.skill);this.org.show()}},{name:"Harpooned!",assign:function(b){var a=this;b.wrap_before("dies",this,function(){for(var c=b.getrangeallunits(),e=0;e<c[1].length;e++)squadron[c[1][e].unit]!=b&&(squadron[c[1][e].unit].log("Harpooned! deals 1 %HIT%"),squadron[c[1][e].unit].resolvehit(1));a.remove()});b.wrap_after("resolveishit",this,function(c){if(0<c.criticalresolved){c=b.getrangeallunits();for(var e=0;e<c[1].length;e++)squadron[c[1][e].unit]!=b&&(squadron[c[1][e].unit].log("Harpooned! deals 1 %HIT%"),
squadron[c[1][e].unit].resolvehit(1));b.log("Harpooned! deals 1 damage card");b.applydamage(1);a.remove();b.show()}})},candoaction:function(){return this.isactive},action:function(b){var a=this.unit.rollattackdie(1,this.unit,"hit")[0];this.unit.log("roll 1 attack dice [%0]",this.name);this.unit.log("Rolled: %HIT% [%1]",a,this.name);if("hit"==a||"critical"==a)this.unit.resolvehit(1),this.unit.checkdead();this.remove();this.unit.endaction(b)}}];var Mustache=window.Mustache||{},Critical=window.Critical||{},FAST=!1,s,ENGAGED=!1,BLACK="#111",GREEN="#0F0",RED="#F00",WHITE="#FFF",BLUE="#0AF",YELLOW="#FF0",GREY="#888",HALFBLACK="#222",HALFGREEN="#080",HALFRED="#800",HALFWHITE="#888",HALFBLUE="#058",HALFYELLOW="#880",HALFGREY="#444",TIMEANIM=FAST?0:1E3,FACE=["focus","hit","critical","evade","blank"],ATTACKDICE=[0,0,1,1,1,2,4,4],DEFENSEDICE=[0,0,3,3,3,4,4,4],MPOS={F0:[0,3],RL1:[0,2],RR1:[0,4],RF1:[0,3],RF5:[0,3],F1:[1,3],F2:[2,3],F3:[3,3],F4:[4,
3],F5:[5,3],BL1:[1,2],BL2:[2,2],BL3:[3,2],TL1:[1,1],TL2:[2,1],TL3:[3,1],BR1:[1,4],BR2:[2,4],BR3:[3,4],TR1:[1,5],TR2:[2,5],TR3:[3,5],K1:[1,7],K2:[2,7],K3:[3,7],K4:[4,7],K5:[5,7],SL2:[2,0],SL3:[3,0],SR2:[2,6],SR3:[3,6],TRL3:[3,0],TRR3:[3,6],TRL2:[2,0],TRR2:[2,6]},NOLOG=!1,generics=[],gid=0,xws_lookup=function(b){for(var a in PILOT_dict)if(PILOT_dict[a]==b)return a;return""},upg_lookup=function(b){for(var a in UPGRADE_dict)if(UPGRADE_dict[a]==b)return a;return""},activeunit,unitlist,pilotlist,squadron=
[],active=0,globalid=1,targetunit,attackunit,PATTERN,SOUND_DIR="ogg/",SOUND_FILES="cloak_romulan decloak_romulan EXPLODE3 KX9_laser_cannon TIE-Fire Slave1-Guns Falcon-Guns XWing-Fly1 TIE-Fly2 Slave1-Fly1 Falcon-Fly1 Falcon-Fly3 YWing-Fly2 ISD-Fly missile XWing-Fly2 DStar-Gun4 TIE-Fly6 Slave1-Fly2 ghost".split(" "),SOUNDS={},SOUND_NAMES="cloak decloak explode xwing_fire tie_fire slave_fire falcon_fire xwing_fly tie_fly slave_fly falcon_fly yt2400_fly ywing_fly isd_fly missile xwing2_fly dstar_gun tie2_fly slave2_fly ghost".split(" ");
function loadsound(){var b,a,c={explode:2,cloak:0,decloak:1};for(b=0;b<squadron.length;b++){var e=squadron[b].ship.firesnd;c[e]=SOUND_NAMES.indexOf(e);-1==SOUND_NAMES.indexOf(e)&&console.log("cannot find fire sound for "+e+"/"+squadron[b].ship.name);e=squadron[b].ship.flysnd;c[e]=SOUND_NAMES.indexOf(e);-1==SOUND_NAMES.indexOf(e)&&console.log("cannot find sound for "+e+"/"+squadron[b].ship.name);for(a=1;a<squadron[b].weapons.length;a++)e=squadron[b].weapons[a].firesnd,c[e]=SOUND_NAMES.indexOf(e),-1==
SOUND_NAMES.indexOf(e)&&console.log("cannot find fire sound for "+e+"/"+squadron[b].weapons[a].name)}for(b in c)SOUNDS[b]=new Howl({src:[SOUND_DIR+SOUND_FILES[c[b]]+".ogg",SOUND_DIR+SOUND_FILES[c[b]]+".m4a",SOUND_DIR+SOUND_FILES[c[b]]+".wav"],autoplay:!1,loop:!1})}function transformPoint(b,a){var c=a.x*b.a+a.y*b.c+b.e;a.y=a.x*b.b+a.y*b.d+b.f;a.x=c;return a}function halftone(b){return b==GREEN?HALFGREEN:b==RED?HALFRED:b==WHITE?HALFWHITE:b==BLUE?HALFBLUE:b==YELLOW?HALFYELLOW:b==GREY?HALFGREY:b}
var wrap_after=function(b,a,c,e){var f=this,h=f[b];"undefined"==typeof f[b].save&&this!=Bomb.prototype&&this!=Unit.prototype&&this!=Weapon.prototype&&(f[b].save=f.__proto__[b]);"undefined"==typeof h&&console.log("name"+b+" undefined");var l=function(){var a=Array.prototype.slice.call(arguments),b;b=h.apply(this,a);return b=c.apply(this,a.concat([b]))};l.save=h;l.org=a;"undefined"==typeof a.wrapping&&(a.wrapping=[]);a.wrapping.push({name:b,wrap:this});l.vanilla="undefined"!=typeof h.vanilla?h.vanilla:
h;l.unwrapper=function(b){var c=f.wrap_before(b,a,function(b){l.unwrap(a);c.unwrap(a);f.show();return b})};h.next=l;l.unwrap=function(a){if(l.org==a)return l.save.next=l.next,"undefined"==typeof l.next&&(f[b]=l.save),"getskill"==b&&filltabskill(),f.show(),l.save;"function"==typeof l.save.unwrap&&(l.save=l.save.unwrap(a));f.show();return l};this[b]=l;"getskill"==b&&filltabskill();return l},wrap_before=function(b,a,c,e){var f=this,h=f[b];"undefined"==typeof f[b].save&&this!=Bomb.prototype&&this!=Unit.prototype&&
this!=Weapon.prototype&&(f[b].save=f.__proto__[b]);"undefined"==typeof h&&console.log("name"+b+" undefined");var l=function(){var a=Array.prototype.slice.call(arguments);c.apply(this,a);return h.apply(this,a)};l.save=h;l.org=a;"undefined"==typeof h&&console.error("org:"+a.name+" "+b);"undefined"==typeof a.wrapping&&(a.wrapping=[]);a.wrapping.push({name:b,wrap:this});l.vanilla="undefined"!=typeof h.vanilla?h.vanilla:h;l.unwrapper=function(b){var c=f.wrap_before(b,a,function(){l.unwrap(a);c.unwrap(a);
f.show()})};h.next=l;l.unwrap=function(a){if(l.org==a)return l.save.next=l.next,"undefined"==typeof l.next&&(f[b]=l.save),f.show(),l.save;"function"==typeof l.save.unwrap&&(l.save=l.save.unwrap(a));return l};return this[b]=l},MS=function(b,a){return(new Snap.Matrix).scale(b,a)},MT=function(b,a){return(new Snap.Matrix).translate(b,a)},MR=function(b,a,c){return(new Snap.Matrix).rotate(b,a,c)},C={GREEN:"#0F0",RED:"#F00",WHITE:"#FFF"},P,A={CONDITION:{key:"t",color:YELLOW},ARCROTATE:{key:"R",color:GREEN},
ROLL:{key:"r",color:GREEN},SLAM:{key:"s",color:BLUE},COORDINATE:{key:"o",color:GREEN},FOCUS:{key:"f",color:GREEN},TARGET:{key:"l",color:BLUE},EVADE:{key:"e",color:GREEN},BOOST:{key:"b",color:GREEN},STRESS:{key:"?",color:RED},CLOAK:{key:"k",color:BLUE},ISTARGETED:{key:"l",color:RED},ASTROMECH:{key:"A",color:YELLOW},CANNON:{key:"C",color:YELLOW},CREW:{key:"W",color:YELLOW},MISSILE:{key:"M",color:YELLOW},TORPEDO:{key:"P",color:YELLOW},ELITE:{key:"E",color:YELLOW},TURRET:{key:"U",color:YELLOW},UPGRADE:{key:"S",
color:YELLOW},CRITICAL:{key:"c",color:RED},SALVAGED:{key:"V",color:YELLOW},BOMB:{key:"B",color:YELLOW},TITLE:{key:"t",color:YELLOW},MOD:{key:"m",color:YELLOW},SYSTEM:{key:"S",color:YELLOW},ILLICIT:{key:"I",color:YELLOW},LASER:{key:"%",color:RED},REINFORCE:{key:"i",color:GREEN},TURRETLASER:{key:"$",color:RED},BILASER:{key:"<",color:RED},MOBILELASER:{key:"<",color:RED},LASER180:{key:">",color:RED},NOTHING:{key:"&nbsp;",color:WHITE},HIT:{key:"d",color:WHITE},SHIELD:{key:"v",color:YELLOW},TECH:{key:"X",
color:WHITE},RELOAD:{key:"/",color:YELLOW}},AINDEX="ROLL FOCUS TARGET EVADE BOOST STRESS CLOAK ISTARGETED ASTRO CANNON CREW MISSILE TORPEDO ELITE TURRET RELOAD REINFORCE UPGRADE CRITICAL NOTHING".split(" ");function repeat(b,a){for(var c="",e=0;e<a;e++)c+=b;return c}function dist(b,a){return(b.x-a.x)*(b.x-a.x)+(b.y-a.y)*(b.y-a.y)}function changeia(b){for(var a in squadron)squadron[a].behavior=b}
function Unit(b,a){var c;this.behavior=ALONE;this.isdocked=this.dead=!1;this.ship={};this.id=gid;this.life=1;this.arcrotation=180;this.wrapping=[];var e=this.id;generics["u"+gid]=this;gid++;this.maxupg=[];this.exclupg=[];this.team=b;this.faction=TEAMS[b].faction;this.shipactionList=[];this.dial=[];this.dialselect="<table class='dial' id='dial"+e+"'></table>";this.text="<span id='text"+e+"' class='details'></span>";this.upgradesno=0;this.upgrades=[];this.criticals=[];this.conditions=[];this.DEFENSEREROLLD=
[];this.ATTACKREROLLA=[];this.ATTACKMODA=[];this.ATTACKADD=[];this.DEFENSEMODD=[];this.DEFENSEADD=[];this.tx=this.ty=this.alpha=0;if("undefined"==typeof PILOTS[a])this.error("pilot does not exists "+a);else{e=unitlist[PILOTS[a].unit];this.ship={shield:e.shield,hull:e.hull,firesnd:e.firesnd,flysnd:e.flysnd,name:PILOTS[a].unit,hastitle:e.hastitle,code:e.code};"undefined"==typeof PILOTS[a].shipimg?(c=e.faction.indexOf(this.faction),-1==c&&(c=0),this.shipimg=e.img[c]):this.shipimg=PILOTS[a].shipimg;this.scale=
e.scale;this.islarge=1==e.islarge?!0:!1;this.hull=e.hull;this.shield=e.shield;this.agility=e.evade;this.hasmobilearc="Mobilelaser"==e.weapon_type;for(c=0;c<e.dial.length;c++)this.dial[c]={move:e.dial[c].move,difficulty:e.dial[c].difficulty};this.shipactionList=e.actionList.slice(0);this.weapons=[];this.upgrades=[];this.criticals=[];this.conditions=[];this.bombs=[];this.lastdrop=-1;Laser(this,e.weapon_type,e.fire);this.name=PILOTS[a].name;this.pilotid=a;this.unique=1==PILOTS[a].unique?!0:!1;this.skill=
PILOTS[a].skill;this.install="undefined"!=typeof PILOTS[a].install?PILOTS[a].install:function(){};this.uninstall="undefined"!=typeof PILOTS[a].uninstall?PILOTS[a].uninstall:function(){};e=PILOTS[a].upgrades;this.upg=[];this.upgbonus=[];for(c=0;20>c;c++)this.upg[c]=-1;this.upgradetype=[];for(c=0;c<e.length;c++)this.upgradetype[c]=e[c];this.upgradetype[c++]=Unit.MOD;unitlist[this.ship.name].hastitle&&(this.upgradetype[c++]=Unit.TITLE);this.upgradesno=c;this.points=PILOTS[a].points;this.activeweapon=
this.usedweapon=this.addedattack2=this.noattack=this.addedattack=-1;this.touching=[];this.action=this.maneuver=-1;this.actionsdone=[];this.hasdecloaked=this.hasmoved=!1;this.tractorbeam=this.focus=this.reroll=0;this.lastmaneuver=-1;this.iscloaked=!1;this.istargeted=[];this.targeting=[];this.stress=0;this.checkpilotstress=!0;this.hasfired=this.reinforceaft=this.reinforce=this.evade=this.ionized=0;this.maxfired=1;this.criticalresolved=this.hitresolved=0;this.m=new Snap.Matrix;this.collision=!1;this.oldoverlap=
-1;this.ocollision={overlap:-1,template:[],mine:[]};this.install(this);0<=this.team&&3>this.team&&TEAMS[this.team].updatepoints();"undefined"!=typeof this.init&&this.init()}}Unit.FCH_HIT=1;Unit.FCH_FOCUS=100;Unit.FCH_CRIT=10;Unit.FE_EVADE=1;Unit.FE_FOCUS=10;Unit.FE_focus=function(b){return Math.floor(b/10)%10};Unit.FE_evade=function(b){return b%10};Unit.FE_blank=function(b,a){return a-Unit.FE_evade(b)-Unit.FE_focus(b)};Unit.FCH_hit=function(b){return b%10};
Unit.FCH_focus=function(b){return Math.floor(b/100)%10};Unit.FCH_crit=function(b){return Math.floor(b/10)%10};Unit.FCH_blank=function(b,a){return a-Unit.FCH_crit(b)-Unit.FCH_focus(b)-Unit.FCH_hit(b)};Unit.ILLICIT="Illicit";Unit.ELITE="Elite";Unit.TURRET="Turret";Unit.MISSILE="Missile";Unit.ASTROMECH="Astromech";Unit.TORPEDO="Torpedo";Unit.CANNON="Cannon";Unit.BOMB="Bomb";Unit.TECH="Tech";Unit.CREW="Crew";Unit.SYSTEM="System";Unit.SALVAGED="Salvaged";Unit.MOD="Mod";Unit.TITLE="Title";Unit.ROCK="Rock";
Unit.DEBRIS="Debris";Unit.NONE="None";Unit.CONDITION="Condition";Unit.REROLL_M=0;Unit.ADD_M=1;Unit.MOD_M=2;Unit.ATTACK_M=0;Unit.DEFENSE_M=1;Unit.ATTACKCOMPARE_M=2;Unit.DEFENDCOMPARE_M=3;Unit.REBEL="REBEL";Unit.EMPIRE="EMPIRE";Unit.SCUM="SCUM";var ROCK="Rock",DEBRIS="Debris",NONE="None";
Unit.prototype={wrap_before:function(b,a,c,e){return wrap_before.call(this,b,a,c,e)},wrap_after:function(b,a,c,e){return wrap_after.call(this,b,a,c,e)},tosquadron:function(b){var a,c=this.upg,e=[];for(a in c)-1<c[a]&&e.push(Upgradefromid(this,c[a]));this.color=this.faction==Unit.REBEL?RED:this.faction==Unit.EMPIRE?GREEN:YELLOW;a=this.shipimg;this.islarge?this.img="undefined"==typeof a?b.text(0,0,this.ship.code).transform("r -90 0 0 "+(this.faction==Unit.EMPIRE||this.faction==Unit.SCUM?"s 2 -2":"s 2 2")+
"t -15 5").attr({"class":"xwingship"}):b.image("png/"+this.shipimg+".png",-50*this.scale,-50*this.scale,100*this.scale,100*this.scale).transform("r 90 0 0"):("undefined"!=typeof this.shipimg&&(a=this.shipimg),this.img="undefined"==typeof a?b.text(-10,10,this.ship.code).transform("r -90 0 0 "+(this.faction==Unit.EMPIRE||this.faction==Unit.SCUM?"r -1 1":"")).attr({"class":"xwingship"}):b.image("png/"+a+".png",-20*this.scale,-20*this.scale,40*this.scale,40*this.scale).transform("r 90 0 0").attr({pointerEvents:"none"}));
this.imgsmoke=b.image("png/smoke.gif",-20,-60,30,50).transform("r 180 0 0").attr({display:"none"});this.imgflame=b.image("png/out.gif",-15,-40,20,40).transform("r 180 0 0").attr({display:"none"});c=this.islarge?40:20;this.outline=b.rect(-c,-c,2*c,2*c).attr({fill:"rgba(8,8,8,0.5)",strokeWidth:2});this.border=b.rect(-c,-c,2*c,2*c).attr({fill:"rgba(0,0,0,0)",strokeWidth:2,stroke:halftone(this.color)});this.tohitstats={};this.tohit=b.text(-c,c-30,"0").attr({"class":"tohit",strokeWidth:1});this.meanhit=
b.text(-c,c-15,"0").attr({"class":"tohit",strokeWidth:1});this.meanhitsymbol=b.text(-c+40,c-15,"0").attr({"class":"symbols",strokeWidth:0,text:"d"});this.meancrit=b.text(-c,c,"0").attr({"class":"tohit",strokeWidth:1});this.meancritsymbol=b.text(-c+40,c,"0").attr({"class":"symbols",strokeWidth:0,text:"c"});this.gproba=b.group(this.tohit,this.meanhit,this.meanhitsymbol,this.meancrit,this.meancritsymbol).attr({display:"none",fontSize:"15",stroke:"#fff",fill:"#fff",opacity:1});this.skillbar=b.text(1-
c,3-c,repeat("u",this.skill)).transform("r -90 0 0").attr({"class":"xsymbols",fill:"#fa0"});this.firebar=b.text(1-c,5-c,repeat("u",this.weapons[0].attack)).transform("r -90 0 0").attr({"class":"xsymbols",fill:"#f00"});this.evadebar=b.text(1-c,7-c,repeat("u",this.agility)).transform("r -90 0 0").attr({"class":"xsymbols",fill:"#0f0"});this.hullbar=b.text(1-c,9-c,repeat("u",this.hull)).transform("r -90 0 0").attr({"class":"xsymbols",fill:"#cc0"});this.shieldbar=b.text(1-c,9-c,repeat("u",this.shield+
this.hull)).transform("r -90 0 0").attr({"class":"xsymbols",fill:"#0af"});this.gstat=b.group(this.skillbar,this.firebar,this.evadebar,this.shieldbar,this.hullbar,this.gproba).attr({pointerEvents:"none"});this.dialspeed=b.text(2+c,3-c,"").attr({"class":"dialspeed",pointerEvents:"none"});this.dialdirection=b.text(c+8,3-c,"").attr({"class":"symbols",pointerEvents:"none"});this.actionicon=b.text(c+2,-7,"").attr({pointerEvents:"none","class":"symbols",strokeWidth:0});this.sector=b.polygon(3-c,-c,0,0,c-
3,-c).attr({fill:this.color,opacity:.5,strokeWidth:0});this.ranges=[];this.sectors=[];this.infoicon=[];for(a=0;6>a;a++)this.infoicon[a]=b.text(c-7,6-c+7*a,A[AINDEX[a+2]].key).attr({pointerEvents:"none","class":"xsymbols",fill:A[AINDEX[a+2]].color,strokeWidth:0});this.geffect=b.group(this.imgflame,this.imgsmoke).attr({pointerEvents:"none"});this.g=b.group(this.sector,this.outline,this.img,this.border,this.dialspeed,this.dialdirection,this.actionicon,this.infoicon[0],this.infoicon[1],this.infoicon[2],
this.infoicon[3],this.infoicon[4],this.infoicon[5],this.gstat);VIEWPORT.add(this.g);VIEWPORT.add(this.geffect);this.g.addClass("unit");this.g.hover(function(){this.setinfo(translate(this.name))}.bind(this),function(){$(".info").hide()}.bind(this));this.setdefaultclickhandler();this.upgrades.sort(function(a,b){var c=(a.isWeapon()?4:0)+(a.isBomb()?1:0);return(b.isWeapon()?4:0)+(b.isBomb()?1:0)-c});this.g.drag(this.dragmove.bind(this),this.dragstart.bind(this),this.dragstop.bind(this))},setinfo:function(b){var a=
VIEWPORT.m.clone(),c=$("#svgout").width(),e=$("#svgout").height(),f=0,h=0;e>c?h=(e-c)/2:f=(c-e)/2;var l=Math.max(GW/c,GH/e),t=this.g.getBBox(),c=$("#svgout").offset();$("#playmat").width();$("#playmat").height();e=a.x(t.x,t.y-20)/l;e+=c.left+f;a=a.y(t.x,t.y-20)/l;a+=c.top+h;return $(".info").css({left:e,top:a}).attr({pointerEvents:"none"}).html(formatstring(b)).appendTo("body").show()},desactivate:function(){for(var b in this.wrapping){var a=this.wrapping[b];"function"==typeof a.wrap[a.name].unwrap&&
a.wrap[a.name].unwrap(this)}this.isactive=!1},toJSON:function(){var b={};b.name=xws_lookup(this.name);b.points=PILOTS[this.pilotid].points;b.ship=xws_lookup(this.ship.name);for(var a={},c={},e=0;e<this.upg.length;e++){var f=this.upg[e];if(-1<f&&"undefined"!=typeof f){var h=UPGRADES[f];"undefined"==typeof a[upg_lookup(h.type)]&&(a[upg_lookup(h.type)]=[]);b.points+=h.points;if("undefined"!=typeof UPGRADES[f].pointsupg)for(var l=0;l<UPGRADES[f].upgrades.length;l++)c[UPGRADES[f].upgrades[l]]=UPGRADES[f].pointsupg;
a[upg_lookup(h.type)].push(upg_lookup(h.name))}}for(e=0;e<this.upg.length;e++)f=this.upg[e],-1<f&&"undefined"!=typeof f&&"undefined"!=typeof c[UPGRADES[f].type]&&(h=c[UPGRADES[f].type],b.points=0<UPGRADES[f].points+h?b.points+h:b.points-UPGRADES[f].points);this.points=b.points;b.upgrades=a;return b},toJuggler:function(b,a){var c=this.name;1==b&&(c=translate(this.name));c=c.replace(/\'/g,"");1==PILOTS[this.pilotid].ambiguous&&"undefined"!=typeof PILOTS[this.pilotid].edition&&1!=a&&(c=c+"("+PILOTS[this.pilotid].edition+
")");a&&"undefined"!=typeof this.ship.code&&(c="<span class='ship'>"+this.ship.code+"</span> <span class='"+(this.faction==Unit.REBEL?"HALFRED":this.faction==Unit.EMPIRE?"HALFGREEN":"HALFYELLOW")+"'>"+c+"</span>");for(var e=0;e<this.upg.length;e++){var f=this.upg[e];if(-1<f){var h=UPGRADES[f].name;1==b&&(h=translate(UPGRADES[f].name));c=a?c+(" <span class='"+UPGRADES[f].type+"'></span> "):c+" + ";c+=h.replace(/\(Crew\)/g,"").replace(/\'/g,"")}}return c},toASCII:function(){var b=this.pilotid,a,c;for(a=
0;a<this.upg.length;a++)c=this.upg[a],-1<c&&(b+=","+c);return b+=":"+Math.floor(this.tx)+","+Math.floor(this.ty)+","+Math.floor(this.alpha)},toKey:function(){for(var b=("00"+this.pilotid.toString(32)).slice(-2),a=[],c=0;c<this.upg.length;c++)-1<this.upg[c]&&a.push(this.upg[c]);a.sort();for(c=0;c<a.length;c++)b+=("00"+a[c].toString(32)).slice(-2);return b},setpriority:function(b){var a={FOCUS:3,EVADE:1,REINFORCE:7,CLOAK:4,TARGET:2,CRITICAL:100,BOMB:5,ILLICIT:6}[b.type];"undefined"==typeof a&&(a=0);
b.priority=a;a=[];"BOOST"==b.type&&(a=this.getboostmatrix(this.m));"ROLL"==b.type&&(a=this.getrollmatrix(this.m));if(0<a.length){var c=this.m,e=this.evaluateposition(),f=e-1;for(i=0;i<a.length;i++)this.m=a[i],f=Math.max(f,this.evaluateposition());this.m=c;f>e&&(b.priority=2*(f-e))}},getstatstring:function(){var b;b=""+("<div class='xsymbols RED'>"+repeat("u",this.weapons[0].getattack())+"</div>");b+="<div class='xsymbols GREEN'>"+repeat("u",this.getagility())+"</div>";b+="<div class='xsymbols YELLOW'>"+
repeat("u",this.hull)+"</div>";return b+="<div class='xsymbols BLUE'>"+repeat("u",this.shield)+"</div>"},getupgradeaddstring:function(){for(var b="",a=0;a<this.upgradetype.length;a++)-1==this.upg[a]&&(b+="<button num="+a+" class='upgrades "+this.upgradetype[a].replace(/\|/g,"")+"'><sup class='label'>"+this.getupgradelist(this.upgradetype[a]).length+"</sup></button>");return b},showskill:function(){$("#unit"+this.id+" .statskill").html(this.getskill())},showupgradeadd:function(){$("#unit"+this.id+
" .upgavail").html(this.getupgradeaddstring());addupgradeaddhandler(this)},getagility:function(){return phase==COMBAT_PHASE?this.agility-this.tractorbeam:this.agility},getskill:function(){return this.skill},getdial:function(){return this.hasionizationeffect()?[{move:"F1",difficulty:"WHITE"}]:this.dial},doplan:function(){this.showdial();return this.deferred},getdialstring:function(){var b=[],a="";for(j=0;5>=j;j++)for(b[j]=[],k=0;7>=k;k++)b[j][k]="<td></td>";var c=this.getdial();for(j=0;j<c.length;j++)d=
c[j],b[MPOS[d.move][0]][MPOS[d.move][1]]="<td class='symbols "+d.difficulty+"' move='"+d.move+"'>"+P[d.move].key+"</td>";for(j=5;0<=j;j--){a+="<tr>";a=0<j&&5>j?a+("<td>"+j+"</td>"):a+"<td></td>";for(k=0;7>=k;k++)a+=b[j][k];a+="</tr>\n"}return a},canreveal:function(b){return"RED"!=b.difficulty||0==this.stress},showdial:function(){var b=[],a,c,e=this.getdial();if(phase==PLANNING_PHASE||phase==SELECT_PHASE){for(a=0;5>=a;a++)for(b[a]=[],c=0;7>=c;c++)b[a][c]="<td></td>";$("#select"+this.id).val();for(a=
0;a<e.length;a++){c=e[a];var f=MPOS[c.move][0],h=MPOS[c.move][1];this.canreveal(c)?(b[f][h]="<td",phase==PLANNING_PHASE&&(b[f][h]+=" onclick='activeunit.setmaneuver("+a+")'"),b[f][h]+=" class='symbols maneuver "+c.difficulty,this.maneuver==a&&(b[f][h]+=" selected"),b[f][h]+="' >"+P[c.move].key+"</td>"):b[f][h]="<td></td>"}e="";for(a=5;0<=a;a--){e+="<tr>";e=0<a&&5>a?e+("<td>"+a+"</td>"):e+"<td></td>";for(c=0;7>=c;c++)e+=b[a][c];e+="</tr>\n"}phase==SELECT_PHASE?$("#dial"+this.id).html(e):$("#maneuverdial").html(e)}phase>=
PLANNING_PHASE&&(-1==this.maneuver||this.hasmoved)&&this.clearmaneuver()},getupgradelist:function(b){for(var a=[],c=0;c<UPGRADES.length;c++){var e=UPGRADES[c];if(!("undefined"!=typeof e.faction&&null==this.faction.match(e.faction)||"undefined"!=typeof e.ship&&-1==this.ship.name.search(e.ship)||"undefined"!=typeof e.ishuge||"undefined"!=typeof e.islarge&&this.islarge!=e.islarge||"undefined"!=typeof e.skillmin&&this.getskill()<e.skillmin||"undefined"!=typeof e.agilitymax&&this.getagility()>=e.agilitymax||
"undefined"!=typeof e.noupgrades&&-1<this.upgradetype.indexOf(e.noupgrades)||"undefined"!=typeof e.actionrequired&&-1==this.shipactionList.indexOf(e.actionrequired.toUpperCase())||"undefined"!=typeof this.maxupg[e.type]&&this.maxupg[e.type]<e.points)){if("undefined"!=typeof e.requiredupg){for(var f=!0,h=0;h<e.requiredupg.length;h++)if(-1==this.upgradetype.indexOf(e.requiredupg[h])){f=!1;break}if(!f)continue}!b.match(e.type)||1==e.takesdouble&&this.upgradetype.indexOf(e.type)==this.upgradetype.lastIndexOf(e.type)||
a.push(c)}}a.sort(function(a,b){return translate(UPGRADES[a].name)>translate(UPGRADES[b].name)});return a},turn:function(b){this.alpha+=b;this.m.rotate(b,0,0);this.show()},getactionstring:function(){for(var b="",a=0;a<this.shipactionList.length;a++)b+="<span class='s"+this.shipactionList[a]+"'></span>";return b},showactionlist:function(){var b=this.getactionstring();$("#unit"+this.id+" .actionlist").html(b)},getattacktable:function(b){return ATTACK[b]},attackroll:function(b){var a,c,e,f,h=this.getattacktable(b),
l=0,t=Math.random();if(0==b)return 0;for(c=0;c<=b;c++)for(e=0;e<=b-c;e++)for(f=0;f<=b-c-e;f++)if(a=c*Unit.FCH_FOCUS+e+Unit.FCH_CRIT*f,l+=h[a],l>t)return Unit.FCH_FOCUS*c+f*Unit.FCH_CRIT+e;return 0},confirm:function(b){return confirm(b)},rollattackdie:function(b,a,c){a=[];for(c=0;c<b;c++)a.push(FACE[ATTACKDICE[this.rand(8)]]);return a},rolldefensedie:function(b,a,c){a=[];for(c=0;c<b;c++)a.push(FACE[DEFENSEDICE[this.rand(8)]]);return a},rand:function(b){return Math.floor(Math.random()*b)},getdefensetable:function(b){return DEFENSE[b]},
defenseroll:function(b){var a,c,e,f=$.Deferred(),h=this.getdefensetable(b),l=0,t=Math.random();if(0==b)return f.resolve({dice:b,roll:0}).promise();"undefined"==typeof h&&this.error("P undefined for n="+b);for(e=0;e<=b;e++)for(c=0;c<=b-e;c++)if(a=e*Unit.FE_FOCUS+c*Unit.FE_EVADE,l+=h[a],l>t)return f.resolve({dice:b,roll:Unit.FE_FOCUS*e+c*Unit.FE_EVADE}).promise();return f.resolve({dice:b,roll:0}).promise()},getdicemodifiers:function(){return[{from:Unit.ATTACK_M,type:Unit.MOD_M,to:Unit.ATTACK_M,org:this,
req:function(){return this.canusefocus()}.bind(this),aiactivate:function(b,a){return 0<Unit.FCH_focus(b)},f:function(b,a){this.removefocustoken();var c=Unit.FCH_focus(b);0<c&&(b=b-Unit.FCH_FOCUS*c+Unit.FCH_HIT*c);return b}.bind(this),str:"focus",token:!0,noreroll:"focus"},{from:Unit.ATTACK_M,type:Unit.REROLL_M,to:Unit.ATTACK_M,org:this,req:function(b,a,c){return this.canusetarget(c)}.bind(this),n:function(){return 9},dice:["blank","focus"],f:function(){activeunit.removetarget(targetunit)},str:"target",
token:!0},{from:Unit.DEFENSE_M,type:Unit.MOD_M,to:Unit.DEFENSE_M,org:this,req:function(){return this.canusefocus()}.bind(this),aiactivate:function(b,a){mm=getattackvalue();return 0<Unit.FE_focus(b)&&Unit.FCH_hit(mm)+Unit.FCH_crit(mm)>Unit.FE_evade(b)},f:function(b,a){this.removefocustoken();var c=Unit.FE_focus(b);0<c&&(b=b-Unit.FE_FOCUS*c+Unit.FE_EVADE*c);return b}.bind(this),str:"focus",token:!0},{from:Unit.DEFENSE_M,type:Unit.ADD_M,to:Unit.DEFENSE_M,org:this,req:function(){return this.canuseevade()}.bind(this),
aiactivate:function(b,a){mm=getattackvalue();return Unit.FCH_hit(mm)+Unit.FCH_crit(mm)>Unit.FE_evade(b)},f:function(b,a){this.removeevadetoken();return{m:b+Unit.FE_EVADE,n:a+1}}.bind(this),str:"evade",token:!0,noreroll:"focus"},{from:Unit.DEFENSE_M,type:Unit.ADD_M,to:Unit.DEFENSE_M,org:this,req:function(){return this.canusereinforce()}.bind(this),aiactivate:function(b,a){mm=getattackvalue();return Unit.FCH_hit(mm)+Unit.FCH_crit(mm)>Unit.FE_evade(b)},f:function(b,a){return{m:b+Unit.FE_EVADE,n:a+1}}.bind(this),
str:"reinforce",token:!0,noreroll:"focus"}]},adddicemodifier:function(b,a,c,e,f){f.org=e;f.type=a;f.from=b;f.to=c;this.wrap_after("getdicemodifiers",e,function(a){return a.concat(f)})},setclickhandler:function(b){this.g.unmousedown();this.g.mousedown(b)},setdefaultclickhandler:function(){this.g.unmousedown();this.g.mousedown(function(){this.select()}.bind(this))},dragshow:function(){this.g.transform(this.dragMatrix);this.geffect.transform(this.dragMatrix)},dragmove:function(b,a,c,e){c=VIEWPORT.m.split();
e=Math.max(GW/$("#svgout").width(),GH/$("#svgout").height());b=b*e/c.scalex;a=a*e/c.scalex;this.dragMatrix=MT(b,a).add(this.m);this.dx=b;this.dy=a;this.dragged=!0;$(".phasepanel").hide();this.dragshow()},dragstart:function(b,a,c){this.showhitsector(!1);this.dragMatrix=this.m;this.dragged=!1},dragstop:function(b){this.dragged&&(this.m=this.dragMatrix,this.showpanel(),this.tx+=this.dx,this.ty+=this.dy);this.dragged=!1},isinzone:function(b){b=this.getOutlinePoints(b);var a;a=2>=this.team?SETUP["playzone"+
this.team]:SETUP.playzone1;return Snap.path.isPointInside(a,b[0].x,b[0].y)&&Snap.path.isPointInside(a,b[1].x,b[1].y)&&Snap.path.isPointInside(a,b[2].x,b[2].y)&&Snap.path.isPointInside(a,b[3].x,b[3].y)?!0:!1},getOutlinePoints:function(b){var a=this.islarge?40:20;"undefined"==typeof b&&(b=this.m);return[{x:b.x(-a,-a),y:b.y(-a,-a)},{x:b.x(a,-a),y:b.y(a,-a)},{x:b.x(a,a),y:b.y(a,a)},{x:b.x(-a,a),y:b.y(-a,a)}]},getOutlineString:function(b){b=this.getOutlinePoints(b);return{s:"M "+b[0].x+" "+b[0].y+" L "+
b[1].x+" "+b[1].y+" "+b[2].x+" "+b[2].y+" "+b[3].x+" "+b[3].y+" Z",p:b}},getOutline:function(b){var a=this.islarge?40:20,c=s.rect(-a,-a,2*a,2*a),a=s.text(a+8,3-a,"8").attr({"class":"symbols",fontSize:"1.3em"});return s.g(a,c).transform(b).attr({fill:this.color,opacity:.3,display:"none"})},getSectorPoints:function(b,a){var c=this.islarge?40:20;if(this.hasmobilearc)return this.getQuarterSectorPoints(b,a);var e=Math.sqrt((c-3)*(c-3)+c*c);return $.map([{x:-(e+100*b)/e*(c-3),y:-(e+100*b)/e*c},{x:-c+3,
y:-c-100*b},{x:c-3,y:-c-100*b},{x:(e+100*b)/e*(c-3),y:-(e+100*b)/e*c}],function(b,c){return transformPoint(a,b)})},getQuarterSectorPoints:function(b,a){var c=this.islarge?40:20,e=Math.sqrt(2),f=e*c;return $.map([{x:-(f+100*b)/e,y:-(f+100*b)/e},{x:-c,y:-c-100*b},{x:c,y:-c-100*b},{x:(f+100*b)/e,y:-(f+100*b)/e}],function(b,c){return transformPoint(a,b)})},getRangePoints:function(b,a){var c=this.islarge?40:20;return $.map([{x:-c,y:-100*b-c},{x:c,y:-100*b-c},{x:100*b+c,y:-c},{x:100*b+c,y:c},{x:c,y:100*
b+c},{x:-c,y:100*b+c},{x:-100*b-c,y:c},{x:-100*b-c,y:-c}],function(b,c){return transformPoint(a,b)})},getHalfRangePoints:function(b,a){var c=this.islarge?40:20;return $.map([{x:100*b+c,y:0},{x:100*b+c,y:-c},{x:c,y:-100*b-c},{x:-c,y:-100*b-c},{x:-100*b-c,y:-c},{x:-100*b-c,y:0}],function(b,c){return transformPoint(a,b)})},getRangeString:function(b,a){var c=" A "+100*b+" "+100*b+" 0 0 1 ",e=this.getRangePoints(b,a);return"M "+e[1].x+" "+e[1].y+c+e[2].x+" "+e[2].y+" L "+e[3].x+" "+e[3].y+c+e[4].x+" "+
e[4].y+" L "+e[5].x+" "+e[5].y+c+e[6].x+" "+e[6].y+" L "+e[7].x+" "+e[7].y+c+e[0].x+" "+e[0].y+" Z"},getHalfRangeString:function(b,a){var c=" A "+100*b+" "+100*b+" 0 0 0 ",e=this.getHalfRangePoints(b,a);return"M "+e[0].x+" "+e[0].y+" L "+e[1].x+" "+e[1].y+c+e[2].x+" "+e[2].y+" L "+e[3].x+" "+e[3].y+c+e[4].x+" "+e[4].y+" L "+e[5].x+" "+e[5].y+" Z"},getSubRangeString:function(b,a,c){var e=" A "+100*b+" "+100*b+" 0 0 1 ";b=this.getRangePoints(b,c);var f="M "+b[0].x+" "+b[0].y+" L "+b[1].x+" "+b[1].y+
e+b[2].x+" "+b[2].y+" L "+b[3].x+" "+b[3].y+e+b[4].x+" "+b[4].y+" L "+b[5].x+" "+b[5].y+e+b[6].x+" "+b[6].y+" L "+b[7].x+" "+b[7].y+e+b[0].x+" "+b[0].y,e=" A "+100*a+" "+100*a+" 0 0 0 ";b=this.getRangePoints(a,c);return f+=" L "+b[0].x+" "+b[0].y+e+b[7].x+" "+b[7].y+" L "+b[6].x+" "+b[6].y+e+b[5].x+" "+b[5].y+" L "+b[4].x+" "+b[4].y+e+b[3].x+" "+b[3].y+" L "+b[2].x+" "+b[2].y+e+b[1].x+" "+b[1].y+" L "+b[0].x+" "+b[0].y},getHalfSubRangeString:function(b,a,c){var e=" A "+100*b+" "+100*b+" 0 0 0 ";b=
this.getHalfRangePoints(b,c);var f="M "+b[0].x+" "+b[0].y+" L "+b[1].x+" "+b[1].y+e+b[2].x+" "+b[2].y+" L "+b[3].x+" "+b[3].y+e+b[4].x+" "+b[4].y+" L "+b[5].x+" "+b[5].y,e=" A "+100*a+" "+100*a+" 0 0 1 ";b=this.getHalfRangePoints(a,c);return f+=" L "+b[5].x+" "+b[5].y+" L "+b[4].x+" "+b[4].y+e+b[3].x+" "+b[3].y+" L "+b[2].x+" "+b[2].y+e+b[1].x+" "+b[1].y+" L "+b[0].x+" "+b[0].y+" Z"},getPrimarySectorString:function(b,a){var c;c=this.getSectorPoints(b,a);var e=" A "+100*b+" "+100*b+" 0 0 1 ",f=transformPoint(a,
{x:0,y:0});return"M "+f.x+" "+f.y+" L "+c[0].x+" "+c[0].y+e+c[1].x+" "+c[1].y+" L "+c[2].x+" "+c[2].y+e+c[3].x+" "+c[3].y+" Z"},getPrimarySubSectorString:function(b,a,c){var e=" A "+100*b+" "+100*b+" 0 0 1 ";b=this.getSectorPoints(b,c);var f="M "+b[0].x+" "+b[0].y+e+b[1].x+" "+b[1].y+" L "+b[2].x+" "+b[2].y+e+b[3].x+" "+b[3].y;b=this.getSectorPoints(a,c);e=" A "+100*a+" "+100*a+" 0 0 0 ";return f+="L "+b[3].x+" "+b[3].y+e+b[2].x+" "+b[2].y+" L "+b[1].x+" "+b[1].y+e+b[0].x+" "+b[0].y+" Z"},setmaneuver:function(b){this.lastmaneuver=
this.maneuver;this.maneuver=b;this.showdial();this.showmaneuver();"undefined"==typeof this.deferred&&this.error("undefined deferred");nextplanning()},select:function(){if(this.dead||this.isdocked)return activeunit;if(phase<ACTIVATION_PHASE||phase==ACTIVATION_PHASE||phase==COMBAT_PHASE){var b=activeunit;phase==COMBAT_PHASE&&(attackunit=b);activeunit=this;b!=this&&b.unselect();$("#"+this.id).addClass("selected");this.show();center(this)}return activeunit},unselect:function(){this.showoutline();this.showmaneuver();
$(".team div").removeClass("selected")},getmcollisions:function(b){var a,c,e=[];a=this.getOutlineString(b);b=a.s;c=a.p;for(a=0;a<OBSTACLES.length;a++)if(OBSTACLES[a].type!=NONE){var f=OBSTACLES[a].getOutlineString();if(OBSTACLES[a].type==Unit.BOMB&&(0<Snap.path.intersection(f.s,b).length||this.isPointInside(f.s,c)||this.isPointInside(b,f.p))){e.push(a);break}}return e},getBall:function(b){return{x:b.x(0,0),y:b.y(0,0),diam:this.islarge?56:28}},guessevades:function(b,a){var c=function(c){c==Unit.FE_evade(b.roll)&&
(this.log("guessed correctly ! +1 %EVADE% [%0]",self.name),b.roll+=Unit.FE_EVADE,b.dice+=1);$("#actiondial").empty();a.resolve(b)}.bind(this);this.log("guess the number of evades out of %0 dice [%1]",b.dice,self.name);$("#actiondial").empty();for(var e=0;e<=b.dice;e++)(function(a){var b=$("<button>").html(a+" <code class='xevadetoken'></code>").on("touch click",function(){c(a)}.bind(this));$("#actiondial").append(b)}).call(this,e)},guessmove:function(b){var a=b.getdial(),c;for(c in a)(function(a){var c=
d.move.substr(-1),c=$("<button>").html("<span class='symbols maneuver>"+P[d.move].key+"</span>"+c).on("touch click",function(){a==b&&console.log(">> guess correctly!")}.bind(this));$("#actiondial").append(c)}).call(this,c)},fastgetocollisions:function(b,a,c,e){var f,h=[],l=this.getBall(a);if("undefined"==typeof c&&(f=b.invert(),c=a.x(0,0),e=a.y(0,0),a=f.x(c,e),f=f.y(c,e),c=s.path("M 0 0 L "+a+" "+f).appendTo(VIEWPORT).attr({display:"none"}),e=c.getTotalLength(),0==e))return!1;for(a=f=0;f<=e;f+=e/
5,a++){var t=c.getPointAtLength(f);h[a]={x:b.x(t.x,t.y),y:b.y(t.x,t.y)}}for(a=0;a<OBSTACLES.length;a++)if(OBSTACLES[a].type!=Unit.BOMB&&OBSTACLES[a].type!=Unit.NONE){b=OBSTACLES[a].getBall();f=b.diam+l.diam;c=f*f;if((b.x-l.x)*(b.x-l.x)+(b.y-l.y)*(b.y-l.y)<c)return!0;for(f=0;f<h.length;f++)if((b.x-h[f].x)*(b.x-h[f].x)+(b.y-h[f].y)*(b.y-h[f].y)<c)return!0}return!1},getocollisions:function(b,a,c,e){var f,h,l=[],t={overlap:-1,template:[],mine:[]},x=this.getOutlineString(b).s;f=this.getOutlineString(a);
a=f.s;h=f.p;for(f=0;f<OBSTACLES.length;f++){var q=OBSTACLES[f];if(q.type!=NONE){var m=q.getOutlineString();(0<Snap.path.intersection(m.s,a).length||this.isPointInside(m.s,h)||this.isPointInside(a,m.p))&&this.oldoverlap!=f&&(q.type!=Unit.BOMB?t.overlap=f:t.mine.push(q))}}if("undefined"!=typeof c){for(f=h=0;h<=e;h+=5,f++)q=c.getPointAtLength(h),l[f]={x:b.x(q.x,q.y),y:b.y(q.x,q.y)};for(b=0;b<l.length;b++)if(!this.isPointInside(x,[l[b]])&&!this.isPointInside(a,[l[b]]))for(f=0;f<OBSTACLES.length;f++)if(q=
OBSTACLES[f],q.type!=NONE&&f!=t.overlap&&-1==t.template.indexOf(f)&&-1==t.mine.indexOf(q))for(c=q.getOutlineString().p,h=0;h<c.length;h++)if(e=c[h].x-l[b].x,m=c[h].y-l[b].y,100>=e*e+m*m){q.type!=Unit.BOMB?t.template.push(f):t.mine.push(OBSTACLES[f]);break}}return t},iscollidingunit:function(b,a){var c=this.getOutlineString(b).s,e=a.getOutlineString(a.m).s,f=0<Snap.path.intersection(c,e).length;this.islarge&&(f=f||this.isinoutline(c,a,a.m));a.islarge&&(f=f||a.isinoutline(e,this,b));return f},getcollidingunits:function(b){var a,
c=[];for(a in squadron){var e=squadron[a];e!=this&&this.iscollidingunit(b,e)&&c.push(e)}return c},getpathmatrix:function(b,a,c){"undefined"==typeof P[a]&&console.log("***Undefined maneuver "+a);var e=P[a].path,f=e.getTotalLength();this.islarge&&(f+=40);b=b.clone();a.match(/RF1|RF5|RR1|RL1/)&&(b=b.rotate(180,0,0));f=this.getmatrixwithmove(b,e,f);(a.match(/K\d|SR\d|SL\d/)||1==c)&&f.rotate(180,0,0);a.match(/TRL\d/)&&f.rotate(-90,0,0);a.match(/TRR\d/)&&f.rotate(90,0,0);a.match(/RF1|RF5|RR1|RL1/)&&f.rotate(180,
0,0);e.remove();return f},getmovecolor:function(b,a,c,e,f,h){var l,t=!1;if(!this.isinzone(b))return RED;c&&(c=this.ocollision,this.ocollision=this.getocollisions(this.m,b,e,f),this.hascollidedobstacle()&&(t=!0),this.ocollision=c);if(t)return YELLOW;if(a)for(l in a=this.getOutlineString(b),this.getskill(),squadron)if(e=squadron[l],e!=this&&(b=h?e.futurem:e.m,b=e.getOutlineString(b),0<Snap.path.intersection(b.s,a.s).length||this.islarge&&!e.islarge&&this.isPointInside(a.s,b.p)||!this.islarge&&e.islarge&&
this.isPointInside(b.s,a.p)))return WHITE;return GREEN},isTurret:function(b){return"Turretlaser"==b.type},candoactivation:function(){return-1!=this.maneuver},candoroll:function(){for(var b=this.getrollmatrix(this.m),a=!1,c=this.canmoveonobstacles("ROLL"),e=0;e<b.length;e++)var f=this.getmovecolor(b[e],!0,!0),a=a||f==GREEN||f==YELLOW&&c;return a},candoboost:function(){for(var b=this.getboostmatrix(this.m),a=!1,c=this.canmoveonobstacles("BOOST"),e=0;e<b.length;e++)var f=this.getmovecolor(b[e],!0,!0),
a=a||f==GREEN||f==YELLOW&&c;return a},candocoordinate:function(){return 0<this.selectnearbyally(2).length},candoreload:function(){return!0},candoreinforce:function(){return!0},newaction:function(b,a){return{action:b,org:this,type:a,name:a}},getactionbarlist:function(b){var a,c=[];for(a=0;a<this.shipactionList.length;a++){var e=this.shipactionList[a];if(!this.isactiondone(e))switch(e){case "CLOAK":this.candocloak()&&c.push(this.newaction(this.addcloak,"CLOAK"));break;case "FOCUS":this.candofocus()&&
c.push(this.newaction(this.addfocus,"FOCUS"));break;case "EVADE":this.candoevade()&&c.push(this.newaction(this.addevade,"EVADE"));break;case "TARGET":this.candotarget()&&c.push(this.newaction(this.resolvetarget,"TARGET"));break;case "ARCROTATE":this.candoarcrotate()&&c.push(this.newaction(this.resolvearcrotate,"ARCROTATE"));break;case "BOOST":this.candoboost()&&c.push(this.newaction(this.resolveboost,"BOOST"));break;case "ROLL":this.candoroll()&&c.push(this.newaction(this.resolveroll,"ROLL"));break;
case "SLAM":b&&c.push(this.newaction(this.resolveslam,"SLAM"));break;case "COORDINATE":this.candocoordinate()&&c.push(this.newaction(this.resolvecoordinate,"COORDINATE"));break;case "RELOAD":this.candoreload()&&c.push(this.newaction(this.resolvereload,"RELOAD"));break;case "REINFORCE":this.candoreinforce()&&c.push(this.newaction(this.addreinforce,"REINFORCE"))}}return c},getupgactionlist:function(){var b,a=[];for(b=0;b<this.upgrades.length;b++){var c=this.upgrades[b];!this.isactiondone(c.name)&&c.isactive&&
"function"==typeof c.action&&c.candoaction()&&a.push({org:c,action:c.action,type:c.type.toUpperCase(),name:c.name});!this.isactiondone(c.name+"/2")&&c.isactive&&"function"==typeof c.action2&&c.candoaction2()&&a.push({org:c,action:c.action2,type:c.type.toUpperCase(),name:c.name+"/2"})}return a},getcritactionlist:function(){var b,a=[];for(b=0;b<this.criticals.length;b++){var c=this.criticals[b];!this.isactiondone(c.name)&&c.isactive&&"function"==typeof c.action&&(c.type="CRITICAL",c.org=c,a.push(c))}return a},
getcondactionlist:function(){var b,a=[];for(b=0;b<this.conditions.length;b++){var c=this.conditions[b];!this.isactiondone(c.name)&&c.isactive&&"function"==typeof c.action&&c.candoaction()&&a.push({org:c,action:c.action,type:Unit.CONDITION.toUpperCase(),name:c.name})}return a},getactionlist:function(b){b=this.getactionbarlist(b);var a=this.getupgactionlist(),c=this.getcritactionlist(),e=this.getcondactionlist();return b.concat(a).concat(c).concat(e)},addevadetoken:function(){this.evade++;this.animateaddtoken("xevadetoken");
this.movelog("E");this.show()},addevade:function(b){this.addevadetoken();this.endaction(b,"EVADE")},addfocustoken:function(){this.focus++;this.animateaddtoken("xfocustoken");this.movelog("FO");this.show()},addreinforcetoken:function(){var b=function(a){this.reinforceaft=a;this.reinforce++;this.log("Adding reinforce token on "+(0==a?"fore":"aft")+" side");this.animateaddtoken("xreinforcetoken");this.movelog("E");$("#actiondial").empty();this.unlock()}.bind(this);$("#actiondial").empty();var a=$("<button>").html("Fore").on("touch click",
function(){b(0)}.bind(this));$("#actiondial").append(a);a=$("<button>").html("Aft").on("touch click",function(){b(1)}.bind(this));$("#actiondial").append(a);this.latedeferred=this.deferred;this.newlock().done(function(){this.deferred=this.latedeferred}.bind(this))},addtractorbeam:function(b){this.addtractorbeamtoken();if(1==this.tractorbeam&&!this.islarge){var a=this.m,c=Unit.prototype.getrollmatrix.call(this,this.m).concat(this.getpathmatrix(this.m,"F1"));b.doselection(function(e){b.resolveactionmove.call(this,
c,function(b,h){b.ocollision=b.getocollisions(a,c[h]);b.endnoaction(e,"BOOST")},!0,!0)}.bind(this))}},addtractorbeamtoken:function(){this.tractorbeam++;this.animateaddtoken("xtractorbeamtoken");this.movelog("TB");this.show()},removetractorbeamtoken:function(){this.tractorbeam--;this.animateremovetoken("xtractorbeamtoken");this.movelog("tb");this.show()},addfocus:function(b){this.addfocustoken();this.endaction(b,"FOCUS")},addstress:function(){this.stress++;this.animateaddtoken("xstresstoken");this.movelog("ST");
this.show()},addiontoken:function(){this.ionized++;this.animateaddtoken("xionizedtoken");this.movelog("I");this.show()},removeiontoken:function(){this.ionized--;this.animateremovetoken("xionizedtoken");this.movelog("i");this.show()},warndeath:function(b,a,c){},dies:function(){this.movelog("d-0");$("#"+this.id).attr("onclick","");$("#"+this.id).addClass("dead");$("#"+this.id).html(""+this);$("#"+this.id+" .outoverflow").each(function(a){"auto"!=$(this).css("top")&&$(this).css("top",$(this).parent().offset().top+
"px")});i=squadron.indexOf(this);for(i in squadron)squadron[i]==this?delete squadron[i]:squadron[i].team==this.team&&squadron[i].warndeath(this.hull,this.shield,this);filltabskill();for(i=0;i<this.targeting.length;i++){var b=this.targeting[i];n=b.istargeted.indexOf(this);-1<n&&b.istargeted.splice(n,1);b.show()}for(i=0;i<this.istargeted.length;i++)b=this.istargeted[i],n=b.targeting.indexOf(this),-1<n&&b.targeting.splice(n,1),b.show();this.targeting=[];this.g.attr({display:"none"});this.imgsmoke.attr("display",
"none");this.imgflame.attr("display","none");this.imgexplosion=this.islarge?s.image("png/explosion3.gif",-80,-80,160,160):s.image("png/explosion3.gif#"+Math.random(),-40,-40,80,80);this.geffect.add(this.imgexplosion);this.show();FAST||SOUNDS.explode.play();this.dead=!0;this==this.captain&&this.electcaptain();this.log("has exploded!");setTimeout(function(){this.geffect.attr({display:"none"});this.show();TEAMS[this.team].checkdead()&&win(this.team)}.bind(this),FAST?0:1E3)},canbedestroyed:function(){return skillturn!=
this.getskill()?!0:!1},checkdead:function(){if(!this.dead&&(0>=this.hull||!this.isinzone(this.m))){this.dies();var b=TEAMS[this.team].history.rawdata;"undefined"==typeof b[round]&&(b[round]={hits:0,dead:""});b[round].dead+=this.name+" ";return!0}return!1},cancelhit:function(b,a){var c=Unit.FCH_hit(b.ch);return c>=b.e?{ch:b.ch-b.e*Unit.FCH_HIT,e:0}:{ch:b.ch-c*Unit.FCH_HIT,e:b.e-c}},cancelcritical:function(b,a){var c=Unit.FCH_crit(b.ch);return c>=b.e?{ch:b.ch-b.e*Unit.FCH_CRIT,e:0}:{ch:b.ch-c*Unit.FCH_CRIT,
e:b.e-c}},attackrerolls:function(b,a){return 0},evadeattack:function(b){var a=getdefenseresult(),c=getattackresult();displayattackroll(getattackdice(),c);a=this.cancelhit({ch:c,e:a},b);a=this.cancelcritical(a,b);"undefined"==typeof a&&this.error("undefined cancel critical");return a.ch},declareattack:function(b,a){targetunit=a;this.activeweapon=b;if(this.weapons[b].declareattack(a))return this.log("attacks %0 with %1",a.name,this.weapons[b].name),a.isattackedby(b,this),!0;this.log("cannot attack %0 [%1]",
a.name,this.weapons[b].name);return!1},isattackedby:function(b,a){},endmodifydefensestep:function(){},endmodifyattackstep:function(){},modifydamageassigned:function(b,a){return b},modifydefenseroll:function(b,a,c){return a},modifyattackroll:function(b,a,c){return b},resolveishit:function(){},hashit:function(b){return 0<this.criticalresolved+this.hitresolved},resolvedamage:function(){$(".fireline").remove();FAST||this.playfiresnd();var b=targetunit.evadeattack(this),b=this.weapons[this.activeweapon].modifydamageassigned(b,
targetunit),b=targetunit.modifydamageassigned(b,this);TEAMS[this.team].allred+=getattackdice();TEAMS[targetunit.team].allgreen+=getdefensedice();TEAMS[this.team].allhits+=Unit.FCH_hit(b);TEAMS[this.team].allcrits+=Unit.FCH_crit(b);TEAMS[targetunit.team].allevade+=Unit.FE_evade(getdefenseresult());var a=Unit.FCH_crit(b),c=Unit.FCH_hit(b);this.hasdamaged=!0;this.hitresolved=c;this.criticalresolved=a;this.hashit(targetunit)&&(targetunit.resolveishit(this),this.weapons[this.activeweapon].prehit(targetunit,
a,c),this.hitresolved+this.criticalresolved<targetunit.shield?targetunit.log("-%0 %SHIELD%",this.criticalresolved+this.hitresolved):0<targetunit.shield&&targetunit.log("-%0 %SHIELD%",targetunit.shield),this.hitresolved=targetunit.resolvehit(this.hitresolved),this.criticalresolved=targetunit.resolvecritical(this.criticalresolved),this.weapons[this.activeweapon].posthit(targetunit,a,c));this.weapons[this.activeweapon].endattack(a,c);this.usedweapon=this.activeweapon;this.weapons[this.activeweapon].hasdoubleattack()?
(this.latedeferred=this.deferred,targetunit.canbedestroyed(skillturn)&&targetunit.checkdead(),targetunit.dead||this.newlock().done(function(){this.deferred=this.latedeferred;this.log("+1 attack with %0",this.weapons[this.activeweapon].name);this.resolveattack(this.activeweapon,targetunit)}.bind(this)),this.cleanupattack()):TEAMS[targetunit.team].initiative?(targetunit.afterdefenseeffect(a,c,this),barrier(function(){this.afterattackeffect(a,c);targetunit.canbedestroyed(skillturn)&&targetunit.checkdead();
targetunit.endbeingattacked(a,c,this);this.endattack(a,c,targetunit);this.cleanupattack()}.bind(this))):(this.afterattackeffect(a,c),barrier(function(){targetunit.afterdefenseeffect(a,c,this);targetunit.canbedestroyed(skillturn)&&targetunit.checkdead();this.endattack(a,c,targetunit);targetunit.endbeingattacked(a,c,this);this.cleanupattack()}.bind(this)))},afterattackeffect:function(b,a){},afterdefenseeffect:function(b,a){},postattack:function(b){},cleanupattack:function(){this.actionbarrier();ENGAGED=
!1},resetfocus:function(){return 0},resetevade:function(){return 0},resetreinforce:function(){return 0},resettractorbeam:function(){return 0},endround:function(){for(var b=0;b<this.upgrades.length;b++)this.upgrades[b].endround();this.focus=this.resetfocus();this.evade=this.resetevade();this.reinforce=this.resetreinforce();this.hasfired=0;this.maxfired=1;this.tractorbeam=this.resettractorbeam();this.oldoverlap=this.ocollision.overlap;this.ocollision.overlap=-1;this.ocollision.template=[];this.ocollision.mine=
[];this.collision=!1;this.touching=[];this.showinfo()},playfiresnd:function(){var b=targetunit.g.getBBox(),a=transformPoint(this.m,{x:0,y:-(this.islarge?40:20)}),c=s.path("M "+a.x+" "+a.y+" L "+(b.x+b.w/2)+" "+(b.y+b.h/2)).appendTo(VIEWPORT).attr({stroke:this.color,strokeWidth:2}),e=setInterval(function(){c.remove();clearInterval(e)},200);this.movelog("f-"+targetunit.id+"-"+this.activeweapon);"undefined"!=typeof this.weapons[this.activeweapon]&&"undefined"!=typeof this.weapons[this.activeweapon].firesnd?
SOUNDS[this.weapons[this.activeweapon].firesnd].play():SOUNDS[this.ship.firesnd].play()},endattack:function(b,a,c){for(i=0;i<DICES.length;i++)$("."+DICES[i]+"dice").remove();this.show()},endbeingattacked:function(b,a,c){},showpositions:function(b){var a,c=[];this.evaluatemoves(!0,!0);for(a=0;a<b.length;a++)c[a]=this.getOutline(b[a].m).attr({title:b[a].move,opacity:.4,fill:halftone(b[a].color),display:"block","class":"possible"}).appendTo(VIEWPORT),function(a){c[a].hover(function(){c[a].attr({stroke:b[a].color,
strokeWidth:4})}.bind(this),function(){c[a].attr({strokeWidth:0})}.bind(this))}.call(this,a)},showmeanposition:function(){this.getdial();this.evaluatemoves(!0,!0);this.showpositions([{color:GREEN,move:"mean",m:this.meanm}])},shownextpositions:function(){var b=this.getdial();this.evaluatemoves(!0,!0);var a=[];for(i=0;i<b.length;i++)a[i]=b[i].next;this.showpositions(a)},showpossiblepositions:function(){this.evaluatemoves(!0,!0);var b=this.getdial();this.showpositions(b)},electcaptain:function(){var b=
this,a,c,e,f=[];c="";e=this.selectnearbyunits(2,function(a,b){return a.team==b.team&&!a.dead&&!a.isdocked&&!a.islarge&&a.behavior!=ALONE&&a.getorientation()==b.getorientation()});for(a in e){var h=e[a];f.push(h);c+=h.name+" ";if(h.skill>b.skill||h.skill==b.skill&&h.id<b.id)b=h}if(1>=f.length)this.behavior=ALONE,this.captain=null;else{console.log("CAPTAIN ELECTED:"+b.name+"("+c+")");b.captain=b;b.squad=f;for(a in f)f[a].captain=b,f[a].squad=f;f.sort(function(a,b){var c;for(c=1;3>=c;c++){if(a.isinsector(a.m,
c,b,this.getHalfSubRangeString,this.getHalfRangeString))return-1;if(b.isinsector(b.m,c,a,this.getHalfSubRangeString,this.getHalfRangeString))return 1}for(c=1;3>=c;c++){if(a.isinsector(a.m.clone().rotate(90,0,0),c,b,this.getHalfSubRangeString,this.getHalfRangeString))return-1;if(b.isinsector(b.m.clone().rotate(90,0,0),c,a,this.getHalfSubRangeString,this.getHalfRangeString))return 1}return 0}.bind(this));u=f[0];for(a=1;a<f.length&&(c=!1,c|=f[a].isinsector(f[a].m,1,u,this.getHalfSubRangeString,this.getHalfRangeString),
c|=f[a].isinsector(f[a].m,2,u,this.getHalfSubRangeString,this.getHalfRangeString),c);a++);b.firstrow=a;h=[];b.captaingd=[];e=f.length;for(c=0;c<f.length;c++){var l=f[c].getdial();for(a=0;a<l.length;a++)"undefined"==typeof h[l[a].move]&&(h[l[a].move]=[]),h[l[a].move].push(a)}l=f=c=0;for(a in h)h[a].length==e&&("BL1"==a&&f++,"BL2"==a&&(f+=2),"BL3"==a&&(f+=3),"TL1"==a&&l++,"TL3"==a&&(l+=3),b.captaingd[c++]={move:a,idx:h[a],color:GREEN})}},showgrouppositions:function(){"undefined"==typeof this.captain&&
this.electcaptain();this.captain.evaluategroupmoves();this.showpositions(this.captain.captaingd)},evaluateposition:function(){var b=0,a=0,c=0,e,f,h=0,l=0;NOLOG=!0;for(f in squadron){var t=squadron[f];if(this.isenemy(t)){var x=0;for(e=0;e<t.weapons.length;e++){var q=t.weapons[e].getrange(this);0<q&&4>q&&(x=Math.max(x,t.getattackstrength(e,this)))}b+=x;for(e=0;e<this.weapons.length;e++)q=this.weapons[e].getrange(t),0<q&&4>q&&(a=Math.max(a,this.getattackstrength(e,t)));h+=Math.sqrt(this.getdist(this.m,
t)/1E4);c++;0<x&&l++}}NOLOG=!1;return{self:a,enemy:b,dist:h/c}},evaluategroupmoves:function(){var b=[GREEN,WHITE,YELLOW,RED,BLACK],a=["GREEN","WHITE","RED"],c,e,f,h,l,t=this.captaingd,x={"#000":0,"#F00":1,"#FF0":2,"#FFF":3,"#0F0":4},q=this.squad.length;for(c=0;c<q;c++)this.squad[c].evaluatemoves(!0,!0);for(e=0;e<t.length;e++)t[e].m=this.getpathmatrix(this.m,t[e].move);for(c=0;c<t.length;c++){f=t[c].idx;var m=l=0;for(e=0;e<f.length;e++){h=this.squad[e].getdial()[f[e]].color;var r=this.squad[e].getdial()[f[e]].difficulty;
b.indexOf(h)>l&&(l=b.indexOf(h));a.indexOf(r)>m&&(m=a.indexOf(r))}t[c].color=b[l];t[c].difficulty=a[m]}NOLOG=!0;for(c=0;c<t.length;c++)t[c].path=P[t[c].move].path,t[c].len=t[c].path.getTotalLength()+(this.islarge?40:0);for(c=0;c<t.length;c++){a=[];f=t[c];f.color=GREEN;for(b=0;b<q;b++)if(e=this.squad[b],a[b]=e.getpathmatrix(e.m,f.move),!e.canreveal(f)){f.color=BLACK;break}if(f.color!=BLACK){for(b=0;b<q;b++)e=this.squad[b],l=e.getmovecolor(a[b],!0,!0,f.path,f.len,!0),x[f.color]>x[l]&&(f.color=l);if(f.color!=
RED&&f.color!=BLACK){h=RED;for(e=0;e<t.length;e++)if("F0"!=t[e].move&&("RED"!=t[e].difficulty||"RED"!=t[c].difficulty)){m=[];for(b=0;b<q;b++)m[b]=this.squad[b].getmatrixwithmove(a[b],t[e].path,t[e].len);for(b=0;b<q&&this.squad[b].isinzone(m[b]);b++);if(!(b<q)){l=GREEN;for(b=0;b<q;b++)if(this.squad[b].fastgetocollisions(a[b],m[b],t[e].path,t[e].len)){l=YELLOW;break}x[l]>x[h]&&(h=l);if(h==GREEN)break}}x[h]<x[f.color]&&(f.color=h)}}}},getorientation:function(){return(this.m.split().rotate+360+180)%360-
180},evaluatemoves:function(b,a){this.meanmround=round;var c=this.getdial(),e=0,f=0,h=0,l=0,t,x=RED,q={"#000":0,"#F00":1,"#FF0":2,"#FFF":3,"#0F0":4};NOLOG=!0;var m=this.getorientation();for(t=0;t<c.length;t++)c[t].path=P[c[t].move].path,c[t].len=c[t].path.getTotalLength()+(this.islarge?40:0);for(t=0;t<c.length;t++){var r=this.getpathmatrix(this.m,c[t].move);c[t].m=r;if(this.canreveal(c[t])){var y=this.getmovecolor(r,b,a,c[t].path,c[t].len,!0);c[t].color=y;if(y!=RED&&y!=BLACK&&b&&a){for(var B=RED,
z=this.ocollision,E=0;E<c.length;E++){var G;if("F0"!=c[E].move&&("RED"!=c[E].difficulty||(this.hasnostresseffect()||"GREEN"==c[t].difficulty)&&"RED"!=c[t].difficulty)){var I=this.getmatrixwithmove(r,c[E].path,c[E].len);G=GREEN;this.isinzone(I)?a&&(this.fastgetocollisions(r,I,c[E].path,c[E].len)?this.ocollision.overlap=1:this.ocollision.overlap=-1,this.hascollidedobstacle()&&(G=YELLOW)):G=RED;q[G]>q[B]&&(B=G)}}this.ocollision=z;q[B]<q[y]&&(c[t].color=B)}}else c[t].color=BLACK;q[x]>q[c[t].color]&&(x=
c[t].color);c[t].color!=GREEN&&c[t].color!=WHITE||c[t].move.match(/K\d|SR\d|SL\d|TRL\d|TRR\d/)||(r=r.split(),l++,r.rotate=(r.rotate-m+180)%360-180,e+=r.dx,f+=r.dy,h+=r.rotate)}for(t=0;t<c.length;t++)"F0"==c[t].move&&(c[t].color=x);0==l&&(l=1);e/=l;f/=l;h/=l;this.meanm=(new Snap.Matrix).translate(e,f).rotate(h+m,0,0);NOLOG=!1},removetarget:function(b){var a;a=b.istargeted.indexOf(this);-1<a&&b.istargeted.splice(a,1);a=this.targeting.indexOf(b);-1<a&&(this.targeting.splice(a,1),this.movelog("t-"+b.id),
b.show(),this.show());0==this.targeting.length&&$("#atokens > .xtargettoken").remove()},removeevadetoken:function(){this.animateremovetoken("xevadetoken");this.evade--;this.movelog("e");this.show()},removereinforcetoken:function(){this.animateremovetoken("xreinforcetoken");this.reinforce--;this.movelog("i");this.show()},removefocustoken:function(){this.animateremovetoken("xfocustoken");this.focus--;this.movelog("fo");this.show()},resolveactionmove:function(b,a,c,e){var f;this.pos=[];var h=function(a,
b,h){for(f=0;f<this.pos.length;f++)this.pos[f].ol.remove();if(c){var q=a.split(),l=this.m.split();s.path("M "+l.dx+" "+l.dy+" L "+q.dx+" "+q.dy).attr({stroke:this.color,display:TRACE?"block":"none",strokeWidth:"20px",strokeLinecap:"round",strokeDasharray:"1, 30",opacity:.2,fill:"rgba(0,0,0,0)"}).addClass("trace").appendTo(VIEWPORT);this.m=a}q=this.getmcollisions(this.m);if(0<q.length)for(f=0;f<q.length;f++)l=OBSTACLES[q[f]],l.type==Unit.BOMB&&"function"==typeof l.detonate?l.detonate(this,!1):(this.ocollision.overlap=
f,this.log("colliding with obstacle"),e||this.resolveocollision(1,[]));else this.ocollision.overlap=-1;c&&(q=a.split(),this.movelog("am-"+Math.floor(300+q.dx)+"-"+Math.floor(300+q.dy)+"-"+Math.floor((360+Math.floor(q.rotate))%360)));h(this,b);this.show()}.bind(this);for(f=b.length-1;0<=f;f--){var l=this.getmovecolor(b[f],!0,!0);if(e&&(l==YELLOW||l==RED)||l==GREEN||e&&!c)p=this.getOutline(b[f]).attr({display:"block"}).appendTo(VIEWPORT),this.pos.push({ol:p,k:f})}if(0<this.pos.length)if(1==this.pos.length)h(b[this.pos[0].k],
this.pos[0].k,a);else for(f=0;f<this.pos.length;f++)(function(c){var e=this.pos[c];e.ol.hover(function(){this.pos[c].ol.attr({stroke:this.color,strokeWidth:4})}.bind(this),function(){this.pos[c].ol.attr({strokeWidth:0})}.bind(this));e.ol.click(function(){h(b[this.pos[c].k],this.pos[c].k,a)}.bind(this));e.ol.touchend(function(){h(b[this.pos[c].k],this.pos[c].k,a)}.bind(this))}).call(this,f);else h(this.m,-1,a)},resolveactionselection:function(b,a){var c;this.pos=[];var e=function(e){for(c=0;c<b.length;c++)b[c].outline.removeClass("outline"),
b[c].outline.attr({fill:"rgba(8,8,8,0.5)"}),b[c].setdefaultclickhandler();a(e)}.bind(this);if(0==b.length)e(-1);else if(1==b.length)e(0);else for(c=0;c<b.length;c++)b[c].outline.attr({fill:"rgba(100,100,100,0.8)"}),b[c].outline.addClass("outline"),function(a){b[a].setclickhandler(function(){e(a)})}(c)},getboostmatrix:function(b){return[this.getpathmatrix(b,"F1"),this.getpathmatrix(b,"BL1"),this.getpathmatrix(b,"BR1")]},resolveboost:function(b){this.resolveactionmove(this.getboostmatrix(this.m),function(a,
c){a.endaction(b,"BOOST")},!0,this.canmoveonobstacles("BOOST"))},resolvecoordinate:function(b){var a=this,c=this.selectnearbyally(2);0<c.length&&this.resolveactionselection(c,function(e){c[e].select();c[e].doaction(c[e].getactionlist(),"+1 free action").done(function(){return a.select()});a.endaction(b,"COORDINATE")})},resolvereload:function(b){for(var a=0;a<this.upgrades.length;a++)this.upgrades[a].type.match(/Torpedo|Missile/)&&(this.upgrades[a].isactive=!0);this.noattack=round;this.showstats();
this.endaction(b,"RELOAD")},addreinforce:function(b){this.addreinforcetoken();this.endaction(b,"REINFORCE")},candoarcrotate:function(){return this.hasmobilearc},setarcrotate:function(b){this.arcrotation=90*b},resolvearcrotate:function(b,a){for(var c=this.weapons[0].auxiliary,e=[],f=["front","right side","back","left side"],h=this,l=0;4>l;l++)e[l]=s.path(c.call(this,1,this.m.clone().rotate(90*l-this.arcrotation,0,0))).attr({fill:this.color,stroke:this.color,opacity:.1}).appendTo(VIEWPORT);for(l=0;4>
l;l++)(function(c){e[c].hover(function(){e[c].attr({opacity:.4})},function(){e[c].attr({opacity:.1})});e[c].click(function(){h.setarcrotate(c);h.movelog("R-"+c);h.log("Moving firing arc rotated to the %0",f[c]);for(var l=0;4>l;l++)e[l].attr({display:"none"});1==a?h.endnoaction(b,"ARCMOBILE"):h.endaction(b,"ARCMOBILE")})})(l)},canmoveonobstacles:function(b){return!1},getdecloakmatrix:function(b){var a=this.getpathmatrix(b.clone().rotate(90,0,0),"F2").translate(0,this.islarge?20:0).rotate(-90,0,0),
c=this.getpathmatrix(b.clone().rotate(-90,0,0),"F2").translate(0,this.islarge?20:0).rotate(90,0,0);return[b.clone(),a.clone().translate(0,-20),a,a.clone().translate(0,20),c.clone().translate(0,-20),c,c.clone().translate(0,20),this.getpathmatrix(b.clone(),"F2")]},removecloaktoken:function(){this.agility-=2;this.iscloaked=!1;this.animateremovetoken("xcloaktoken");this.movelog("ct");FAST||SOUNDS.decloak.play()},resolvedecloak:function(b){var a="(or self to cancel)";1==b&&(a="(or self)");this.log("select position to decloak "+
a);this.doselection(function(a){this.resolveactionmove(this.getdecloakmatrix(this.m),function(c,f){(0<f||1==b)&&this.removecloaktoken();this.hasdecloaked=!0;this.endnoaction(a,"DECLOAK")}.bind(this),!0,this.canmoveonobstacles("DECLOAK"))}.bind(this));return!0},gettallonrollmatrix:function(b,a){var c=this.getpathmatrix(b,a);return[c.clone().translate(0,-20),c,c.clone().translate(0,20)]},getrollmatrix:function(b){var a=this.getpathmatrix(b.clone().rotate(90,0,0),"F1").translate(0,this.islarge?20:0).rotate(-90,
0,0);b=this.getpathmatrix(b.clone().rotate(-90,0,0),"F1").translate(0,this.islarge?20:0).rotate(90,0,0);p=[a.clone().translate(0,-20),a,a.clone().translate(0,20),b.clone().translate(0,-20),b,b.clone().translate(0,20)];this.islarge&&(p=p.concat([a.clone().translate(0,-40),a.clone().translate(0,40),b.clone().translate(0,-40),b.clone().translate(0,40)]));return p},resolveroll:function(b){this.resolveactionmove(this.getrollmatrix(this.m),function(a,c){a.endaction(b,"ROLL")},!0,this.canmoveonobstacles("ROLL"))},
boundtargets:function(b){if(-1<this.targeting.indexOf(b))return!0;for(b=this.targeting.length-1;0<=b;b--)this.removetarget(this.targeting[b]);return!1},addtarget:function(b){this.boundtargets(b)||(this.targeting.push(b),this.animateaddtoken("xtargettoken"),b.istargeted.push(this),b.animateaddtoken("xtargetedtoken"),this.movelog("T-"+b.id),b.show(),this.show())},gettargetableunits:function(b){return this.selectnearbyenemy(b)},selectnearbyunits:function(b,a){var c=[];"undefined"==typeof a&&(a=function(){return!0});
for(var e in squadron)!squadron[e].isdocked&&a(this,squadron[e])&&this.getrange(squadron[e])<=b&&c.push(squadron[e]);return c},selectnearbyobstacle:function(b){var a=[],c=9E4;1==b?c=1E4:2==b&&(c=4E4);for(b=0;b<OBSTACLES.length;b++){var e=OBSTACLES[b];(e.type==DEBRIS||e.type==ROCK)&&this.getdist(this.m,e)<=c&&a.push(e)}return a},selectnearbyally:function(b,a){return this.selectnearbyunits(b,function(b,e){var c=!0;"function"==typeof a&&(c=a(b,e));return b.isally(e)&&b!=e&&c})},selectnearbyenemy:function(b,
a){return this.selectnearbyunits(b,function(b,e){var c=!0;"function"==typeof a&&(c=a(b,e));return b.isenemy(e)&&c})},isally:function(b){return b.team==this.team},isenemy:function(b){return b.team!=this.team},resolvetargetnoaction:function(b,a){var c=this.gettargetableunits(3);this.resolveactionselection(c,function(e){0<=e&&this.addtarget(c[e]);1==a?this.endnoaction(b,"TARGET"):this.endaction(b,"TARGET")}.bind(this))},resolvetarget:function(b){this.resolvetargetnoaction(b,!1)},addcloaktoken:function(){this.iscloaked=
!0;this.agility+=2;this.animateaddtoken("xcloaktoken");this.movelog("CT");FAST||SOUNDS.cloak.play()},addcloak:function(b){this.addcloaktoken();this.endaction(b,"CLOAK")},resolveslam:function(b){var a=this.getdial();a.length<=this.lastmaneuver&&(this.lastmaneuver=0);for(var c=a[this.lastmaneuver].move.substr(-1),e=[],f=[],h=0;h<a.length;h++)a[h].move.substr(-1)==c&&(e.push(this.getpathmatrix(this.m,a[h].move)),f.push(h));this.log("select maneuver for SLAM");this.noattack=round;this.wrap_after("getdial",
this,function(a){for(var b=[],c=0;c<a.length;c++)b[c]={move:a[c].move,difficulty:"WHITE"};return b}).unwrapper("endmaneuver");this.wrap_after("endmaneuver",this,function(){this.endaction(b,"SLAM")}).unwrapper("endactivationphase");this.wrap_after("candoendmaneuveraction",this,function(){return!1}).unwrapper("endphase");this.resolveactionmove(e,function(a,b){this.maneuver=f[b];this.resolvemaneuver()}.bind(this),!1,!0)},enqueueaction:function(b,a){actionr.push($.Deferred());var c=actionr.length-1;"undefined"==
typeof a&&(a="undefined");actionr[c].name=a;0==c?b(c):actionr[c-1].done(function(){b(c)}.bind(this));return actionr[c]},endnoaction:function(b,a){actionr[b].resolve(a);b==actionr.length-1&&actionrlock.resolve();this.show()},endaction:function(b,a){phase==ACTIVATION_PHASE&&$("#activationdial").show();this.clearaction();this.endnoaction(b,a)},resolveaction:function(b,a){$("#actiondial").empty();null==b?this.endaction(a,null):(this.actionsdone.push(b.name),b.action.call(b.org,a))},resolvenoaction:function(b,
a){$("#actiondial").empty();null==b?this.endnoaction(a,null):b.action.call(b.org,a)},getrequirements:function(b){return b.getrequirements()},evaluatetohit:function(b,a){var c=this.gethitrange(b,a);if(a!=this&&3>=c&&0<c){var e=this.getattackstrength(b,a),f=a.getdefensestrength(b,this),c=this.focus,h=this.reroll,l=this.weapons[b];-1<this.targeting.indexOf(a)&&(this.reroll=10);1==l.consumes&&"Target".match(this.getrequirements(l))&&this.canusetarget(a)&&(this.reroll=0);1==l.consumes&&"Focus".match(this.getrequirements(l))&&
this.canusefocus()&&this.focus--;e=tohitproba(this,this.weapons[b],a,this.getattacktable(e),a.getdefensetable(f),e,f);c&&(this.focus=c);h&&(this.reroll=h);return e}return{proba:[],tohit:0,meanhit:0,meancritical:0,tokill:0}},isfireobstructed:function(){return-1<this.ocollision.overlap&&OBSTACLES[this.ocollision.overlap].type==ROCK},hascollidedobstacle:function(){return-1<this.ocollision.overlap||0<this.ocollision.template.length},canfire:function(){return this.noattack<round&&this.hasfired<this.maxfired&&
!this.iscloaked&&!this.isfireobstructed()},modifyattackdefense:function(b,a,c,e){return{a:b,d:a}},getattackstrength:function(b,a){return this.weapons[b].getattack()+this.weapons[b].getrangeattackbonus(a)},getobstructiondef:function(b){return this.getoutlinerange(this.m,b).o?1:0},getdefensestrength:function(b,a){var c=this.getagility(),e=a.getobstructiondef(this);0<e&&this.log("+%0 defense for obstacle",e);return c+a.weapons[b].getrangedefensebonus(this)+e},hasnorerollmodifiers:function(b,a,c,e,f){for(var h=
this.getdicemodifiers(),l=0;l<h.length;l++){var t=h[l];if(t.from==b&&t.to==a&&t.type==Unit.MOD_M&&t.req(c,e)&&t.noreroll==f)return!0}return!1},getresultmodifiers:function(b,a,c,e){var f,h=function(a,b){var f=a.str+(c==Unit.DEFENSE_M?"modtokend":"modtokena");"undefined"!=typeof a.token&&(f="x"+a.str+"token");f=$("<span>").addClass(f).attr({id:"mod"+b,title:"modify roll ["+a.org.name+"]"}).html("");f.click(function(){modroll(this.f,b,e)}.bind(a));return f},l=function(a,b){var f=a.str+(c==Unit.DEFENSE_M?
"modtokend":"modtokena");"undefined"!=typeof a.token&&(f="x"+a.str+"token");f=$("<span>").addClass(f).attr({id:"mod"+b,title:"add result ["+a.org.name+"]"}).html("");f.click(function(){addroll(this.f,b,e)}.bind(a));return f},t=function(a,b){var f=a.n(),h="R"+f,q="tokens",m;a.str&&(q="x"+a.str+"token",h="");m="undefined"!=typeof a.side?a.side:function(){};h=$("<span>").addClass(q).attr({id:"reroll"+b,title:f+" rerolls["+a.org.name+"]"}).html(h);h.click(function(){m();reroll(f,c,e,a,b)});return h},
x=this.getdicemodifiers(),q=[];for(f=0;f<x.length;f++){var m=x[f];m.from==c&&m.to==e&&(m.type==Unit.MOD_M&&m.req.call(this,b,a)&&q.push(h(m,f)),m.type==Unit.ADD_M&&m.req.call(this,b,a)&&q.push(l(m,f)),m.type==Unit.REROLL_M&&m.req.call(this,activeunit,activeunit.weapons[activeunit.activeweapon],targetunit)&&q.push(t(m,f)))}return q},addhasfired:function(){this.hasfired++},resolveattack:function(b,a){var c;this.gethitrange(b,a);this.addhasfired();this.hasdamaged=!1;displaycombatdial();var e=a.g.getBBox(),
f=transformPoint(this.m,{x:0,y:-(this.islarge?40:20)});s.path("M "+f.x+" "+f.y+" L "+(e.x+e.w/2)+" "+(e.y+e.h/2)).appendTo(VIEWPORT).attr({stroke:this.color,strokeWidth:2,strokeDasharray:100,"class":"animated fireline"});this.select();for(c in squadron)if(squadron[c]==this)break;this.preattackroll(b,a);this.doselection(function(e){var f=this.getattackstrength(b,a);this.doattackroll(this.attackroll(f),f,b,c,e)}.bind(this),"in combat")},preattackroll:function(b,a){},predefenseroll:function(b,a){},doattack:function(b,
a){this.activeweapons=b;this.activeenemies=a;this.showattack(b,a)},doattackroll:function(b,a,c,e,f){b=this.weapons[c].modifydamagegiven(b);this.weapons[c].lastattackroll=b;displayattackroll(b,a);this.ar=b;this.ad=a;displayattacktokens(this,function(a){targetunit.predefenseroll(c,a);targetunit.defenseroll(targetunit.getdefensestrength(c,a)).done(function(a){targetunit.dodefenseroll(a.roll,a.dice,e,f)})})},dodefenseroll:function(b,a,c,e){this.dr=b;this.dd=a;displaydefenseroll(b,a);displaydefensetokens(this,
function(){this.resolvedamage();this.endnoaction(e,"in combat")}.bind(squadron[c]))},drawpathmove:function(b,a,c,e){FAST||("undefined"!=typeof e&&(s=e),this.islarge?(e=b.clone(),s.path("M 0 0 l 0 -20").transform(e).appendTo(VIEWPORT).attr({stroke:this.color,display:TRACE?"block":"none",strokeWidth:"20px",opacity:.2,fill:"rgba(0,0,0,0)"}).addClass("trace"),a=s.path(a.getSubpath(0,c-40)).attr("display","none"),a.clone().transform(e.translate(0,-20)).appendTo(VIEWPORT).attr({stroke:this.color,display:TRACE?
"block":"none",strokeWidth:"20px",opacity:.2,fill:"rgba(0,0,0,0)"}).addClass("trace"),s.path("M 0 0 l 0 -20").transform(this.getmatrixwithmove(b,a,c-20)).appendTo(VIEWPORT).attr({stroke:this.color,display:TRACE?"block":"none",strokeWidth:"20px",opacity:.2,fill:"rgba(0,0,0,0)"}).addClass("trace")):s.path(a.getSubpath(0,c)).transform(b).attr({stroke:this.color,display:TRACE?"block":"none",strokeWidth:"20px",opacity:.2,fill:"rgba(0,0,0,0)"}).addClass("trace").appendTo(VIEWPORT),this.show())},getmatrixwithmove:function(b,
a,c){var e=a.getTotalLength();b=b.clone();if(0==e)return b;this.islarge?20>=c?b.translate(0,-c):(e=c>e+20?c-e-20:0,a=a.getPointAtLength(c-e-20),b.translate(a.x,-20+a.y).rotate(a.alpha-90,0,0).translate(0,-e)):(a=a.getPointAtLength(c),b.translate(a.x,a.y).rotate(a.alpha-90,0,0));return b},removestresstoken:function(){0<this.stress&&(this.stress--,this.animateremovetoken("xstresstoken"),this.movelog("st"),this.show())},handledifficulty:function(b){this.checkpilotstress&&("RED"==b?this.addstress():"GREEN"==
b&&0<this.stress&&this.removestresstoken())},premove:function(){},revealmaneuver:function(b){},completemaneuver:function(b,a,c,e){var f=P[b].path,h,l=f.getTotalLength(),t=this.m.clone();b.match(/RF1|RF5|RR1|RL1/)&&(t=t.rotate(180,0,0));this.islarge&&(l+=40);this.moves=[this.getmatrixwithmove(t,f,l)];this.moves[0].move=b;this.maneuverdifficulty=a;if("F0"==b)this.hasmoved=!0,c&&(this.m.rotate(180,0,0),this.movelog("m-"+b+"-180-"+Math.floor(l))),this.handledifficulty(a),this.lastmaneuver=this.maneuver,
this.endmaneuver(),this.touching=[];else{this.collision=!1;this.showhitsector(!1);h=this.moves[0];var x=this.getcollidingunits(h),q=[];if(0<x.length)for(this.log("collides with %0: no action",x[0].name),this.collision=!0;0<l&&0<x.length;)q=x,--l,h=this.getmatrixwithmove(t,f,l),x=this.getcollidingunits(h);this.drawpathmove(t,f,l);for(i=0;i<this.touching.length;i++)x=this.touching[i],x.touching.splice(x.touching.indexOf(this),1);this.touching=q;this.ocollision=this.getocollisions(t,h,f,l);this.isfireobstructed()&&
this.log("overlaps obstacle: cannot attack");this.hascollidedobstacle()&&this.log("unit or template overlaps obstacle: no action");0<l&&(this.m=h);var m=0;0<l?(this.hasmoved=!0,$("#activationdial").empty(),FAST||SOUNDS[this.ship.flysnd].play(),Snap.animate(0,l,function(a){h=this.getmatrixwithmove(t,f,a);b.match(/RF1|RF5|RR1|RL1/)&&h.rotate(180,0,0);this.g.transform(h);this.geffect.transform(h)}.bind(this),TIMEANIM*l/200,mina.linear,function(){this.collision||(b.match(/K\d|SR\d|SL\d|RF1|RF5|RR1|RL1/)||
1==c?(this.m.rotate(180,0,0),m=180):b.match(/TRL\d/)?(this.m.rotate(-90,0,0),m=-90):b.match(/TRR\d/)&&("undefined"!=typeof e?this.m=e:this.m.rotate(90,0,0),m=90));this.movelog("m-"+b+"-"+(360+m)%360+"-"+Math.floor(l));this.handledifficulty(a);this.lastmaneuver=this.maneuver;this.hascollidedobstacle()&&this.resolveocollision(this.ocollision.overlap,this.ocollision.template);if(0<this.ocollision.mine.length)for(i=0;i<this.ocollision.mine.length;i++)this.ocollision.mine[i].detonate(this,!1);this.collision&&
this.resolvecollision();this.endmaneuver()}.bind(this))):(this.hasmoved=!0,this.log("cannot move"),this.handledifficulty(a),this.lastmaneuver=this.maneuver,this.collision&&this.resolvecollision(),this.endmaneuver())}},getmaneuverlist:function(){var b=this.getmaneuver(),a={};a[b.move]=b;return"undefined"!=typeof b?a:{}},resolvemaneuver:function(){$("#activationdial").empty();if(!(0>this.maneuver)){var b=[],a=[],c=this.getmaneuverlist(),e;for(e in c)if(a.push(c[e]),c[e].move.match(/TRR\d|TRL\d/))for(var f=
this.gettallonrollmatrix(this.m,c[e].move),h=0;h<f.length;h++)b.push(f[h]),0<h&&a.push(c[e]);else 1!=c[e].halfturn||c[e].move.match(/K\d|SR\d|SL\d/)?b.push(this.getpathmatrix(this.m,c[e].move)):b.push(this.getpathmatrix(this.m,c[e].move).rotate(180,0,0));this.resolveactionmove(b,function(c,e){-1==e&&(e=0);var f=a[e].move,h=a[e].difficulty;1!=a[e].halfturn&&(a[e].halfturn=!1);this.completemaneuver(f,h,a[e].halfturn,b[e])}.bind(this),!1,!0)}},endmaneuver:function(){var b=this.ionized,a=1===this.team?
2:1;if(this.hasionizationeffect())for(var c=0;c<b;c++)this.removeiontoken();this.maneuver=-1;this.hasmoved=!0;this.show();this.moves=[];this.checkdead()?this.shield=this.hull=0:(TEAMS[this.team].initiative?($(document).trigger("endmaneuver"+this.team,[this]),$(document).trigger("endmaneuver"+a,[this])):($(document).trigger("endmaneuver"+a,[this]),$(document).trigger("endmaneuver"+this.team,[this])),this.doendmaneuveraction());this.cleanupmaneuver()},cleanupmaneuver:function(){this.actionbarrier()},
unlock:function(b){this.show();return this.deferred.resolve(b)},newlock:function(){this.deferred=$.Deferred();return this.deferred.promise()},enddecloak:function(){return this.newlock()},candomaneuver:function(){return-1<this.maneuver},addafterattackeffect:function(b,a){this.wrap_after("afterattackeffect",b,a)},addafterdefenseeffect:function(b,a){this.wrap_after("afterdefenseeffect",b,a)},isattacktwice:function(){return!1},addattack:function(b,a,c,e,f,h,l){var t=this;"undefined"==typeof h&&(h="endattack");
"undefined"==typeof l&&(l=!1);(l?Unit.prototype:this).wrap_after(h,a,function(l,q){var m=!1,r,x;"removeshield"==h||"endattack"==h||"endbeingattacked"==h||"warndeath"==h?x=activeunit:"undefined"==typeof x&&(x=this);for(r in c)if(c[r].isactive){m=!0;break}if(b.call(t,l,q,x)&&t.noattack<round&&m&&!t.iscloaked&&!t.isfireobstructed()){var B=x.deferred,m=function(){var h,m=[];this.deferred=B;h="function"==typeof f?f.call(this):this.selectnearbyenemy(3);for(var r in c)c[r].isactive&&0<c[r].getenemiesinrange(h).length&&
m.push(c[r]);0==m.length?(this.log("no available target for %0",a.name),this.cleanupattack()):b.call(this,l,q,x)?(this.log("+1 attack [%0]",a.name),this.select(),"function"==typeof e&&this.wrap_before("resolveattack",this,function(){e.call(this)}.bind(this)).unwrapper("cleanupattack"),this.maxfired++,this.doattack(m,h)):this.cleanupattack()}.bind(t);"endcombatphase"!=h&&"warndeath"!=h&&phase==COMBAT_PHASE?x.newlock().done(m):m()}})},candoendmaneuveraction:function(){return this.candoaction()&&!this.collision&&
!this.hascollidedobstacle()},doendmaneuveraction:function(){return this.candoendmaneuveraction()?this.doaction(this.getactionlist(!0),"",this.candoendmaneuveraction):this.enqueueaction(function(b){this.endnoaction(b)}.bind(this),this.name)},doselection:function(b,a){return this.enqueueaction(b,a)},isactiondone:function(b){return-1!=this.actionsdone.indexOf(b)},doaction:function(b,a,c){"undefined"==typeof c&&(c=this.candoaction);return 0==b.length?(this.log("no action available"),this.enqueueaction(function(a){this.endnoaction(a)}.bind(this),
this.name)):this.enqueueaction(function(e){var f;$("#actiondial").empty();if(c.call(this)){this.select();"undefined"!=typeof a&&""!=a&&this.log(a);$("#actiondial").html($("<div>"));for(f=0;f<b.length;f++)this.isactiondone(b[f].name)||function(a,c){var h=$("<div>").addClass("symbols").text(A[a.type].key).click(function(){this.resolveaction(a,e)}.bind(this));a.type==Unit.BOMB&&h.addClass("bombs");h.attr("title",b[f].name);"/2"==b[f].name.slice(-2)&&h.css("color","yellow");$("#actiondial > div").append(h)}.call(this,
b[f],f);var h=$("<button>").addClass("m-skip").addClass("wbutton").click(function(){this.resolveaction(null,e)}.bind(this));$("#actiondial > div").append(h)}else this.endaction(e,null)}.bind(this),b[0].name)},donoaction:function(b,a,c,e){return 0==b.length?(this.log("no action available"),this.enqueueaction(function(a){this.endnoaction(a)}.bind(this),this.name)):this.enqueueaction(function(f){var h;"undefined"!=typeof a&&""!=a&&this.log(a);this.select();$("#actiondial").html($("<div>"));for(h=0;h<
b.length;h++)(function(a,b){var c=$("<div title='"+a.name+"'>").addClass("symbols").text(A[a.type].key).click(function(){this.resolvenoaction(a,f)}.bind(this));$("#actiondial > div").append(c)}).call(this,b[h],h);1==c&&(h=$("<button>").addClass("m-skip").addClass("wbutton").click(function(){"function"==typeof e&&e();this.resolvenoaction(null,f)}.bind(this)),$("#actiondial > div").append(h))}.bind(this),b[0].name)},hasnostresseffect:function(){return 0==this.stress},candoaction:function(){return this.hasnostresseffect()},
candecloak:function(){return this.iscloaked&&phase==ACTIVATION_PHASE&&!this.hasdecloaked},selecttargetforattack:function(b,a){var c;ENGAGED=!0;c=this.weapons[b].getenemiesinrange(a);if(0==c.length)return this.log("no target for %0",this.weapons[b].name),this.cleanupattack(),!1;$("#attackdial").empty();this.selectunit(c,function(a,c){this.declareattack(b,a[c])?this.resolveattack(b,a[c]):this.cleanupattack()},[""],!1);return!0},getactiveweapons:function(b){return this.weapons},showattack:function(b,
a){var c=[],e,f;$("#attackdial").show();"undefined"==typeof b&&(b=this.getactiveweapons());var h=this.getenemiesinrange(b,a),l=$("<div>");for(e=f=0;f<b.length;f++)0<h[f].length&&(c[e++]=this.weapons.indexOf(b[f]));var t=this;for(e=0;e<c.length;e++)(function(b){var c=A[t.weapons[b].type.toUpperCase()];l.append($("<div>").attr({"class":"symbols "+b.color}).html(c.key).click(function(){t.selecttargetforattack(b,a)}))})(c[e]);l.append($("<button>").attr({"class":"m-skip wbutton"}).click(function(){this.cancelattack()}.bind(this)));
$("#attackdial").html(l)},cancelattack:function(){this.addhasfired();this.show();this.cleanupattack()},candotarget:function(){return 0<this.gettargetableunits(3).length},candofocus:function(){return!0},candoevade:function(){return!0},candropbomb:function(){return this.lastdrop!=round&&this.getskill()==skillturn},addactivationdial:function(b,a,c,e){this.activationdial.push({pred:b,action:a,html:c,elt:e})},endactivate:function(){},actionbarrier:function(){actionrlock=$.Deferred();this.areactionspending()?
actionrlock.done(function(){this.unlock();phase==ACTIVATION_PHASE&&this.endactivate()}.bind(this)):(actionrlock.resolve(),this.unlock(),phase==ACTIVATION_PHASE&&this.endactivate())},addafteractions:function(b){actionrlock.done(b)},areactionspending:function(){for(var b=0;b<actionr.length;b++)if("pending"==actionr[b].state())return!0;return!1},dodecloak:function(){this.iscloaked?this.resolvedecloak():this.hasdecloaked=!0;this.actionbarrier()},getbomblocation:function(){return["F1"]},getbombposition:function(b,
a){for(var c=[],e=0;e<b.length;e++)c.push(this.getpathmatrix(this.m.clone().rotate(180,0,0).translate(0,(this.islarge?40:20)-a),b[e]));return c},bombdropped:function(){},updateactivationdial:function(){var b=this;this.activationdial=[];if(!(this.candropbomb()&&this.hasionizationeffect()||b.lastdrop==round))switch(this.bombs.length){case 3:this.bombs[2].canbedropped()&&this.addactivationdial(function(){return b.lastdrop!=round&&b.bombs[2].canbedropped()},function(){b.lastdrop=round;$(".bombs").remove();
b.bombs[2].actiondrop()},A.BOMB.key,$("<div>").attr({"class":"symbols bombs",title:b.bombs[2].name}));case 2:this.bombs[1].canbedropped()&&this.addactivationdial(function(){return b.lastdrop!=round&&b.bombs[1].canbedropped()},function(){b.lastdrop=round;$(".bombs").remove();b.bombs[1].actiondrop()},A.BOMB.key,$("<div>").attr({"class":"symbols bombs",title:b.bombs[1].name}));case 1:this.bombs[0].canbedropped()&&this.addactivationdial(function(){return b.lastdrop!=round&&b.bombs[0].canbedropped()},
function(){b.lastdrop=round;$(".bombs").remove();b.bombs[0].actiondrop()},A.BOMB.key,$("<div>").attr({"class":"symbols bombs",title:b.bombs[0].name}))}return this.activationdial},doactivation:function(){this.hasionizationeffect()||this.revealmaneuver(this.maneuver);this.showactivation()},showactivation:function(){$("#activationdial").html("<div></div>");if(this.timeformaneuver()&&!this.areactionspending()){for(var b=this.updateactivationdial(),a=0;a<b.length;a++)(function(a){var c=b[a];c.pred()&&
c.elt.appendTo("#activationdial > div").click(function(){$("#activationdial").html("<div></div>");c.action()}).html(c.html)})(a);$("<button>").addClass("m-move").addClass("wbutton").click(function(){this.resolvemaneuver()}.bind(this)).appendTo("#activationdial > div")}},movelog:function(b){b.match(/L-%%.*/)&&this.setinfo(decodeURIComponent(b.substring(4,b.length-2))).delay(1500).fadeOut(400);ANIM+="_"+this.id+"-"+b},computepoints:function(){},error:function(b){b=formatstring(b);log("<div><span style='color:red;font-weight:bold;'>**ERROR** ["+
this.name+"]</span> "+b+"</div>")},log:function(b,a,c,e){NOLOG||("undefined"!=typeof UI_translation[b]&&(b=UI_translation[b]),"string"==typeof a&&(a=translate(a)),b=b.replace(/%0/g,a),"string"==typeof c&&(c=translate(c)),b=b.replace(/%1/g,c),"string"==typeof e&&(e=translate(e)),b=b.replace(/%2/g,e),b=formatstring(b),log("<div><span style='color:"+this.color+"'>["+this.name+"]</span> "+b+"</div>"))},candocloak:function(){return!this.iscloaked},clearaction:function(){this.action=-1},showaction:function(){if(this.action<
this.actionList.length&&-1<this.action){var b=A[this.actionList[this.action].type].color;this.actionicon.attr({fill:this==activeunit?b:halftone(b)})}else this.actionicon.attr({text:""})},showinfo:function(){var b=0,a=$("#"+this.id+" .usabletokens").html(),c=this.getusabletokens();$("#"+this.id+" .usabletokens").html(c);if(a!=c)for(var e in squadron)a=squadron[e],this.isally(a)&&this.getskill()>=a.getskill()&&a.showoverflow();0<this.focus&&this.infoicon[b++].attr({text:A.FOCUS.key,fill:A.FOCUS.color});
0<this.evade&&this.infoicon[b++].attr({text:A.EVADE.key,fill:A.EVADE.color});0<this.reinforce&&this.infoicon[b++].attr({text:A.REINFORCE.key,fill:A.REINFORCE.color});1==this.iscloaked&&this.infoicon[b++].attr({text:A.CLOAK.key,fill:A.CLOAK.color});0<this.targeting.length&&6>b&&this.infoicon[b++].attr({text:A.TARGET.key,fill:A.TARGET.color});0<this.istargeted.length&&this.infoicon[b++].attr({text:A.ISTARGETED.key,fill:A.ISTARGETED.color});0<this.stress&&6>b&&this.infoicon[b++].attr({text:A.STRESS.key,
fill:A.STRESS.color});0<this.ionized&&6>b&&this.infoicon[b++].attr({text:"Z",fill:A.STRESS.color});0<this.tractorbeam&&6>b&&this.infoicon[b++].attr({text:"Y",fill:A.STRESS.color});for(e=b;6>e;e++)this.infoicon[b++].attr({text:""})},showoutline:function(){this.border.attr({stroke:activeunit==this?this.color:halftone(this.color)})},dock:function(b){this.isdocked=!0;$("#"+this.id).attr("onclick","");$("#"+this.id).addClass("docked");$("#"+this.id).html(""+this);this.g.attr({display:"none"});this.geffect.attr({display:"none"});
phase!==SELECT_PHASE&&(this.log("docked on %0",b.name),this.show());b.docked=this},deploy:function(b,a){this.movelog("DPY");$("#"+this.id).removeClass("docked");$("#"+this.id).html(""+this);$("#"+this.id+" .outoverflow").each(function(a){"auto"!=$(this).css("top")&&$(this).css("top",$(this).parent().offset().top+"px")});$("#"+this.id).click(function(){this.select()}.bind(this));this.g.attr({display:"block"});this.geffect.attr({display:"block"});this.m=b.m.clone();this.show();b.docked=null;b.isinzone(b.m)?
(this.log("deploying from %0",b.name),this.log("select maneuver for deployment"),b.doselection(function(c){this.resolveactionmove(a,function(a,b){var c=this.getdial().length;b>=c?(this.m.translate(0,-20),b-=c):this.m.translate(0,20).rotate(180,0,0);this.maneuver=b;this.resolvemaneuver();this.isdocked=!1}.bind(this),!1,!0);b.endnoaction(c,"DEPLOY")}.bind(this))):(this.log("Cannot deploy from fleeing ship; destroyed!"),this.checkdead())},endcombatphase:function(){$(".fireline").remove()},endphase:function(){},
beginsetupphase:function(){return this.newlock()},endsetupphase:function(){},beginplanningphase:function(){this.actionsdone=[];return this.newlock()},beginactivationphase:function(){return this.newlock()},timetoshowmaneuver:function(){return-1<this.maneuver&&phase<=ACTIVATION_PHASE},getmaneuver:function(){return this.hasionizationeffect()?{move:"F1",difficulty:"WHITE"}:this.getdial()[this.maneuver]},showmaneuver:function(){if(this.timetoshowmaneuver()){var b=this.getmaneuver(),a=C["undefined"!=typeof this.forceddifficulty?
this.forceddifficulty:b.difficulty];activeunit!=this&&(a=halftone(a));this.dialspeed.attr({text:P[b.move].speed,fill:a});this.dialdirection.attr({text:P[b.move].key,fill:a})}},clearmaneuver:function(){this.dialspeed.attr({text:""});this.dialdirection.attr({text:""})},beginactivation:function(){this.showmaneuver();this.show()},endactivationphase:function(){},endplanningphase:function(){},hasionizationeffect:function(){return 0<this.ionized&&!this.islarge||1<this.ionized},begincombatphase:function(){return this.newlock()},
beginattack:function(){},toString:function(){var b,a;this.shipname=SHIP_translation[this.ship.name];"undefined"==typeof SHIP_translation[this.ship.name]&&(this.shipname=this.ship.name);this.translatedname=translate(this.name);if(phase==SELECT_PHASE)return a=PILOTS[this.pilotid].dict,1==PILOTS[this.pilotid].ambiguous&&"undefined"!=typeof PILOTS[this.pilotid].edition&&(a+="-"+PILOTS[this.pilotid].edition.toLowerCase().replace(" ","")),this.imgname=a,this.isunique=1==PILOTS[this.pilotid].unique?!1:!0,
this.fire=this.weapons[0].getattack(),this.diallist=dial2JSON(this.getdial()),Mustache.render(TEMPLATES["unit-creation"],this);b=formatstring(getpilottexttranslation(this,this.faction));this.id=squadron.indexOf(this);this.tooltip=""!=b?[b]:[];b=8+2*this.upgrades.length;this.shieldpts3=this.hullpts3=this.shieldpts2=this.hullpts2="";this.hull+this.shield<=b?(this.hullpts=repeat("u ",this.hull),this.shieldpts=repeat("u ",this.shield)):this.hull>b?(this.hullpts=repeat("u ",this.hull),this.shieldpts="",
this.hull<=2*b?(this.hullpts2=repeat("u ",this.hull-b),this.shield+this.hull<=2*b?this.shieldpts2=repeat("u ",this.shield):(this.shieldpts2=repeat("u ",2*b-this.hull),this.shieldpts3=repeat("u ",this.shield-2*b))):(this.hullpts2=repeat("u ",b),this.hullpts3=repeat("u ",this.hull-2*b),this.shieldpts3=repeat("u ",this.shield))):(this.hullpts=repeat("u ",this.hull),this.shieldpts=repeat("u ",b-this.hull),this.shieldpts2=repeat("u ",this.shield-b+this.hull));this.isinleft=1==this.team;this.conds=[];for(a in this.conditions)this.conds.push(this.conditions[a]);
return Mustache.render(TEMPLATES["unit-combat"],this)},canusefocus:function(){return 0<this.focus},canuseevade:function(){return 0<this.evade},canusereinforce:function(){if(0<this.reinforce){var b=this.isinfiringarc(attackunit);if(0==this.reinforceaft){if(b)return!0;this.log("Attacker is not in arc, therefore cannot use reinforce on fore side")}else if(1==this.reinforceaft)if(b)this.log("Attacker is in arc, therefore cannot use reinforce on aft side");else return!0}return!1},canusetarget:function(b){return 0<
this.targeting.length&&("undefined"==typeof b||-1<this.targeting.indexOf(b))},getusabletokens:function(){this.focuses=1<this.focus?[this.focus]:[];this.evades=1<this.evade?[this.evade]:[];this.reinforces=1<this.reinforce?[this.reinforce]:[];this.stresses=1<this.stress?[this.stress]:[];this.ionizedes=1<this.ionized?[this.ionized]:[];this.tractorbeames=1<this.tractorbeam?[this.tractorbeam]:[];this.targetedname=[];this.targetingname=[];this.nomoreattack=this.noattack==round;for(var b=0;b<this.istargeted.length;b++)this.targetedname[b]=
this.istargeted[b].name.replace(/\'/g,"");for(b=0;b<this.targeting.length;b++)this.targetingname[b]=this.targeting[b].name.replace(/\'/g,"");return Mustache.render(TEMPLATES.usabletokens,this)},showstats:function(){$("#unit"+this.id+" .statevade .val").html(this.getagility());if(phase==SELECT_PHASE)$("#unit"+this.id+" .stathull .val").html(this.ship.hull),$("#unit"+this.id+" .statshield .val").html(this.ship.shield);else{this.skillbar.attr({text:repeat("u",this.getskill())});this.firebar.attr({text:repeat("u",
this.weapons[0].getattack())});this.evadebar.attr({text:repeat("u",this.getagility())});this.hullbar.attr({text:repeat("u",this.hull)});this.shieldbar.attr({text:repeat("u",this.shield+this.hull)});var b=8+2*this.upgrades.length;this.hull+this.shield<=b?($("#"+this.id+" .stat .hull").html(repeat("u ",this.hull)),$("#"+this.id+" .stat .shield").html(repeat("u ",this.shield))):this.hull>b?($("#"+this.id+" .stat .hull").html(repeat("u ",b)),this.hull<=2*b?($("#"+this.id+" .stat2 .hull").html(repeat("u ",
this.hull-b)),this.shield+this.hull<=2*b?$("#"+this.id+" .stat2 .shield").html(repeat("u ",this.shield)):($("#"+this.id+" .stat2 .shield").html(repeat("u ",2*b-this.hull)),$("#"+this.id+" .stat3 .shield").html(repeat("u ",this.shield-2*b+this.hull)))):($("#"+this.id+" .stat2 .hull").html(repeat("u ",b)),$("#"+this.id+" .stat3 .hull").html(repeat("u ",this.hull-2*b)),$("#"+this.id+" .stat3 .shield").html(repeat("u ",this.shield)))):($("#"+this.id+" .stat .hull").html(repeat("u ",this.hull)),$("#"+
this.id+" .stat .shield").html(repeat("u ",b-this.hull)),$("#"+this.id+" .stat2 .shield").html(repeat("u ",this.shield-b+this.hull)))}},showpanel:function(){var b=VIEWPORT.m.clone(),a=this.g.getBBox(),c=$("#svgout").width(),e=$("#svgout").height(),f=0,h=0;e>c?h=(e-c)/2:f=(c-e)/2;c=Math.min(c/GW,e/GH);f+=(b.x(a.x,a.y)+a.width/2)*c;a=h+b.y(a.x,a.y)*c;b=b.split().scalex;$(".phasepanel").css({left:f+b*(this.islarge?40:20),top:a}).show();$("#positiondial button").hide()},timeformaneuver:function(){return this==
activeunit&&-1<this.maneuver&&!this.hasmoved&&this.getskill()==skillturn&&phase==ACTIVATION_PHASE&&subphase==ACTIVATION_PHASE},showoverflow:function(){this.dead||($("#"+this.id).html(""+this),$("#"+this.id+" .outoverflow").each(function(b){"auto"!=$(this).css("top")&&$(this).css("top",$(this).parent().offset().top+"px")}))},show:function(){phase==SELECT_PHASE?$("#unit"+this.id).html(this.toString()):"undefined"!=typeof this.g&&(this.g.transform(this.m),this.g.appendTo(VIEWPORT),this.geffect.transform(this.m),
this.geffect.appendTo(VIEWPORT),this.showoutline(),this.flameno++,this.showstats(),this.showinfo(),activeunit==this&&(this.showpanel(),this.showdial(),this.showmaneuver(),phase!=ACTIVATION_PHASE||this.hasfired||this.showactivation(),ENGAGED||phase!=COMBAT_PHASE||(!this.canfire()||this.areactionspending()||INREPLAY?$("#attackdial").empty():this.showattack(this.activeweapons,this.activeenemies)),this.showoverflow()))},updatetohit:function(b,a){var c=this.weapons[a],e=c.getenemiesinrange();if(b)for(f in e)e[f].tohitstats[this.id]=
{unit:this,weapon:a};else for(var f in e)delete e[f].tohitstats[this.id];for(f in e){var h=e[f];NOLOG=!0;var l=1,t=0,x=0,q=h.focus,m=h.evade,r,y;for(y in h.tohitstats){var B=h.tohitstats[y],c=B.weapon;if("undefined"!=typeof B.unit){var z=B.unit.evaluatetohit(B.weapon,h),l=l*(1-z.tohit/100),t=t+z.meanhit,x=x+z.meancritical;0<h.focus&&h.focus--;0<h.evade&&h.evade--;for(r=[];"function"==typeof B.unit.weapons[c].followupattack&&-1==r.indexOf(c);)r.push(c),c=B.unit.weapons[c].followupattack(),z=B.unit.evaluatetohit(c,
h),l*=1-z.tohit/100,t+=z.meanhit,x+=z.meancritical,0<h.focus&&h.focus--,0<h.evade&&h.evade--}}h.tohitstats.tohit=l;h.tohitstats.meanhit=t;h.tohitstats.meancrit=x;h.evade=m;h.focus=q;NOLOG=!1}},displaytohit:function(b){b=this.weapons[b].getenemiesinrange();for(var a in b){var c=b[a],e=1-c.tohitstats.tohit,f=c.tohitstats.meanhit,h=c.tohitstats.meancrit;if(0==f)c.gproba.attr({display:"none"});else{var l=-c.m.split().rotate;c.gproba.transform("r "+l+" 0 0").attr({display:"block"});c.tohit.attr({text:Math.floor(100*
e)+"%"});c.meanhit.attr({text:Math.floor(100*f)/100});c.meancrit.attr({text:Math.floor(100*h)/100})}c.show()}},showhitsector:function(b,a){this.select();"undefined"==typeof a&&(a=0);var c=this.weapons[a];if(b){var e=c.getlowrange(),f=c.gethighrange();if(c.isTurret()||this.isTurret(c))this.showrange(b,e,f);else{var h;if(1==e){for(h=e;h<=f;h++)this.sectors.push(s.path(this.getPrimarySectorString(h,this.m)).attr({fill:this.color,stroke:this.color,opacity:.1,pointerEvents:"none"}).appendTo(VIEWPORT));
if("undefined"!=typeof c.auxiliary)for(c=c.auxiliary,h=e;h<=f;h++)this.sectors.push(s.path(c.call(this,h,this.m)).attr({fill:this.color,stroke:this.color,opacity:.1,pointerEvents:"none"}).appendTo(VIEWPORT))}else{for(h=e;h<=f;h++)this.sectors.push(s.path(this.getPrimarySubSectorString(e-1,h,this.m)).attr({fill:this.color,stroke:this.color,opacity:.1,pointerEvents:"none"}).appendTo(VIEWPORT));if("undefined"!=typeof c.subauxiliary)for(c=c.subauxiliary,h=e;h<=f;h++)this.sectors.push(s.path(c.call(this,
e-1,h,this.m.clone())).attr({fill:this.color,stroke:this.color,opacity:.1,pointerEvents:"none"}).appendTo(VIEWPORT))}}}else{for(h=0;h<this.sectors.length;h++)this.sectors[h].remove();for(h=0;h<this.ranges.length;h++)this.ranges[h].remove();this.ranges=[];this.sectors=[]}this.updatetohit(b,a);this.displaytohit(a)},showrange:function(b,a,c){this.select();if(b)if(1==a)for(b=a;b<=c;b++)this.ranges.push(s.path(this.getRangeString(b,this.m)).attr({fill:this.color,stroke:this.color,opacity:.1,pointerEvents:"none"}).appendTo(VIEWPORT));
else for(b=a;b<=c;b++)this.ranges.push(s.path(this.getSubRangeString(a-1,b,this.m)).attr({fill:this.color,stroke:this.color,opacity:.1,pointerEvents:"none"}).appendTo(VIEWPORT));else{for(b=0;b<this.ranges.length;b++)this.ranges[b].remove();this.ranges=[]}},togglehitsector:function(b){this.showhitsector(0<this.sectors.length+this.ranges.length?!1:!0,b)},togglerange:function(){this.showrange(0<this.ranges.length?!1:!0,1,3)},isPointInside:function(b,a){for(var c=0;c<a.length;c++)if(Snap.path.isPointInside(b,
a[c].x,a[c].y))return!0;return!1},isinsector:function(b,a,c,e,f,h){c=c.getOutlineString(c.m);b=1<a?e.call(this,a-1,a,b):f.call(this,a,b);return null!=b&&(0<Snap.path.intersection(c.s,b).length||this.isPointInside(b,c.p))},isinfiringarc:function(b){return 3>=this.getsector(b)},isinprimaryfiringarc:function(b){return 3>=this.getprimarysector(b)},isinauxiliaryfiringarc:function(b){return 3>=this.getauxiliarysector(b)},getsector:function(b,a){return this.weapons[0].getsector(b)},getprimarysector:function(b,
a){var c;"undefined"==typeof a&&(a=this.m);var e=this.getoutlinerange(a,b).d;for(c=e;c<=e+1&&3>=c;c++)if(this.isinsector(a,c,b,this.getPrimarySubSectorString,this.getPrimarySectorString))return c;return 4},getauxiliarysector:function(b,a,c,e){var f;"undefined"==typeof a&&(a=this.m);"undefined"==typeof c&&(c=this.weapons[0].subauxiliary,e=this.weapons[0].auxiliary);var h=this.getoutlinerange(a,b).d;for(f=h;f<=h+1&&3>=f;f++)if(this.isinsector(a,f,b,c,e))return f;return 4},isinoutline:function(b,a,c){return this.isPointInside(b,
a.getOutlinePoints(c))},checkcollision:function(b){return-1<this.touching.indexOf(b)},resolvecollision:function(){var b;"undefined"==typeof this.touching&&(this.touching=[]);for(b=0;b<this.touching.length;b++){var a=this.touching[b];-1==a.touching.indexOf(this)&&(a.touching.push(this),a.collidedby(this))}},collidedby:function(b){},canhavehitocollision:function(){return!0},canhavecriticalocollision:function(){return!0},resolveocollision:function(b,a){var c;-1==a.indexOf(b)&&-1<b&&a.push(b);for(c=0;c<
a.length;c++){var e=this.rollattackdie(1,OBSTACLES[a[c]],"blank")[0];switch(e){case "focus":this.log("roll for collision: <span class='focusreddice'></span>");break;case "hit":this.log("roll for collision: <span class='hitreddice'></span>");break;case "blank":this.log("roll for collision: <span class='blankreddice'></span>");break;case "critical":this.log("roll for collision: <span class='criticalreddice'></span>")}OBSTACLES[a[c]].type==ROCK?"hit"==e&&this.canhavehitocollision()?(this.log("+1 %HIT% [collision]"),
this.resolvehit(1),this.checkdead()):"critical"==e&&this.canhavecriticalocollision()&&(this.log("+1 %CRIT% [collision]"),this.resolvecritical(1),this.checkdead()):OBSTACLES[a[c]].type==DEBRIS&&(this.addstress(),"critical"==e&&(this.log("+1 %CRIT% [debris collision]"),this.resolvecritical(1),this.checkdead()))}},addshield:function(b){this.movelog("S-"+b);this.shield<this.ship.shield&&this.animateaddtoken("cshield");this.shield+=b;return this.shield>this.ship.shield?(this.shield=this.ship.shield,!0):
!1},addhull:function(b){this.movelog("H-"+b);this.hull<this.ship.hull&&this.animateaddtoken("chull");this.hull+=b;this.hull>this.ship.hull&&(this.hull=this.ship.hull)},animateremovetoken:function(b){if(!FAST){var a=VIEWPORT.m.clone(),c=$("#svgout").width(),e=$("#svgout").height(),f=0,h=0;e>c?h=(e-c)/2:f=(c-e)/2;var l=Math.max(GW/c,GH/e),t=this.g.getBBox(),c=$("#svgout").offset();$("#playmat").width();$("#playmat").height();e=a.x(t.x,t.y)/l;e+=c.left+f;a=a.y(t.x,t.y)/l;a+=c.top+h;$("<div>").addClass("upanim").css({left:e,
top:a}).html("<code class='"+b+"'></code>").appendTo("body").show()}},animateaddtoken:function(b){if(!FAST){var a=VIEWPORT.m.clone(),c=$("#svgout").width(),e=$("#svgout").height(),f=0,h=0;e>c?h=(e-c)/2:f=(c-e)/2;var l=Math.max(GW/c,GH/e),t=this.g.getBBox(),c=$("#svgout").offset();$("#playmat").width();$("#playmat").height();e=a.x(t.x,t.y)/l;e+=c.left+f;a=a.y(t.x,t.y)/l;a+=c.top+h;$("<div>").addClass("downanim").css({left:e,top:a}).html("<code class='"+b+"'></code>").appendTo("body").show()}},removeshield:function(b){0<
this.shield&&this.animateremovetoken("cshield");this.shield-=b;this.movelog("s-"+b);0>this.shield&&(this.shield=0);var a=TEAMS[this.team].history.rawdata;"undefined"==typeof a[round]&&(a[round]={hits:0,dead:""});a[round].hits+=b},resolvehit:function(b){var a=0;if(0==b)return 0;this.shield>b?this.removeshield(b):(a=b-this.shield,0<this.shield&&this.removeshield(this.shield),0<a&&this.applydamage(a));this.show();return a},resolvecritical:function(b){var a=0;if(0==b)return 0;this.shield>b?this.removeshield(b):
(a=b-this.shield,0<this.shield&&this.removeshield(this.shield),0<a&&this.applycritical(a));this.show();return a},removehull:function(b){0<this.hull&&this.animateremovetoken("chull");this.hull-=b;this.movelog("h-"+b);var a=TEAMS[this.team].history.rawdata;"undefined"==typeof a[round]&&(a[round]={hits:0,dead:""});a[round].hits+=b;this.log("-%0 %HULL%",b);this.hull<=this.ship.hull/2&&this.imgsmoke.attr({display:"block"});1==this.hull&&(this.imgsmoke.attr({display:"none"}),this.imgflame.attr({display:"block"}))},
selectunit:function(b,a,c,e){e&&b.push(this);0<b.length&&this.doselection(function(f){"undefined"!=typeof c&&""!=c[0]&&this.log.apply(this,c);this.resolveactionselection(b,function(c){e&&this==b[c]||a.call(this,b,c);this.endnoaction(f,"SELECT")}.bind(this))}.bind(this),"selectunit")},selectcritical:function(b,a){var c=function(b,c){$("#actiondial").empty();a(b);this.endnoaction(c,"CRITICAL")}.bind(this);this.doselection(function(a){var e;$("#actiondial").empty();for(e=0;e<b.length;e++)(function(e){var f=
$("<button>").text(Critical.CRITICAL_DECK[b[e]].name).click(function(){c(b[e],a)}.bind(this));$("#actiondial").append(f)}).call(this,e);$("#actiondial").show()}.bind(this),"critical")},selectupgradetodesactivate:function(b,a){var c=function(b,c){$("#actiondial").empty();null!=b&&(b.desactivate(),b.unit.show(),a.desactivate(),this.log("desactivating %0 [%1]",b.name,this.name));this.endnoaction(c,"CREW")}.bind(this);a.isactive&&this.doselection(function(a){var e;$("#actiondial").empty();for(e=0;e<b.length;e++)(function(e){var f=
$("<button>").text(b[e].name).click(function(){c(b[e],a)});$("#actiondial").append(f)}).call(this,e);e=$("<button>").addClass("m-skip").addClass("wbutton").click(function(){c(null,a)});$("#actiondial").append(e);$("#actiondial").show()}.bind(this),"upgrade")},selectdamage:function(){var b,a=0;for(b=0;b<Critical.CRITICAL_DECK.length;b++)-1<Critical.CRITICAL_DECK[b].version.indexOf(CURRENT_DECK)&&(a+=Critical.CRITICAL_DECK[b].count);var c=this.rand(a);for(b=a=0;b<Critical.CRITICAL_DECK.length;b++)if(-1<
Critical.CRITICAL_DECK[b].version.indexOf(CURRENT_DECK)&&(a+=Critical.CRITICAL_DECK[b].count,a>c))return b;return 0},applydamage:function(b){var a,c;for(c=0;c<b;c++){a=this.selectdamage();Critical.CRITICAL_DECK[a].count--;var e=new Critical(this,a);this.deal(e,Critical.FACEDOWN).done(function(b){switch(b.face){case Critical.FACEUP:b.crit.faceup(),this.movelog("c-"+a);case Critical.FACEDOWN:this.removehull(1);this.checkdead();break;case Critical.DISCARD:this.criticals.slice(this.criticals.indexOf(e),
1)}this.show()}.bind(this))}},applycritical:function(b){var a,c;for(c=0;c<b;c++){a=this.selectdamage();Critical.CRITICAL_DECK[a].count--;var e=new Critical(this,a);this.deal(e,Critical.FACEUP).done(function(b){switch(b.face){case Critical.FACEUP:b.crit.faceup(),this.movelog("c-"+a);case Critical.FACEDOWN:this.removehull(1);break;case Critical.DISCARD:this.criticals.slice(this.criticals.indexOf(e),1)}this.show()}.bind(this))}},deal:function(b,a){return $.Deferred().resolve({crit:b,face:a})},gethitrange:function(b,
a){return this.isally(a)?0:this.weapons[b].getrange(a)},getenemiesinrange:function(b,a){var c,e=[];"undefined"==typeof b&&(b=this.weapons);for(c=0;c<b.length;c++)e[c]=b[c].getenemiesinrange(a);return e},getrange:function(b){return this.getoutlinerange(this.m,b).d},getdist:function(b,a){var c=this.getOutlinePoints(b),e=a.getOutlinePoints(a.m),f=-1,h,l;for(h=0;h<c.length;h++)for(l=0;l<e.length;l++){var t=dist(e[l],c[h]);if(t<f||-1==f)f=t}return f},getoutlinerange:function(b,a){var c=this.getOutlinePoints(b),
e=a.getOutlinePoints(a.m),f=90001,h,l,t=0,x=!1,q,m;for(h=0;4>h;h++)for(l=0;4>l;l++){var r=dist(e[l],c[h]);r<f&&(f=r,q=h,m=l)}if(9E4<f)return{d:4,o:!1};l=e[m].x-c[q].x;var r=e[m].y-c[q].y,y=-c[q].x*r+c[q].y*l;if(0<OBSTACLES.length)for(t=0;t<OBSTACLES.length;t++)if(OBSTACLES[t].type!=NONE){var B=OBSTACLES[t].getOutlineString().p;if(0==B.length||OBSTACLES[t].type==Unit.BOMB)break;var z=B[0].x*r-B[0].y*l+y,E=z;for(h=1;h<B.length&&!(dist(e[m],B[h])<1.2*f&&dist(c[q],B[h])<1.2*f&&(E=B[h].x*r-B[h].y*l+y,
0>E*z));h++);if(0>E*z)break}t<OBSTACLES.length&&(x=!0);return 1E4>=f?{d:1,o:x}:4E4>=f?{d:2,o:x}:{d:3,o:x}},getrangeallunits:function(){var b=[[],[],[],[],[]],a;for(a in squadron){var c=squadron[a];c!=this&&(c=this.getrange(c),b[c].push({unit:a}))}return b}};var Unit=window.Unit||{},Mustache=window.Mustache||{},UPGRADE_TYPES={Elite:"ept",Torpedo:"torpedo",Astromech:"amd",Turret:"turret",Missile:"missile",Crew:"crew",Cannon:"cannon",Bomb:"bomb",Title:"title",Mod:"mod",System:"system",Illicit:"illicit",Salvaged:"salvaged",Tech:"tech"};function AUXILIARY(b,a){return this.getPrimarySectorString(b,a.clone().rotate(this.arcrotation,0,0))}function SUBAUXILIARY(b,a,c){return this.getPrimarySubSectorString(b,a,c.clone().rotate(this.arcrotation,0,0))}
function Bomb(b,a){$.extend(this,a);b.upgrades.push(this);this.isactive=!0;this.wrapping=[];this.unit=b;b.bombs.push(this);this.exploded=!1}
Bomb.prototype={wrap_before:Unit.prototype.wrap_before,wrap_after:Unit.prototype.wrap_after,isWeapon:function(){return!1},isBomb:function(){return!0},showOrdnance:function(){return this+1},aiactivate:function(){var b=[],a,c=0;this.canbedropped()?c=3:this.candoaction()&&(c=2);for(var e in squadron)a=squadron[e],this.unit.isenemy(a)&&(this.unit.getrange(a)<=c&&!this.unit.isinprimaryfiringarc(a)||1>=this.unit.getrange(a))&&b.push(a);return 0<b.length},canbedropped:function(){return this.isactive&&!this.unit.hasmoved&&
this.unit.lastdrop!=round},desactivate:function(){this.isactive=!1;this.unit.movelog("D-"+this.unit.upgrades.indexOf(this))},getBall:function(){var b=this.g.getBBox();return{x:b.x+b.width/2,y:b.y+b.height/2,diam:Math.max(b.width/2,b.height/2)}},actiondrop:function(b){this.unit.lastdrop=round;$(".bombs").remove();this.drop(this.unit.getbomblocation(),b)},toString:function(){this.tooltip=formatstring(getupgtxttranslation(this.name,this.type));this.trname=translate(this.name).replace(/\'/g,"&#39;");
this.left=1==this.unit.team;return Mustache.render(TEMPLATES.bomb,this)},getrangeallunits:function(){var b=[[],[],[],[],[]],a;for(a in squadron){var c=this.getrange(squadron[a]);0<c&&b[c].push({unit:a})}return b},getcollisions:function(){var b=this.getOutlineString(),a=[],c;for(c in squadron){var e=squadron[c],f=e.getOutlineString(e.m),h=f.s,f=f.p;(0<Snap.path.intersection(b.s,h).length||this.unit.isPointInside(b.s,f)||this.unit.isPointInside(h,b.p))&&a.push(e)}return a},getrange:function(b){var a=
this.getOutlineString(this.m).p;b=b.getOutlinePoints(b.m);var c=90001,e,f;for(e=0;e<a.length;e++)for(f=0;4>f;f++){var h=dist(b[f],a[e]);h<c&&(c=h)}return 9E4<c?4:1E4>=c?1:4E4>=c?2:3},resolveactionmove:function(b,a){var c;this.pos=[];var e=function(a,e,l){this.m=a;for(c=0;c<b.length;c++)this.pos[c].remove();l(this,e)}.bind(this);this.unit.ia&&(b=this.unit.chooseBombDrop(b));if(1==b.length)this.pos[0]=this.getOutline(b[0]).attr({fill:this.unit.color,opacity:.7}),e(b[0],0,a);else for(c=0;c<b.length;c++)(function(c){this.pos[c]=
this.getOutline(b[c]).attr({fill:this.unit.color,opacity:.7});this.pos[c].hover(function(){this.pos[c].attr({stroke:this.unit.color,strokeWidth:"4px"})}.bind(this),function(){this.pos[c].attr({strokeWidth:"0"})}.bind(this));this.pos[c].click(function(){e(b[c],c,a)})}).call(this,c)},drop:function(b,a){var c=this;0<this.ordnance?(--this.ordnance,c=$.extend({},this)):this.desactivate();c.resolveactionmove(this.unit.getbombposition(b,this.size),function(b){this.display(0,0);this.unit.bombdropped(this);
"undefined"!=typeof a&&this.unit.endnoaction(a,"DROP")}.bind(c),!1,!0)},display:function(b,a){if(0!==b||0!==a)this.m=this.m.clone().translate(b,a);this.img1=s.image("png/"+this.img,-this.width/2,-this.height/2,this.width,this.height);this.outline=this.getOutline(new Snap.Matrix).attr({display:"block","class":"bombanim",stroke:halftone(BLUE),strokeWidth:2,fill:"rgba(8,8,8,0.3)"});this.g=s.group(this.outline,this.img1);this.g.hover(function(){var a=VIEWPORT.m.clone(),b=$("#svgout").width(),c=$("#svgout").height(),
l=0,t=0;c>b?t=(c-b)/2:l=(b-c)/2;var x=Math.max(GW/b,GH/c),q=this.g.getBBox(),b=$("#svgout").position(),c=a.x(q.x,q.y-20)/x,c=c+(b.left+l),a=a.y(q.x,q.y-20)/x,a=a+(b.top+t);this.outline.attr({stroke:BLUE});$(".info").css({left:c,top:a}).html(this.name).appendTo("body").show()}.bind(this),function(){$(".info").hide();this.outline.attr({stroke:halftone(BLUE)})}.bind(this));this.g.transform(this.m);this.g.appendTo(VIEWPORT);this.g.attr("display","block");BOMBS.push(this);if(this.stay){OBSTACLES.push(this);
var c=this.getcollisions();0<c.length&&this.unit.resolveactionselection(c,function(a){this.detonate(c[a],!0)}.bind(this))}},getOutline:function(b){return s.path(this.getOutlineString(b).s).appendTo(VIEWPORT)},getOutlineString:function(b){"undefined"==typeof b&&(b=this.m);var a=transformPoint(b,{x:-16,y:-15}),c=transformPoint(b,{x:16,y:-15}),e=transformPoint(b,{x:16,y:15});b=transformPoint(b,{x:-16,y:15});a=this.op=[a,c,e,b];return{s:"M "+a[0].x+" "+a[0].y+" L "+a[1].x+" "+a[1].y+" "+a[2].x+" "+a[2].y+
" "+a[3].x+" "+a[3].y+" Z",p:a}},explode_base:function(){this.exploded=!0;this.unit.log("%0 explodes",this.name);SOUNDS[this.snd].play();this.g.remove();BOMBS.splice(BOMBS.indexOf(this),1)},explode:function(){this.explode_base()},detonate:function(b,a){OBSTACLES.splice(OBSTACLES.indexOf(this),1);this.explode_base()},endround:function(){},show:function(){}};
function Weapon(b,a){this.isprimary=!1;this.issecondary=!0;$.extend(this,a);b.upgrades[b.upgrades.length]=this;this.wrapping=[];this.ordnance=0;this.isactive=!0;this.unit=b;this.lastattackroll=-1;b.weapons.push(this)}
function Laser(b,a,c){c={type:a,name:"Laser",isactive:!0,attack:c,range:[1,3],isprimary:!0,issecondary:!1};switch(a){case "Bilaser":case "Mobilelaser":c.auxiliary=AUXILIARY;c.subauxiliary=SUBAUXILIARY;break;case "Laser180":c.auxiliary=function(a,b){return this.getHalfRangeString(a,b)},c.subauxiliary=function(a,b,c){return this.getHalfSubRangeString(a,b,c)}}return new Weapon(b,c)}
Weapon.prototype={wrap_before:Unit.prototype.wrap_before,wrap_after:Unit.prototype.wrap_after,isBomb:function(){return!1},isWeapon:function(){return!0},showOrdnance:function(){return this+1},desactivate:function(){0<this.ordnance&&this.type.match(/Torpedo|Missile|Bomb|Illicit/)?--this.ordnance:this.isactive=!1},toString:function(){this.tooltip=formatstring(getupgtxttranslation(this.name,this.type));this.trname=translate(this.name).replace(/\'/g,"&#39;");this.left=1==this.unit.team;if(this.isactive){var b,
a=this.getrangeallunits();for(b=0;b<a.length&&!a[b].isenemy(this.unit);b++);this.nofire=b==a.length?!0:!1}this.attackkey=A[this.type.toUpperCase()].key;this.req=[];"undefined"!=typeof this.getrequirements()&&("Target".match(this.getrequirements())&&this.req.push([A.TARGET.key]),"Focus".match(this.getrequirements())&&this.req.push(A.FOCUS.key));this.uid=squadron.indexOf(this.unit);this.rank=this.unit.upgrades.indexOf(this);return Mustache.render(TEMPLATES.weapon,this)},prehit:function(b,a,c){},posthit:function(b,
a,c){},getrequirements:function(){return this.requires},getattack:function(){return this.attack},isTurret:function(){return this.type==Unit.TURRET},getlowrange:function(){return this.range[0]},gethighrange:function(){return this.range[1]},isinrange:function(b){return b>=this.getlowrange()&&b<=this.gethighrange()},modifydamagegiven:function(b){return b},modifyattackroll:function(b,a,c){return b},modifydamageassigned:function(b,a){return b},canfire:function(b){return"undefined"==typeof b?!0:!this.isactive||
b.isdocked||this.unit.isally(b)||this.unit.checkcollision(b)?!1:"undefined"!=typeof this.getrequirements()?"Target".match(this.getrequirements())&&this.unit.canusetarget(b)||"Focus".match(this.getrequirements())&&this.unit.canusefocus()?!0:!1:!0},getrangeattackbonus:function(b){return this.isprimary&&1==this.getrange(b)?(this.unit.log("+1 attack for range 1"),1):0},declareattack:function(b){"undefined"!=typeof this.getrequirements()&&(this.twinattack=!1,"Target".match(this.getrequirements())&&!0===
this.consumes&&this.unit.canusetarget(b)?this.unit.removetarget(b):"Focus".match(this.getrequirements())&&!0===this.consumes&&this.unit.canusefocus(b)&&this.unit.removefocustoken());return!0},getrangedefensebonus:function(b){return this.isprimary&&3==this.getrange(b)?(b.log("+1 defense for range 3"),1):0},getauxiliarysector:function(b){return"undefined"==typeof this.auxiliary?4:this.unit.getauxiliarysector(b,this.unit.m,this.subauxiliary,this.auxiliary)},getprimarysector:function(b){return this.unit.getprimarysector(b,
this.unit.m)},getsector:function(b){var a=this.unit.m,c=this.unit.getprimarysector(b,a);return 4>c?c:"undefined"==typeof this.auxiliary?4:"undefined"==typeof this.auxiliary||this.type.match(/Turretlaser|Bilaser|Mobilelaser|Laser180|Laser|Turret/)?this.unit.getauxiliarysector(b,a):this.getauxiliarysector(b)},getrange:function(b){if(!this.canfire(b))return 0;if(this.isTurret()||this.unit.isTurret(this))return b=this.unit.getrange(b),this.isinrange(b)?b:0;b=this.getsector(b);return b>=this.getlowrange()&&
b<=this.gethighrange()?b:0},endattack:function(b,a){this.type.match(/Torpedo|Missile/)&&1!=this.twinattack&&this.desactivate()},hasdoubleattack:function(){return!1},hasenemiesinrange:function(){for(var b in squadron){var a=squadron[b];if(this.unit.isenemy(a)&&0<this.getrange(a))return!0}return!1},getenemiesinrange:function(b){var a=[];"undefined"==typeof b&&(b=squadron);for(var c in b){var e=b[c];!e.isdocked&&e.isenemy(this.unit)&&0<this.getrange(e)&&a.push(e)}return a},getrangeallunits:function(){var b,
a=[];for(b in squadron){var c=squadron[b];this.unit!=c&&0<this.getrange(c)&&a.push(c)}return a},endround:function(){},show:function(){}};
function Upgradefromid(b,a){var c=UPGRADES[a];c.id=a;return c.type==Unit.BOMB?"undefined"==typeof c.isBomb||c.isBomb()?new Bomb(b,c):new Upgrade(b,a):"undefined"!=typeof c.isWeapon?c.isWeapon()?new Weapon(b,c):new Upgrade(b,a):c.type.match(/Turretlaser|Bilaser|Mobilelaser|Laser180|Laser|Torpedo|Cannon|Missile|Turret/)||!0===c.isweapon?new Weapon(b,c):new Upgrade(b,a)}
function Upgrade(b,a){$.extend(this,UPGRADES[a]);b.upgrades.push(this);this.isactive=!0;this.unit=b;this.wrapping=[];this.ordnance=0}
Upgrade.prototype={wrap_before:Unit.prototype.wrap_before,wrap_after:Unit.prototype.wrap_after,toString:function(){this.tooltip=formatstring(getupgtxttranslation(this.name,this.type));this.trname=translate(this.name).replace(/\'/g,"&#39;");this.left=1==this.unit.team;this.hasshield="undefined"!=typeof this.shield&&0<this.shield?!0:!1;this.hasfocus="undefined"!=typeof this.focus&&0<this.focus?!0:!1;if("undefined"!=typeof this["switch"]&&this.canswitch()){for(var b=0;b<this.unit.upgrades.length&&this.unit.upgrades[b]!=
this;b++);this.hasswitch={uid:this.unit.id,uuid:b}}else this.hasswitch=!1;return Mustache.render(TEMPLATES.upgrade,this)},isWeapon:function(){return!1},isBomb:function(){return!1},showOrdnance:function(){return this+1},getlowrange:function(){return this.range[0]},gethighrange:function(){return this.range[1]},endround:function(){},desactivate:function(){0<this.ordnance&&this.type.match(/Torpedo|Missile|Bomb|Illicit/)?--this.ordnance:(this.isactive=!1,this.unit.movelog("D-"+this.unit.upgrades.indexOf(this)),
this.unit.show())},show:function(){},install:function(b){if("undefined"!=typeof this.addedaction){var a=this.addedaction.toUpperCase();b["addedaction"+this.id]=b.shipactionList.length;b.shipactionList.push(a);b.showactionlist()}"undefined"!=typeof this.upgrades&&(b["addedupg"+this.id]=b.upgradesno,"undefined"!=typeof this.pointsupg&&(b.upgbonus[this.upgrades[0]]=this.pointsupg),"undefined"!=typeof this.maxupg&&(b.maxupg[this.upgrades[0]]=this.maxupg),!0===this.exclusive&&(b.exclupg[this.upgrades[0]]=
!0),b.upgradetype=b.upgradetype.concat(this.upgrades),b.upgradesno=b.upgradetype.length,b.showupgradeadd());if("undefined"!=typeof this.lostupgrades){for(a=0;a<b.upgradetype.length;a++)-1<this.lostupgrades.indexOf(b.upgradetype[a])&&(-1<b.upg[a]&&removeupgrade(b,a,b.upg[a]),b.upg[a]=-2);b.showupgradeadd()}if("undefined"!=typeof this.takesdouble){for(var a=[],c=0,e=0;e<b.upgradetype.length;e++)b.upgradetype[e]==this.type&&a.push({index:e});for(e=0;e<b.upgrades.length;e++)b.upgrades[e].type===this.type&&
("undefined"===typeof b.upgrades[e].takesdouble||!1===b.upgrades[e].takesdouble?c++:c+=2);if(c>a.length)removeupgrade(b,a[a.length-2].index,this.id);else for(var f in a)if(-1==b.upg[a[f].index]){b.upg[a[f].index]=-2;break}b.showupgradeadd()}},uninstall:function(b){var a;"undefined"!=typeof this.addedaction&&(this.addedaction.toUpperCase(),b.shipactionList.splice(b["addedaction"+this.id],1));if("undefined"!=typeof this.upgrades){"undefined"!=typeof this.pointsupg&&(b.upgbonus[this.upgrades[0]]=0);
"undefined"!=typeof this.maxupg&&(b.maxupg[this.upgrades[0]]=0);for(a=0;a<this.upgrades.length;a++){var c=a+b["addedupg"+this.id],e=$("#unit"+b.id+" .upg div[num="+c+"]");0<e.length&&(e=e.attr("data"),removeupgrade(b,c,e))}b.upgradetype.splice(b["addedupg"+this.id],this.upgrades.length);b.upgradesno=b.upgradetype.length}if("undefined"!=typeof this.lostupgrades)for(a=0;a<b.upgradetype.length;a++)-1<this.lostupgrades.indexOf(b.upgradetype[a])&&(b.upg[a]=-1);if("undefined"!=typeof this.takesdouble)for(a=
0;a<b.upgradetype.length;a++)if(b.upgradetype[a]==this.type&&-2==b.upg[a]){b.upg[a]=-1;break}for(a in b.upgrades)if(b.upgrades[a].type==this.type&&b.upgrades[a].id==this.id){b.upgrades.splice(a,1);break}}};var IACOMPUTING=0,JOUSTER=0,ALONE=1;function IAUnit(){}
IAUnit.prototype={IAinit:function(){"undefined"!==typeof this.init?(this.init.shield=this.shield,this.init.hull=this.hull,this.init.m=this.m):this.init={shield:this.shield,hull:this.hull,m:this.m};this.ia=!0},confirm:function(b){return!0},chooseBombDrop:function(b){if(1>=b.length)return b;var a,c,e=9999.9,f,h;h=[];for(i in squadron)c=squadron[i],this.isenemy(c)&&2>=this.getrange(c)&&h.push(c.m);if(1===h.length)h=h[0];else{f=c=0;for(v in h)c+=h[v].e,f+=h[v].f;c=1*c/h.length;f=1*f/h.length;h=new Snap.Matrix(1,
0,0,1,c,f)}for(var l in b)c=Math.abs(b[l].e-h.e),f=Math.abs(b[l].f-h.f),c=Math.sqrt(c*c+f*f),c<e&&(a=l,e=c);return[b[a]]},guessevades:function(b,a){this.rand(b.dice+1)==Unit.FE_evade(b.roll)&&(this.log("guessed correctly the number of evades ! +1 %EVADE% [%0]",self.name),b.roll+=Unit.FE_EVADE,b.dice+=1);a.resolve(b)},findpositions:function(b){var a=this.shipactionList.length,c=0,e;for(e in this.upgrades)this.upgrades[e].name.match(/Push the Limit|Experimental Interface/)?c+=1:"undefined"!==typeof this.upgrades[e].action&&
(a+=1);this.name.match(/Darth Vader/)&&(c+=1);e=[];var f,h=[GREEN,WHITE,YELLOW,RED];for(f=0;f<b.length;f++){var l=b[f];if(l.color!=BLACK){var t=this.getpathmatrix(this.m,b[f].move),x=24-8*h.indexOf(l.color);l.color==RED&&(x-=20);l.color==BLACK&&(x=-100);var q=this.m;this.m=t;t=this.evaluateposition();x+=t.self-t.enemy-t.dist;"GREEN"!=l.difficulty||l.color!=GREEN&&l.color!=WHITE||(x+=(c+a)*this.stress);"RED"==l.difficulty&&(x-=1.5);this.m=q;e.push({n:x,m:f})}}return e},findallpositions:function(b){var a,
c,e,f=[],h=[GREEN,WHITE,YELLOW,RED,BLACK];for(c=0;c<b.length;c++){a=b[c];e=24-8*h.indexOf(a.color);a.color==WHITE&&(e+=8);a.color==RED&&(e-=20);a.color==BLACK&&(e=-100);"RED"==a.difficulty&&(e-=1.5);e*=this.squad.length;for(a=0;a<this.squad.length;a++){var l=this.squad[a],t=l.getpathmatrix(l.m,b[c].move),x=l.m;l.m=t;t=l.evaluateposition();e+=t.self-1*t.enemy-t.dist;l.m=x}f.push({n:e,m:c})}return f},computeallmaneuvers:function(){var b,a=[],c=this.getskill();for(b in squadron){var a=squadron[b],e=
a.getskill();a.oldm=a.m;e<c&&(a.team!=this.team?(a.meanmround!=round&&a.evaluatemoves(!1,!1),a.m=a.meanm):("undefined"==typeof a.futurem&&(a.futurem=a.m),a.m=a.futurem))}this.evaluategroupmoves();a=this.findallpositions(this.captaingd);for(b in squadron)squadron[b].m=squadron[b].oldm;if(0<a.length){a.sort(function(a,b){return b.n-a.n});c=this.captaingd[a[0].m].idx;e=this.captaingd[a[0].m].move;for(b=0;b<c.length;b++)a=this.squad[b],a.lastmaneuver=a.maneuver,a.maneuver=c[b],a.futurem=a.getpathmatrix(a.m,
e);nextplanning()}else console.log("(q=vide) UNDEFINED GD FOR "+this.name);this.log("Group maneuver set")},computemaneuver:function(){var b,a=this.getdial(),c=this.getskill();for(b in squadron){var e=squadron[b],f=e.getskill();e.oldm=e.m;f<c&&(e.team!=this.team?(e.meanmround!=round&&e.evaluatemoves(!1,!1),e.m=e.meanm):("undefined"==typeof e.futurem&&(e.futurem=e.m),e.m=e.futurem))}this.evaluatemoves(!0,!0);c=this.findpositions(a);for(b in squadron)squadron[b].m=squadron[b].oldm;if(0<c.length)c.sort(function(a,
b){return b.n-a.n}),b=c[0].m;else for(b=0;b<a.length&&"RED"==a[b].difficulty&&!a[b].move.match(/F\d/);b++);this.futurem=this.getpathmatrix(this.m,a[b].move);this.log("Maneuver set");return b},resolveactionselection:function(b,a){a(0)},selectcritical:function(b,a){for(var c=0;c<b.length;c++)if(0==CRITICAL_DECK[b[c]].lethal){a(b[c]);return}a(b[0])},resolveactionmove:function(b,a,c,e,f){var h,l=!1,t=-1E3;e=-1;var x=this.m;for(h=0;h<b.length;h++)if(this.getmovecolor(b[h],!0,!0)==GREEN){var q,l=!0;"array"==
typeof f?q=f[h]:(this.m=b[h],q=this.evaluateposition(),q=q.self-q.enemy-q.dist);t<q&&(t=q,e=h)}this.m=x;if(l&&-1<e){c&&(c=b[e].split(),f=this.m.split(),s.path("M "+f.dx+" "+f.dy+" L "+c.dx+" "+c.dy).appendTo(VIEWPORT).attr({stroke:this.color,display:TRACE?"block":"none",strokeWidth:"20px",strokeLinecap:"round",strokeDasharray:"1, 30",opacity:.2,fill:"rgba(0,0,0,0)"}).addClass("trace"),this.show(),this.m=b[e],c=this.m.split(),this.movelog("am-"+Math.floor(300+c.dx)+"-"+Math.floor(300+c.dy)+"-"+Math.floor((360+
Math.floor(c.rotate))%360)));b=this.getmcollisions(this.m);if(0<b.length)for(h=0;h<b.length;h++)"function"==typeof OBSTACLES[b[h]].detonate?OBSTACLES[b[h]].detonate(this):(this.log("colliding with obstacle"),this.resolveocollision(1,[]));a(this,e)}else this.m=x,a(this,-1)},doplan:function(){$("#move").css({display:"none"});$("#maneuverdial").empty();this.squad=[];if(this.behavior==JOUSTER){var b=this.squad,a;for(a in b)b[a].captain=null,b[a].squad=[];this.electcaptain()}if(this.behavior==JOUSTER)if(this==
this.captain){console.log("captain for team "+this.team+" is:"+this.name);console.log("surrounded by "+this.selectnearbyally(3).length+" units");IACOMPUTING++;1==IACOMPUTING&&($("#npimg").hide(),$("#npimgwait").show());var c;c=setInterval(function(){this.computeallmaneuvers();IACOMPUTING--;0==IACOMPUTING&&($("#npimg").show(),$("#npimgwait").hide());clearInterval(c)}.bind(this),0)}else-1==this.maneuver&&(this.maneuver=0),nextplanning();else phase==PLANNING_PHASE&&-1==this.maneuver&&(IACOMPUTING++,
1==IACOMPUTING&&($("#npimg").hide(),$("#npimgwait").show()),c=setInterval(function(){var a=this.computemaneuver();IACOMPUTING--;0==IACOMPUTING&&($("#npimg").show(),$("#npimgwait").hide());this.newm=this.getpathmatrix(this.m,this.getdial()[a].move);this.setmaneuver(a);clearInterval(c)}.bind(this),0));return this.deferred},showdial:function(){$("#maneuverdial").empty();phase>=PLANNING_PHASE&&(-1==this.maneuver||this.hasmoved)&&this.clearmaneuver()},resolvedecloak:function(){for(var b=this.getdecloakmatrix(this.m),
a=this.getdial()[this.maneuver].move,c=[],e=this.m,f=0;f<b.length;f++){this.m=this.getpathmatrix(b[f],a);var h=this.evaluateposition();c[f]=h.self-h.enemy-h.dist}this.m=e;this.resolveactionmove(b,function(a,b){0<b&&(this.removecloaktoken(),a.show());this.hasdecloaked=!0}.bind(this),!0,c)},showactivation:function(){},timetoshowmaneuver:function(){return-1<this.maneuver&&skillturn>=this.getskill()&&phase==ACTIVATION_PHASE&&subphase==ACTIVATION_PHASE},updateactivationdial:function(){this.activationdial=
[];if(!(this.candropbomb()&&this.hasionizationeffect()||this.lastdrop==round))switch(this.bombs.length){case 3:this.bombs[2].canbedropped()&&this.activationdial.push({action:this.bombs[2].actiondrop,org:this.bombs[2],type:this.bombs[2].type,name:this.bombs[2].name});case 2:this.bombs[1].canbedropped()&&this.activationdial.push({action:this.bombs[1].actiondrop,org:this.bombs[1],type:this.bombs[1].type,name:this.bombs[1].name});case 1:this.bombs[0].canbedropped()&&this.activationdial.push({action:this.bombs[0].actiondrop,
org:this.bombs[0],type:this.bombs[0].type,name:this.bombs[0].name})}return this.activationdial},doactivation:function(){var b=this.updateactivationdial();0<b.length&&this.donoaction(b);this.timeformaneuver()&&this.resolvemaneuver()},showaction:function(){$("#actiondial").empty();if(-1<this.action&&this.action<this.actionList.length){var b=A[this.actionList[this.action]].color;this.actionicon.attr({fill:this==activeunit?b:halftone(b)})}else this.actionicon.attr({text:""})},donoaction:function(b,a){b.sort(function(a,
b){return"CRITICAL"==a.type?-1:"CRITICAL"==b.type?1:"EVADE"==a.type?-1:"EVADE"==b.type?1:"FOCUS"==a.type?-1:"FOCUS"==b.type?1:0});return this.enqueueaction(function(c){this.select();"undefined"!=typeof a&&""!=a&&this.log(a);for(var e=null,f=0;f<b.length;f++)if("CRITICAL"==b[f].type){e=b[f];break}else if("EVADE"==b[f].type&&this.candoevade()){var h=!0,l=this.getenemiesinrange();for(j=0;j<l.length;j++)if(0<l[j].length){h=!1;break}if(h){e=b[f];break}else if(1<=this.focus){e=b[f];break}}else if("FOCUS"==
b[f].type){if(this.candofocus()){e=b[f];break}}else if("undefined"!==typeof b[f].org.aiactivate){if(b[f].org.aiactivate()){e=b[f];break}}else{e=b[f];break}this.resolvenoaction(e,c)}.bind(this),"donoaction ia")},doaction:function(b,a,c){var e;"undefined"==typeof c&&(c=this.candoaction);for(e=0;e<b.length;e++)this.setpriority(b[e]);b.sort(function(a,b){return b.priority-a.priority});return 0==b.length?this.enqueueaction(function(a){this.endnoaction(a)}.bind(this)):this.enqueueaction(function(e){var f;
if(c.call(this)){this.select();"undefined"!=typeof a&&""!=a&&this.log(a);var l=null;for(f=0;f<b.length;f++)if("CRITICAL"==b[f].type){l=b[f];break}else if("CLOAK"==b[f].type&&this.candocloak()){l=b[f];break}else if("EVADE"==b[f].type&&this.candoevade()){l=b[f];break}else if("TARGET"==b[f].type&&this.candotarget()){l=b[f];break}else if("FOCUS"==b[f].type){if(this.candofocus()){l=b[f];break}}else if("undefined"!==typeof b[f].org.aiactivate){if(b[f].org.aiactivate()){l=b[f];break}}else{l=b[f];break}this.resolveaction(l,
e)}else this.endaction(e)}.bind(this),"doaction ia")},showattack:function(){},doattack:function(b,a){var c=0,e=null,f,h,l;NOLOG=!0;"undefined"==typeof b&&(b=this.weapons);var t=this.getenemiesinrange(b,a);for(h=0;h<b.length;h++){var x=t[h];l=this.weapons.indexOf(b[h]);for(f=0;f<x.length;f++){var q=this.evaluatetohit(l,x[f]).tohit;q>c&&!x[f].isdocked&&(e=x[f],c=q,this.activeweapon=l)}}NOLOG=!1;if(null!=e)return this.selecttargetforattack(this.activeweapon,[e]);this.addhasfired();this.cleanupattack();
return!1},getresultmodifiers:function(b,a,c,e){var f=this.getdicemodifiers();NOLOG=!1;for(var h=0;h<f.length;h++){var l=f[h];l.from==c&&l.to==e&&(l.type==Unit.MOD_M&&l.req(b,a)&&("function"==typeof l.aiactivate&&1!=l.aiactivate(b,a)||modroll(l.f,h,e)),l.type==Unit.ADD_M&&l.req(b,a)&&("function"==typeof l.aiactivate&&1!=l.aiactivate(b,a)||addroll(l.f,h,e)),l.type==Unit.REROLL_M&&l.req(activeunit,activeunit.weapons[activeunit.activeweapon],targetunit)&&("function"!=typeof l.aiactivate||1==l.aiactivate(b,
a))&&(0<$(".blankreddice").length||0<$(".focusreddice").length&&0==this.focuses.length)&&("function"==typeof l.f&&l.f(),reroll(a,c,e,l,h)))}return[]}};Critical=window.Critical||{};function metaUnit(){this.ordnance=!1;this.touching=[];this.evade=this.stress=this.focus=0;this.targeting=[]}
metaUnit.prototype={resolveactionselection:function(b,a){a(0)},selectcritical:function(b,a){for(var c=0;c<b.length;c++)if(0==Critical.CRITICAL_DECK[b[c]].lethal){a(b[c]);return}a(b[0])},animateaddtoken:function(){},animateremovetoken:function(){},dodecloak:function(){-1<this.shipactionList.indexOf("CLOAK")&&this.resolvedecloak()},resolvedecloak:function(){for(var b=[],a=0,c=0;c<this.moves.length;c++)for(var e=this.getdecloakmatrix(this.moves[c]),f=0;f<e.length;f++)b[a++]=e[f];this.moves=b},isactiondone:function(b){return!1},
addiontoken:function(){},addstress:function(){this.stress++},addevadetoken:function(){this.evade++},removeevadetoken:function(){this.evade--},removestresstoken:function(){this.stress--},addtarget:function(b){for(b=0;b<this.moves.length;b++)this.moves[b].targeting=[targetunit];this.targeting=[targetunit]},removetarget:function(b){console.log("removetarget meta");b=this.targeting.indexOf(b);-1<b&&this.targeting.splice(b,1)},addfocustoken:function(){this.focus++},removefocustoken:function(){this.focus--},
initcounters:function(b){b.BOOST=!1;b.ROLL=!1;b.focus=0;b.stress=0;b.evade=0;b.move="";b.reroll=0;b.targeting=[];this.m=b},resolvemaneuver:function(){var b,a,c;this.reroll=this.focus=this.evade=this.stress=this.maneuver=c=0;this.targeting=[];var e=this.getmaneuverlist(),f=[];for(b in e){var h=e[b];for(a=0;a<this.moves.length;a++){var l;this.evade=this.focus=this.stress=0;this.targeting=[];l=this.getpathmatrix(this.moves[a],h.move,h.halfturn);this.initcounters(l);this.handledifficulty(h.difficulty);
l.stress=this.stress;l.focus=this.focus;l.evade=this.evade;l.reroll=0;l.targeting=this.targeting;l.move=h.move;f[c++]=l}}this.moves=f;this.endmaneuver()},endmaneuver:function(){this.candoendmaneuveraction()&&this.doendmaneuveraction()},candoendmaneuveraction:function(){return!0},doendmaneuveraction:function(){this.doaction(this.getactionlist(!0))},movelog:function(){},showdial:function(){},showactivation:function(){},timetoshowmaneuver:function(){},doactivation:function(){this.beginactivation();this.premove();
this.dodecloak();this.resolvemaneuver();this.endactivationphase()},log:function(){},beginactivation:function(){},endactivationphase:function(){},showaction:function(){},donoaction:function(b,a){this.doaction(b,a)},resolveboost:function(){for(var b=[],a=0,c=0;c<this.moves.length;c++){var e=this.moves[c];if(!e.BOOST)for(var f=this.getboostmatrix(e),h=0;h<f.length;h++)f[h].BOOST=!0,f[h].ROLL=e.ROLL,f[h].reroll=0,f[h].stress=e.stress,f[h].focus=e.focus,f[h].evade=e.evade,f[h].move=e.move,f[h].targeting=
e.targeting,b[a++]=f[h];b[a++]=e}this.moves=b;this.endaction(0,"BOOST")},resolvefocus:function(){for(var b=[],a=0;a<this.moves.length;a++)b[a]=this.moves[a].clone(),b[a].stress=this.moves[a].stress,b[a].move=this.moves[a].move,b[a].evade=this.moves[a].evade,b[a].targeting=this.targeting,b[a].reroll=0,b[a].focus=1;this.moves=b;this.endaction(0,"FOCUS")},resolveevade:function(){for(var b=[],a=0;a<this.moves.length;a++)b[a]=this.moves[a].clone(),b[a].stress=this.moves[a].stress,b[a].move=this.moves[a].move,
b[a].targeting=this.targeting,b[a].reroll=0,b[a].focus=this.moves[a].evade,b[a].evade=1;this.moves=b;this.endaction(0,"EVADE")},resolvetargetnoaction:function(b,a){for(var c=[],e=0;e<this.moves.length;e++)c[e]=this.moves[e].clone(),c[e].move=this.moves[e].move,c[e].targeting=[targetunit],c[e].focus=this.moves[e].focus,c[e].evade=this.moves[e].evade,c[e].reroll=0,c[e].stress=this.moves[e].stress;this.moves=c;this.endaction(0,"TARGET")},gettargetableunits:function(b){return b==this.range?[targetunit]:
[]},selectunit:function(b,a){0<b.length&&a.call(this,b,0)},resolveroll:function(){for(var b=[],a=0,c=0;c<this.moves.length;c++){var e=this.moves[c];if(!e.ROLL)for(var f=this.getrollmatrix(e),h=0;h<f.length;h++)f[h].ROLL=!0,f[h].BOOST=e.BOOST,f[h].reroll=0,f[h].focus=e.focus,f[h].evade=e.evade,f[h].stress=e.stress,f[h].move=e.move,f[h].targeting=e.targeting,b[a++]=f[h];b[a++]=e}this.moves=b;this.endaction(0,"ROLL")},uniquearray:function(b){for(var a={},c=[],e=0,f=b.length;e<f;++e)a.hasOwnProperty(b[e])||
(c.push(b[e]),a[b[e]]=1);return c},doaction:function(b,a,c){a=[];c=[];var e=0,f=0,h=[],l;for(l=0;l<this.moves.length;l++)this.stress=0,0<this.moves[l].stress&&(this.stress=this.moves[l].stress),this.hasnostresseffect()?a[e++]=this.moves[l]:c[f++]=this.moves[l];for(l=0;l<b.length;l++){this.moves=a;switch(b[l].type){case "ROLL":this.resolveroll();break;case "BOOST":this.resolveboost();break;case "FOCUS":this.resolvefocus();this.addfocustoken();break;case "TARGET":this.resolvetarget(0,!1);break;case "ELITE":b[l].action.call(b[l].org,
0);break;case "EVADE":this.resolveevade(),this.addevadetoken()}h=h.concat(this.moves)}this.moves=h.concat(c);return $.Deferred().resolve().promise()},resolveactionmove:function(b,a){for(var c=0;c<b.length;c++)console.log("ram:"+b[c])},candotarget:function(){return!0},candoaction:function(){return!0},candoroll:function(){return!0},candoboost:function(){return!0},endaction:function(b,a){},getmaneuverlist:function(){for(var b=this.getdial(),a={},c=0;c<b.length;c++)a[b[c].move]=b[c];return a},getrange:function(){return this.range},
getsector:function(){return this.range},getoutlinerange:function(b,a){return{d:this.range}},isinsector:function(){return!0},checkcollision:function(){return!1},isally:function(){return!1},isenemy:function(b){return b==targetunit||this==targetunit},begincombatphase:function(){},selectnearbyenemy:function(b){return this.range==b?[targetunit]:[]},doselection:function(){},setinfo:function(b,a){var c=a.pageX+20,e=a.pageY;return $(".info").css({left:c,top:e}).html(formatstring(b)).appendTo("body").show()},
resolveattack:function(b,a){},cleanupattack:function(){},computeproba:function(b,a,c){this.evade=Math.floor(c/60);this.targeting=1==Math.floor(c/10)%2?[targetunit]:[];this.focus=Math.floor(c/20)%2;this.stress=Math.floor(c/40)%2;if(0==b.getrange(targetunit))return null;b.declareattack(targetunit);this.resolveattack(b,targetunit);var e=this.getattackstrength(a,targetunit),f=targetunit.getdefensestrength(a,this);a=this.modifyattackdefense(e,f,targetunit,a);e=a.a;f=a.d;this.reroll=0<this.targeting.length?
9:c%10;b=tohitproba(this,b,targetunit,ATTACK[e],DEFENSE[f],e,f);targetunit.cleanupattack();return b},showattack:function(b,a){for(var c,e=[],f=0,h,l,t=this.getprimarysector,x=this.getauxiliarysector,q=3;1<=q;q--){this.range=q;this.begincombatphase();c=this.moves;l=[];for(h=0;h<c.length;h++){var m=10*(8*c[h].evade+4*c[h].stress+2*c[h].focus+(0<c[h].targeting.length?1:0))+c[h].reroll;l[m]=[]}for(var r=0;r<b.length;r++){var y=b[r],B;activeweapon=r;if(y.isactive){y.isTurret()||this.isTurret(y)?B=this.getSubRangeString:
(B=this.getPrimarySubSectorString,this.getprimarysector=t,this.getauxiliarysector=function(){return 4});for(h in l)m=this.computeproba(y,r,h),null!=m&&(l[h][r]=m);for(h=0;h<c.length;h++)m=10*(8*c[h].evade+4*c[h].stress+2*c[h].focus+(0<c[h].targeting.length?1:0))+c[h].reroll,"undefined"!=typeof l[m][r]&&(e[f++]={f:B,proba:l[m][r],m:c[h],range:q});if("undefined"!=typeof y.subauxiliary){B=y.subauxiliary;this.getprimarysector=function(){return 4};this.getauxiliarysector=x;for(h in l)m=this.computeproba(y,
r,h),null!=m&&(l[h][r]=m);for(h=0;h<c.length;h++)m=10*(8*c[h].evade+4*c[h].stress+2*c[h].focus+(0<c[h].targeting.length?1:0))+c[h].reroll,"undefined"!=typeof l[m][r]&&(e[f++]={f:B,proba:l[m][r],m:c[h],range:q})}}}}this.focus=0;this.targeting=[];this.evade=this.stress=0;this.getprimarysector=t;this.getauxiliarysector=x;e.sort(function(a,b){var c=a.proba.tohit-b.proba.tohit;return 0<c?1:0>c?-1:0});for(f=0;f<e.length;f++)c=e[f],h=50,l=100,50>c.proba.tohit&&(h=Math.round(c.proba.tohit/2+25)),80<c.proba.tohit&&
(l=100-(c.proba.tohit-80)),h="hsl("+Math.round(1.2*(100-c.proba.tohit))+","+l+","+h+")",c.parent=this,a.path(c.f.call(this,c.range-1,c.range,c.m)).hover(function(a){$(".info").show();var b=this.m.move;this.parent.setinfo(this.proba.tohit+"%<br/>"+P[b].speed+"<span class='symbols'>"+P[b].key+"</span>"+(this.m.focus?"+%FOCUS%":"")+(this.m.BOOST?"+%BOOST%":"")+(this.m.ROLL?"+%ROLL%":"")+(this.m.evade?"+%EVADE%":"")+(0<this.m.targeting.length?"+%TARGET%":""),a)}.bind(c),function(){$(".info").hide()}.bind(this)).attr({fill:h});
return!1}};(function(){var b=window.Critical||{},a=window.Unit||{},c=function(){var a=[];!this.hasionizationeffect()&&this.candoaction()&&(this.candoboost()&&a.push(this.newaction(this.resolveboost,"BOOST")),this.candoroll()&&a.push(this.newaction(this.resolveroll,"ROLL")),this.doaction(a,"free %BOOST% or %ROLL% action"))},e=function(){this.firstroundhit=-1;this.wrap_after("resolveishit",this,function(a){this.firstroundhit<round&&(this.firstroundhit=round,new Condition(a,this,"I'll Show You The Dark Side"))})},
f=function(){this.adddicemodifier(a.DEFENSE_M,a.MOD_M,a.DEFENSE_M,this,{req:function(a,b){return 0<this.stress}.bind(this),f:function(b,c){var e=a.FE_focus(b);2<e&&(e=2);return 0<e?(this.log("%0 %FOCUS% -> %0 %EVADE%",e),b-e*a.FE_FOCUS+e*a.FE_EVADE):b}.bind(this),str:"focus"})},h=function(b,c){this.log("cancel %CRIT% first");b=this.cancelcritical(b,c);return b=a.prototype.cancelhit(b,c)},l=function(){var c=this;a.prototype.wrap_after("deal",this,function(a,e,f){var h=$.Deferred();f.then(function(a){if(a.face==
b.FACEUP&&attackunit==c&&targetunit==this){a=this.selectdamage();b.CRITICAL_DECK[a].count--;var e=this.selectdamage();b.CRITICAL_DECK[e].count--;var f=this.selectdamage();b.CRITICAL_DECK[f].count--;a=[a,e,f];c.log("select one critical");c.selectcritical(a,function(a){h.resolve({crit:new b(this,a),face:b.FACEUP})}.bind(this))}else h.resolve(a)}.bind(this));return h.promise()})},t=function(){this.wrap_after("modifyattackroll",this,function(b,c,e,f){0<a.FCH_focus(f)&&(f=f-a.FCH_FOCUS+a.FCH_HIT);return f}.bind(this));
this.adddicemodifier(a.ATTACK_M,a.MOD_M,a.ATTACK_M,this,{req:function(a,b){return 0<this.focus}.bind(this),aiactivate:function(b,c){return 0<a.FCH_focus(b)},f:function(b,c){return 0<a.FCH_focus(b)?(this.log("1 %FOCUS% -> 1 %HIT%"),b-a.FCH_FOCUS+a.FCH_HIT):b}.bind(this),str:"focus"});this.adddicemodifier(a.DEFENSE_M,a.MOD_M,a.DEFENSE_M,this,{req:function(a,b){return 0<this.focus}.bind(this),aiactivate:function(b,c){return 0<a.FE_focus(b)},f:function(b,c){return 0<a.FE_focus(b)?(this.log("1 %FOCUS% -> 1 %EVADE%"),
b-a.FE_FOCUS+a.FE_EVADE):b}.bind(this),str:"focus"})},x=function(a){var b,c=this.getdial(),e;for(e in a)if(b=a[e],("RED"==b.difficulty||"GREEN"==b.difficulty)&&!this.hasionizationeffect())for(e=0;e<c.length;e++)c[e].difficulty==b.difficulty&&(a[c[e].move]=c[e]);return a};window.PILOTS=[{name:"Contracted Scout",faction:a.SCUM,pilotid:0,done:!0,unit:"JumpMaster 5000",skill:3,points:25,upgrades:[a.ELITE,a.CREW,a.ILLICIT]},{name:"Wedge Antilles",done:!0,unique:!0,faction:a.REBEL,unit:"X-Wing",skill:9,
init:function(){this.wrap_before("resolveattack",this,function(a,b){b.log("-1 defense [%0]",this.name);b.wrap_after("getagility",this,function(a){return 0<a?a-1:a}).unwrapper("cleanupattack");b.showstats()})},pilotid:1,points:29,upgrades:[a.ELITE,a.TORPEDO,a.ASTROMECH]},{name:"Garven Dreis",done:!0,faction:a.REBEL,unique:!0,unit:"X-Wing",init:function(){this.wrap_after("removefocustoken",this,function(){this.selectunit(this.selectnearbyally(2),function(a,b){a[b].log("+1 %FOCUS%");a[b].addfocustoken()}.bind(this),
["select unit for free %FOCUS%"],!1)})},pilotid:2,skill:6,points:26,upgrades:[a.TORPEDO,a.ASTROMECH]},{name:"Red Squadron Pilot",done:!0,unit:"X-Wing",faction:a.REBEL,skill:4,points:23,pilotid:3,upgrades:[a.TORPEDO,a.ASTROMECH]},{name:"Rookie Pilot",done:!0,unit:"X-Wing",faction:a.REBEL,skill:2,points:21,pilotid:4,upgrades:[a.TORPEDO,a.ASTROMECH]},{name:"Turbolaser",done:!0,unit:"Turbolaser",faction:a.EMPIRE,skill:0,points:4,pilotid:5,upgrades:[a.MISSILE,a.MISSILE,a.TORPEDO,a.TORPEDO,a.TURRET]},{name:"Thermal Exhaust Port",
done:!0,unit:"Exhaust Port",faction:a.EMPIRE,skill:0,points:49,pilotid:6,upgrades:[],init:function(){this.wrap_before("dies",this,function(){for(var b in squadron)squadron[b].team==this.team&&a.prototype.dies.call(squadron[b])})}},{name:"Biggs Darklighter",done:!0,pilotid:7,init:function(){var b=this;Weapon.prototype.wrap_after("getenemiesinrange",this,function(a,c){"undefined"==typeof c&&(c=a,this.unit.selectnearbyenemy(3));if(1==this.unit.foundbiggs){for(var e=[],f=0;f<c.length;f++){var h=c[f];
(h==b||1<h.getrange(b))&&e.push(h)}c=e}return c});a.prototype.wrap_after("getenemiesinrange",this,function(a,c,e){this.foundbiggs=!1;c=[];for(var f=0;f<a.length;f++)if(-1<e[f].indexOf(b)){this.foundbiggs=!0;break}if(this.foundbiggs)for(f=0;f<a.length;f++){c[f]=[];for(var h=0;h<e[f].length;h++){var q=e[f][h];(q==b||1<q.getrange(b))&&c[f].push(q)}}else c=e;return c})},unique:!0,unit:"X-Wing",faction:a.REBEL,skill:5,points:25,upgrades:[a.TORPEDO,a.ASTROMECH]},{name:"Luke Skywalker",done:!0,pilotid:8,
faction:a.REBEL,init:function(){this.adddicemodifier(a.DEFENSE_M,a.MOD_M,a.DEFENSE_M,this,{req:function(a,b){return!0},aiactivate:function(b,c){return 0<a.FE_focus(b)},f:function(b,c){0<a.FE_focus(b)&&(this.log("1 %FOCUS% -> 1 %EVADE%"),b=b-a.FE_FOCUS+a.FE_EVADE);return b}.bind(this),str:"focus"})},unique:!0,unit:"X-Wing",skill:8,points:28,upgrades:[a.ELITE,a.TORPEDO,a.ASTROMECH]},{name:"Gray Squadron Pilot",done:!0,faction:a.REBEL,unit:"Y-Wing",skill:4,pilotid:9,points:20,upgrades:[a.TURRET,a.TORPEDO,
a.TORPEDO,a.ASTROMECH]},{name:"'Dutch' Vander",done:!0,pilotid:10,init:function(){this.wrap_after("addtarget",this,function(a){this.selectunit(this.selectnearbyally(2),function(a,b){a[b].selectunit(a[b].gettargetableunits(3),function(a,b){-1<this.gettargetableunits(3).indexOf(a[b])&&this.addtarget(a[b])},["select target to lock"],!1)},["select unit for free %TARGET% (or self to cancel)"],!0)})},faction:a.REBEL,unique:!0,unit:"Y-Wing",skill:6,points:23,upgrades:[a.TURRET,a.TORPEDO,a.TORPEDO,a.ASTROMECH]},
{name:"Horton Salm",done:!0,pilotid:11,faction:a.REBEL,unique:!0,unit:"Y-Wing",skill:8,points:25,init:function(){this.adddicemodifier(a.ATTACK_M,a.REROLL_M,a.ATTACK_M,this,{dice:["blank"],n:function(){return 9},req:function(a,b,c){a=this.getrange(c);return 2<=a&&3>=a?(this.log("reroll any blank result"),!0):!1}.bind(this)})},upgrades:[a.TURRET,a.TORPEDO,a.TORPEDO,a.ASTROMECH]},{name:"Gold Squadron Pilot",done:!0,pilotid:12,unit:"Y-Wing",faction:a.REBEL,skill:2,points:18,upgrades:[a.TURRET,a.TORPEDO,
a.TORPEDO,a.ASTROMECH]},{name:"Academy Pilot",done:!0,pilotid:13,unit:"TIE Fighter",faction:a.EMPIRE,skill:1,points:12,upgrades:[]},{name:"Obsidian Squadron Pilot",done:!0,pilotid:14,unit:"TIE Fighter",faction:a.EMPIRE,skill:3,points:13,upgrades:[]},{name:"Black Squadron Pilot",done:!0,pilotid:15,unit:"TIE Fighter",faction:a.EMPIRE,skill:4,points:14,upgrades:[a.ELITE]},{name:"'Scourge'",unique:!0,beta:!0,done:!0,pilotid:16,unit:"TIE Fighter",faction:a.EMPIRE,skill:7,wave:["epic"],points:17,init:function(){this.wrap_after("getattackstrength",
this,function(a,b,c){return 0<b.criticals.length?(this.log("+1 attack die for attacking damaged unit"),c+1):c})},upgrades:[a.ELITE]},{name:"'Winged Gundark'",faction:a.EMPIRE,pilotid:17,init:function(){this.wrap_after("modifyattackroll",this,function(b,c,e,f){0<a.FCH_hit(f)&&(f=f-a.FCH_HIT+a.FCH_CRIT);return f});this.adddicemodifier(a.ATTACK_M,a.MOD_M,a.ATTACK_M,this,{req:function(a,b){return 1==this.getrange(targetunit)}.bind(this),aiactivate:function(b,c){return 0<a.FCH_hit(b)},f:function(b,c){0<
a.FCH_hit(b)&&(this.log("1 %HIT% -> 1 %CRIT%"),b=b-a.FCH_HIT+a.FCH_CRIT);return b}.bind(this),str:"hit"})},done:!0,unique:!0,unit:"TIE Fighter",skill:5,points:15,upgrades:[]},{name:"'Night Beast'",faction:a.EMPIRE,done:!0,pilotid:18,init:function(){this.wrap_after("handledifficulty",this,function(a){"GREEN"==a&&this.candofocus()&&this.candoaction()&&this.doaction([this.newaction(this.addfocus,"FOCUS")],"green maneuver -> free focus action")})},unique:!0,unit:"TIE Fighter",skill:5,points:15,upgrades:[]},
{name:"'Backstabber'",unique:!0,done:!0,pilotid:19,faction:a.EMPIRE,init:function(){this.wrap_after("getattackstrength",this,function(a,b,c){b.isinfiringarc(this)||(c+=1,this.log("+1 attack against %0",b.name));return c})},unit:"TIE Fighter",skill:6,points:16,upgrades:[]},{name:"'Dark Curse'",done:!0,pilotid:20,faction:a.EMPIRE,unique:!0,init:function(){var b=this;this.wrap_after("isattackedby",this,function(c,e){e.wrap_after("canusefocus",b,function(){return!1}).unwrapper("afterdefenseeffect");e.wrap_after("canusetarget",
b,function(){return!1}).unwrapper("afterdefenseeffect");e.wrap_after("getdicemodifiers",b,function(b){for(var c=[],e=0;e<b.length;e++)b[e].type!=a.REROLL_M&&c.push(b[e]);return c}).unwrapper("afterdefenseeffect")})},unit:"TIE Fighter",skill:6,points:16,upgrades:[]},{name:"'Mauler Mithel'",faction:a.EMPIRE,done:!0,pilotid:21,init:function(){this.wrap_after("getattackstrength",this,function(a,b,c){1==this.gethitrange(a,b)&&(this.log("+1 attack against %0",b.name),c+=1);return c})},unique:!0,unit:"TIE Fighter",
skill:7,points:17,upgrades:[a.ELITE]},{name:"'Howlrunner'",unique:!0,done:!0,pilotid:22,faction:a.EMPIRE,unit:"TIE Fighter",skill:8,init:function(){a.prototype.adddicemodifier(a.ATTACK_M,a.REROLL_M,a.ATTACK_M,this,{dice:["blank","focus"],n:function(){return 1},req:function(a,b,c){return a!=this&&!this.dead&&1==a.getrange(this)&&a.isally(this)&&b.isprimary?(a.log("+%1 reroll(s) [%0]",this.name,1),!0):!1}.bind(this)})},points:18,upgrades:[a.ELITE]},{name:"Maarek Stele",unique:!0,done:!0,pilotid:23,
ambiguous:!0,faction:a.EMPIRE,edition:"TIE Advanced",unit:"TIE Advanced",skill:7,points:27,init:l,upgrades:[a.ELITE,a.MISSILE]},{name:"Maarek Stele",unique:!0,done:!0,pilotid:24,ambiguous:!0,edition:"TIE Defender",faction:a.EMPIRE,unit:"TIE Defender",skill:7,points:35,init:l,shipimg:"tie-defender-red",upgrades:[a.ELITE,a.CANNON,a.MISSILE]},{name:"Tempest Squadron Pilot",faction:a.EMPIRE,done:!0,pilotid:25,unit:"TIE Advanced",skill:2,points:21,upgrades:[a.MISSILE]},{name:"Storm Squadron Pilot",faction:a.EMPIRE,
done:!0,pilotid:26,unit:"TIE Advanced",skill:4,points:23,upgrades:[a.MISSILE]},{name:"Darth Vader",faction:a.EMPIRE,unique:!0,done:!0,pilotid:27,unit:"TIE Advanced",skill:9,init:function(){this.wrap_before("doendmaneuveraction",this,function(){this.log("+1 action [%0]",this.name);this.doaction(this.getactionlist(),"",this.candoendmaneuveraction)})},secaction:-1,points:29,upgrades:[a.ELITE,a.MISSILE]},{name:"Alpha Squadron Pilot",faction:a.EMPIRE,done:!0,pilotid:28,unit:"TIE Interceptor",skill:1,points:18,
upgrades:[]},{name:"Avenger Squadron Pilot",faction:a.EMPIRE,done:!0,pilotid:29,unit:"TIE Interceptor",skill:3,points:20,upgrades:[]},{name:"Saber Squadron Pilot",faction:a.EMPIRE,done:!0,pilotid:30,unit:"TIE Interceptor",skill:4,points:21,wave:["aces",2],upgrades:["Elite"]},{name:"'Fel's Wrath'",faction:a.EMPIRE,unique:!0,unit:"TIE Interceptor",skill:5,pilotid:31,done:!0,init:function(){this.wrap_after("endcombatphase",this,function(){this.hasfired=0;this.checkdead()});this.wrap_after("canbedestroyed",
this,function(a,b){return-1==a})},points:23,upgrades:[]},{name:"Turr Phennir",faction:a.EMPIRE,unique:!0,done:!0,pilotid:32,unit:"TIE Interceptor",skill:7,init:function(){this.addafterattackeffect(this,function(){var a=[];this.candoboost()&&a.push(this.newaction(this.resolveboost,"BOOST"));this.candoroll()&&a.push(this.newaction(this.resolveroll,"ROLL"));this.doaction(a,"free %BOOST% or %ROLL% action")})},points:25,upgrades:[a.ELITE]},{name:"Soontir Fel",faction:a.EMPIRE,unique:!0,done:!0,pilotid:33,
init:function(){this.wrap_after("addstress",this,function(){this.log("+1 %STRESS% -> +1 %FOCUS%");this.addfocustoken()})},unit:"TIE Interceptor",skill:9,points:27,upgrades:[a.ELITE]},{name:"Tycho Celchu",faction:a.REBEL,unique:!0,pilotid:34,done:!0,init:function(){this.wrap_after("hasnostresseffect",this,function(){return!0})},unit:"A-Wing",skill:8,points:26,upgrades:[a.ELITE,a.MISSILE]},{name:"Arvel Crynyd",faction:a.REBEL,pilotid:35,unique:!0,done:!0,unit:"A-Wing",init:function(){this.wrap_after("checkcollision",
this,function(a){return!1})},skill:6,points:23,upgrades:[a.MISSILE]},{name:"Green Squadron Pilot",faction:a.REBEL,done:!0,wave:["aces",2],unit:"A-Wing",skill:3,pilotid:36,points:19,upgrades:[a.ELITE,a.MISSILE]},{name:"Prototype Pilot",faction:a.REBEL,done:!0,pilotid:37,wave:["aces",2],unit:"A-Wing",skill:1,points:17,upgrades:[a.MISSILE]},{name:"Outer Rim Smuggler",faction:a.REBEL,unit:"YT-1300",done:!0,pilotid:38,install:function(){this.hull=6;this.shield=4;this.weapons[0].attack=2},uninstall:function(){this.hull=
8;this.shield=5;this.weapons[0].attack=3},skill:1,points:27,upgrades:[a.CREW,a.CREW]},{name:"Chewbacca",unique:!0,done:!0,ambiguous:!0,faction:a.REBEL,unit:"YT-1300",skill:5,pilotid:39,points:42,deal:function(a,c){var e=$.Deferred();return c==b.FACEUP?(this.log("turn faceup damage facedown"),e.resolve({crit:a,face:b.FACEDOWN}).promise()):e.resolve({crit:a,face:c}).promise()},upgrades:[a.ELITE,a.MISSILE,a.CREW,a.CREW]},{name:"Lando Calrissian",faction:a.REBEL,unique:!0,unit:"YT-1300",skill:7,pilotid:40,
points:44,init:function(){this.wrap_after("handledifficulty",this,function(a){"GREEN"==a&&this.selectunit(this.selectnearbyally(1),function(a,b){a[b].log("+1 action [%0]",this.name);a[b].doaction(a[b].getactionbarlist(),"")}.bind(this),["select unit (or self to cancel) [%0]",this.name],!0)})},done:!0,upgrades:[a.ELITE,a.MISSILE,a.CREW,a.CREW]},{name:"Han Solo",unique:!0,done:!0,faction:a.REBEL,unit:"YT-1300",skill:9,pilotid:41,points:46,init:function(){this.adddicemodifier(a.ATTACK_M,a.REROLL_M,a.ATTACK_M,
this,{dice:["blank","focus","hit","critical"],n:function(){return 9},req:function(a,b,c){return!0},mustreroll:!0})},upgrades:[a.ELITE,a.MISSILE,a.CREW,a.CREW]},{name:"Kath Scarlet",unique:!0,faction:a.EMPIRE,unit:"Firespray-31",skill:7,pilotid:42,done:!0,init:function(){this.wrap_before("resolveattack",this,function(b,c){var e=this;c.wrap_after("cancelcritical",e,function(b,c,f){a.FCH_crit(b.ch)>a.FCH_crit(f.ch)&&(this.log("+1 %STRESS% for cancelling %CRIT% [%0]",e.name),this.addstress());return f}).unwrapper("afterdefenseeffect")})},
points:38,upgrades:[a.ELITE,a.CANNON,a.BOMB,a.CREW,a.MISSILE]},{name:"Boba Fett",unique:!0,done:!0,pilotid:43,faction:a.EMPIRE,init:function(){this.wrap_after("getmaneuverlist",this,function(a){if(this.hasionizationeffect())return a;for(var b=1;3>=b;b++)"undefined"!=typeof a["BL"+b]?(this.log("select %BANKLEFT% or %BANKRIGHT% turn"),a["BR"+b]={move:"BR"+b,difficulty:a["BL"+b].difficulty}):"undefined"!=typeof a["BR"+b]&&(this.log("select %BANKLEFT% or %BANKRIGHT% turn"),a["BL"+b]={move:"BL"+b,difficulty:a["BR"+
b].difficulty});return a})},unit:"Firespray-31",skill:8,points:39,upgrades:[a.ELITE,a.CANNON,a.BOMB,a.CREW,a.MISSILE]},{name:"Krassis Trelix",unique:!0,done:!0,pilotid:44,faction:a.EMPIRE,unit:"Firespray-31",attackrerolls:function(a,b){return a.isprimary?0:1},init:function(){this.adddicemodifier(a.ATTACK_M,a.REROLL_M,a.ATTACK_M,this,{dice:["blank","focus"],n:function(){return 1},req:function(a,b,c){return b.isprimary?!1:(a.log("+%1 reroll(s) [%0]",a.name,1),!0)}})},skill:5,points:36,upgrades:[a.CANNON,
a.BOMB,a.CREW,a.MISSILE]},{name:"Bounty Hunter",unit:"Firespray-31",skill:3,pilotid:45,done:!0,faction:a.EMPIRE,points:33,upgrades:[a.CANNON,a.BOMB,a.CREW,a.MISSILE]},{name:"Ten Numb",faction:a.REBEL,unique:!0,done:!0,pilotid:46,unit:"B-Wing",skill:8,shipimg:"b-wing-1",init:function(){var b=this;this.wrap_before("resolveattack",this,function(c,e){e.wrap_after("cancelcritical",b,function(b,c,f){return 0<a.FCH_crit(b.ch)&&0==a.FCH_crit(f.ch)?(e.log("cannot cancel 1 %CRIT% [%0]",this.name),{ch:f.ch+
a.FCH_CRIT,e:f.e+1}):f}.bind(this)).unwrapper("afterdefenseeffect")})},points:31,upgrades:[a.ELITE,a.SYSTEM,a.CANNON,a.TORPEDO,a.TORPEDO]},{name:"Ibtisam",unique:!0,done:!0,faction:a.REBEL,unit:"B-Wing",skill:6,pilotid:47,points:28,shipimg:"b-wing-1",attackrerolls:function(a){return 0<this.stress?1:0},init:function(){var b={dice:["blank","focus"],n:function(){return 1},req:function(a,b,c){return 0<this.stress?(this.log("+%0 reroll",1),!0):!1}.bind(this)};this.adddicemodifier(a.DEFENSE_M,a.REROLL_M,
a.DEFENSE_M,this,b);this.adddicemodifier(a.ATTACK_M,a.REROLL_M,a.ATTACK_M,this,$.extend({},b))},upgrades:[a.ELITE,a.SYSTEM,a.CANNON,a.TORPEDO,a.TORPEDO]},{name:"Dagger Squadron Pilot",unit:"B-Wing",done:!0,wave:["aces",3],pilotid:48,faction:a.REBEL,skill:4,points:24,upgrades:[a.SYSTEM,a.CANNON,a.TORPEDO,a.TORPEDO]},{name:"Blue Squadron Pilot",unit:"B-Wing",done:!0,wave:["aces",3],faction:a.REBEL,skill:2,pilotid:49,points:22,upgrades:[a.SYSTEM,a.CANNON,a.TORPEDO,a.TORPEDO]},{name:"Rebel Operative",
unit:"HWK-290",done:!0,faction:a.REBEL,skill:2,pilotid:50,points:16,upgrades:[a.TURRET,a.CREW]},{name:"Roark Garnet",unique:!0,faction:a.REBEL,unit:"HWK-290",skill:4,pilotid:51,init:function(){this.wrap_after("begincombatphase",this,function(a){var b=this;this.selectunit(this.selectnearbyally(3),function(a,c){a[c].log("has PS of 12");a[c].wrap_after("getskill",b,function(a){return 12}).unwrapper("endcombatphase")},["select unit [%0]",this.name],!1);return a})},done:!0,points:19,upgrades:[a.TURRET,
a.CREW]},{name:"Kyle Katarn",faction:a.REBEL,unique:!0,done:!0,unit:"HWK-290",skill:6,pilotid:52,points:21,init:function(){this.wrap_after("begincombatphase",this,function(a){this.canusefocus()&&this.selectunit(this.selectnearbyally(3),function(a,b){this.removefocustoken();a[b].addfocustoken();a[b].log("+1 %FOCUS%")},["select unit for free %FOCUS% (or self to cancel)"],!0);return a})},upgrades:[a.ELITE,a.TURRET,a.CREW]},{name:"Jan Ors",faction:a.REBEL,unique:!0,done:!0,pilotid:53,unit:"HWK-290",skill:8,
init:function(){var b=this;a.prototype.adddicemodifier(a.ATTACK_M,a.ADD_M,a.ATTACK_M,this,{req:function(a,c){return 0==b.stress&&!b.dead&&activeunit.isally(b)&activeunit!=b&&3>=b.getrange(activeunit)},f:function(c,e){var f=b.rollattackdie(1,b,"critical")[0];b.addstress();activeunit.log("+1 attack die [%0]",b.name);return"focus"==f?{m:c+a.FCH_FOCUS,n:e+1}:"hit"==f?{m:c+a.FCH_HIT,n:e+1}:"critical"==f?{m:c+a.FCH_CRIT,n:e+1}:{m:c,n:e+1}},str:"hit"})},points:25,upgrades:[a.ELITE,a.TURRET,a.CREW]},{name:"Scimitar Squadron Pilot",
done:!0,unit:"TIE Bomber",skill:2,pilotid:54,faction:a.EMPIRE,points:16,upgrades:[a.TORPEDO,a.TORPEDO,a.MISSILE,a.MISSILE,a.BOMB]},{name:"Gamma Squadron Pilot",done:!0,pilotid:55,unit:"TIE Bomber",faction:a.EMPIRE,skill:4,points:18,upgrades:[a.TORPEDO,a.TORPEDO,a.MISSILE,a.MISSILE,a.BOMB]},{name:"Captain Jonus",faction:a.EMPIRE,done:!0,pilotid:56,init:function(){a.prototype.adddicemodifier(a.ATTACK_M,a.REROLL_M,a.ATTACK_M,this,{dice:["blank","focus"],n:function(){return 2},req:function(a,b,c){return a!=
this&&!this.dead&&1==a.getrange(this)&&a.isally(this)&&1!=b.isprimary?(a.log("+%1 reroll(s) [%0]",this.name,2),!0):!1}.bind(this)})},unique:!0,unit:"TIE Bomber",skill:6,points:22,upgrades:[a.ELITE,a.TORPEDO,a.TORPEDO,a.MISSILE,a.MISSILE,a.BOMB]},{name:"Major Rhymer",done:!0,pilotid:57,faction:a.EMPIRE,init:function(){for(var a=0;a<this.weapons.length;a++)this.weapons[a].wrap_after("getlowrange",this,function(a){1<a&&--a;return a}),this.weapons[a].wrap_after("gethighrange",this,function(a){3>a&&(a+=
1);return a});this.log("extending weapon ranges")},unique:!0,unit:"TIE Bomber",skill:7,points:26,upgrades:[a.ELITE,a.TORPEDO,a.TORPEDO,a.MISSILE,a.MISSILE,a.BOMB]},{name:"Captain Kagi",faction:a.EMPIRE,unique:!0,done:!0,pilotid:58,init:function(){var b=this;a.prototype.wrap_after("gettargetableunits",this,function(a,c){-1<c.indexOf(b)&&!b.dead&&(c=[b]);return c})},unit:"Lambda-Class Shuttle",skill:8,points:27,upgrades:[a.SYSTEM,a.CANNON,a.CREW,a.CREW]},{name:"Colonel Jendon",faction:a.EMPIRE,pilotid:59,
init:function(){this.wrap_after("begincombatphase",this,function(a){0<this.targeting.length&&this.selectunit(this.selectnearbyally(1),function(a,b){var c=this.targeting[0];a[b].addtarget(c);this.removetarget(c);a[b].log("+%1 %TARGET% / %0",c.name,1)},["select unit to move %TARGET% (or self to cancel)"],!0);return a})},done:!0,unique:!0,unit:"Lambda-Class Shuttle",skill:6,points:26,upgrades:[a.SYSTEM,a.CANNON,a.CREW,a.CREW]},{name:"Captain Yorr",faction:a.EMPIRE,pilotid:60,unique:!0,done:!0,unit:"Lambda-Class Shuttle",
skill:4,init:function(){var b=this;a.prototype.wrap_after("addstress",this,function(){-1<this.selectnearbyally(2).indexOf(b)&&2>=b.stress&&!b.dead&&(this.log("%STRESS% -> %0 [%0]",b.name),this.removestresstoken(),this.showinfo(),b.addstress(),b.showinfo())})},points:24,upgrades:[a.SYSTEM,a.CANNON,a.CREW,a.CREW]},{name:"Omicron Group Pilot",faction:a.EMPIRE,done:!0,unit:"Lambda-Class Shuttle",skill:2,pilotid:61,points:21,upgrades:[a.SYSTEM,a.CANNON,a.CREW,a.CREW]},{name:"Lieutenant Lorrir",faction:a.EMPIRE,
unique:!0,done:!0,pilotid:62,wave:["aces"],unit:"TIE Interceptor",skill:5,points:23,init:function(){this.wrap_after("getrollmatrix",this,function(a,b){for(var c=-20;20>=c;c+=20){var e=this.m.clone().translate(0,c).rotate(90,0,0),f=this.m.clone().translate(0,c).rotate(-90,0,0);b=b.concat([this.getpathmatrix(e,"BR1").rotate(-90,0,0),this.getpathmatrix(f,"BR1").rotate(90,0,0),this.getpathmatrix(e,"BL1").rotate(-90,0,0),this.getpathmatrix(f,"BL1").rotate(90,0,0)])}return b});this.wrap_before("endaction",
this,function(a,b){"ROLL"==b&&this.addstress()})},upgrades:[]},{name:"Royal Guard Pilot",faction:a.EMPIRE,done:!0,pilotid:63,unit:"TIE Interceptor",skill:6,points:22,wave:["aces"],upgrades:[a.ELITE]},{name:"Tetran Cowall",faction:a.EMPIRE,unique:!0,done:!0,pilotid:64,wave:["aces"],init:function(){this.wrap_after("getmaneuverlist",this,function(a){var b=!1,c,e;for(e in a)if(e.match(/K/)){b=!0;c=a[e];break}if(b&&!this.hasionizationeffect())for(this.log("select %UTURN% speed"),e=1;5>=e;e+=2)"undefined"==
typeof a["K"+e]&&(a["K"+e]={move:"K"+e,difficulty:c.difficulty,halfturn:!1});return a})},unit:"TIE Interceptor",skill:7,points:24,upgrades:[a.ELITE]},{name:"Kir Kanos",faction:a.EMPIRE,pilotid:65,wave:["aces"],shipimg:"tie-interceptor-1",init:function(){this.wrap_after("modifyattackroll",this,function(b,c,e,f){0<this.evade&&(f+=a.FCH_HIT);return f});this.adddicemodifier(a.ATTACK_M,a.ADD_M,a.ATTACK_M,this,{req:function(a,b){var c=this.getrange(targetunit);return 3>=c&&2<=c&&this.canuseevade()}.bind(this),
f:function(b,c){this.removeevadetoken();this.log("+1 %HIT% for attacking at range 2-3");return{m:b+a.FCH_HIT,n:c+1}}.bind(this),str:"evade"})},done:!0,unique:!0,unit:"TIE Interceptor",skill:6,points:24,upgrades:[]},{name:"Carnor Jax",faction:a.EMPIRE,pilotid:66,wave:["aces"],init:function(){var b=this;a.prototype.wrap_after("canusefocus",this,function(a){return 1==this.getrange(b)&&this.isenemy(b)&&!b.dead?!1:a});a.prototype.wrap_after("canuseevade",this,function(a){return 1==this.getrange(b)&&this.isenemy(b)&&
!b.dead?!1:a});a.prototype.wrap_after("candofocus",this,function(a){return 1==this.getrange(b)&&this.isenemy(b)&&!b.dead?!1:a});a.prototype.wrap_after("candoevade",this,function(a){return 1==this.getrange(b)&&this.isenemy(b)&&!b.dead?!1:a})},unique:!0,done:!0,unit:"TIE Interceptor",skill:8,points:26,upgrades:[a.ELITE]},{name:"Bandit Squadron Pilot",faction:a.REBEL,pilotid:67,done:!0,unit:"Z-95 Headhunter",skill:2,points:12,upgrades:[a.MISSILE]},{name:"Tala Squadron Pilot",faction:a.REBEL,pilotid:68,
done:!0,unit:"Z-95 Headhunter",skill:4,points:13,upgrades:[a.MISSILE]},{name:"Lieutenant Blount",faction:a.REBEL,pilotid:69,done:!0,init:function(){this.wrap_after("hashit",this,function(a,b){0==this.criticalresolved+this.hitresolved&&this.log("%0 is hit",targetunit.name);return!0})},unique:!0,unit:"Z-95 Headhunter",skill:6,points:17,upgrades:[a.ELITE,a.MISSILE]},{name:"Airen Cracken",faction:a.REBEL,pilotid:70,done:!0,init:function(){this.addafterattackeffect(this,function(){var a=this.selectnearbyally(1,
function(a,b){return b.candoaction()});0<a.length&&this.doselection(function(b){this.log("select unit for a free action"+a.length);this.resolveactionselection(a,function(c){var e=a[c].getactionlist();0<e.length?a[c].doaction(e,"").done(function(){this.select()}.bind(this)):this.select();this.endnoaction(b,"")}.bind(this))}.bind(this))})},unique:!0,unit:"Z-95 Headhunter",skill:8,points:19,upgrades:[a.ELITE,a.MISSILE]},{name:"Delta Squadron Pilot",faction:a.EMPIRE,pilotid:71,done:!0,unit:"TIE Defender",
skill:1,points:30,upgrades:[a.CANNON,a.MISSILE]},{name:"Glaive Squadron Pilot",faction:a.EMPIRE,done:!0,pilotid:72,unit:"TIE Defender",skill:6,points:34,wave:["aces"],upgrades:[a.ELITE,a.CANNON,a.MISSILE],shipimg:"tie-defender-red"},{name:"Onyx Squadron Pilot",done:!0,faction:a.EMPIRE,pilotid:73,unit:"TIE Defender",skill:3,points:32,upgrades:[a.CANNON,a.MISSILE]},{name:"Colonel Vessery",done:!0,pilotid:74,faction:a.EMPIRE,init:function(){this.wrap_after("attackroll",this,function(a,b){0<targetunit.istargeted.length&&
0==this.targeting.length&&(this.addtarget(targetunit),this.log("+%1 %TARGET% / %0",targetunit.name,1));return b})},unique:!0,unit:"TIE Defender",skill:6,points:35,upgrades:[a.ELITE,a.CANNON,a.MISSILE]},{name:"Rexler Brath",faction:a.EMPIRE,done:!0,pilotid:75,init:function(){this.addafterattackeffect(this,function(a,b){this.canusefocus()&&0<this.hitresolved&&(this.log("-1 %FOCUS%, %0 damage -> %0 critical(s)",b),this.donoaction([{name:this.name,org:this,type:"FOCUS",action:function(a){var b=targetunit.criticals.length-
1;this.removefocustoken();for(var c=0;c<this.hitresolved;c++)this.log(targetunit.criticals[b-c-this.criticalresolved].name),targetunit.criticals[b-c-this.criticalresolved].faceup();targetunit.checkdead();targetunit.show();this.endnoaction(a,"")}.bind(this)}],"",!0))})},unique:!0,unit:"TIE Defender",skill:8,wave:["aces"],points:37,upgrades:[a.ELITE,a.CANNON,a.MISSILE]},{name:"Knave Squadron Pilot",faction:a.REBEL,done:!0,pilotid:76,unit:"E-Wing",skill:1,points:27,upgrades:[a.SYSTEM,a.TORPEDO,a.ASTROMECH]},
{name:"Blackmoon Squadron Pilot",pilotid:77,faction:a.REBEL,done:!0,unit:"E-Wing",skill:3,points:29,upgrades:[a.SYSTEM,a.TORPEDO,a.ASTROMECH]},{name:"Etahn A'baht",done:!0,pilotid:78,faction:a.REBEL,init:function(){var b=this;a.prototype.adddicemodifier(a.ATTACK_M,a.MOD_M,a.ATTACK_M,this,{req:function(a,c){return b.isally(activeunit)&&!b.dead&&b.isinfiringarc(targetunit)},aiactivate:function(b,c){return a.FCH_hit(b)},f:function(c,e){return 0<a.FCH_hit(c)?(this.log("1 %HIT% -> 1 %CRIT% [%0]",b.name),
c+a.FCH_CRIT-a.FCH_HIT):c},str:"hit"})},unique:!0,unit:"E-Wing",skill:5,points:32,upgrades:[a.ELITE,a.SYSTEM,a.TORPEDO,a.ASTROMECH]},{name:"Corran Horn",faction:a.REBEL,done:!0,pilotid:79,init:function(){this.addattack(function(){return!0},this,this.weapons,function(){this.log("no attack next round");this.noattack=round+1}.bind(this),null,"endcombatphase")},unique:!0,unit:"E-Wing",skill:8,points:35,upgrades:[a.ELITE,a.SYSTEM,a.TORPEDO,a.ASTROMECH]},{name:"Sigma Squadron Pilot",faction:a.EMPIRE,pilotid:80,
done:!0,unit:"TIE Phantom",skill:3,points:25,upgrades:[a.SYSTEM,a.CREW]},{name:"Shadow Squadron Pilot",done:!0,faction:a.EMPIRE,pilotid:81,unit:"TIE Phantom",skill:5,points:27,upgrades:[a.SYSTEM,a.CREW]},{name:"'Echo'",faction:a.EMPIRE,done:!0,pilotid:82,getdecloakmatrix:function(a){var b;b=this.getpathmatrix(a,"BL2");var c=this.getpathmatrix(a,"BR2"),c=[a,b,c];for(b=-20;20>=b;b+=20)var e=a.clone().translate(0,b).rotate(90,0,0),f=a.clone().translate(0,b).rotate(-90,0,0),c=c.concat([this.getpathmatrix(e,
"BL2").rotate(-90,0,0),this.getpathmatrix(e,"BR2").rotate(-90,0,0),this.getpathmatrix(f,"BL2").rotate(90,0,0),this.getpathmatrix(f,"BR2").rotate(90,0,0)]);return c},unique:!0,unit:"TIE Phantom",skill:6,points:30,upgrades:[a.ELITE,a.SYSTEM,a.CREW]},{name:"'Whisper'",faction:a.EMPIRE,done:!0,pilotid:83,init:function(){this.wrap_after("hashit",this,function(a,b){b&&(this.log("+1 %FOCUS%"),this.addfocustoken());return b})},unique:!0,unit:"TIE Phantom",skill:7,points:32,upgrades:[a.ELITE,a.SYSTEM,a.CREW]},
{name:"Wes Janson",done:!0,wave:["epic"],pilotid:84,init:function(){this.wrap_before("cleanupattack",this,function(){void 0!==targetunit&&(0<targetunit.targeting.length?(targetunit.log("-1 %TARGET% [%0]",this.name),targetunit.removetarget(targetunit.targeting[0])):0<targetunit.focus?(targetunit.log("-1 %FOCUS% [%0]",this.name),targetunit.removefocustoken()):0<targetunit.evade&&(targetunit.log("-1 %EVADE% [%0]",this.name),targetunit.removeevadetoken()))})},faction:a.REBEL,unique:!0,unit:"X-Wing",skill:8,
points:29,upgrades:[a.ELITE,a.TORPEDO,a.ASTROMECH]},{name:"Jek Porkins",done:!0,pilotid:85,wave:["epic"],init:function(){this.wrap_after("addstress",this,function(){this.removestresstoken();var a=this.rollattackdie(1,this,"blank")[0];this.log("-1 %STRESS%, roll 1 attack dice");"hit"==a&&(this.applydamage(1),this.checkdead())})},faction:a.REBEL,unique:!0,unit:"X-Wing",skill:7,points:26,upgrades:[a.ELITE,a.TORPEDO,a.ASTROMECH]},{name:"'Hobbie' Klivian",faction:a.REBEL,done:!0,wave:["epic"],pilotid:86,
init:function(){this.wrap_before("removetarget",this,function(a){this.stress&&(this.log("-1 %TARGET% -> -1 %STRESS%"),this.removestresstoken())});this.wrap_before("addtarget",this,function(a){this.stress&&(this.removestresstoken(),this.log("+1 %TARGET% -> -1 %STRESS%"))})},unique:!0,unit:"X-Wing",skill:5,points:25,upgrades:[a.TORPEDO,a.ASTROMECH]},{name:"Tarn Mison",done:!0,pilotid:87,wave:["epic"],init:function(){this.wrap_after("isattackedby",this,function(a,b){if(0==this.targeting.length||this.getskill()<
b.getskill())this.log("+%1 %TARGET% / %0",b.name,1),this.addtarget(b)})},faction:a.REBEL,unique:!0,unit:"X-Wing",skill:3,points:23,upgrades:[a.TORPEDO,a.ASTROMECH]},{name:"Jake Farrell",faction:a.REBEL,done:!0,pilotid:88,wave:["aces"],freemove:function(){var a=[];this.candoboost()&&a.push(this.newaction(this.resolveboost,"BOOST"));this.candoroll()&&a.push(this.newaction(this.resolveroll,"ROLL"));this.doaction(a,"free %BOOST% or %ROLL% action")},init:function(){this.wrap_before("addfocustoken",this,
function(){this.candoaction()&&this.freemove()})},unique:!0,unit:"A-Wing",skill:7,points:24,upgrades:[a.ELITE,a.MISSILE]},{name:"Gemmer Sojan",done:!0,pilotid:89,wave:["aces"],init:function(){this.wrap_after("getagility",this,function(a){0<this.selectnearbyenemy(1).length&&(a+=1);return a})},faction:a.REBEL,unique:!0,unit:"A-Wing",skill:5,points:22,upgrades:[a.MISSILE]},{name:"Keyan Farlander",faction:a.REBEL,done:!0,pilotid:90,wave:["aces"],shipimg:"b-wing-1",init:function(){this.wrap_after("modifyattackroll",
this,function(b,c,e,f){b=a.FCH_focus(f);0<this.stress&&(f=f-a.FCH_FOCUS*b+a.FCH_HIT*b);return f});this.adddicemodifier(a.ATTACK_M,a.MOD_M,a.ATTACK_M,this,{req:function(a,b){return 0<this.stress}.bind(this),aiactivate:function(a,b){return!0},f:function(b,c){var e=a.FCH_focus(b);this.removestresstoken();return 0<e?(this.log("%0 %FOCUS% -> %0 %HIT%, -1 %STRESS%",e),b-a.FCH_FOCUS*e+a.FCH_HIT*e):b}.bind(this),str:"stress",noreroll:"focus"})},unique:!0,unit:"B-Wing",skill:7,points:29,upgrades:[a.ELITE,
a.SYSTEM,a.CANNON,a.TORPEDO,a.TORPEDO]},{name:"Nera Dantels",faction:a.REBEL,done:!0,pilotid:91,wave:["aces"],shipimg:"b-wing-1",init:function(){this.log("can fire %Unit.TORPEDO% at 360 degrees");this.wrap_after("isTurret",this,function(b,c){return b.type==a.TORPEDO?!0:c})},unique:!0,unit:"B-Wing",skill:5,points:26,upgrades:[a.ELITE,a.SYSTEM,a.CANNON,a.TORPEDO,a.TORPEDO]},{name:"Wild Space Fringer",done:!0,pilotid:92,faction:a.REBEL,unit:"YT-2400",skill:2,points:30,upgrades:[a.CANNON,a.MISSILE,a.CREW]},
{name:"Eaden Vrill",done:!0,pilotid:93,init:function(){this.wrap_after("getattackstrength",this,function(a,b,c){0<b.stress&&this.weapons[a].isprimary&&(this.log("+1 attack die"),c+=1);return c})},faction:a.REBEL,unit:"YT-2400",unique:!0,skill:3,points:32,upgrades:[a.CANNON,a.MISSILE,a.CREW]},{name:"'Leebo'",faction:a.REBEL,done:!0,pilotid:94,init:function(){this.wrap_after("deal",this,function(a,c,e){var f=$.Deferred();e.then(function(a){if(a.face==b.FACEUP){a=this.selectdamage();b.CRITICAL_DECK[a].count--;
var c=this.selectdamage();b.CRITICAL_DECK[c].count--;a=[a,c];this.log("select one critical");this.selectcritical(a,function(a){f.resolve({crit:new b(this,a),face:b.FACEUP})}.bind(this))}else f.resolve(a)}.bind(this));return f.promise()})},unit:"YT-2400",unique:!0,skill:5,points:34,upgrades:[a.ELITE,a.CANNON,a.MISSILE,a.CREW]},{name:"Dash Rendar",faction:a.REBEL,pilotid:95,unit:"YT-2400",unique:!0,skill:7,done:!0,init:function(){this.wrap_after("hascollidedobstacle",this,function(a){return!1});this.wrap_after("canmoveonobstacles",
this,function(){return!0})},points:36,upgrades:[a.ELITE,a.CANNON,a.MISSILE,a.CREW]},{name:"Patrol Leader",faction:a.EMPIRE,done:!0,pilotid:96,unit:"VT-49 Decimator",skill:3,points:40,upgrades:[a.TORPEDO,a.CREW,a.CREW,a.CREW,a.BOMB]},{name:"Captain Oicunn",faction:a.EMPIRE,unit:"VT-49 Decimator",skill:4,points:42,pilotid:97,unique:!0,done:!0,init:function(){this.wrap_before("resolvecollision",this,function(){for(var a=0;a<this.touching.length;a++){var b=this.touching[a];b.isenemy(this)&&(b.log("+1 %HIT% [%0]",
this.name),b.resolvehit(1),b.checkdead())}})},upgrades:[a.ELITE,a.TORPEDO,a.CREW,a.CREW,a.CREW,a.BOMB]},{name:"Commander Kenkirk",faction:a.EMPIRE,pilotid:98,init:function(){this.wrap_after("getagility",this,function(a){0<this.criticals.length&&(a+=1);return a})},done:!0,unit:"VT-49 Decimator",skill:6,points:44,unique:!0,upgrades:[a.ELITE,a.TORPEDO,a.CREW,a.CREW,a.CREW,a.BOMB]},{name:"Rear Admiral Chiraneau",pilotid:99,init:function(){this.wrap_after("modifyattackroll",this,function(b,c,e,f){0<a.FCH_focus(f)&&
2>=this.range&&(f=f-a.FCH_FOCUS+a.FCH_CRIT);return f});this.adddicemodifier(a.ATTACK_M,a.MOD_M,a.ATTACK_M,this,{req:function(a,b){return 2>=this.getrange(targetunit)}.bind(this),aiactivate:function(b,c){return a.FCH_focus(b)},f:function(b,c){return 0<a.FCH_focus(b)?(this.log("1 %FOCUS% -> 1 %CRIT%"),b-a.FCH_FOCUS+a.FCH_CRIT):b}.bind(this),str:"hit"})},faction:a.EMPIRE,unit:"VT-49 Decimator",skill:8,points:46,done:!0,unique:!0,upgrades:[a.ELITE,a.TORPEDO,a.CREW,a.CREW,a.CREW,a.BOMB]},{name:"Prince Xizor",
faction:a.SCUM,pilotid:100,modifydamageassigned:function(a,b){if(0==a)return 0;var c=this.selectnearbyally(1);if(0<c.length){c.sort(function(a,b){var c=a.hull+a.shield,e=b.hull+b.shield;return c<e?1:c>e?-1:0});if(10<=a)return c[0].resolvecritical(1),this.log("-1 %CRIT%"),c[0].log("+1 %CRIT% [%0]",this.name),a-10;c[0].resolvehit(1);c[0].checkdead();this.log("-1 %HIT%");c[0].log("+%1 %HIT% [%0]",this.name,1);return a-1}return a},unique:!0,done:!0,unit:"StarViper",skill:7,points:31,upgrades:[a.ELITE,
a.TORPEDO]},{name:"Guri",faction:a.SCUM,pilotid:101,modifyattackroll:function(b,c,e){1==this.getrange(targetunit)&&(b+=a.FCH_FOCUS);return b},init:function(){this.wrap_after("begincombatphase",this,function(a){0<this.selectnearbyenemy(1).length&&(this.log("+1 %FOCUS%, ennemy at range 1"),this.addfocustoken());return a})},done:!0,unique:!0,unit:"StarViper",skill:5,points:30,upgrades:[a.ELITE,a.TORPEDO]},{name:"Black Sun Vigo",faction:a.SCUM,done:!0,pilotid:102,unit:"StarViper",skill:3,points:27,upgrades:[a.TORPEDO]},
{name:"Black Sun Enforcer",faction:a.SCUM,pilotid:103,done:!0,unit:"StarViper",skill:1,points:25,upgrades:[a.TORPEDO]},{name:"Serissu",faction:a.SCUM,pilotid:104,done:!0,init:function(){var b=this;a.prototype.adddicemodifier(a.DEFENSE_M,a.REROLL_M,a.DEFENSE_M,this,{dice:["blank","focus"],n:function(){return 1},req:function(a,c,e){return e==this||b.dead||this.dead||1!=e.getrange(this)||!e.isally(this)?!1:(e.log("+%1 reroll(s) [%0]",this.name,1),!0)}.bind(this)})},unit:"M3-A Interceptor",skill:8,points:20,
unique:!0,upgrades:[a.ELITE]},{name:"Laetin A'shera",faction:a.SCUM,pilotid:105,init:function(){this.addafterdefenseeffect(this,function(a,b,c){0==a+b&&(this.log("0 %HIT%, +1 %EVADE%"),this.addevadetoken())})},done:!0,unit:"M3-A Interceptor",skill:6,points:18,unique:!0,upgrades:[]},{name:"Tansarii Point Veteran",faction:a.SCUM,pilotid:106,done:!0,unit:"M3-A Interceptor",skill:5,points:17,upgrades:[a.ELITE]},{name:"Cartel Spacer",faction:a.SCUM,pilotid:107,done:!0,unit:"M3-A Interceptor",skill:2,points:14,
upgrades:[]},{name:"IG-88A",faction:a.SCUM,pilotid:108,unique:!0,unit:"Aggressor",skill:6,points:36,init:function(a){this.addafterattackeffect(this,function(b,c){("undefined"==typeof a||!a.dead)&&targetunit.dead&&this.shield<this.ship.shield&&(this.addshield(1),this.showstats(),this.log("+1 %SHIELD% for a kill"))})},done:!0,upgrades:[a.ELITE,a.SYSTEM,a.CANNON,a.CANNON,a.BOMB,a.ILLICIT]},{name:"IG-88B",faction:a.SCUM,pilotid:109,done:!0,init:function(a){var b=[];this.ig88battack=-1;for(var c=0;c<this.weapons.length;c++){var e=
this.weapons[c];"Cannon"==e.type&&e.isWeapon()&&b.push(e)}0!=b.length&&(this.weapons.indexOf(b[0]),this.addattack(function(b,c){return 0==b+c&&this.ig88battack<round&&("undefined"==typeof a||!a.dead)},{name:"IG-88B"},b,function(){this.ig88battack=round},function(){return squadron}))},unique:!0,unit:"Aggressor",skill:6,points:36,upgrades:[a.ELITE,a.SYSTEM,a.CANNON,a.CANNON,a.BOMB,a.ILLICIT]},{name:"IG-88C",faction:a.SCUM,pilotid:110,init:function(a){this.wrap_before("resolveboost",this,function(){"undefined"!=
typeof a&&a.dead||(this.log("free %EVADE% action [%0]","IG-88C"),this.doselection(function(a){this.addevade(a)}.bind(this)))})},done:!0,unique:!0,unit:"Aggressor",skill:6,points:36,upgrades:[a.ELITE,a.SYSTEM,a.CANNON,a.CANNON,a.BOMB,a.ILLICIT]},{name:"IG-88D",faction:a.SCUM,pilotid:111,init:function(a){this.wrap_after("getmaneuverlist",this,function(b){"undefined"==typeof b.SL3||"undefined"!=typeof a&&a.dead||(this.log("%SLOOPLEFT% or %TURNLEFT% maneuver"),b.TL3={move:"TL3",halfturn:!0,difficulty:b.SL3.difficulty});
"undefined"!=typeof b.SR3&&(this.log("%SLOOPRIGHT% or %TURNRIGHT% maneuver"),b.TR3={move:"TR3",halfturn:!0,difficulty:b.SR3.difficulty});return b})},unique:!0,done:!0,unit:"Aggressor",skill:6,points:36,upgrades:[a.ELITE,a.SYSTEM,a.CANNON,a.CANNON,a.BOMB,a.ILLICIT]},{name:"N'Dru Suhlak",unique:!0,done:!0,wave:["6"],pilotid:112,faction:a.SCUM,init:function(){var a=this.getattackstrength;this.getattackstrength=function(b,c){var e=a.call(this,b,c);0==this.selectnearbyally(2).length&&("undefined"!=typeof c&&
this.log("+1 attack against %0, at range >=3 of friendly ships",c.name),e+=1);return e}.bind(this)},unit:"Z-95 Headhunter",skill:7,points:17,upgrades:[a.ELITE,a.MISSILE,a.ILLICIT]},{name:"Kaa'To Leeachos",unique:!0,pilotid:113,faction:a.SCUM,done:!0,wave:["6"],init:function(){this.wrap_after("begincombatphase",this,function(a){var b=this.selectnearbyally(2);this.selectunit(b,function(a,b){0<a[b].evade?(a[b].removeevadetoken(),this.addevadetoken(),a[b].log("-1 %EVADE% [%0]",this.name),this.log("+1 %EVADE%")):
0<a[b].focus&&(a[b].removefocustoken(),this.addfocustoken(),a[b].log("-1 %FOCUS% [%0]",this.name),this.log("+1 %FOCUS%"))},["select %FOCUS%/%EVADE% to take (or self to cancel)"],!0);return a})},unit:"Z-95 Headhunter",skill:5,points:15,upgrades:[a.ELITE,a.MISSILE,a.ILLICIT]},{name:"Black Sun Soldier",faction:a.SCUM,pilotid:114,done:!0,wave:["6"],unit:"Z-95 Headhunter",skill:3,points:13,upgrades:[a.MISSILE,a.ILLICIT]},{name:"Binayre Pirate",faction:a.SCUM,pilotid:115,done:!0,wave:["6"],unit:"Z-95 Headhunter",
skill:1,points:12,upgrades:[a.MISSILE,a.ILLICIT]},{name:"Boba Fett",faction:a.SCUM,pilotid:116,wave:["6"],unit:"Firespray-31",skill:8,points:39,modifyattackroll:function(a,b,c){1==this.getrange(targetunit)&&(a+=1);return a},init:function(){var b={dice:["blank","focus"],n:function(){var a=0,b;for(b in squadron){var c=squadron[b];1==this.getrange(c)&&this.isenemy(c)&&a++}return a}.bind(this),req:function(a,b,c){return!0}};this.adddicemodifier(a.ATTACK_M,a.REROLL_M,a.ATTACK_M,this,b);this.adddicemodifier(a.DEFENSE_M,
a.REROLL_M,a.DEFENSE_M,this,$.extend({},b))},done:!0,unique:!0,upgrades:[a.ELITE,a.CANNON,a.BOMB,a.CREW,a.MISSILE,a.ILLICIT]},{name:"Kath Scarlet",done:!0,wave:["6"],pilotid:117,init:function(){this.wrap_after("getattackstrength",this,function(a,b,c){4>this.weapons[a].getauxiliarysector(b)&&(this.log("+1 attack die against %0 in auxiliary arc",b.name),c+=1);return c})},unique:!0,faction:a.SCUM,unit:"Firespray-31",skill:7,points:38,upgrades:[a.ELITE,a.CANNON,a.BOMB,a.CREW,a.MISSILE,a.ILLICIT]},{name:"Emon Azzameen",
done:!0,unique:!0,wave:["6"],pilotid:118,getbomblocation:function(){return["F1","TL3","TR3","F3"]},faction:a.SCUM,unit:"Firespray-31",skill:6,points:36,upgrades:[a.CANNON,a.BOMB,a.CREW,a.MISSILE,a.ILLICIT]},{name:"Mandalorian Mercenary",faction:a.SCUM,pilotid:119,done:!0,unit:"Firespray-31",skill:5,points:35,wave:["6"],upgrades:[a.ELITE,a.CANNON,a.BOMB,a.CREW,a.MISSILE,a.ILLICIT]},{name:"Kavil",unique:!0,done:!0,wave:["6"],pilotid:120,init:function(){this.wrap_after("getattackstrength",this,function(a,
b,c){this.isinprimaryfiringarc(b)||(this.log("+1 attack die against %0 outside firing arc",b.name),c+=1);return c})},faction:a.SCUM,unit:"Y-Wing",skill:7,points:24,upgrades:[a.ELITE,a.TURRET,a.TORPEDO,a.TORPEDO,a.SALVAGED]},{name:"Drea Renthal",unique:!0,pilotid:121,faction:a.SCUM,unit:"Y-Wing",skill:5,done:!0,wave:["6"],init:function(){this.wrap_before("removetarget",this,function(a){this.selectunit(this.gettargetableunits(3),function(a,b){-1==this.targeting.indexOf(a[b])&&(this.addtarget(a[b]),
this.addstress())},["select unit to target, +1 %STRESS% (or self to cancel)"],!0)})},points:22,upgrades:[a.TURRET,a.TORPEDO,a.TORPEDO,a.SALVAGED]},{name:"Hired Gun",faction:a.SCUM,pilotid:122,done:!0,unit:"Y-Wing",skill:4,points:20,wave:["6"],upgrades:[a.TURRET,a.TORPEDO,a.TORPEDO,a.SALVAGED]},{name:"Syndicate Thug",faction:a.SCUM,pilotid:123,done:!0,wave:["6"],unit:"Y-Wing",skill:2,points:18,upgrades:[a.TURRET,a.TORPEDO,a.TORPEDO,a.SALVAGED]},{name:"Dace Bonearm",unique:!0,pilotid:124,faction:a.SCUM,
unit:"HWK-290",done:!0,wave:["6"],init:function(){var b=this;a.prototype.wrap_after("addiontoken",this,function(){!b.dead&&3>=this.getrange(b)&&b.isenemy(this)&&0==b.stress&&(b.addstress(),this.resolvehit(1),b.log("+1 %STRESS%"),this.log("+%1 %HIT% [%0]",b.name,1),this.checkdead())})},skill:7,points:23,upgrades:[a.ELITE,a.TURRET,a.CREW,a.ILLICIT]},{name:"Palob Godalhi",unique:!0,pilotid:125,wave:["6"],faction:a.SCUM,unit:"HWK-290",init:function(){this.wrap_after("begincombatphase",this,function(a){this.selectunit(this.selectnearbyenemy(2),
function(a,b){0<a[b].evade?(a[b].removeevadetoken(),this.addevadetoken(),a[b].log("-1 %EVADE% [%0]",this.name),this.log("+1 %EVADE%")):0<a[b].focus&&(a[b].removefocustoken(),this.addfocustoken(),a[b].log("-1 %FOCUS% [%0]",this.name),this.log("+1 %FOCUS%"))},["select %FOCUS%/%EVADE% to take (or self to cancel)"],!0);return a})},done:!0,skill:5,points:20,upgrades:[a.ELITE,a.TURRET,a.CREW,a.ILLICIT]},{name:"Torkil Mux",unique:!0,pilotid:126,done:!0,wave:["6"],init:function(){this.wrap_after("endactivationphase",
this,function(){this.selectunit(this.selectnearbyenemy(2),function(a,b){a[b].wrap_after("getskill",this,function(a){return 0}).unwrapper("endcombatphase")},["select unit for a 0 PS"],!1)})},faction:a.SCUM,unit:"HWK-290",skill:3,points:19,upgrades:[a.TURRET,a.CREW,a.ILLICIT]},{name:"Spice Runner",faction:a.SCUM,pilotid:127,done:!0,unit:"HWK-290",skill:1,points:16,wave:["6"],upgrades:[a.TURRET,a.CREW,a.ILLICIT]},{name:"Commander Alozen",faction:a.EMPIRE,pilotid:128,unit:"TIE Advanced",unique:!0,done:!0,
skill:5,wave:["epic"],points:25,init:function(){this.wrap_after("begincombatphase",this,function(a){this.selectunit(this.gettargetableunits(1),function(a,b){this.addtarget(a[b]);this.log("+%1 %TARGET% / %0",a[b].name,1)},["select unit to lock (or self to cancel)"],!0);return a})},upgrades:[a.ELITE,a.MISSILE]},{name:"Juno Eclipse",unique:!0,pilotid:129,done:!0,faction:a.EMPIRE,unit:"TIE Advanced",skill:8,wave:["epic"],points:28,init:function(){this.wrap_after("getmaneuverlist",this,function(a){if(this.hasionizationeffect())return a;
var b={},c,e=[];for(c in a)for(var f=a[c],h=parseInt(f.move.substr(-1),10),q=-1;1>=q;q++){var l=f.move.replace(/\d/,h+q+""),t;!(t="undefined"==typeof P[l])&&(t="undefined"!=typeof b[l])&&(t=f.difficulty,t=!("GREEN"==t||"WHITE"==t&&"GREEN"!=b[l].difficulty));t||(b[l]={move:l,difficulty:f.difficulty,halfturn:f.halfturn})}for(c in b)e.push(b[c]);return e})},upgrades:[a.ELITE,a.MISSILE]},{name:"Zertik Strom",unique:!0,pilotid:130,done:!0,faction:a.EMPIRE,unit:"TIE Advanced",skill:6,wave:["epic"],init:function(){var a=
this;Weapon.prototype.wrap_after("getrangeattackbonus",this,function(b,c){this.unit.isenemy(a)&&1==a.getrange(this.unit)&&(this.unit.log("0 attack range bonus [%0]",a.name),c=0);return c})},points:26,upgrades:[a.ELITE,a.MISSILE]},{name:"Lieutenant Colzet",unique:!0,pilotid:131,faction:a.EMPIRE,unit:"TIE Advanced",skill:3,points:23,upgrades:[a.MISSILE],done:!0,wave:["epic"],init:function(){this.wrap_before("endphase",this,function(){this.selectunit(this.targeting,function(a,b){if(this.canusetarget(a[b])){var c=
a[b].criticals;this.removetarget(a[b]);0<c.length&&c[rand(c.length)].faceup()}},["select unit (or self to cancel)"],!0)})}},{name:"Bossk",faction:a.SCUM,pilotid:132,unit:"YV-666",unique:!0,skill:7,points:35,done:!0,init:function(){this.wrap_after("hashit",this,function(a,b){var c=this.criticalresolved+this.hitresolved;b&&0<this.criticalresolved&&(c<=a.shield||2>=a.hull&&c>a.shield?(this.criticalresolved--,this.hitresolved+=2,this.log("1 %CRIT% -> 2 %HIT%")):this.log("%0 %SHIELD% are down, more than 2 %HULL%: keeping critical",
a.name));return b})},upgrades:[a.ELITE,a.CANNON,a.MISSILE,a.CREW,a.CREW,a.CREW,a.ILLICIT]},{name:"Moralo Eval",faction:a.SCUM,pilotid:133,unit:"YV-666",unique:!0,skill:6,points:34,done:!0,init:function(){for(var a=0;a<this.weapons.length;a++)"Cannon"==this.weapons[a].type&&(this.log("can fire %0 in auxiliary firing arc",this.weapons[a].name),this.weapons[a].auxiliary=this.weapons[0].auxiliary,this.weapons[a].subauxiliary=this.weapons[0].subauxiliary)},upgrades:[a.CANNON,a.MISSILE,a.CREW,a.CREW,a.CREW,
a.ILLICIT]},{name:"Latts Razzi",faction:a.SCUM,pilotid:134,unit:"YV-666",unique:!0,skill:5,points:33,done:!0,init:function(){var b=this;a.prototype.wrap_after("declareattack",this,function(a,c,e){if(!e)return e;!b.dead&&b.isally(this)&&b.canusetarget(c)&&b.donoaction([this.newaction(function(a){this.removetarget(c);c.wrap_after("getdefensestrength",b,function(a,b,c){return 0<c?c-1:c}).unwrapper("afterdefenseeffect");this.endnoaction(a,"TARGET")}.bind(b),"TARGET")],b.name+": -1 agility for "+c.name,
!0);return e})},upgrades:[a.CANNON,a.MISSILE,a.CREW,a.CREW,a.CREW,a.ILLICIT]},{name:"Trandoshan Slaver",faction:a.SCUM,pilotid:135,unit:"YV-666",done:!0,skill:2,points:29,upgrades:[a.CANNON,a.MISSILE,a.CREW,a.CREW,a.CREW,a.ILLICIT]},{name:"Talonbane Cobra",unique:!0,faction:a.SCUM,pilotid:136,unit:"Kihraxz Fighter",skill:9,upgrades:[a.ELITE,a.MISSILE,a.ILLICIT],done:!0,init:function(){this.wrap_after("getattackstrength",this,function(a,b,c){return c+this.weapons[a].getrangeattackbonus(b)});this.wrap_after("getdefensestrength",
this,function(a,b,c){return c+b.weapons[a].getrangedefensebonus(this)})},points:28},{name:"Graz the Hunter",unique:!0,pilotid:137,faction:a.SCUM,unit:"Kihraxz Fighter",skill:6,upgrades:[a.MISSILE,a.ILLICIT],init:function(){this.wrap_after("getdefensestrength",this,function(a,b,c){3>=this.weapons[a].getsector(b)&&(c+=1,this.log("+1 defense die for defending in firing arc"));return c})},done:!0,points:25},{name:"Black Sun Ace",faction:a.SCUM,pilotid:138,unit:"Kihraxz Fighter",done:!0,skill:5,upgrades:[a.ELITE,
a.MISSILE,a.ILLICIT],points:23},{name:"Cartel Marauder",done:!0,pilotid:139,faction:a.SCUM,unit:"Kihraxz Fighter",skill:2,upgrades:[a.MISSILE,a.ILLICIT],points:20},{name:"Miranda Doni",unique:!0,pilotid:140,done:!0,faction:a.REBEL,unit:"K-Wing",skill:8,upgrades:[a.TURRET,a.TORPEDO,a.TORPEDO,a.MISSILE,a.CREW,a.BOMB,a.BOMB],mirandaturn:-1,preattackroll:function(a,b){if(this.mirandaturn!=round){var c={org:this,name:this.name,type:"SHIELD",action:function(a){this.mirandaturn=round;this.log("-1 attack die");
this.wrap_after("getattackstrength",this,function(a,b,c){a=this.weapons[a].getrangeattackbonus(b);0<c-a&&--c;return c}).unwrapper("attackroll");this.shield<this.ship.shield&&(this.addshield(1),this.log("+1 %SHIELD%"));this.endnoaction(a,"SHIELD")}.bind(this)},e={org:this,name:this.name,type:"HIT",action:function(a){this.log("-1 %SHIELD%");this.log("+1 attack die");this.mirandaturn=round;this.wrap_after("getattackstrength",this,function(a,b,c){return 1+c}).unwrapper("attackroll");this.removeshield(1);
this.endnoaction(a,"HIT")}.bind(this)},f=[];0<this.shield&&f.push(e);this.shield<this.ship.shield&&f.push(c);this.donoaction(f,"select to add shield/roll 1 fewer die or remove shield/roll 1 additional die",!0)}},points:29},{name:"Esege Tuketu",unique:!0,pilotid:141,faction:a.REBEL,unit:"K-Wing",skill:6,upgrades:[a.TURRET,a.TORPEDO,a.TORPEDO,a.MISSILE,a.CREW,a.BOMB,a.BOMB],points:28,done:!0,init:function(){var b=this;a.prototype.wrap_before("beginattack",this,function(){!b.dead&&this!=b&&this.isally(b)&&
(this.wrap_after("canusefocus",b,function(a){return a||b.canusefocus()&&2>=this.getrange(b)}).unwrapper("endattack"),this.wrap_before("removefocustoken",b,function(){2>=this.getrange(b)&&(this.focus++,b.log("-1 %FOCUS% [%0]",this.name),b.removefocustoken())}).unwrapper("endattack"))})}},{name:"Guardian Squadron Pilot",faction:a.REBEL,pilotid:142,done:!0,unit:"K-Wing",skill:4,upgrades:[a.TURRET,a.TORPEDO,a.TORPEDO,a.MISSILE,a.CREW,a.BOMB,a.BOMB],points:25},{name:"Warden Squadron Pilot",faction:a.REBEL,
pilotid:143,done:!0,unit:"K-Wing",skill:2,upgrades:[a.TURRET,a.TORPEDO,a.TORPEDO,a.MISSILE,a.CREW,a.BOMB,a.BOMB],points:23},{name:"'Redline'",unique:!0,pilotid:144,faction:a.EMPIRE,unit:"TIE Punisher",skill:7,done:!0,init:function(){this.wrap_after("addtarget",this,function(a){this.log("+%1 %TARGET% / %0",a.name,2);this.targeting.push(a);a.istargeted.push(this);this.movelog("T-"+a.id);a.show();this.show()})},boundtargets:function(a){var b=this.targeting;if(-1<this.targeting.indexOf(a))return!0;for(a=
b.length-2;0<=a;a++)this.removetarget(b[a]);return!1},upgrades:[a.SYSTEM,a.TORPEDO,a.TORPEDO,a.MISSILE,a.MISSILE,a.BOMB,a.BOMB],points:27},{name:"'Deathrain'",unique:!0,pilotid:145,faction:a.EMPIRE,unit:"TIE Punisher",skill:6,done:!0,init:function(){this.wrap_after("getbombposition",this,function(a,b,c){this.log("positions:"+c.length);for(var e=0;e<a.length;e++)c.push(this.getpathmatrix(this.m.clone().translate(0,20-b),a[e]));return c});this.wrap_after("bombdropped",this,function(){this.candoroll()&&
this.candoaction()&&($("#activationdial").hide(),this.doaction([this.newaction(this.resolveroll,"ROLL")],"free %ROLL% action"))})},upgrades:[a.SYSTEM,a.TORPEDO,a.TORPEDO,a.MISSILE,a.MISSILE,a.BOMB,a.BOMB],points:26},{name:"Black Eight Squadron Pilot",faction:a.EMPIRE,pilotid:146,done:!0,unit:"TIE Punisher",skill:4,upgrades:[a.SYSTEM,a.TORPEDO,a.TORPEDO,a.MISSILE,a.MISSILE,a.BOMB,a.BOMB],points:23},{name:"Cutlass Squadron Pilot",faction:a.EMPIRE,done:!0,pilotid:147,unit:"TIE Punisher",skill:2,upgrades:[a.SYSTEM,
a.TORPEDO,a.TORPEDO,a.MISSILE,a.MISSILE,a.BOMB,a.BOMB],points:21},{name:"Poe Dameron",faction:a.REBEL,pilotid:148,unit:"T-70 X-Wing",unique:!0,done:!0,ambiguous:!0,skill:8,upgrades:[a.ELITE,a.TORPEDO,a.ASTROMECH,a.TECH],init:t,points:31},{name:"'Blue Ace'",faction:a.REBEL,done:!0,pilotid:149,unit:"T-70 X-Wing",skill:5,unique:!0,getboostmatrix:function(b){return[this.getpathmatrix(b,"TR1"),this.getpathmatrix(b,"TL1")].concat(a.prototype.getboostmatrix.call(this,b))},upgrades:[a.TORPEDO,a.ASTROMECH,
a.TECH],points:27},{name:"Ello Asty",faction:a.REBEL,done:!0,pilotid:150,beta:!0,unit:"T-70 X-Wing",skill:7,unique:!0,init:function(){var a=[];this.wrap_after("getdial",this,function(b){if(0==a.length)for(var c=0;c<b.length;c++){var e=b[c].move,f=b[c].difficulty;e.match(/TR[RL]\d/)&&(f="WHITE");a[c]={move:e,difficulty:f}}return 0==this.stress?a:b})},upgrades:[a.ELITE,a.TORPEDO,a.ASTROMECH,a.TECH],points:30},{name:"'Red Ace'",faction:a.REBEL,done:!0,pilotid:151,beta:!0,unit:"T-70 X-Wing",skill:6,unique:!0,
init:function(){this.sr=-1;this.wrap_after("removeshield",this,function(a){this.sr<round&&(this.log("+1 %SHIELD%"),this.sr=round,this.addevadetoken())})},upgrades:[a.TORPEDO,a.ASTROMECH,a.TECH],points:29},{name:"Blue Squadron Novice",faction:a.REBEL,done:!0,unit:"T-70 X-Wing",wave:["aces",8],skill:2,pilotid:152,upgrades:[a.TORPEDO,a.ASTROMECH,a.TECH],points:24},{name:"Red Squadron Veteran",faction:a.REBEL,pilotid:153,done:!0,unit:"T-70 X-Wing",wave:["aces",8],skill:4,upgrades:[a.ELITE,a.TORPEDO,a.ASTROMECH,
a.TECH],points:26},{name:"Omega Squadron Pilot",faction:a.EMPIRE,done:!0,pilotid:154,unit:"TIE/FO Fighter",skill:4,upgrades:[a.TECH,a.ELITE],points:17},{name:"Zeta Squadron Pilot",faction:a.EMPIRE,done:!0,pilotid:155,unit:"TIE/FO Fighter",skill:3,upgrades:[a.TECH],points:16},{name:"Epsilon Squadron Pilot",faction:a.EMPIRE,done:!0,pilotid:156,unit:"TIE/FO Fighter",skill:1,upgrades:[a.TECH],points:15},{name:"'Zeta Ace'",faction:a.EMPIRE,done:!0,pilotid:157,unique:!0,unit:"TIE/FO Fighter",skill:5,getrollmatrix:function(b){var c=
this.getpathmatrix(b.clone().rotate(90,0,0),"F2").translate(0,this.islarge?20:0).rotate(-90,0,0),e=this.getpathmatrix(b.clone().rotate(-90,0,0),"F2").translate(0,this.islarge?20:0).rotate(90,0,0);return[c.clone().translate(0,-20),c,c.clone().translate(0,20),e.clone().translate(0,-20),e,e.clone().translate(0,20)].concat(a.prototype.getrollmatrix.call(this,b))},upgrades:[a.ELITE,a.TECH],points:18},{name:"'Epsilon Leader'",faction:a.EMPIRE,done:!0,pilotid:158,unique:!0,unit:"TIE/FO Fighter",skill:6,
init:function(){this.wrap_after("begincombatphase",this,function(a){var b=this.selectnearbyally(1);b.push(this);for(var c=0;c<b.length;c++)b[c].removestresstoken();return a})},upgrades:[a.TECH],points:19},{name:"'Epsilon Ace'",faction:a.EMPIRE,done:!0,pilotid:159,unique:!0,unit:"TIE/FO Fighter",skill:4,init:function(){this.wrap_after("getskill",this,function(a){return 0==this.criticals.length?12:a})},upgrades:[a.TECH],points:17},{name:"'Omega Ace'",faction:a.EMPIRE,done:!0,pilotid:160,unique:!0,unit:"TIE/FO Fighter",
skill:7,init:function(){this.wrap_after("modifyattackroll",this,function(b,c,e,f){0<this.focus&&0<this.targeting.length&&(f=c*a.FCH_CRIT);return f});this.adddicemodifier(a.ATTACK_M,a.MOD_M,a.ATTACK_M,this,{req:function(a,b){return this.canusefocus()&&-1<this.targeting.indexOf(targetunit)}.bind(this),f:function(b,c){this.removefocustoken();this.removetarget(targetunit);this.log("all results are %CRIT%");return c*a.FCH_CRIT}.bind(this),str:"critical"})},upgrades:[a.ELITE,a.TECH],points:20},{name:"'Omega Leader'",
faction:a.EMPIRE,beta:!0,pilotid:161,unique:!0,unit:"TIE/FO Fighter",skill:8,upgrades:[a.ELITE,a.TECH],points:21,done:!0,init:function(){var b=this;this.wrap_after("isattackedby",this,function(c,e){-1<b.targeting.indexOf(e)&&e.wrap_after("getdicemodifiers",b,function(b){for(var c=[],e=0;e<b.length;e++)b[e].from!=a.ATTACK_M&&c.push(b[e]);return c}).unwrapper("endattack")});this.wrap_before("resolveattack",this,function(b,c){-1<this.targeting.indexOf(c)&&c.wrap_after("getdicemodifiers",this,function(b){for(var c=
[],e=0;e<b.length;e++)b[e].from!=a.DEFENSE_M&&c.push(b[e]);return c}).unwrapper("endbeingattacked")});this.wrap_after("setpriority",this,function(a){"TARGET"==a.type&&this.candotarget()&&0==this.targeting.length&&(a.priority+=10)})}},{name:"Hera Syndulla",unique:!0,faction:a.REBEL,unit:"VCX-100",skill:7,pilotid:162,ambiguous:!0,edition:"VCX-100",points:40,done:!0,upgrades:[a.SYSTEM,a.TURRET,a.TORPEDO,a.TORPEDO,a.CREW,a.CREW],init:function(){this.wrap_after("getmaneuverlist",this,function(a){return x.call(this,
a)});for(var b=0;b<this.weapons.length;b++){var c=this.weapons[b];c.type==a.TORPEDO&&(c.auxiliary=AUXILIARY,c.subauxiliary=SUBAUXILIARY)}}},{name:"'Chopper'",unique:!0,pilotid:163,faction:a.REBEL,unit:"VCX-100",skill:4,points:37,done:!0,init:function(){this.wrap_after("begincombatphase",this,function(a){for(var b=0;b<this.touching.length;b++)this.touching[b].isenemy(this.team)&&(this.touching[b].addstress(),this.touching[b].log("+1 %STRESS% [%0]",this.name));return a});for(var b=0;b<this.weapons.length;b++){var c=
this.weapons[b];c.type==a.TORPEDO&&(c.auxiliary=AUXILIARY,c.subauxiliary=SUBAUXILIARY)}},upgrades:[a.SYSTEM,a.TURRET,a.TORPEDO,a.TORPEDO,a.CREW,a.CREW]},{name:"Ezra Bridger",faction:a.REBEL,unique:!0,done:!0,pilotid:164,ambiguous:!0,edition:"Attack Shuttle",unit:"Attack Shuttle",skill:4,points:20,init:f,upgrades:[a.ELITE,a.TURRET,a.CREW]},{name:"Hera Syndulla",faction:a.REBEL,unique:!0,done:!0,pilotid:165,unit:"Attack Shuttle",skill:7,ambiguous:!0,edition:"Attack Shuttle",points:22,init:function(){this.wrap_after("getmaneuverlist",
this,function(a){return x.call(this,a)})},upgrades:[a.ELITE,a.TURRET,a.CREW]},{name:"Sabine Wren",faction:a.REBEL,unique:!0,done:!0,pilotid:166,unit:"Attack Shuttle",skill:5,points:21,ambiguous:!0,edition:"Attack Shuttle",init:function(){this.wrap_after("beginactivation",this,c)},upgrades:[a.ELITE,a.TURRET,a.CREW]},{name:"'Zeb' Orrelios",faction:a.REBEL,unique:!0,ambiguous:!0,edition:"Attack Shuttle",unit:"Attack Shuttle",skill:3,pilotid:167,points:18,done:!0,cancelhit:h,upgrades:[a.TURRET,a.CREW]},
{name:"Kanan Jarrus",faction:a.REBEL,unique:!0,pilotid:168,unit:"VCX-100",skill:5,points:38,upgrades:[a.SYSTEM,a.TURRET,a.TORPEDO,a.TORPEDO,a.CREW,a.CREW],done:!0,init:function(){for(var b=this,c=0;c<this.weapons.length;c++){var e=this.weapons[c];e.type==a.TORPEDO&&(e.auxiliary=AUXILIARY,e.subauxiliary=SUBAUXILIARY)}a.prototype.wrap_after("preattackroll",this,function(a,c){var e=this.selectnearbyenemy(2);b.canusefocus()&&-1<e.indexOf(b)&&!b.dead&&b.donoaction([{org:b,name:b.name,type:"FOCUS",action:function(a){this.wrap_after("getattackstrength",
b,function(a,b,c){NOLOG=!0;a=this.weapons[a].getrangeattackbonus(b);c-=a;NOLOG=!1;0<c&&--c;return c+a}).unwrapper("attackroll");b.removefocustoken();this.log("-1 attack against %0",b.name);this.select();b.endnoaction(a,"FOCUS")}.bind(this)}],"",!0)})}},{name:"'Wampa'",faction:a.EMPIRE,unique:!0,pilotid:169,unit:"TIE Fighter",wave:["epic"],skill:4,points:14,done:!0,init:function(){this.adddicemodifier(a.ATTACKCOMPARE_M,a.ADD_M,a.ATTACK_M,this,{req:function(a,b){return 0<b},f:function(b,c){if(activeunit.ia)return 0<
a.FCH_crit(b)?(this.log("cancel all dice"),targetunit.log("+1 damage card [%0]",this.name),targetunit.applydamage(1),{m:0,n:0}):{m:b,n:c};this.log("cancel all dice");0<a.FCH_crit(b)&&(targetunit.log("+1 damage card [%0]",this.name),targetunit.applydamage(1));return{m:0,n:0}}.bind(this),str:"critical"})},upgrades:[]},{name:"'Youngster'",faction:a.EMPIRE,unique:!0,pilotid:170,unit:"TIE Fighter",skill:6,wave:["epic"],points:15,done:!0,init:function(){for(var b=null,c=this,e=0;e<this.upgrades.length;e++)this.upgrades[e].type==
a.ELITE&&"function"==typeof this.upgrades[e].action&&(b=$.extend({},this.upgrades[e]),b.clone=!0,b.isactive=!0);null!=b&&(this.log("share %0 upgrade",b.name),a.prototype.wrap_after("getupgactionlist",c,function(a){var e=this.selectnearbyally(3);!c.dead&&this.ship.name.match(/.*TIE.*Fighter.*/)&&-1<e.indexOf(c)&&b.candoaction()&&b.isactive&&(this.log("elite action from %0 available",c.name),b.unit=this,a.push({org:b,action:b.action,type:b.type.toUpperCase(),name:b.name}));return a}))},upgrades:[a.ELITE]},
{name:"'Chaser'",faction:a.EMPIRE,unique:!0,pilotid:171,done:!0,unit:"TIE Fighter",skill:3,wave:["epic"],points:14,init:function(){var b=this;a.prototype.wrap_after("removefocustoken",this,function(){!b.dead&&this.isally(b)&&this!=b&&1>=this.getrange(b)&&(b.log("+1 %FOCUS%"),b.addfocustoken())})},upgrades:[]},{name:"Gamma Squadron Veteran",faction:a.EMPIRE,pilotid:172,done:!0,unit:"TIE Bomber",skill:5,wave:["aces"],points:19,upgrades:[a.ELITE,a.TORPEDO,a.TORPEDO,a.MISSILE,a.MISSILE,a.BOMB]},{name:"The Inquisitor",
faction:a.EMPIRE,pilotid:173,unit:"TIE Adv. Prototype",skill:8,unique:!0,done:!0,points:25,init:function(){this.weapons[0].wrap_after("getrangedefensebonus",this,function(a,b){1==b&&this.unit.log("defense range nullified");return 0});this.wrap_after("getattackstrength",this,function(a,b,c){0==a&&1<this.weapons[0].getrange(b)&&(this.log("+1 attack die with primary weapon [%0]",this.name),c+=1);return c})},upgrades:[a.ELITE,a.MISSILE]},{name:"Valen Rudor",faction:a.EMPIRE,unique:!0,pilotid:174,unit:"TIE Adv. Prototype",
skill:6,points:22,done:!0,init:function(){this.addafterdefenseeffect(this,function(a,b,c){this.candoaction()&&(this.log("+1 free action [%0]",this.name),this.doaction(this.getactionlist(),""))})},upgrades:[a.ELITE,a.MISSILE]},{name:"Sienar Test Pilot",faction:a.EMPIRE,pilotid:175,done:!0,unit:"TIE Adv. Prototype",skill:2,points:16,upgrades:[a.MISSILE]},{name:"Zuckuss",faction:a.SCUM,pilotid:176,unique:!0,unit:"G-1A Starfighter",skill:7,points:28,done:!0,upgrades:[a.ELITE,a.CREW,a.SYSTEM,a.ILLICIT],
init:function(){this.wrap_after("modifyattackdefense",this,function(a,b,c,e,f){f.a+=1;f.d+=1;return f})},preattackroll:function(a,b){var c={org:this,name:this.name,type:"HIT",action:function(a){this.log("+1 attack die");this.wrap_after("getattackstrength",this,function(a,b,c){return 1+c}).unwrapper("attackroll");targetunit.wrap_after("getdefensestrength",this,function(a,b,c){return 1+c}).unwrapper("defenseroll");this.endnoaction(a,"HIT")}.bind(this)};this.donoaction([c],"select to add +1 attack roll",
!0)}},{name:"4-LOM",faction:a.SCUM,pilotid:177,unique:!0,done:!0,unit:"G-1A Starfighter",skill:6,points:27,init:function(){this.wrap_before("endphase",this,function(){var a=this.selectnearbyunits(1,function(){return!0});0<this.stress&&this.selectunit(a,function(a,b){a[b].addstress();this.removestresstoken();a[b].log("+1 %STRESS% [%0]",this.name);this.log("-1 %STRESS%")},["select unit (or self to cancel)"],!0)})},upgrades:[a.ELITE,a.CREW,a.SYSTEM,a.ILLICIT]},{name:"Nashtah Pup Pilot",faction:a.SCUM,
done:!0,pilotid:178,unique:!0,unit:"Z-95 Headhunter",skill:2,wave:["8"],points:0,upgrades:[],init:function(){self=this;self.upg=[]}},{name:"Dengar",faction:a.SCUM,unique:!0,pilotid:179,unit:"JumpMaster 5000",skill:9,points:33,done:!0,init:function(){var a=this;this.dengarattack=-1;this.addattack(function(b,c,e){this.retaliationtarget=e;return a.dengarattack<round&&e!=a&&a.isinprimaryfiringarc(e)},this,this.weapons,function(){this.dengarattack=round},function(){return[this.retaliationtarget]},"endbeingattacked")},
upgrades:[a.ELITE,a.CREW,a.ILLICIT]},{name:"Tel Trevura",faction:a.SCUM,unique:!0,pilotid:180,unit:"JumpMaster 5000",skill:7,points:30,done:!0,init:function(){this.resurrected=!1;this.wrap_before("checkdead",this,function(){0>=this.hull&&!this.dead&&!this.resurrected&&(this.addhull(this.ship.hull-this.hull),this.criticals=[],SOUNDS.explode.play(),this.resurrected=!0,this.log("resists!"),this.applydamage(4),this.showoverflow())})},upgrades:[a.ELITE,a.CREW,a.ILLICIT]},{name:"Manaroo",faction:a.SCUM,
pilotid:181,unit:"JumpMaster 5000",skill:4,unique:!0,points:27,done:!0,init:function(){this.wrap_before("begincombatphase",this,function(){this.selectunit(this.selectnearbyally(1),function(a,b){for(var c=this.focus,e=this.evade,f=0;f<c;f++)this.removefocustoken(),a[b].addfocustoken();for(f=0;f<e;f++)this.removeevadetoken(),a[b].addevadetoken();c=this.targeting;for(f=c.length-1;0<=f;f--)e=c[f],this.removetarget(e),a[b].addtarget(e);c=this.istargeted;for(f=c.length-1;0<=f;f--)e=c[f],e.removetarget(this),
e.addtarget(a[b])},["select unit (or self to cancel) [%0]",this.name],!0)})},upgrades:[a.ELITE,a.CREW,a.ILLICIT]},{name:"Tomax Bren",faction:a.EMPIRE,pilotid:182,unit:"TIE Bomber",skill:8,wave:["aces"],unique:!0,done:!0,points:24,upgrades:[a.ELITE,a.TORPEDO,a.TORPEDO,a.MISSILE,a.MISSILE,a.BOMB],init:function(){var b=this;b.flip=-1;for(var c=0;c<this.upgrades.length;c++){var e=this.upgrades[c];e.type==a.ELITE&&function(a){a.wrap_after("desactivate",this,function(){b.flip<round&&b.donoaction([{org:b,
name:b.name,type:"Unit.ELITE",action:function(c){a.isactive=!0;b.log("name reactivated:"+a.name);b.flip=round;b.endnoaction(c,"Unit.ELITE")}}],"Choose to reactivate an elite upgrade (or not)",!0)})}(e)}}},{name:"Lothal Rebel",faction:a.REBEL,done:!0,unit:"VCX-100",skill:3,pilotid:183,points:35,upgrades:[a.SYSTEM,a.TURRET,a.TORPEDO,a.TORPEDO,a.CREW,a.CREW],init:function(){for(var b=0;b<this.weapons.length;b++){var c=this.weapons[b];c.type==a.TORPEDO&&(c.auxiliary=AUXILIARY,c.subauxiliary=SUBAUXILIARY)}}},
{name:"Baron of the Empire",faction:a.EMPIRE,pilotid:184,done:!0,unit:"TIE Adv. Prototype",skill:4,points:19,upgrades:[a.ELITE,a.MISSILE]},{name:"Gand Findsman",faction:a.SCUM,pilotid:185,done:!0,unit:"G-1A Starfighter",skill:5,points:25,upgrades:[a.ELITE,a.CREW,a.SYSTEM,a.ILLICIT]},{name:"Ruthless Freelancer",faction:a.SCUM,pilotid:186,done:!0,unit:"G-1A Starfighter",skill:3,points:23,upgrades:[a.CREW,a.SYSTEM,a.ILLICIT]},{name:"'Zeta Leader'",faction:a.EMPIRE,pilotid:187,done:!0,unique:!0,unit:"TIE/FO Fighter",
skill:7,points:20,upgrades:[a.ELITE,a.TECH],modifyattackdefense:function(a,b,c,e){0==this.stress&&(this.addstress(),a+=1);return{a:a,d:b}},preattackroll:function(a,b){var c={org:this,name:this.name,type:"STRESS",action:function(a){this.log("+1 attack die");this.wrap_after("getattackstrength",this,function(a,b,c){return 1+c}).unwrapper("attackroll");this.addstress();this.endnoaction(a,"STRESS")}.bind(this)};0==this.stress&&this.donoaction([c],"select to add +1 attack roll",!0)}},{name:"Countess Ryad",
faction:a.EMPIRE,pilotid:188,done:!0,unique:!0,unit:"TIE Defender",skill:5,wave:["aces"],points:34,shipimg:"tie-defender-red",upgrades:[a.ELITE,a.CANNON,a.MISSILE],init:function(){this.wrap_after("getmaneuverlist",this,function(a){if(this.hasionizationeffect())return a;for(var b=1;5>=b;b++)"undefined"!=typeof a["F"+b]&&(a["K"+b]={move:"K"+b,difficulty:a["F"+b].difficulty});return a})}},{name:"'Deathfire'",faction:a.EMPIRE,pilotid:189,done:!0,unique:!0,unit:"TIE Bomber",skill:3,wave:["aces"],points:17,
upgrades:[a.TORPEDO,a.TORPEDO,a.MISSILE,a.MISSILE,a.BOMB],init:function(){var b;for(b=0;b<this.upgrades.length;b++){var c=this.upgrades[b];"function"==typeof c.action&&c.type==a.BOMB&&c.wrap_after("canbedropped",this,Bomb.prototype.canbedropped)}}},{name:"Rey",faction:a.REBEL,pilotid:190,done:!0,unique:!0,unit:"YT-1300",skill:8,wave:["aces"],points:45,upgrades:[a.ELITE,a.MISSILE,a.CREW,a.CREW],init:function(){this.adddicemodifier(a.ATTACK_M,a.REROLL_M,a.ATTACK_M,this,{dice:["blank"],n:function(){return 2},
req:function(a,b,c){return a.isinfiringarc(c)}});this.adddicemodifier(a.DEFENSE_M,a.REROLL_M,a.DEFENSE_M,this,{dice:["blank"],n:function(){return 2},req:function(a,b,c){return c.isinfiringarc(a)}})}},{name:"Poe Dameron",faction:a.REBEL,pilotid:191,unit:"T-70 X-Wing",unique:!0,done:!0,ambiguous:!0,edition:"HoR",init:t,skill:9,wave:["aces"],upgrades:[a.ELITE,a.TORPEDO,a.ASTROMECH,a.TECH],points:33},{name:"'Quickdraw'",faction:a.EMPIRE,pilotid:192,unit:"TIE/SF Fighter",unique:!0,done:!0,skill:9,upgrades:[a.ELITE,
a.SYSTEM,a.MISSILE,a.TECH],points:29,init:function(){this.qdattack=-1;this.addattack(function(a,b){return this.qdattack<round},this,[this.weapons[0]],function(){this.qdattack=round},function(){return squadron},"removeshield")}},{name:"'Backdraft'",faction:a.EMPIRE,pilotid:193,unit:"TIE/SF Fighter",unique:!0,done:!0,skill:7,upgrades:[a.ELITE,a.SYSTEM,a.MISSILE,a.TECH],points:27,init:function(){this.wrap_after("modifyattackroll",this,function(b,c,e,f){3>=this.weapons[0].getauxiliarysector(e)&&(f+=a.FCH_CRIT);
return f});this.adddicemodifier(a.ATTACK_M,a.ADD_M,a.ATTACK_M,this,{req:function(a,b){return!targetunit.dead&&0==this.activeweapon&&3>=this.weapons[0].getauxiliarysector(targetunit)}.bind(this),f:function(b,c){this.log("%0 in auxiliary arc -> +1 %CRIT%",targetunit.name);return{m:b+a.FCH_CRIT,n:c+1}}.bind(this),str:"critical"})}},{name:"Zeta Specialist",faction:a.EMPIRE,pilotid:194,done:!0,unit:"TIE/SF Fighter",skill:3,upgrades:[a.SYSTEM,a.MISSILE,a.TECH],points:23},{name:"Ketsu Onyo",faction:a.SCUM,
pilotid:195,unit:"Lancer-class Pursuit Craft",unique:!0,skill:7,done:!0,upgrades:[a.ELITE,a.CREW,a.ILLICIT,a.ILLICIT],points:38,init:function(){var a=this;this.wrap_before("begincombatphase",this,function(){this.selectunit(this.selectnearbyenemy(1,function(b,c){var e=a.weapons[0];return 3>=e.getprimarysector(c)&&3>=e.getauxiliarysector(c)}),function(b,c){b[c].log("+1 tractor beam token [%0]",a.name);b[c].addtractorbeam(a)},["select unit for tractor beam token [%0]",a.name],!1)})}},{name:"Asajj Ventress",
faction:a.SCUM,pilotid:196,unit:"Lancer-class Pursuit Craft",unique:!0,done:!0,skill:6,upgrades:[a.ELITE,a.CREW,a.ILLICIT,a.ILLICIT],points:37,init:function(){var a=this;this.wrap_before("begincombatphase",this,function(){this.selectunit(this.selectnearbyenemy(2,function(b,c){return 3>=a.weapons[0].getauxiliarysector(c)}),function(b,c){b[c].log("+1 stress [%0]",a.name);b[c].addstress(a)},["select unit [%0]",a.name],!1)})}},{name:"Sabine Wren",faction:a.SCUM,pilotid:197,unit:"Lancer-class Pursuit Craft",
unique:!0,done:!0,skill:5,upgrades:[a.CREW,a.ILLICIT,a.ILLICIT],points:35,init:function(){this.adddicemodifier(a.DEFENSE_M,a.ADD_M,a.DEFENSE_M,this,{req:function(a,b){return 2>=this.weapons[0].getauxiliarysector(activeunit)}.bind(this),f:function(b,c){this.log("Attacker inside Range 1-2 of mobile arc -> +1 %FOCUS%");return{m:b+a.FE_FOCUS,n:c+1}}.bind(this),str:"focus"})}},{name:"Shadowport Hunter",faction:a.SCUM,pilotid:198,done:!0,unit:"Lancer-class Pursuit Craft",skill:2,upgrades:[a.CREW,a.ILLICIT,
a.ILLICIT],points:33},{name:"Zealous Recruit",faction:a.SCUM,pilotid:199,done:!0,unit:"Protectorate Starfighter",skill:1,upgrades:[a.TORPEDO],points:20},{name:"Concord Dawn Veteran",faction:a.SCUM,pilotid:200,done:!0,unit:"Protectorate Starfighter",skill:3,upgrades:[a.ELITE,a.TORPEDO],points:22},{name:"Concord Dawn Ace",faction:a.SCUM,pilotid:201,done:!0,unit:"Protectorate Starfighter",skill:5,upgrades:[a.ELITE,a.TORPEDO],points:23},{name:"Kad Solus",faction:a.SCUM,pilotid:202,unique:!0,done:!0,unit:"Protectorate Starfighter",
skill:6,upgrades:[a.ELITE,a.TORPEDO],points:25,init:function(){this.wrap_after("handledifficulty",this,function(a){"RED"==a&&(this.addfocustoken(),this.addfocustoken(),this.log("red maneuver -> +2 %FOCUS% [%0]",this.name))})}},{name:"Old Teroch",faction:a.SCUM,pilotid:203,unique:!0,done:!0,unit:"Protectorate Starfighter",skill:7,upgrades:[a.ELITE,a.TORPEDO],points:26,init:function(){var a=this;this.wrap_before("begincombatphase",this,function(){this.selectunit(this.selectnearbyenemy(1,function(a,
b){return!0}),function(b,c){var e,f=b[c].focus,h=b[c].evade;if(0<f)for(b[c].log("-%0 %FOCUS% [%1]",f,a.name),e=0;e<f;e++)b[c].removefocustoken();if(0<h)for(b[c].log("-%0 %EVADE% [%1]",f,a.name),e=0;e<h;e++)b[c].removeevadetoken()},["select unit [%0]",a.name],!1)})}},{name:"Fenn Rau",faction:a.SCUM,pilotid:204,unique:!0,done:!0,unit:"Protectorate Starfighter",skill:9,upgrades:[a.ELITE,a.TORPEDO],points:28,init:function(){this.wrap_after("getattackstrength",this,function(a,b,c){1==this.getrange(b)&&
(this.log("+1 attack die"),c+=1);return c});this.wrap_after("getdefensestrength",this,function(a,b,c){1==this.getrange(b)&&(this.log("+1 defense die"),c+=1);return c})}},{name:"Norra Wexley",faction:a.REBEL,pilotid:205,unique:!0,unit:"ARC-170",skill:7,done:!0,upgrades:[a.ELITE,a.TORPEDO,a.CREW,a.ASTROMECH],points:29,init:function(){this.wrap_after("modifyattackroll",this,function(b,c,e,f){1==this.targeting.length&&(f+=a.FCH_FOCUS);return f});this.adddicemodifier(a.ATTACK_M,a.ADD_M,a.ATTACK_M,this,
{req:function(a,b){return this.canusetarget(targetunit)}.bind(this),f:function(b,c){this.removetarget(targetunit);this.log("1 %TARGET% -> 1 %FOCUS%");return{m:b+a.FCH_FOCUS,n:c+1}}.bind(this),str:"target"});this.adddicemodifier(a.DEFENSE_M,a.ADD_M,a.DEFENSE_M,this,{req:function(a,b){return this.canusetarget(activeunit)}.bind(this),f:function(b,c){this.removetarget(activeunit);this.log("1 %TARGET% -> 1 %FOCUS%");return{m:b+a.FE_FOCUS,n:c+1}}.bind(this),str:"target"})}},{name:"Shara Bey",faction:a.REBEL,
pilotid:206,unique:!0,done:!0,unit:"ARC-170",skill:6,upgrades:[a.ELITE,a.TORPEDO,a.CREW,a.ASTROMECH],points:28,init:function(){var b=this;a.prototype.wrap_after("declareattack",b,function(a,c,e){e&&b!=this&&b.isally(this)&&(this.wrap_after("canusetarget",b,function(a,c){return 2>=b.getrange(this)&&-1<b.targeting.indexOf(a)?!0:c}).unwrap("cleanupattack"),this.wrap_before("removetarget",b,function(a){2>=b.getrange(this)&&-1==this.targeting.indexOf(a)&&-1<b.targeting.indexOf(a)&&b.removetarget(a)}).unwrap("cleanupattack"));
return e})}},{name:"Thane Kyrell",faction:a.REBEL,pilotid:207,unique:!0,done:!0,unit:"ARC-170",skill:4,upgrades:[a.TORPEDO,a.CREW,a.ASTROMECH],points:26,init:function(){var b=this;a.prototype.wrap_after("afterdefenseeffect",this,function(a,c){b!=this&&this.isally(b)&&3>=b.getrange(this)&&b.candoaction()&&(b.log("+1 free action [%0]",b.name),b.doaction(b.getactionlist(),""))})}},{name:"Braylen Stramm",faction:a.REBEL,pilotid:208,unique:!0,done:!0,unit:"ARC-170",skill:3,upgrades:[a.TORPEDO,a.CREW,a.ASTROMECH],
points:25,init:function(){this.wrap_before("endmaneuver",this,function(){if(0<this.stress){var a=this.rollattackdie(1,this,"hit")[0];if("hit"==a||"critical"==a)this.log("-1 stress [%0]",this.name),this.removestresstoken()}})}},{name:"Omega Specialist",faction:a.EMPIRE,pilotid:209,done:!0,unit:"TIE/SF Fighter",skill:5,upgrades:[a.ELITE,a.SYSTEM,a.MISSILE,a.TECH],points:25},{name:"Sabine Wren",faction:a.REBEL,pilotid:210,done:!0,unique:!0,unit:"TIE Fighter",skill:5,ambiguous:!0,edition:"TIE Fighter",
upgrades:[a.ELITE],points:15,wave:["10"],init:function(){this.wrap_after("beginactivation",this,c)}},{name:"Chewbacca",unit:"YT-1300",skill:5,unique:!0,edition:"HoR",wave:["aces"],ambiguous:!0,done:!0,pilotid:211,faction:a.REBEL,upgrades:[a.ELITE,a.MISSILE,a.CREW,a.CREW],points:42,init:function(){var a=this;this.addattack(function(b,c,e){return 0>=b+c&&3>=a.getrange(e)},this,this.weapons,function(){},function(){return squadron},"warndeath")}},{name:"Han Solo",unit:"YT-1300",skill:9,done:!0,unique:!0,
edition:"HoR",wave:["aces"],ambiguous:!0,pilotid:212,faction:a.REBEL,upgrades:[a.ELITE,a.MISSILE,a.CREW,a.CREW],points:46},{name:"Nien Nunb",unit:"T-70 X-Wing",unique:!0,wave:["aces"],done:!0,pilotid:213,faction:a.REBEL,upgrades:[a.ELITE,a.TORPEDO,a.ASTROMECH,a.TECH],init:function(){this.wrap_after("addstress",this,function(){0<this.selectnearbyenemy(1,function(a,b){return a.isinprimaryfiringarc(b)}).length&&this.removestresstoken()})},points:29,skill:7},{name:"'Snap' Wexley",unit:"T-70 X-Wing",unique:!0,
done:!0,pilotid:214,faction:a.REBEL,upgrades:[a.ELITE,a.TORPEDO,a.ASTROMECH,a.TECH],points:28,wave:["aces"],skill:6,init:function(){this.wrap_before("endmaneuver",this,function(){var a=this.moves,b;for(b in a)a[b].move.match(/\w+[234]/)&&!this.collision&&this.candoboost()&&this.doaction([this.newaction(this.resolveboost,"BOOST")],"free %BOOST%")})}},{name:"Jess Pava",unit:"T-70 X-Wing",unique:!0,done:!0,pilotid:215,faction:a.REBEL,upgrades:[a.TORPEDO,a.ASTROMECH,a.TECH],points:25,skill:3,wave:["aces"],
init:function(){var b=this,c=function(){return b.selectnearbyally(1,function(a,b){return a!=b}).length};this.adddicemodifier(a.ATTACK_M,a.REROLL_M,a.ATTACK_M,this,{dice:["blank","focus"],n:c,req:function(a,b,c){return!0}});this.adddicemodifier(a.DEFENSE_M,a.REROLL_M,a.DEFENSE_M,this,{dice:["blank","focus"],n:c,req:function(a,b,c){return!0}})}},{name:"Ahsoka Tano",faction:a.REBEL,pilotid:216,unique:!0,unit:"TIE Fighter",skill:7,upgrades:[a.ELITE],points:17,wave:["10"],done:!0,init:function(){var a=
this;this.wrap_before("begincombatphase",this,function(){if(this.canusefocus()){var b=this.selectnearbyally(1);b.push(this);this.selectunit(b,function(b,c){b[c]!=a&&(a.removefocustoken(),b[c].log("+1 free action [%0]",a.name),b[c].doaction(b[c].getactionlist(),""))},["select unit, self to cancel [%0]",a.name],!1)}})}},{name:"Captain Rex",faction:a.REBEL,pilotid:217,unique:!0,done:!0,unit:"TIE Fighter",skill:4,wave:["10"],upgrades:[],points:14,init:function(){this.wrap_after("endattack",this,function(a,
b,c){new Condition(c,this,"Suppressive Fire")})}},{name:"Constable Zuvio",faction:a.SCUM,pilotid:218,unique:!0,unit:"Quadjumper",skill:7,upgrades:[a.ELITE,a.CREW,a.BOMB,a.TECH,a.ILLICIT],points:19,done:!0,init:function(){this.wrap_after("getbombposition",this,function(a,b,c){var e=this.maneuver;if(this.getdial()[e].move.match(/R/))for(e=0;e<a.length;e++)c.push(this.getpathmatrix(this.m.clone(),a[e]).translate(0,-b+20));return c});for(var a=0;a<this.bombs.length;a++)this.bombs[a].wrap_after("canbedropped",
this,function(a){return a||this.unit.getdial()[this.unit.maneuver].move.match(/R/)})}},{name:"Unkar Plutt",faction:a.SCUM,pilotid:219,unique:!0,unit:"Quadjumper",skill:3,upgrades:[a.CREW,a.BOMB,a.TECH,a.ILLICIT],points:17,done:!0,init:function(){this.wrap_after("endactivationphase",this,function(){for(var a in this.touching){var b=this.touching[a];this.log("+1 tractor beam for %0",b.name);b.addtractorbeam(this)}})}},{name:"Jakku Gunrunner",faction:a.SCUM,pilotid:220,done:!0,unit:"Quadjumper",skill:1,
upgrades:[a.CREW,a.BOMB,a.TECH,a.ILLICIT],points:15},{name:"Heff Tobber",faction:a.REBEL,pilotid:221,unique:!0,unit:"U-Wing",skill:3,upgrades:[a.SYSTEM,a.TORPEDO,a.CREW,a.CREW],points:24,done:!0,init:function(){this.wrap_after("collidedby",this,function(a){this.doaction(this.getactionlist(),"")})}},{name:"Blue Squadron Pathfinder",faction:a.REBEL,pilotid:222,unit:"U-Wing",done:!0,skill:2,upgrades:[a.SYSTEM,a.TORPEDO,a.CREW,a.CREW],points:23},{name:"Bodhi Rook",faction:a.REBEL,unique:!0,pilotid:223,
unit:"U-Wing",skill:4,done:!0,upgrades:[a.SYSTEM,a.TORPEDO,a.CREW,a.CREW],points:25,init:function(){var b=this;a.prototype.wrap_after("gettargetableunits",this,function(c,e){if(b.isally(this)){var f=[],h;for(h in squadron){var l=squadron[h];l.isally(b)&&(f=f.concat(a.prototype.gettargetableunits.vanilla.call(l,3)))}return f}return e})}},{name:"'Duchess'",faction:a.EMPIRE,unique:!0,done:!0,pilotid:224,unit:"TIE Striker",skill:8,upgrades:[a.ELITE],points:23,init:function(){this.facultativeailerons=
!0}},{name:"'Countdown'",faction:a.EMPIRE,unique:!0,pilotid:225,unit:"TIE Striker",skill:5,upgrades:[],done:!0,points:20,init:function(){this.adddicemodifier(a.ATTACKCOMPARE_M,a.ADD_M,a.ATTACK_M,this,{req:function(a,b){return 0==this.stress&&0<b}.bind(this),f:function(a,b){return 0==this.stress?(this.log("cancel all dice results"),this.applydamage(1),this.endattack(),this.addstress(),{m:0,n:0}):{m:a,n:b}}.bind(this),str:"hit"})}},{name:"'Pure Sabacc'",faction:a.EMPIRE,unique:!0,pilotid:226,unit:"TIE Striker",
skill:6,upgrades:[a.ELITE],points:22,done:!0,init:function(){this.wrap_after("getattackstrength",this,function(a,b,c){1>=this.criticals.length&&(c+=1);return c})}},{name:"Imperial Trainee",faction:a.EMPIRE,pilotid:227,done:!0,unit:"TIE Striker",skill:1,upgrades:[],points:17},{name:"Black Squadron Scout",faction:a.EMPIRE,pilotid:228,done:!0,unit:"TIE Striker",skill:4,upgrades:[a.ELITE],points:20},{name:"Scarif Defender",faction:a.EMPIRE,pilotid:229,done:!0,unit:"TIE Striker",skill:3,upgrades:[],points:18},
{name:"Cassian Andor",faction:a.REBEL,pilotid:230,unit:"U-Wing",skill:6,unique:!0,done:!0,upgrades:[a.ELITE,a.SYSTEM,a.TORPEDO,a.CREW,a.CREW],points:27,init:function(){var a=this;this.wrap_after("beginactivationphase",this,function(b){var c=this.selectnearbyally(2,function(a,b){return 0<b.stress?!0:!1});0<c.length&&this.doselection(function(b){this.log("select unit for -1 stress");this.resolveactionselection(c,function(e){c[e].removestresstoken();a.endnoaction(b)})}.bind(this));return b})}},{name:"Kylo Ren",
faction:a.EMPIRE,pilotid:231,unique:!0,unit:"Upsilon-Class Shuttle",skill:6,done:!0,upgrades:[a.ELITE,a.SYSTEM,a.CREW,a.CREW,a.TECH,a.TECH],points:34,init:e},{name:"Major Stridan",faction:a.EMPIRE,pilotid:232,unique:!0,done:!0,unit:"Upsilon-Class Shuttle",skill:4,upgrades:[a.SYSTEM,a.CREW,a.CREW,a.TECH,a.TECH],points:32,init:function(){this.wrap_after("selectnearbyally",this,function(b,c,e){"undefined"==typeof e&&(e=c,c=void 0);return 1<b?e:a.prototype.selectnearbyally.call(this,3,c)})}},{name:"Lieutenant Dormitz",
faction:a.EMPIRE,pilotid:233,unique:!0,done:!0,unit:"Upsilon-Class Shuttle",skill:3,upgrades:[a.SYSTEM,a.CREW,a.CREW,a.TECH,a.TECH],points:31},{name:"Starkiller Base Pilot",faction:a.EMPIRE,pilotid:234,done:!0,unit:"Upsilon-Class Shuttle",skill:2,upgrades:[a.SYSTEM,a.CREW,a.CREW,a.TECH,a.TECH],points:30},{name:"'Zeb' Orrelios",faction:a.REBEL,pilotid:235,unique:!0,done:!0,ambiguous:!0,edition:"TIE Fighter",unit:"TIE Fighter",skill:3,wave:["10"],upgrades:[],points:13,cancelhit:h},{name:"Resistance Sympathizer",
faction:a.REBEL,pilotid:236,done:!0,unit:"YT-1300",skill:3,wave:["aces"],upgrades:[a.MISSILE,a.CREW,a.CREW],points:38},{name:"Sarco Plank",faction:a.SCUM,pilotid:237,done:!0,unique:!0,unit:"Quadjumper",skill:5,upgrades:[a.ELITE,a.CREW,a.BOMB,a.TECH,a.ILLICIT],points:18,init:function(){this.wrap_after("getdefensestrength",this,function(a,b,c){a=0;b=this.getagility();0<=this.lastmaneuver&&(a=P[this.getdial()[this.lastmaneuver].move].speed);b<a&&(c=c-b+a);return c})}},{name:"Inaldra",faction:a.SCUM,
pilotid:238,unique:!0,done:!0,unit:"M3-A Interceptor",skill:3,wave:["epic"],upgrades:[a.ELITE],points:15,init:function(){this.adddicemodifier(a.ATTACK_M,a.REROLL_M,a.ATTACK_M,this,{dice:["blank","focus"],n:function(){return 9},req:function(a,b,c){return 0<this.shield?!0:!1}.bind(this),side:function(){this.removeshield(1)}.bind(this)});this.adddicemodifier(a.DEFENSE_M,a.REROLL_M,a.DEFENSE_M,this,{dice:["blank","focus"],n:function(){return 9},req:function(a,b,c){return 0<this.shield?!0:!1}.bind(this),
side:function(){this.removeshield(1)}.bind(this)})}},{name:"Genesis Red",faction:a.SCUM,pilotid:239,unique:!0,done:!0,unit:"M3-A Interceptor",skill:7,wave:["epic"],upgrades:[a.ELITE],points:19,init:function(){this.wrap_after("addtarget",this,function(a){var b=a.evade-this.evade;(0<a.focus-this.focus||0<b)&&this.log("balance %FOCUS% and %EVADE% with %0",a.name);if(a.focus>this.focus)for(;a.focus>this.focus;)this.addfocustoken();if(a.evade>this.evade)for(;a.evade>this.evade;)this.addevadetoken()})}},
{name:"Sunny Bounder",faction:a.SCUM,pilotid:240,unique:!0,unit:"M3-A Interceptor",skill:1,wave:["epic"],upgrades:[],points:14},{name:"Quinn Jast",faction:a.SCUM,pilotid:241,unique:!0,wave:["epic"],unit:"M3-A Interceptor",skill:6,upgrades:[a.ELITE],points:18,done:!0,init:function(){this.wrap_before("begincombatphase",this,function(){this.donoaction([{action:function(b){this.noattack=round;for(var c in this.upgrades){var e=this.upgrades[c];e.type!=a.TORPEDO&&e.type!=a.MISSILE||0!=e.isactive||(e.isactive=
!0)}this.endnoaction(b,"")}.bind(this),type:"TORPEDO",name:this.name}],"",!0)})}},{name:"Senator's Shuttle",faction:a.REBEL,pilotid:242,unit:"Corellian Star Shuttle",skill:0,done:!0,upgrades:[],points:2,init:function(){this.wrap_before("begincombatphase",this,function(){this.noattack=round});var a=this,b;for(b in squadron){var c=squadron[b];c.team==this.team&&1==this.getrange(c)&&c.wrap_after("getupgactionlist",this,function(b){var c=this.selectnearbyally(1);!a.dead&&-1<c.indexOf(a)&&b.push({org:a,
action:function(b){a.addevadetoken();this.endaction(b)},type:"REINFORCE",name:"Protect"});return b})}}},{name:"Lieutenant Kestal",faction:a.EMPIRE,unique:!0,done:!1,pilotid:243,unit:"TIE Aggressor",skill:7,points:22,upgrades:[a.ELITE,a.TURRET,a.MISSILE,a.MISSILE]},{name:"'Double Edge'",faction:a.EMPIRE,unique:!0,done:!1,pilotid:244,unit:"TIE Aggressor",skill:4,points:19,upgrades:[a.ELITE,a.TURRET,a.MISSILE,a.MISSILE]},{name:"Onyx Squadron Escort",faction:a.EMPIRE,unique:!1,done:!0,pilotid:245,unit:"TIE Aggressor",
skill:5,points:19,upgrades:[a.TURRET,a.MISSILE,a.MISSILE]},{name:"Sienar Specialist",faction:a.EMPIRE,unique:!1,done:!0,pilotid:246,unit:"TIE Aggressor",skill:2,points:17,upgrades:[a.TURRET,a.MISSILE,a.MISSILE]},{name:"Wullffwarro",faction:a.REBEL,unique:!0,done:!1,pilotid:247,unit:"Auzituck Gunship",skill:7,points:30,upgrades:[a.ELITE,a.CREW,a.CREW]},{name:"Lowhhrick",faction:a.REBEL,unique:!0,done:!1,pilotid:248,unit:"Auzituck Gunship",skill:5,points:28,upgrades:[a.ELITE,a.CREW,a.CREW]},{name:"Wookiee Liberator",
faction:a.REBEL,unique:!1,done:!0,pilotid:249,unit:"Auzituck Gunship",skill:3,points:26,upgrades:[a.ELITE,a.CREW,a.CREW]},{name:"Kashyyyk Defender",faction:a.REBEL,unique:!1,done:!0,pilotid:250,unit:"Auzituck Gunship",skill:1,points:24,upgrades:[a.CREW,a.CREW]},{name:"Captain Nym",faction:a.SCUM,unique:!0,done:!1,pilotid:251,unit:"Scurrg H-6 Bomber",skill:8,points:30,upgrades:[a.ELITE,a.TURRET,a.TORPEDO,a.MISSILE,a.CREW,a.BOMB,a.BOMB]},{name:"Sol Sixxa",faction:a.SCUM,unique:!0,done:!1,pilotid:252,
unit:"Scurrg H-6 Bomber",skill:6,points:28,upgrades:[a.ELITE,a.TURRET,a.TORPEDO,a.MISSILE,a.CREW,a.BOMB,a.BOMB]},{name:"Lok Revenant",faction:a.SCUM,unique:!1,done:!0,pilotid:253,unit:"Scurrg H-6 Bomber",skill:3,points:26,upgrades:[a.ELITE,a.TURRET,a.TORPEDO,a.MISSILE,a.CREW,a.BOMB,a.BOMB]},{name:"Karthakk Pirate",faction:a.SCUM,unique:!1,done:!0,pilotid:254,unit:"Scurrg H-6 Bomber",skill:1,points:24,upgrades:[a.TURRET,a.TORPEDO,a.MISSILE,a.CREW,a.BOMB,a.BOMB]},{name:"Captain Nym",faction:a.REBEL,
unique:!0,done:!1,pilotid:255,unit:"Scurrg H-6 Bomber",skill:8,points:30,upgrades:[a.ELITE,a.TURRET,a.TORPEDO,a.MISSILE,a.CREW,a.BOMB,a.BOMB]},{name:"Dalan Oberos",faction:a.SCUM,done:!1,unique:!0,pilotid:256,unit:"StarViper",skill:6,points:30,upgrades:[a.ELITE,a.TORPEDO]},{name:"Thweek",faction:a.SCUM,done:!1,unique:!0,pilotid:257,unit:"StarViper",skill:4,points:28,upgrades:[a.TORPEDO],init:function(){var a=this;this.wrap_after("endsetupphase",this,function(){var b=[],c;for(c in squadron)squadron[c].team!=
this.team&&b.push(squadron[c]);var e=$.Deferred();this.selectunit(b,function(a,b){this.log("select unit for condition [%0]","Shadowed");new Condition(a[b],this,"Shadowed");e.resolve()}.bind(this),["select unit for condition (or self to cancel) [%0]",a.name],!0)})}},{name:"Black Sun Assassin",faction:a.SCUM,done:!0,pilotid:258,unit:"StarViper",skill:5,points:28,upgrades:[a.ELITE,a.TORPEDO]},{name:"Viktor Hel",unique:!0,faction:a.SCUM,pilotid:259,unit:"Kihraxz Fighter",done:!1,skill:7,upgrades:[a.ELITE,
a.MISSILE,a.ILLICIT],points:25},{name:"Captain Jostero",unique:!0,faction:a.SCUM,pilotid:260,unit:"Kihraxz Fighter",done:!1,skill:4,upgrades:[a.ELITE,a.MISSILE,a.ILLICIT],points:24},{name:"Major Vynder",faction:a.EMPIRE,unique:!0,done:!1,pilotid:261,unit:"Alpha-class Star Wing",skill:7,points:26,upgrades:[a.ELITE,a.TORPEDO,a.MISSILE]},{name:"Lieutenant Karsabi",faction:a.EMPIRE,unique:!0,done:!1,pilotid:262,unit:"Alpha-class Star Wing",skill:5,points:24,upgrades:[a.ELITE,a.TORPEDO,a.MISSILE]},{name:"Rho Squadron Veteran",
faction:a.EMPIRE,done:!0,pilotid:263,unit:"Alpha-class Star Wing",skill:4,points:21,upgrades:[a.ELITE,a.TORPEDO,a.MISSILE]},{name:"Nu Squadron Pilot",faction:a.EMPIRE,done:!0,pilotid:264,unit:"Alpha-class Star Wing",skill:2,points:18,upgrades:[a.TORPEDO,a.MISSILE]},{name:"Torani Kulda",faction:a.SCUM,pilotid:265,unique:!0,done:!1,unit:"M12-L Kimogila Fighter",skill:8,points:27,upgrades:[a.ELITE,a.TORPEDO,a.MISSILE,a.SALVAGED,a.ILLICIT]},{name:"Dalan Oberos",faction:a.SCUM,pilotid:266,unique:!0,done:!1,
unit:"M12-L Kimogila Fighter",ambiguous:!0,edition:"Kimogila Fighter",skill:7,points:25,upgrades:[a.ELITE,a.TORPEDO,a.MISSILE,a.SALVAGED,a.ILLICIT]},{name:"Cartel Executioner",faction:a.SCUM,pilotid:267,unique:!1,done:!1,unit:"M12-L Kimogila Fighter",skill:5,points:24,upgrades:[a.ELITE,a.TORPEDO,a.MISSILE,a.SALVAGED,a.ILLICIT]},{name:"Cartel Brute",faction:a.SCUM,pilotid:268,unique:!1,done:!1,unit:"M12-L Kimogila Fighter",skill:3,points:22,upgrades:[a.TORPEDO,a.MISSILE,a.SALVAGED,a.ILLICIT]},{name:"Fenn Rau",
faction:a.REBEL,unique:!0,unit:"Sheathipede-class Shuttle",skill:9,edition:"Sheathipede-class Shuttle",ambiguous:!0,pilotid:269,points:20,done:!1,upgrades:[a.ELITE,a.CREW,a.ASTROMECH]},{name:"Ezra Bridger",faction:a.REBEL,unique:!0,ambiguous:!0,edition:"Sheathipede-class Shuttle",unit:"Sheathipede-class Shuttle",skill:5,pilotid:270,points:17,done:!0,init:f,upgrades:[a.ELITE,a.CREW,a.ASTROMECH]},{name:"'Zeb' Orrelios",faction:a.REBEL,unique:!0,ambiguous:!0,edition:"Sheathipede-class Shuttle",unit:"Sheathipede-class Shuttle",
skill:3,pilotid:271,points:16,done:!0,cancelhit:h,upgrades:[a.CREW,a.ASTROMECH]},{name:"AP-5",faction:a.REBEL,unique:!0,unit:"Sheathipede-class Shuttle",skill:1,pilotid:272,points:15,done:!1,upgrades:[a.CREW,a.ASTROMECH]},{name:"Kylo Ren",faction:a.EMPIRE,pilotid:273,unique:!0,unit:"TIE Silencer",edition:"TIE Silencer",ambiguous:!0,skill:9,done:!0,upgrades:[a.ELITE,a.SYSTEM,a.TECH],points:35,init:e},{name:"Test Pilot 'Blackout'",faction:a.EMPIRE,pilotid:274,unique:!0,unit:"TIE Silencer",skill:7,done:!1,
upgrades:[a.ELITE,a.SYSTEM,a.TECH],points:31},{name:"First Order Test Pilot",faction:a.EMPIRE,pilotid:275,unique:!1,unit:"TIE Silencer",skill:6,done:!0,upgrades:[a.ELITE,a.SYSTEM,a.TECH],points:29},{name:"Sienar-Jaemus Analyst",faction:a.EMPIRE,pilotid:276,unique:!1,unit:"TIE Silencer",skill:4,done:!0,upgrades:[a.SYSTEM,a.TECH],points:26},{name:"'Crimson Leader'",faction:a.REBEL,pilotid:277,unit:"B/SF-17 Bomber",skill:7,unique:!0,done:!1,upgrades:[a.SYSTEM,a.BOMB,a.BOMB,a.TECH],points:29},{name:"'Cobalt Leader'",
faction:a.REBEL,pilotid:278,unit:"B/SF-17 Bomber",skill:6,unique:!0,done:!1,upgrades:[a.SYSTEM,a.BOMB,a.BOMB,a.TECH],points:28},{name:"'Crimson Specialist'",faction:a.REBEL,pilotid:279,unit:"B/SF-17 Bomber",skill:4,unique:!0,done:!1,upgrades:[a.SYSTEM,a.BOMB,a.BOMB,a.TECH],points:27},{name:"Crimson Squadron Pilot",faction:a.REBEL,pilotid:280,unit:"B/SF-17 Bomber",skill:1,unique:!1,done:!0,upgrades:[a.SYSTEM,a.BOMB,a.BOMB,a.TECH],points:25}]})();var Critical=window.Critical||{},Unit=window.Unit||{},PILOTS=window.PILOTS||{},OBSTACLES=window.OBSTACLES||{},UPGRADES=window.UPGRADES=[{name:"Ion Cannon Turret",type:Unit.TURRET,firesnd:"falcon_fire",points:5,attack:3,upgid:0,done:!0,modifyhit:function(b){return Unit.FCH_HIT},prehit:function(b,a,c){this.unit.hitresolved=1;this.unit.criticalresolved=0;b.log("+%1 %HIT%, +1 ion token [%0]",this.name,1);b.addiontoken()},range:[1,2]},{name:"Proton Torpedoes",requires:"Target",consumes:!0,type:Unit.TORPEDO,
firesnd:"missile",points:4,done:!0,attack:4,init:function(b){this.wrap_after("modifyattackroll",this,function(a,b,f,h){0<Unit.FCH_focus(h)&&(h=h-Unit.FCH_FOCUS+Unit.FCH_CRIT);return h});b.adddicemodifier(Unit.ATTACK_M,Unit.MOD_M,Unit.ATTACK_M,this,{req:function(a,e){return b.weapons[b.activeweapon]==this}.bind(this),aiactivate:function(a,b){return 0<Unit.FCH_focus(a)},f:function(a,b){0<Unit.FCH_focus(a)&&(this.unit.log("1 %FOCUS% -> 1 %CRIT% [%0]",this.name),a=a-Unit.FCH_FOCUS+Unit.FCH_CRIT);return a}.bind(this),
str:"focus"});var a=this;b.wrap_after("setpriority",this,function(b){"TARGET"==b.type&&a.isactive&&this.candotarget()&&(b.priority+=10)})},range:[2,3]},{name:"R2 Astromech",done:!0,install:function(b){var a,c=this,e=[];b.installed=!0;b.wrap_after("getdial",this,function(b){if(0===e.length){for(a=0;a<b.length;a++){var f=P[b[a].move].speed,l=b[a].difficulty;if(1==f||2==f)l="GREEN";e[a]={move:b[a].move,difficulty:l}}this.log("1, 2 speed maneuvers are green [%0]",c.name)}return e})},uninstall:function(b){"function"==
typeof b.getdial.unwrap&&b.getdial.unwrap(this)},type:Unit.ASTROMECH,points:1},{name:"R2-D2",done:!0,init:function(b){var a=this;b.wrap_after("handledifficulty",this,function(b){"GREEN"==b&&this.shield<this.ship.shield&&(this.addshield(1),this.log("+1 %SHIELD% [%0]",a.name))})},unique:!0,type:Unit.ASTROMECH,points:4},{name:"R2-F2",done:!0,candoaction:function(){return this.isactive},action:function(b){var a=this.unit;this.isactive&&(this.unit.log("+1 agility until end of round [%0]",a.name),a.wrap_after("getagility",
this,function(a){return a+1}).unwrapper("endphase"),a.showstats());a.endaction(b,Unit.ASTROMECH);return!0},unique:!0,type:Unit.ASTROMECH,points:3},{name:"R5-D8",done:!0,candoaction:function(){if(!this.isactive)return!1;for(var b=0;b<this.unit.criticals.length;b++)if(!1===this.unit.criticals[b].isactive)return!0;return!1},action:function(b){var a=this;this.isactive?this.unit.defenseroll(1).done(function(c){if(0<Unit.FE_evade(c.roll)+Unit.FE_focus(c.roll))for(c=0;c<this.criticals.length;c++)if(!1===
this.criticals[c].isactive){this.log("-1 %HIT% [%0]",a.name);this.criticals.slice(c,1);this.addhull(1);this.show();break}this.endaction(b,Unit.ASTROMECH)}.bind(this.unit)):this.unit.endaction(b,Unit.ASTROMECH)},unique:!0,type:Unit.ASTROMECH,points:3},{name:"R5-X3",unique:!0,type:Unit.ASTROMECH,points:1,done:!0,init:function(b){var a=this;b.wrap_after("updateactivationdial",this,function(){this.addactivationdial(function(){return!this.hasionizationeffect()&&a.isactive}.bind(this),function(){this.log("ignore obstacles [%0]",
a.name);a.desactivate();this.wrap_after("hascollidedobstacle",a,function(a){return!1}).unwrapper("endphase");this.wrap_after("isfireobstructed",this,function(){return!1}).unwrapper("endphase");this.wrap_after("getobstructiondef",this,function(){return 0}).unwrapper("endphase");this.show()}.bind(this),A[Unit.ASTROMECH.toUpperCase()].key,$("<div>").attr({"class":"symbols"}));return this.activationdial})}},{name:"BB-8",unique:!0,done:!0,type:Unit.ASTROMECH,points:2,init:function(b){var a=this;a.bb=-1;
b.wrap_after("updateactivationdial",this,function(b){a.isactive&&a.bb!=round&&!this.hasionizationeffect()&&this.addactivationdial(function(){return!this.hasmoved&&-1<this.maneuver&&"GREEN"==this.getmaneuver().difficulty&&this.candoroll()&&!this.hasionizationeffect()}.bind(this),function(){a.bb=round;this.doaction([this.newaction(this.resolveroll,"ROLL")],a.name+" free roll for green maneuver.")}.bind(this),A[Unit.ASTROMECH.toUpperCase()].key,$("<div>").attr({"class":"symbols",title:a.name}));return this.activationdial})}},
{name:"Integrated Astromech",points:0,type:Unit.MOD,ship:"X-Wing",done:!0,init:function(b){var a=this;b.wrap_after("deal",this,function(b,e,f){var c=-1,l;for(l in this.upgrades)if(b=this.upgrades[l],b.type==Unit.ASTROMECH&&!0===b.isactive){c=l;break}if(-1==c||!a.isactive)return f;var t=$.Deferred();f.then(function(b){var e=1==this.shield+this.hull,f=b.face==Critical.FACEUP&&b.crit.lethal&&2>=this.shield+this.hull;a.isactive&&(e||f)?(this.upgrades[c].desactivate(),this.log("%0 is inactive, damage discarded [%1]",
this.upgrades[c].name,a.name),a.desactivate(),t.resolve({crit:b.crit,face:Critical.DISCARD})):t.resolve(b)}.bind(this));return t.promise()})}},{name:"Weapons Guidance",points:2,type:Unit.TECH,done:!0,init:function(b){var a=this;b.wrap_after("modifyattackroll",this,function(a,b,f,h){0===Unit.FCH_focus(h)&&0<Unit.FCH_blank(h,b)&&this.canusefocus()&&(h+=Unit.FCH_HIT);return h});b.adddicemodifier(Unit.ATTACK_M,Unit.MOD_M,Unit.ATTACK_M,this,{req:function(b,e){return a.isactive&&this.canusefocus()}.bind(b),
aiactivate:function(a,b){return 0<Unit.FCH_blank(a,b)},f:function(b,e){var c=Unit.FCH_blank(b,e);this.removefocustoken();displayattacktokens(this);0<c&&(this.log("1 blank -> 1 %HIT% [%0]",a.name),b+=Unit.FCH_HIT);return b}.bind(b),str:"blank"})}},{name:"R5-K6",init:function(b){var a=this;b.wrap_after("removetarget",this,function(b){this.defenseroll(1).done(function(c){0<Unit.FE_evade(c.roll)&&(this.addtarget(b),this.log("+1 %TARGET% / %1 [%0]",a.name,b.name))}.bind(this))})},done:!0,unique:!0,type:Unit.ASTROMECH,
points:2},{name:"R5 Astromech",done:!0,init:function(b){var a=this;b.wrap_before("endphase",this,function(){for(var b=-1,e=-1,f=0;f<this.criticals.length;f++){var h=this.criticals[f];if(h.isactive&&"ship"==h.type&&(b=f,h.lethal)){e=f;break}}-1<e?(this.log("repairing critical %1 [%0]",a.name,this.criticals[e].name),this.criticals[e].facedown()):-1<b&&(this.log("repairing critical %1 [%0]",a.name,this.criticals[b].name),this.criticals[b].facedown())})},type:Unit.ASTROMECH,points:1},{name:"Determination",
done:!0,rating:1,init:function(b){var a=this;b.wrap_after("deal",this,function(b,e,f){if("pilot"!=b.type)return f;var c=$.Deferred();f.then(function(b){b.face==Critical.FACEUP?(this.log("discarding critical %1 [%0]",a.name,b.crit.name),c.resolve({crit:b.crit,face:Critical.DISCARD})):c.resolve(b)}.bind(this));return c.promise()})},type:Unit.ELITE,points:1},{name:"Swarm Tactics",type:Unit.ELITE,points:2,done:!0,init:function(b){var a=this;"undefined"==typeof Unit.prototype.getswarm&&(Unit.prototype.getswarm=
function(){return[[],[],[]]});Unit.prototype.wrap_after("getswarm",this,function(b){b[a.unit.team]=b[a.unit.team].concat(a.unit);return b});a.unit.propswarm=-1;b.wrap_before("begincombatphase",this,function(){var b=this.getswarm()[this.team],e=this;if(this==b[0])for(var f=b.length,h=function(c){b.sort(function(a,b){return a.getskill()>b.getskill()?1:a.getskill()<b.getskill()?-1:0});var f=b.pop(),h=f.selectnearbyally(1,function(a,b){return a.getskill()>b.getskill()});f.select();var l=f.getskill();
0===h.length?e.endnoaction(c,"SELECT"):f.resolveactionselection(h,function(b){h[b].wrap_after("getskill",a,function(a){return l}).unwrapper("endcombatphase");h[b].log("PS set to %1 [%0]",a.name,l);h[b].showskill();e.endnoaction(c,"SELECT")})},l=0;l<f;l++)this.doselection(h)})}},{name:"Squad Leader",unique:!0,done:!0,type:Unit.ELITE,points:2,candoaction:function(){var b=this.unit.selectnearbyally(2,function(a,b){return b.getskill()<a.getskill()&&b.candoaction()});return this.isactive&&0<b.length},
action:function(b){var a=this.unit,c=a.selectnearbyally(2,function(a,b){return b.getskill()<a.getskill()&&b.candoaction()});0<c.length?a.resolveactionselection(c,function(e){c[e].select();c[e].doaction(c[e].getactionlist(),"+1 free action").done(function(){a.select()});a.endaction(b,"ELITE")}):(a.log("no lower skilled pilot within range 2 [%0]",this.name),a.endaction(b,"ELITE"))}},{name:"Expert Handling",rating:1,candoaction:function(){return this.isactive&&-1==this.unit.actionsdone.indexOf("ROLL")},
action:function(b){-1==this.unit.shipactionList.indexOf("ROLL")&&this.unit.addstress();0<this.unit.istargeted.length?(this.unit.log("select target to lock [%0]",this.name),this.unit.resolveactionselection(this.unit.istargeted,function(a){this.istargeted[a].removetarget(this);this.resolveroll(b)}.bind(this.unit))):this.unit.resolveroll(b)},type:Unit.ELITE,done:!0,points:2},{name:"Marksmanship",rating:1,init:function(b){this.mark=-1;var a=this;b.wrap_after("modifyattackroll",this,function(a,b,f,h){a=
Unit.FCH_focus(h);0<a&&(h=h-Unit.FCH_FOCUS*a+Unit.FCH_CRIT+(a-1)*Unit.FCH_HIT);return h});b.adddicemodifier(Unit.ATTACK_M,Unit.MOD_M,Unit.ATTACK_M,this,{req:function(a,b){return this.mark==round&&this.isactive}.bind(this),aiactivate:function(a,b){return 0<Unit.FCH_focus(a)},f:function(b,e){var c=Unit.FCH_focus(b);0<c&&this.mark==round&&(1<c?this.unit.log("%0 %FOCUS% -> 1 %CRIT%, %1 %HIT% [%2]",c,c-1,a.name):this.unit.log("1 %FOCUS% -> 1 %CRIT% [%1]",c,a.name),b=b-Unit.FCH_FOCUS*c+Unit.FCH_CRIT+(c-
1)*Unit.FCH_HIT);return b}.bind(this),str:"focus",noreroll:"focus"})},candoaction:function(){return this.isactive},action:function(b){this.mark=round;this.unit.endaction(b,Unit.ELITE)},done:!0,type:Unit.ELITE,points:3},{name:"Concussion Missiles",requires:"Target",consumes:!0,type:Unit.MISSILE,firesnd:"missile",points:4,attack:4,done:!0,modifyattackroll:function(b,a,c){0<Unit.FCH_blank(b,a)&&(b+=Unit.FCH_HIT);return b},init:function(b){var a=this;b.adddicemodifier(Unit.ATTACK_M,Unit.MOD_M,Unit.ATTACK_M,
this,{req:function(c,e){return b.weapons[b.activeweapon]==this&&a.isactive}.bind(this),f:function(a,b){0<Unit.FCH_blank(a,b)&&(a+=Unit.FCH_HIT);return a}.bind(this),str:"blank"});b.wrap_after("setpriority",this,function(b){"TARGET"==b.type&&a.isactive&&this.candotarget()&&(b.priority+=10)})},range:[2,3]},{name:"Cluster Missiles",type:Unit.MISSILE,firesnd:"missile",requires:"Target",consumes:!0,points:4,attack:3,done:!0,followupattack:function(){return this.unit.weapons.indexOf(this)},hasdoubleattack:function(){return this.twinattack=
!this.twinattack},init:function(b){var a=this;this.twinattack=!1;b.wrap_after("setpriority",this,function(b){"TARGET"==b.type&&a.isactive&&this.candotarget()&&(b.priority+=10)})},range:[1,2]},{name:"Daredevil",done:!0,rating:1,candoaction:function(){return this.isactive},action:function(b){var a=this;console.log("this:"+this.name);console.log("unit:"+typeof this.unit);this.unit.log("select maneuver [%0]",this.name);this.unit.resolveactionmove([this.unit.getpathmatrix(this.unit.m,"TL1"),this.unit.getpathmatrix(this.unit.m,
"TR1")],function(c,e){if(-1==e)return c.endaction(b,Unit.ELITE);c.addstress();if(-1==c.shipactionList.indexOf("BOOST")){c.log("2 rolls for damage [%0]",a.name);for(var f=c.rollattackdie(2,a,"hit"),h=0;2>h;h++)"hit"==f[h]?c.resolvehit(1):"critical"==f[h]&&c.resolvecritical(1);c.checkdead()}c.endaction(b,Unit.ELITE)},!0,!0)},type:Unit.ELITE,points:3},{name:"Elusiveness",done:!0,rating:1,init:function(b){var a=this;b.adddicemodifier(Unit.DEFENSE_M,Unit.MOD_M,Unit.ATTACK_M,this,{req:function(){return 0===
this.stress&&targetunit==this&&a.isactive}.bind(b),aiactivate:function(a,e){b.log("activate elusiveness "+Unit.FCH_crit(a)+" "+Unit.FCH_hit(a));return 0<Unit.FCH_crit(a)+Unit.FCH_hit(a)},f:function(a,b){this.unit.addstress();0<Unit.FCH_crit(a)?(this.unit.log("1 %CRIT% rerolled [%0]",this.name),a=a-Unit.FCH_CRIT+activeunit.attackroll(1)):0<Unit.FCH_hit(a)&&(this.unit.log("1 %HIT% rerolled [%0]",this.name),a=a-Unit.FCH_HIT+activeunit.attackroll(1));return a}.bind(this),str:"critical"})},type:Unit.ELITE,
points:2},{name:"Homing Missiles",requires:"Target",consumes:!1,type:Unit.MISSILE,firesnd:"missile",attack:4,range:[2,3],done:!0,declareattack:function(b){targetunit.wrap_after("canuseevade",this,function(){return!1}).unwrapper("afterdefenseeffect");targetunit.log("cannot use evade tokens [%0]",this.name);return Weapon.prototype.declareattack.call(this,b)},init:function(b){var a=this;b.wrap_after("setpriority",this,function(b){"TARGET"==b.type&&a.isactive&&this.candotarget()&&(b.priority+=10)})},
points:5},{name:"Push the Limit",init:function(b){var a=this;a.r=-1;b.wrap_before("endaction",this,function(b,e){a.r!=round&&this.candoaction()&&null!==e&&(a.r=round,this.doaction(this.getactionbarlist(),"+1 free action (Skip to cancel) ["+a.name+"]").done(function(b){null===b||"undefined"===typeof b?a.r=-1:this.addafteractions(function(){this.addstress()}.bind(this))}.bind(this)))})},done:!0,type:Unit.ELITE,points:3},{name:"Deadeye",islarge:!1,rating:2,init:function(b){var a=function(a){return"Target"==
a?"Target|Focus":a},c;for(c in b.weapons)b.weapons[c].wrap_after("getrequirements",this,a)},done:!0,type:Unit.ELITE,points:1},{name:"Expose",rating:0,candoaction:function(){return this.isactive},action:function(b){var a=this.unit.weapons[0];this.unit.log("-1 agility, +1 primary attack until end of turn [%0]",this.name);this.unit.wrap_after("getagility",this,function(a){return 0<a?a-1:0}).unwrapper("endphase");a.wrap_after("getattack",this,function(a){return a+1}).unwrapper("endround");this.unit.showstats();
this.unit.endaction(b,Unit.ELITE)},done:!0,type:Unit.ELITE,points:4},{name:"Gunner",done:!0,init:function(b){var a=function(a){return 0===a},c=function(){return 0},e;for(e in b.weapons)b.weapons[e].immediateattack={pred:a,weapon:c};b.addattack(function(a,b){return this.weapons[0].isactive&&0===a+b},this,[b.weapons[0]],function(){this.noattack=round},function(){return this.selectnearbyenemy(3)})},type:Unit.CREW,points:5},{name:"Ion Cannon",type:Unit.CANNON,firesnd:"slave_fire",done:!0,modifyhit:function(b){return Unit.FCH_HIT},
prehit:function(b,a,c){this.unit.hitresolved=1;this.unit.criticalresolved=0;b.log("+%1 %HIT%, +1 ion token [%0]",this.name,1);b.addiontoken()},points:3,attack:3,range:[1,3]},{name:"Heavy Laser Cannon",type:Unit.CANNON,firesnd:"slave_fire",done:!0,modifydamagegiven:function(b){if(0<Unit.FCH_crit(b)){var a=Unit.FCH_crit(b);this.unit.log("%0 %CRIT%-> %0 %HIT% [%1]",a,this.name);b=b-Unit.FCH_CRIT*a+a*Unit.FCH_HIT}return b},points:7,attack:4,range:[2,3]},{name:"Seismic Charges",done:!0,img:"seismic.png",
snd:"explode",width:16,height:8,size:15,explode:function(){if(phase==ACTIVATION_PHASE&&!this.exploded){for(var b=this.getrangeallunits(),a=0;a<b[1].length;a++){var c=squadron[b[1][a].unit];c.log("+1 %HIT% [%0]",this.name);c.resolvehit(1);c.checkdead()}this.explode_base()}},type:Unit.BOMB,points:2},{name:"Mercenary Copilot",init:function(b){var a=this;b.wrap_after("modifyattackroll",this,function(a,b,f,h){0<Unit.FCH_hit(a)&&(a=a-Unit.FCH_HIT+Unit.FCH_CRIT);return a});b.adddicemodifier(Unit.ATTACK_M,
Unit.MOD_M,Unit.ATTACK_M,this,{req:function(a,b){return 3==this.getrange(targetunit)}.bind(b),aiactivate:function(a,b){return 0<Unit.FCH_hit(a)},f:function(b,e){0<Unit.FCH_hit(b)&&(this.log("1 %HIT% -> 1 %CRIT% [%0]",a.name),b=b-Unit.FCH_HIT+Unit.FCH_CRIT);return b}.bind(b),str:"hit"})},done:!0,type:Unit.CREW,points:2},{name:"Assault Missiles",type:Unit.MISSILE,requires:"Target",consumes:!0,firesnd:"missile",done:!0,prehit:function(b,a,c){a=b.getrangeallunits();for(c=0;c<a[1].length;c++)squadron[a[1][c].unit]!=
b&&(squadron[a[1][c].unit].log("+1 %HIT% [%0]",this.name),squadron[a[1][c].unit].resolvehit(1))},init:function(b){var a=this;b.wrap_after("setpriority",this,function(b){"TARGET"==b.type&&a.isactive&&this.candotarget()&&(b.priority+=10)})},points:5,attack:4,range:[2,3]},{name:"Veteran Instincts",done:!0,install:function(b){b.installed=!0;b.wrap_after("getskill",this,function(a){return a+2});b.showskill()},uninstall:function(b){"function"==typeof b.getskill.unwrap&&b.getskill.unwrap(this);b.showskill()},
type:Unit.ELITE,points:1},{name:"Proximity Mines",img:"proximity.png",snd:"explode",width:18,height:18,size:35,done:!0,stay:!0,candoaction:function(){return this.unit.lastdrop!=round&&this.isactive},action:function(b){this.actiondrop(b)},canbedropped:function(){return!1},explode:function(){},detonate:function(b){if(!this.exploded){for(var a=this.unit.rollattackdie(3,this,"critical"),c=0;3>c;c++)"hit"==a[c]?(b.log("+1 %HIT% [%0]",this.name),b.resolvehit(1),b.checkdead()):"critical"==a[c]&&(b.log("+1 %CRIT% [%0]",
this.name),b.resolvecritical(1),b.checkdead());Bomb.prototype.detonate.call(this)}},getOutlineString:function(b){var a="M ";this.op=[];"undefined"==typeof b&&(b=this.m);for(var c=0;25>c;c++){var e=transformPoint(b,{x:this.size*Math.sin(2*c*Math.PI/25),y:this.size*Math.cos(2*c*Math.PI/25)});this.op.push(e);a+=e.x+" "+e.y+" ";0===c&&(a+="L ")}return{s:a+"Z",p:this.op}},type:Unit.BOMB,points:3},{name:"Weapons Engineer",type:Unit.CREW,points:3,done:!0,init:function(b){this.second=!1;var a=this;b.boundtargets=
function(a){if(-1<this.targeting.indexOf(a))return!0;for(a=this.targeting.length-2;0<=a;a--)this.removetarget(this.targeting[a]);return!1};b.wrap_after("addtarget",this,function(b){!0===this.second?this.second=!1:this.doselection(function(b){this.second=!0;this.log("select target to lock [%0]",a.name);this.resolvetargetnoaction(b,!0)}.bind(this))})}},{name:"Draw Their Fire",rating:1,init:function(b){var a=this;a.ea=Unit.prototype.resolvecritical;Unit.prototype.resolvecritical=function(c){!a.unit.dead&&
a.isactive&&0<c&&a.unit in this.selectnearbyally(1)?(this.selectunit([this,b],function(c,f){0===f?a.ea.call(this,1):a.ea.call(b,1)},["select unit [%0]",a.name],!1),a.ea.call(this,c-1)):a.ea.call(this,c);return c}},done:!0,type:Unit.ELITE,points:1},{name:"Luke Skywalker",faction:Unit.REBEL,unique:!0,done:!0,init:function(b){var a=this,c;for(c in b.weapons)b.weapons[c].immediateattack={pred:function(a){return 0===a},weapon:function(){return 0}};b.addattack(function(a,b){return this.weapons[0].isactive&&
0===a+b},this,[b.weapons[0]],function(){this.noattack=round},function(){return this.selectnearbyenemy(3)});b.adddicemodifier(Unit.ATTACK_M,Unit.MOD_M,Unit.ATTACK_M,this,{req:function(b,c){return a.unit.addedattack==round&&a.isactive},aiactivate:function(a,b){return 0<Unit.FCH_focus(a)},f:function(b,c){0<Unit.FCH_focus(b)&&(this.log("1 %FOCUS% -> 1 %HIT% [%0]",a.name),b=b-Unit.FCH_FOCUS+Unit.FCH_HIT);return b},str:"focus"})},type:Unit.CREW,points:7},{name:"Nien Nunb",faction:Unit.REBEL,done:!0,install:function(b){b.installed=
!0;b.wrap_after("getdial",this,function(a){for(var b=0;b<a.length;b++)a[b].move.match(/F[1-5]/)&&(a[b].difficulty="GREEN");return a});b.wrap_after("getmaneuver",this,function(a){return a.move.match(/F[1-5]/)?{move:a.move,difficulty:"GREEN"}:a})},uninstall:function(b){"function"==typeof b.getdial.unwrap&&b.getdial.unwrap(this)},unique:!0,type:Unit.CREW,points:1},{name:"Chewbacca",faction:Unit.REBEL,unique:!0,done:!0,type:Unit.CREW,init:function(b){var a=this;b.wrap_after("deal",this,function(b,e,f){if(!a.isactive)return f;
var c=$.Deferred();f.then(function(b){1==this.hull+this.shield||b.face==Critical.FACEUP&&b.crit.lethal&&2>=this.hull+this.shield?(this.shield<this.ship.shield&&this.addshield(1),this.log("+1 %SHIELD%, 1 damage discarded [%0]",a.name),a.desactivate(),c.resolve({crit:b.crit,face:Critical.DISCARD})):c.resolve(b)}.bind(this));return c.promise()})},points:4},{name:"Advanced Proton Torpedoes",requires:"Target",consumes:!0,type:Unit.TORPEDO,firesnd:"missile",attack:5,done:!0,range:[1,1],init:function(b){var a=
this;b.adddicemodifier(Unit.ATTACK_M,Unit.MOD_M,Unit.ATTACK_M,this,{req:function(a,e){return b.weapons[b.activeweapon]==this}.bind(this),aiactivate:function(a,b){return 0<Unit.FCH_blank(a,b)},f:function(a,b){var c=Unit.FCH_blank(a,b);3<c&&(c=3);0<c&&(this.unit.log("%0 blanks -> %0 %FOCUS% [%1]",c,this.name),a+=c*Unit.FCH_FOCUS);return a}.bind(this),str:"blank"});b.wrap_after("setpriority",this,function(b){"TARGET"==b.type&&a.isactive&&this.candotarget()&&(b.priority+=10)})},points:6},{name:"Autoblaster",
type:Unit.CANNON,done:!0,firesnd:"slave_fire",attack:3,declareattack:function(b){var a=this;b.wrap_after("cancelhit",a,function(b,e,f){a.unit.log("%HIT% cannot be cancelled [%0]",a.name);return b}).unwrapper("afterdefenseeffect");return Weapon.prototype.declareattack.call(this,b)},range:[1,1],points:5},{name:"Fire-Control System",done:!0,init:function(b){var a=this;a.f=-1;b.wrap_before("postattack",this,function(a){this.reroll=10});b.addafterattackeffect(this,function(){-1<this.gettargetableunits(3).indexOf(targetunit)?
(this.log("+1 %TARGET% / %1 [%0]",a.name,targetunit.name),this.addtarget(targetunit)):this.log("no valid target [%0]",a.name)})},type:Unit.SYSTEM,points:2},{name:"Blaster Turret",type:Unit.TURRET,done:!0,firesnd:"falcon_fire",requires:"Focus",consumes:!0,points:4,attack:3,range:[1,2]},{name:"Recon Specialist",init:function(b){var a=this;b.wrap_before("addfocus",this,function(c){b.log("+1 %FOCUS% [%0]",a.name);b.addfocustoken()})},done:!0,type:Unit.CREW,points:3},{name:"Saboteur",type:Unit.CREW,done:!0,
candoaction:function(){var b=this.unit.selectnearbyenemy(1);return this.isactive&&0<b.length},action:function(b){var a=this;if(this.isactive){var c=this.unit.selectnearbyenemy(1);0<c.length?(this.unit.log("select unit [%0]",this.name),this.unit.resolveactionselection(c,function(e){var f,h=[];for(f=0;f<c[e].criticals.length;f++)!1===c[e].criticals[f].isactive&&h.push(f);0<h.length?(f=c[e].rand(h.length),c[e].log("turn faceup one damage card [%0]",a.name),c[e].criticals[h[f]].faceup(),c[e].show()):
c[e].log("no damage card [%0]",a.name);this.endaction(b,"CREW")}.bind(this.unit))):this.unit.endaction(b,"CREW")}else this.unit.endaction(b,"CREW")},points:2},{name:"Intelligence Agent",done:!0,init:function(b){var a=this;b.wrap_before("beginactivationphase",this,function(){this.selectunit(this.selectnearbyenemy(2),function(b,e){b[e].showmaneuver();var c=b[e].getmaneuver();b[e].log("has a %0<span class='symbols'>"+P[c.move].key+"</span> maneuver [%1]",P[c.move].speed,a.name)},["select unit [%0]",
a.name],!1)})},type:Unit.CREW,points:1},{name:"Proton Bombs",done:!0,width:32,height:30,size:15,snd:"explode",img:"proton.png",explode:function(){if(phase==ACTIVATION_PHASE&&!this.exploded){for(var b=this.getrangeallunits(),a=0;a<b[1].length;a++)squadron[b[1][a].unit].applycritical(1),squadron[b[1][a].unit].checkdead();this.explode_base()}},type:Unit.BOMB,points:5},{name:"Adrenaline Rush",done:!0,rating:1,init:function(b){var a=this;b.wrap_after("updateactivationdial",this,function(){this.addactivationdial(function(){return!this.hasionizationeffect()&&
!this.hasmoved&&a.isactive&&-1<this.maneuver&&"RED"==this.getmaneuver().difficulty}.bind(this),function(){this.log("red into white maneuver [%0]",a.name);a.desactivate();this.wrap_after("getmaneuver",a,function(a){return{move:a.move,difficulty:"WHITE"}}).unwrapper("endactivationphase");this.show()}.bind(this),A[Unit.ELITE.toUpperCase()].key,$("<div>").attr({"class":"symbols"}));return this.activationdial})},type:Unit.ELITE,points:1},{name:"Advanced Sensors",done:!0,init:function(b){var a=this;b.wrap_before("beginactivation",
this,function(){this.candoaction()&&!this.hasionizationeffect()&&this.doaction(this.getactionlist(),"").done(function(b){null!==b&&this.wrap_after("candoendmaneuveraction",a,function(){return!1}).unwrapper("endactivationphase")}.bind(this))})},type:Unit.SYSTEM,points:3},{name:"Sensor Jammer",init:function(b){var a=this;b.adddicemodifier(Unit.DEFENSE_M,Unit.MOD_M,Unit.ATTACK_M,this,{req:function(b,e){return a.isactive}.bind(b),aiactivate:function(a,b){return 0<Unit.FCH_hit(a)},f:function(b,e){0<Unit.FCH_hit(b)&&
(this.unit.log("1 %HIT% -> 1 %FOCUS% [%0]",a.name),b=b-Unit.FCH_HIT+Unit.FCH_FOCUS);return b}.bind(this),str:"hit"})},done:!0,type:Unit.SYSTEM,points:4},{name:"Darth Vader",faction:Unit.EMPIRE,unique:!0,done:!0,init:function(b){var a=this;b.addafterattackeffect(a,function(){this.hasfired&&this.donoaction([{org:a,type:"CREW",name:a.name,action:function(b){a.unit.log("+%1 %HIT% [%0]",a.name,2);targetunit.log("+1 %CRIT% [%0]",a.name);this.resolvehit(2);SOUNDS.explode.play();targetunit.resolvecritical(1);
this.checkdead();targetunit.checkdead();this.endnoaction(b,"CREW")}.bind(this)}],"",!0)})},type:Unit.CREW,points:3},{name:"Rebel Captive",faction:Unit.EMPIRE,done:!0,init:function(b){var a=this;b.rebelcaptive=0;b.wrap_before("isattackedby",this,function(b,e){this.rebelcaptive!=round&&(e.log("+1 %STRESS% [%0]",a.name),e.addstress(),this.rebelcaptive=round)}.bind(this))},unique:!0,type:Unit.CREW,points:3},{name:"Flight Instructor",init:function(b){var a=this;b.adddicemodifier(Unit.DEFENSE_M,Unit.REROLL_M,
Unit.DEFENSE_M,this,{dice:["focus"],n:function(){return 2>=activeunit.getskill()?2:1},req:function(b,e,f){this.isactive&&this.unit.log("+%1 %FOCUS% reroll(s) [%0]",a.name,2>=activeunit.getskill()?2:1);return this.isactive}.bind(this)})},done:!0,type:Unit.CREW,points:4},{name:"Navigator",init:function(b){b.wrap_after("getmaneuverlist",this,function(a){var b=this.getdial();if(this.hasionizationeffect())return a;for(var e in a)for(var f=e.replace(/\d/,""),h=0;h<b.length;h++)!b[h].move.match(f)||"undefined"!=
typeof a[b[h].move]||"RED"==b[h].difficulty&&0!==this.stress||(a[b[h].move]=b[h]);return a})},done:!0,type:Unit.CREW,points:3},{name:"Opportunist",rating:2,done:!0,init:function(b){var a=this;b.wrap_after("preattackroll",this,function(b,e){0===e.focus+e.evade&&0===this.stress&&this.donoaction([{org:this,name:this.name,type:"ELITE",action:function(b){this.wrap_after("getattackstrength",a,function(a,b,c){return c+1}).unwrapper("endattack");this.addstress();this.log("+1 attack against %1, +1 %STRESS% [%0]",
a.name,e.name);this.endnoaction(b,"ELITE")}.bind(this)}],"",!0)})},type:Unit.ELITE,points:4},{name:"Ion Pulse Missiles",requires:"Target",consumes:!1,type:Unit.MISSILE,firesnd:"missile",done:!0,modifyhit:function(b){return Unit.FCH_HIT},prehit:function(b,a,c){this.unit.log("+%1 %HIT%, +1 ion token [%0]",this.name,2);this.unit.hitresolved=1;this.unit.criticalresolved=0;b.addiontoken();b.addiontoken()},init:function(b){var a=this;b.wrap_after("setpriority",this,function(b){"TARGET"==b.type&&a.isactive&&
this.candotarget()&&(b.priority+=10)})},points:3,attack:3,range:[2,3]},{name:"Wingman",done:!0,init:function(b){var a=this;b.wrap_before("begincombatphase",this,function(){this.selectunit(this.selectnearbyally(1,function(a,b){return 0<b.stress}),function(a,b){a[b].removestresstoken()},["select unit [%0]",a.name],!1)})},type:Unit.ELITE,points:2},{name:"Decoy",rating:1,init:function(b){var a=this;b.wrap_before("begincombatphase",this,function(){this.selectunit(this.selectnearbyally(2),function(b,e){var c=
b[e].getskill(),h=this.getskill();this.wrap_after("getskill",a,function(a){return c}).unwrapper("endcombatphase");b[e].wrap_after("getskill",a,function(a){return h}).unwrapper("endcombatphase")},["select unit (or self to cancel) [%0]",a.name],!0)})},done:!0,type:Unit.ELITE,points:2},{name:"Outmaneuver",done:!0,init:function(b){var a=this;b.wrap_before("resolveattack",this,function(b,e){e.wrap_after("getdefensestrength",a,function(b,c,e){return!this.isinfiringarc(c)&&c.isinfiringarc(this)&&0<e?(this.log("-1 defense [%0]",
a.name),e-1):e}).unwrapper("dodefenseroll")})},type:Unit.ELITE,points:3},{name:"Predator",done:!0,init:function(b){var a=this;b.wrap_after("attackrerolls",this,function(a,b,f){return 2>=b.getskill()?2:1});b.adddicemodifier(Unit.ATTACK_M,Unit.REROLL_M,Unit.ATTACK_M,this,{dice:["blank","focus"],n:function(){return 2>=targetunit.getskill()?2:1},req:function(b,e,f){this.log("+%1 reroll(s) [%0]",a.name,2>=targetunit.getskill()?2:1);return a.isactive}.bind(b)})},type:Unit.ELITE,points:3},{name:"Flechette Torpedoes",
requires:"Target",consumes:!0,type:Unit.TORPEDO,firesnd:"missile",done:!0,endattack:function(b,a){4>=targetunit.hull&&targetunit.addstress();Weapon.prototype.endattack.call(this)},init:function(b){var a=this;b.wrap_after("setpriority",this,function(b){"TARGET"==b.type&&a.isactive&&this.candotarget()&&(b.priority+=10)})},points:2,attack:3,range:[2,3]},{name:"R7 Astromech",type:Unit.ASTROMECH,points:2,done:!0,init:function(b){b.adddicemodifier(Unit.DEFENSE_M,Unit.REROLL_M,Unit.ATTACK_M,this,{dice:["critical",
"hit","focus"],n:function(){return 9},req:function(){return-1<this.targeting.indexOf(activeunit)}.bind(b),mustreroll:!0})}},{name:"R7-T1",candoaction:function(){return this.isactive},action:function(b){var a=this.unit.selectnearbyenemy(2);0<a.length&&this.isactive?(this.unit.log("select unit [%0]",this.name),this.unit.resolveactionselection(a,function(c){a[c]!=this?(a[c].isinfiringarc(this)&&this.addtarget(a[c]),this.resolveboost(b)):this.endaction(b,"ASTROMECH")}.bind(this.unit))):this.unit.endaction(b,
"ASTROMECH")},done:!0,unique:!0,type:Unit.ASTROMECH,points:3},{name:"Tactician",type:Unit.CREW,limited:!0,points:2,done:!0,init:function(b){var a=this;b.addafterattackeffect(this,function(b,e){2==this.getsector(targetunit)&&(targetunit.addstress(),targetunit.log("+1 %STRESS% [%0]",a.name))})}},{name:"R2-D2",faction:Unit.REBEL,unique:!0,type:Unit.CREW,points:4,done:!0,init:function(b){var a=this;b.wrap_after("endphase",this,function(){for(var b=[],e=this.criticals,f=0;f<e.length;f++)e[f].isactive||
b.push(e[f]);0===this.shield&&0<this.ship.shield&&(this.log("+1 %SHIELD% [%0]",a.name),this.addshield(1),this.show(),0<b.length&&(b=b[this.rand(b.length)],0<Unit.FCH_hit(this.attackroll(1))&&(this.log("+1 %CRIT% [%0]",this.name),b.faceup())))})}},{name:"C-3PO",unique:!0,faction:Unit.REBEL,type:Unit.CREW,points:3,done:!0,init:function(b){var a=-1;b.wrap_after("defenseroll",this,function(b,e){if(a==round)return e;var c=$.Deferred();a=round;e.done(function(a){this.guessevades(a,c)}.bind(this));return c.promise()})}},
{name:"R3-A2",done:!0,init:function(b){var a=this;b.wrap_after("declareattack",this,function(b,e,f){this.isinfiringarc(e)&&f&&this.donoaction([{org:a,name:a.name,type:"ASTROMECH",action:function(b){this.addstress();this.log("+1 %STRESS% [%0]",a.name);e.log("+1 %STRESS% [%0]",a.name);e.addstress();this.endnoaction(b,"ASTROMECH")}.bind(this)}],"",!0);return f})},unique:!0,type:Unit.ASTROMECH,points:2},{name:"R2-D6",upgrades:[Unit.ELITE],noupgrades:Unit.ELITE,skillmin:3,done:!0,unique:!0,type:Unit.ASTROMECH,
points:1},{name:"Enhanced Scopes",done:!0,init:function(b){var a=this;b.wrap_before("beginactivationphase",this,function(){this.log("PS set to %1 [%0]",a.name,0);this.wrap_after("getskill",a,function(a){return 0}).unwrapper("endactivationphase")})},type:Unit.SYSTEM,points:1},{name:"Chardaan Refit",type:Unit.MISSILE,done:!0,firesnd:"missile",isWeapon:function(){return!1},points:-2,ship:"A-Wing"},{name:"Proton Rockets",type:Unit.MISSILE,firesnd:"missile",requires:"Focus",consumes:!1,points:3,attack:2,
done:!0,getattack:function(){var b=this.attack,a=this.unit.getagility();return 3>=a?b+a:b+3},init:function(b){var a=this;b.wrap_after("setpriority",this,function(b){"FOCUS"==b.type&&a.isactive&&this.candofocus()&&(b.priority+=10)})},range:[1,1]},{name:"Kyle Katarn",faction:Unit.REBEL,unique:!0,done:!0,type:Unit.CREW,points:3,init:function(b){var a=this;b.wrap_after("removestresstoken",this,function(){this.log("-1 stress -> +1 %FOCUS% [%0]",a.name);this.addfocustoken()})}},{name:"Jan Ors",faction:Unit.REBEL,
unique:!0,type:Unit.CREW,points:2,done:!0,endround:function(){this.jan=null},init:function(b){TEAMS[b.team].hasJan=!0;this.jan=null;var a=this,c=!1;$(document).on("addfocustoken"+b.team,function(e,f){c||(!a.unit.dead&&null===a.jan&&3>=f.getrange(b)?(c=!0,f.log("select %FOCUS% or %EVADE% token [%0]",a.name),f.donoaction([{name:a.name,org:a,type:"FOCUS",action:function(a){f.realaddfocustoken();f.endnoaction(a,"FOCUS");c=!1}.bind(f)},{name:a.name,org:a,type:"EVADE",action:function(b){a.jan=f;f.addevadetoken();
f.endnoaction(b,"EVADE");c=!1}.bind(f)}],"",!1)):(f.realaddfocustoken(),c=!1))});Unit.prototype.realaddfocustoken=function(){this.focus++;this.animateaddtoken("xfocustoken");this.movelog("FO");this.show()};Unit.prototype.addfocustoken=function(){!0===TEAMS[this.team].hasJan?$(document).trigger("addfocustoken"+this.team,[this]):this.realaddfocustoken()};a.uninstall=function(){TEAMS[b.team].hasJan=!1};b.wrap_after("dies",a,function(){a.uninstall()})}},{name:"R4-D6",done:!0,unique:!0,type:Unit.ASTROMECH,
points:1,init:function(b){var a=this;b.wrap_after("cancelhit",this,function(c,e,f){c=Unit.FCH_hit(f.ch);return 3<=c?(b.log("cancelling %0 hits [%1]",c-2,a),{ch:f.ch-(c-2)*Unit.FCH_HIT,e:f.e}):f});b.adddicemodifier(Unit.ATTACKCOMPARE_M,Unit.ADD_M,Unit.ATTACK_M,this,{req:function(b,e){var c=$(".hitreddice").length,h=c+$(".criticalreddice").length,l=$(".evadegreendice").length;return a.unit===targetunit&&a.isactive&&3<=c-l&&h>l},f:function(a,e){for(var c=Unit.FCH_hit(a),h=$(".evadegreendice").length,
c=3<=c-h?c-h:0,h=0;h<c-2;h++)b.addstress();return{m:a-(c-2)*Unit.FCH_HIT,n:e}},str:"stress"})}},{name:"R5-P9",done:!0,init:function(b){var a=this;b.wrap_before("endcombatphase",this,function(){this.canusefocus()&&this.shield<this.ship.shield&&(this.addshield(1),this.log("1 %FOCUS% -> 1 %SHIELD% [%0]",a.name),this.removefocustoken())})},unique:!0,type:Unit.ASTROMECH,points:3},{name:"Han Solo",faction:Unit.REBEL,init:function(b){var a=this;b.wrap_after("modifyattackroll",this,function(a,b,f,h){a=Unit.FCH_focus(h);
0<a&&0<this.targeting.length&&(this.removetarget(targetunit),h=h-Unit.FCH_FOCUS*a+Unit.FCH_HIT*a);return h});b.adddicemodifier(Unit.ATTACK_M,Unit.MOD_M,Unit.ATTACK_M,this,{req:function(b,e){return a.isactive&&-1<this.targeting.indexOf(targetunit)}.bind(b),aiactivate:function(a,b){return 0<Unit.FCH_focus(a)},f:function(b,e){var c=Unit.FCH_focus(b);this.log("%0 %FOCUS% -> %0 %HIT% [%1]",c,a.name);this.removetarget(targetunit);return b-Unit.FCH_FOCUS*c+Unit.FCH_HIT*c}.bind(b),str:"target",noreroll:"focus"})},
type:Unit.CREW,unique:!0,done:!0,points:2},{name:"Leia Organa",faction:Unit.REBEL,type:Unit.CREW,unique:!0,done:!0,init:function(b){var a=this;b.wrap_before("beginactivationphase",this,function(){a.isactive&&this.donoaction([{type:"CREW",org:a,name:a.name,action:function(c){a.desactivate();for(var e in squadron)squadron[e].isally(b)&&squadron[e].wrap_after("getmaneuver",a,function(a){"RED"==a.difficulty&&(a.difficulty="WHITE");return a}).unwrapper("endactivationphase");this.endnoaction(c,"CREW")}.bind(this)}],
"",!0)})},points:4},{name:"Targeting Coordinator",type:Unit.CREW,limited:!0,done:!0,points:4},{name:"Lando Calrissian",faction:Unit.REBEL,type:Unit.CREW,unique:!0,done:!0,candoaction:function(){return this.isactive},action:function(b){var a=this,c="";this.isactive?this.unit.defenseroll(2).done(function(e){var f=Unit.FE_focus(e.roll);e=Unit.FE_evade(e.roll);var h;for(h=0;h<f;h++)this.addfocustoken();0<f&&(c+=" +"+f+" %FOCUS%");for(h=0;h<e;h++)this.addevadetoken();0<e&&(c+=" +"+e+" %EVADE%");""===c?
this.log("no effect [%0]",a.name):this.log(c+" [%0]",a.name);this.endaction(b,"CREW")}.bind(this.unit)):this.unit.endaction(b,"CREW")},points:3},{name:"Mara Jade",faction:Unit.EMPIRE,type:Unit.CREW,unique:!0,done:!0,init:function(b){var a=this;b.wrap_before("endcombatphase",this,function(){for(var b=this.gettargetableunits(1),e=0;e<b.length;e++)0===b[e].stress&&(b[e].log("+1 %STRESS% [%0]",a.name),b[e].addstress())})},points:3},{name:"Fleet Officer",faction:Unit.EMPIRE,type:Unit.CREW,done:!0,candoaction:function(){return this.isactive},
action:function(b){if(this.isactive){var a=this.unit.selectnearbyally(2);0<a.length?1==a.length?(a[0].addfocustoken(),this.unit.addstress(),this.unit.endaction(b,Unit.CREW)):2==a.length?(a[0].addfocustoken(),a[1].addfocustoken(),a[0].log("adding focus"),a[1].log("adding focus"),this.unit.addstress(),this.unit.endaction(b,Unit.CREW)):(this.unit.log("select 2 units [%0]",this.name),this.unit.resolveactionselection(a,function(c){a[c].addfocustoken();a.splice(c,1);0<a.length?this.resolveactionselection(a,
function(c){a[c].addfocustoken();this.addstress();this.endaction(b,Unit.CREW)}.bind(this)):this.endaction(b,Unit.CREW)}.bind(this.unit))):this.unit.endaction(b,Unit.CREW)}else this.unit.endaction(b,Unit.CREW)},points:3},{name:"Stay On Target",type:Unit.ELITE,points:2,done:!0,init:function(b){b.wrap_after("getmaneuverlist",this,function(a){var b=this.getdial();if(this.hasionizationeffect()||0<this.stress)return a;for(var e in a)for(var f=a[e].move.substr(-1),h=0;h<b.length;h++)b[h].move.substr(-1)==
f&&"undefined"==typeof a[b[h].move]&&(a[b[h].move]={move:b[h].move,difficulty:"RED",halfturn:!1});return a})}},{name:"Dash Rendar",faction:Unit.REBEL,unique:!0,done:!0,init:function(b){b.wrap_after("isfireobstructed",this,function(){return!1});b.wrap_after("getobstructiondef",this,function(){return 0})},type:Unit.CREW,points:2},{name:"Lone Wolf",done:!0,rating:3,init:function(b){var a=this;b.adddicemodifier(Unit.ATTACK_M,Unit.REROLL_M,Unit.ATTACK_M,this,{dice:["blank"],n:function(){return 1},req:function(b,
e,f){b=this.unit.selectnearbyally(2,function(a,b){return a!=b});0===b.length&&a.isactive&&this.unit.log("+1 blank reroll [%0]",a.name);return 0===b.length&&a.isactive}.bind(this)});b.adddicemodifier(Unit.DEFENSE_M,Unit.REROLL_M,Unit.DEFENSE_M,this,{dice:["blank"],n:function(){return 1},req:function(b,e,f){b=this.unit.selectnearbyally(2,function(a,b){return a!=b});0===b.length&&a.isactive&&this.unit.log("+1 blank reroll [%0]",a.name);return 0===b.length&&a.isactive}.bind(this)})},unique:!0,type:Unit.ELITE,
points:2},{name:"'Leebo'",faction:Unit.REBEL,unique:!0,candoaction:function(){return this.unit.candoboost()&&this.isactive},action:function(b){this.isactive?(this.unit.log("free %BOOST% and ion token [%0]",this.name),this.unit.addiontoken(),this.unit.resolveboost(b)):this.unit.endaction(b,"BOOST")},done:!0,type:Unit.CREW,points:2},{name:"Ruthlessness",faction:Unit.EMPIRE,type:Unit.ELITE,points:3,done:!0,init:function(b){var a=this;b.addafterattackeffect(this,function(b,e){if(0!==b+e){var c=targetunit.selectnearbyunits(1,
function(a,b){return b!=targetunit});this.selectunit(c,function(b,c){b[c].log("+%1 %HIT% [%0]",a.name,1);b[c].resolvehit(1);b[c].checkdead()},["select unit [%0]",a.name],!1)}})}},{name:"Intimidation",done:!0,rating:1,init:function(b){var a=this.unit,c=this;Unit.prototype.wrap_after("getagility",this,function(b){return!a.dead&&this.isenemy(a)&&0<b&&"undefined"!=typeof this.touching&&-1<this.touching.indexOf(a)?(this.log("-1 agility [%0]",c.name),b-1):b})},type:Unit.ELITE,points:2},{name:"Ysanne Isard",
faction:Unit.EMPIRE,unique:!0,init:function(b){var a=this;b.wrap_before("begincombatphase",this,function(){0<this.criticals.length&&this.candoevade()&&(this.addevadetoken(),this.log("+1 %EVADE% [%0]",a.name))})},done:!0,type:Unit.CREW,points:4},{name:"Moff Jerjerrod",faction:Unit.EMPIRE,unique:!0,done:!0,type:Unit.CREW,points:2,init:function(b){var a=this;b.wrap_after("deal",this,function(b,e,f){if(!a.isactive)return f;var c=$.Deferred();f.then(function(e){var f,h=[];if(e.crit.lethal&&2>=this.hull+
this.shield&&e.face==Critical.FACEUP||1==this.hull+this.shield){for(f=0;f<this.upgrades.length;f++){var l=this.upgrades[f];l.type==Unit.CREW&&l!=a&&l.isactive&&h.push(l)}h.push(a);h[0].desactivate();this.log("discard %0 to remove critical %1 [%2]",h[0].name,b.name,a.name);c.resolve({crit:e.crit,face:Critical.FACEDOWN});return!1}c.resolve(e);return!0}.bind(this));return c.promise()})}},{name:"Ion Torpedoes",requires:"Target",consumes:!0,type:Unit.TORPEDO,firesnd:"missile",done:!0,prehit:function(b,
a,c){b.addiontoken();b=b.getrangeallunits();for(a=0;a<b[1].length;a++)squadron[b[1][a].unit].log("+1 ion token [%0]",this.name),squadron[b[1][a].unit].addiontoken()},init:function(b){var a=this;b.wrap_after("setpriority",this,function(b){"TARGET"==b.type&&a.isactive&&this.candotarget()&&(b.priority+=10)})},points:5,attack:4,range:[2,3]},{name:"Bodyguard",faction:Unit.SCUM,rating:0,unique:!0,done:!0,init:function(b){var a=this;b.wrap_before("begincombatphase",this,function(){var b=this.selectnearbyally(1,
function(a,b){return a.getskill()<b.getskill()});this.canusefocus()&&this.selectunit(b,function(b,c){b[c].wrap_after("getagility",a,function(a){return a+1}).unwrapper("endcombatphase");this.removefocustoken()},["select unit (or self to cancel) [%0]",a.name],!0)})},type:Unit.ELITE,points:2},{name:"Calculation",done:!0,rating:1,init:function(b){var a=this;b.wrap_after("modifyattackroll",this,function(a,b,f,h){this.canusefocus()&&0<Unit.FCH_focus(h)&&(this.focus--,h=h-Unit.FCH_FOCUS+Unit.FCH_CRIT);return h});
b.adddicemodifier(Unit.ATTACK_M,Unit.MOD_M,Unit.ATTACK_M,this,{req:function(b,e){return this.canusefocus()&&a.isactive}.bind(b),aiactivate:function(a,b){return Unit.FCH_focus(a)},f:function(b,e){var c=Unit.FCH_focus(b);this.removefocustoken();displayattacktokens(this);return 0<c?(this.log("1 %FOCUS% -> 1 %CRIT% [%0]",a.name),b-Unit.FCH_FOCUS+Unit.FCH_CRIT):b}.bind(b),str:"focus"})},type:Unit.ELITE,points:1},{name:"Accuracy Corrector",init:function(b){var a=this;console.log("calling init");b.wrap_after("modifyattackroll",
this,function(a,b,f,h){return 2>Unit.FCH_hit(h)+Unit.FCH_crit(h)?(console.log("modified "+h),2*Unit.FCH_HIT):h});b.adddicemodifier(Unit.ATTACK_M,Unit.ADD_M,Unit.ATTACK_M,this,{req:function(b,e){return a.isactive},aiactivate:function(a,b){return 2>Unit.FCH_hit(a)+Unit.FCH_crit(a)},f:function(b,e){this.log("replace all dice by 2 %HIT% [%0]",a.name);return{m:2,n:2}}.bind(b),str:"hit"})},done:!0,type:Unit.SYSTEM,points:3},{name:"Inertial Dampeners",done:!0,init:function(b){var a=this;b.wrap_after("updateactivationdial",
this,function(){this.addactivationdial(function(){return!this.hasmoved&&a.isactive&&!this.hasionizationeffect()}.bind(this),function(){a.desactivate();this.addstress();this.wrap_after("getmaneuver",a,function(a){return{move:"F0",difficulty:"WHITE"}}).unwrapper("endactivationphase");this.show()}.bind(this),A[Unit.ILLICIT.toUpperCase()].key,$("<div>").attr({"class":"symbols"}));return this.activationdial})},type:Unit.ILLICIT,points:1},{name:"Tractor Beam",type:Unit.CANNON,firesnd:"slave_fire",points:1,
attack:3,done:!0,modifyhit:function(b){return 0},prehit:function(b,a,c){this.unit.hitresolved=0;this.unit.criticalresolved=0;b.log("+1 tractor beam token [%0]",this.name);b.addtractorbeam(this.unit)},range:[1,3]},{name:"Flechette Cannon",type:Unit.CANNON,firesnd:"slave_fire",done:!0,modifyhit:function(b){return Unit.FCH_HIT},prehit:function(b,a,c){this.unit.hitresolved=1;this.unit.criticalresolved=0;b.log("+1 %HIT%, +1 %STRESS% [%0]",this.name);0===b.stress&&b.addstress()},points:2,attack:3,range:[1,
3]},{name:"'Mangler' Cannon",type:Unit.CANNON,firesnd:"slave_fire",points:4,attack:3,done:!0,init:function(b){var a=this;this.wrap_after("modifyattackroll",this,function(a,b,f,h){0<Unit.FCH_hit(h)&&(h=h-Unit.FCH_HIT+Unit.FCH_CRIT);return h});b.adddicemodifier(Unit.ATTACK_M,Unit.MOD_M,Unit.ATTACK_M,this,{req:function(c,e){return b.weapons[b.activeweapon]==this?a.isactive:!1}.bind(this),aiactivate:function(a,b){return 0<Unit.FCH_hit(a)},f:function(b,e){return 0<Unit.FCH_hit(b)?(this.log("1 %HIT% -> 1 %CRIT% [%0]",
a.name),b+Unit.FCH_CRIT-Unit.FCH_HIT):b}.bind(b),str:"hit"})},range:[1,3]},{name:"Dead Man's Switch",done:!0,init:function(b){var a=this;b.wrap_before("dies",this,function(){for(var c=b.getrangeallunits(),e=0;e<c[1].length;e++)squadron[c[1][e].unit].log("+%1 %HIT% [%0]",a.name,1),squadron[c[1][e].unit].applydamage(1)})},type:Unit.ILLICIT,points:2},{name:"Feedback Array",type:Unit.ILLICIT,done:!0,range:[1,1],isTurret:function(){return!0},issecondary:!1,firesnd:"missile",isWeapon:function(){return!0},
declareattack:function(b){this.unit.addhasfired();this.unit.resolvehit(1);this.unit.addiontoken();SOUNDS.explode.play();this.unit.log("-1 %HIT%, +1 %ION% [%0]",this.name);b.log("-1 %HIT% [%0]",this.name);b.resolvehit(1);b.checkdead();this.unit.checkdead();this.unit.hasdamaged=!0;this.unit.cancelattack();return!1},init:function(b){this.toString=Upgrade.prototype.toString},points:2},{name:"'Hot Shot' Blaster",done:!0,isWeapon:function(){return!0},isTurret:function(){return!0},endattack:function(b,a){this.desactivate()},
type:Unit.ILLICIT,firesnd:"xwing_fire",points:3,attack:3,range:[1,2]},{name:"Greedo",faction:Unit.SCUM,unique:!0,done:!0,type:Unit.CREW,init:function(b){b.greedoa=-1;b.greedod=-1;var a=this;b.wrap_before("hashit",a,function(b,e){a.unit.greedoa<round&&b.wrap_after("deal",a,function(b,c,e){return a.unit.greedoa<round?(a.unit.greedoa=round,this.log("first damage is a faceup damage [%0]",a.name),$.Deferred().resolve({crit:b,face:Critical.FACEUP}).promise()):e}).unwrapper("endbeingattacked");return e});
b.wrap_after("resolveishit",a,function(){this.greedod<round&&this.wrap_after("deal",a,function(b,e,f){return this.greedod<round?(this.greedod=round,this.log("first damage is a faceup damage [%0]",a.name),dd=$.Deferred(),dd.resolve({crit:b,face:Critical.FACEUP}).promise()):f}).unwrapper("endbeingattacked")})},points:1},{name:"Salvaged Astromech",type:Unit.SALVAGED,done:!0,points:2,init:function(b){var a=this;b.wrap_after("deal",this,function(b,e,f){if(!a.isactive)return f;var c=$.Deferred();f.then(function(b){"ship"==
b.crit.type&&b.face==Critical.FACEUP?(a.desactivate(),this.log("remove critical %0 [%1]",b.crit.name,a.name),c.resolve({crit:b.crit,face:Critical.DISCARD})):c.resolve(b)}.bind(this));return c.promise()})}},{name:"Bomb Loadout",upgrades:[Unit.BOMB],done:!0,firesnd:"missile",isWeapon:function(){return!1},limited:!0,type:Unit.TORPEDO,points:0,ship:"Y-Wing"},{name:"'Genius'",unique:!0,done:!0,init:function(b){var a=this;b.wrap_after("handledifficulty",this,function(b){b=[];if(this.lastdrop!=round){for(var c=
0;c<this.bombs.length;c++){var f=this.bombs[c];"undefined"==typeof f.action&&f.isactive&&b.push({type:"BOMB",name:f.name,org:a,action:function(a){this.actiondrop(a)}.bind(f)})}this.donoaction(b,"",!0)}})},type:Unit.SALVAGED,points:0},{name:"Unhinged Astromech",type:Unit.SALVAGED,done:!0,install:function(b){var a=[];b.installed=!0;b.wrap_after("getdial",this,function(b){if(0===a.length)for(var c=0;c<b.length;c++){var f=b[c].difficulty,h=b[c].move;h.match(/[A-Z]+3/)&&(f="GREEN");a[c]={move:h,difficulty:f}}return a})},
uninstall:function(b){"function"==typeof b.getdial.unwrap&&b.getdial.unwrap(this)},points:1},{name:"R4-B11",unique:!0,type:Unit.SALVAGED,points:3,done:!0,init:function(b){var a=this;b.adddicemodifier(Unit.ATTACK_M,Unit.MOD_M,Unit.DEFENSE_M,this,{req:function(a,b){return-1<this.targeting.indexOf(targetunit)}.bind(b),f:function(b,e){var c=Unit.FE_evade(b),h=Unit.FE_focus(b);targetunit.canusefocus()||(h=0);this.removetarget(targetunit);if(0<c+h){targetunit.log("Reroll %0 %EVADE%, %1 %FOCUS% [%2]",c,
h,a.name);var l=targetunit.rolldefensedie(h,a,"evade");b-=Unit.FE_EVADE*c+Unit.FE_FOCUS*h;for(var t=0;t<h+c;t++)"evade"==l[t]&&(b+=Unit.FE_EVADE),"focus"==l[t]&&(b+=Unit.FE_FOCUS)}return b}.bind(b),str:"target"})}},{name:"Autoblaster Turret",type:Unit.TURRET,firesnd:"falcon_fire",done:!0,points:2,attack:2,declareattack:function(b){var a=this;b.wrap_after("cancelhit",a,function(b,e,f){a.unit.log("%HIT% cannot be cancelled [%0]",a.name);return b}).unwrapper("afterdefenseeffect");return Weapon.prototype.declareattack.call(this,
b)},range:[1,1]},{name:"R4 Agromech",done:!0,init:function(b){var a=this;this.spendfocus=a.already_executing=!1;b.adddicemodifier(Unit.ATTACK_M,Unit.MOD_M,Unit.ATTACK_M,this,{req:function(b,e){return a.spendfocus}.bind(b),f:function(b,e){a.spendfocus=!1;this.addtarget(targetunit);this.log("+1 %TARGET% / %1 [%0]",a.name,targetunit.name);this.ia||displayattacktokens2(this);return b}.bind(b),str:"target"});b.wrap_before("resolveattack",b,function(b,e){a.spendfocus=!1;this.wrap_before("removefocustoken",
a,function(){a.spendfocus=!0;this.ia||displayattacktokens2(this)}).unwrapper("endattack")})},type:Unit.SALVAGED,points:2},{name:"K4 Security Droid",faction:Unit.SCUM,type:Unit.CREW,done:!0,init:function(b){var a=this;b.wrap_before("handledifficulty",this,function(b){"GREEN"==b&&this.selectunit(this.gettargetableunits(3),function(b,c){this.addtarget(b[c]);this.log("+1 %TARGET% / %1 [%0]",a.name,b[c].name)},["select unit (or self to cancel) [%0]",a.name],!0)})},points:3},{name:"Outlaw Tech",faction:Unit.SCUM,
beta:!0,limited:!0,done:!0,type:Unit.CREW,init:function(b){var a=this;b.wrap_after("handledifficulty",this,function(c){"RED"==c&&(b.log("+1 %FOCUS% [%0]",a.name),b.addfocustoken())})},points:2},{name:"Advanced Targeting Computer",type:Unit.SYSTEM,points:5,init:function(b){var a=this;b.adddicemodifier(Unit.ATTACK_M,Unit.ADD_M,Unit.ATTACK_M,this,{req:function(b,e){return-1<this.targeting.indexOf(targetunit)&&!0===a.isactive}.bind(b),f:function(b,e){return-1<this.targeting.indexOf(targetunit)?(this.log("+1 %CRIT% [%0]",
a.name),$("#atokens > .xtargettoken").remove(),{m:b+10,n:e+1}):{m:b,n:e}}.bind(b),str:"critical"})},ship:"TIE Advanced",done:!0},{name:"Stealth Device",type:Unit.MOD,done:!0,install:function(b){b.wrap_after("getagility",this,function(a){return a+1});b.showstats()},uninstall:function(b){"function"==typeof b.getagility.unwrap&&b.getagility.unwrap(this);b.showstats()},init:function(b){var a=this;b.log("+1 agility [%0]",a.name);b.wrap_before("resolveishit",this,function(b){a.isactive&&(a.uninstall(this),
a.desactivate(),this.log("%0 is hit => destroyed",a.name),this.show())})},points:3},{name:"Shield Upgrade",type:Unit.MOD,done:!0,hadshields:!0,install:function(b){b.installed=!0;0>b.shield&&0>b.ship.shield&&(this.hadshields=!1,b.shield=b.ship.shield=0);b.shield++;b.ship.shield++;b.showstats()},uninstall:function(b){b.shield--;b.ship.shield--;this.hadshields||(b.shield=b.ship.shield=-1);b.showstats()},points:4},{name:"Engine Upgrade",type:Unit.MOD,done:!0,addedaction:"Boost",points:4},{name:"Anti-Pursuit Lasers",
type:Unit.MOD,islarge:!0,done:!0,points:2,init:function(b){var a=this;b.wrap_before("collidedby",this,function(b){if(a.isactive&&b.isenemy(this)){var c=this.rollattackdie(1,a,"hit")[0];"hit"==c||"critical"==c?(b.log("+%1 %HIT% [%0]",a.name,1),b.resolvehit(1),b.checkdead()):b.log("no effect [%0]",a.name)}})}},{name:"Targeting Computer",type:Unit.MOD,done:!0,addedaction:"Target",points:2},{name:"Hull Upgrade",type:Unit.MOD,done:!0,install:function(b){b.hull++;b.ship.hull++;b.installed=!0;b.showstats()},
uninstall:function(b){b.hull--;b.ship.hull--;b.showstats();b.checkdead()},desactivate:function(){this.uninstall(this.unit);Unit.prototype.desactivate.call(this)},points:3},{name:"Munitions Failsafe",type:Unit.MOD,init:function(b){var a=this;b.addafterattackeffect(this,function(b,e){this.weapons[this.activeweapon].isprimary||0!==b+e||(this.log("%0 still active [%1]",this.weapons[this.activeweapon].name,a.name),this.weapons[this.activeweapon].isactive=!0,this.show())})},done:!0,points:1},{name:"Stygium Particle Accelerator",
type:Unit.MOD,done:!0,init:function(b){b.wrap_after("resolvedecloak",this,function(){this.candoevade()&&this.doaction([this.newaction(this.addevade,"EVADE")],"Stygium P.A.: +1 %EVADE%");return!0});b.wrap_after("addcloak",this,function(a){this.candoevade()&&this.doaction([this.newaction(this.addevade,"EVADE")],"Stygium P.A.: +1 %EVADE%")})},points:2},{name:"Advanced Cloaking Device",type:Unit.MOD,points:4,done:!0,init:function(b){var a=this;b.addafterattackeffect(this,function(){this.candoaction()&&
this.candocloak()&&this.doaction([this.newaction(this.addcloak,"CLOAK")],a.name+": free cloack action")})},ship:"TIE Phantom"},{name:"B-Wing/E2",type:Unit.MOD,done:!0,upgrades:[Unit.CREW],points:1,ship:"B-Wing",install:function(b){b.shipimg="b-wing-1.png"},uninstall:function(b){b.shipimg="b-wing-2.png"}},{name:"Countermeasures",type:Unit.MOD,islarge:!0,done:!0,init:function(b){var a=this;b.wrap_before("begincombatphase",this,function(){a.isactive&&this.donoaction([{action:function(b){a.desactivate();
this.wrap_after("getagility",a,function(a){return a+1}).unwrapper("endphase");0<this.istargeted.length?(this.log("select a lock to remove [%0]",a.name),this.resolveactionselection(this.istargeted,function(a){this.istargeted[a].removetarget(this);this.endnoaction(b,"MOD")}.bind(this))):this.endnoaction(b,"MOD")}.bind(this),type:a.type.toUpperCase(),name:a.name}],"",!0)})},points:3},{name:"Experimental Interface",type:Unit.MOD,unique:!0,points:3,init:function(b){var a=this;a.r=-1;b.wrap_before("endaction",
this,function(b,e){a.r!=round&&this.candoaction()&&null!==e&&(a.r=round,this.doaction(this.getupgactionlist(),"+1 free action (Skip to cancel)").done(function(b){null===b||"undefined"===typeof b?a.r=-1:this.addafteractions(function(){this.addstress()}.bind(this))}.bind(this)))})},done:!0},{name:"Tactical Jammer",type:Unit.MOD,islarge:!0,points:1,done:!0,init:function(b){var a=this;Unit.prototype.wrap_after("getobstructiondef",this,function(c,e){!a.unit.dead&&this.isenemy(b)&&0===e&&(OBSTACLES.push(b),
e=this.getoutlinerange(this.m,c).o?1:0,OBSTACLES.splice(OBSTACLES.indexOf(b),1),1==e&&this.log("fire obstructed by %0",b.name));return e})}},{name:"Autothrusters",type:Unit.MOD,actionrequired:"Boost",points:2,done:!0,init:function(b){var a=this;b.wrap_after("modifydefenseroll",this,function(a,b,f,h){2<a.getsector(this)&&0<Unit.FE_blank(h,f)&&(h+=Unit.FE_EVADE);return h});b.adddicemodifier(Unit.DEFENSE_M,Unit.MOD_M,Unit.DEFENSE_M,this,{req:function(b,e){return 2<activeunit.getsector(this)?a.isactive:
!1}.bind(b),f:function(b,e){0<Unit.FE_blank(b,e)&&(this.log("1 blank -> 1 %EVADE% [%0]",a.name),b+=Unit.FE_EVADE);return b}.bind(b),str:"blank"})}},{name:"Slave I",type:Unit.TITLE,unique:!0,points:0,done:!0,ship:"Firespray-31",upgrades:[Unit.TORPEDO]},{name:"Millennium Falcon",type:Unit.TITLE,done:!0,addedaction:"Evade",unique:!0,points:1,ship:"YT-1300"},{name:"Moldy Crow",type:Unit.TITLE,init:function(b){var a=this;b.wrap_after("resetfocus",this,function(){0<this.focus&&this.log("keep %FOCUS% tokens [%0]",
a.name);return this.focus})},unique:!0,done:!0,points:3,ship:"HWK-290"},{name:"ST-321",type:Unit.TITLE,done:!0,init:function(b){b.wrap_after("gettargetableunits",this,function(a){a=[];for(var b in squadron)squadron[b].isenemy(this)&&a.push(squadron[b]);return a})},unique:!0,points:3,ship:"Lambda-Class Shuttle"},{name:"Royal Guard TIE",type:Unit.TITLE,done:!0,upgrades:[Unit.MOD],skillmin:5,points:0,install:function(b){b.shipimg="tie-interceptor-1.png"},uninstall:function(b){b.shipimg="tie-interceptor-2.png"},
ship:"TIE Interceptor"},{name:"A-Wing Test Pilot",type:Unit.TITLE,done:!0,upgrades:[Unit.ELITE],skillmin:2,points:0,ship:"A-Wing",exclusive:!0,install:function(b){b.shipimg="a-wing-1.png"},uninstall:function(b){b.shipimg="a-wing-2.png"}},{name:"Outrider",type:Unit.TITLE,done:!0,install:function(b){var a;for(a=0;a<b.weapons.length;a++)if(b.weapons[a].type==Unit.CANNON){b.weapons[0].desactivate();b.log("primary weapon inactive [%0]",this.name);b.weapons[a].isTurret=function(){return!0};b.log("%0 can fire in 360 degrees [%0]",
b.weapons[a].name,this.name);break}},uninstall:function(b){b.weapons[0].isactive=!0;for(var a=0;a<b.weapons.length;a++)b.weapons[a].type==Unit.CANNON&&(b.weapons[a].isTurret=function(){return!1})},unique:!0,points:5,ship:"YT-2400"},{name:"Dauntless",type:Unit.TITLE,done:!0,init:function(b){var a=this;b.wrap_after("doendmaneuveraction",this,function(){this.candoaction()&&this.collision&&(this.log("+1 free action [%0]",a.name),this.doaction(this.getactionlist(),"").done(function(a){null!==a&&this.addstress()}.bind(this)))})},
unique:!0,points:2,ship:"VT-49 Decimator"},{name:"Virago",type:Unit.TITLE,done:!0,upgrades:[Unit.ILLICIT,Unit.SYSTEM],unique:!0,points:1,skillmin:4,ship:"StarViper"},{name:"'Heavy Scyk' Interceptor",done:!0,upgrades:["Cannon|Torpedo|Missile"],type:Unit.TITLE,points:2,ship:"M3-A Interceptor",install:function(b){b.hull++;b.ship.hull++;b.installed=!0;b.showstats()},init:function(b){this.wrap_after("uninstall",this,function(a){a.hull--;a.ship.hull--;a.showstats();a.checkdead()})},desactivate:function(){this.uninstall(this.unit);
Unit.prototype.desactivate.call(this)}},{name:"IG-2000",type:Unit.TITLE,done:!0,install:function(b){b.ig2000=!0},uninstall:function(b){b.ig2000=!1},init:function(b){for(var a in squadron){var c=squadron[a];c!=b&&!0===c.ig2000&&c.isally(b)&&(b.log("copying %0 abilities [%1]",c.name,this.name),c.init.call(b,c))}},points:0,ship:"Aggressor"},{name:"BTL-A4 Y-Wing",type:Unit.TITLE,done:!0,init:function(b){for(var a=[],c=0;c<b.weapons.length;c++){var e=b.weapons[c];e.type==Unit.TURRET&&!1===e.isprimary&&
(a.push(e),e.wrap_after("isTurret",this,function(){return!1}))}0!==a.length&&(b.wrap_after("isTurret",this,function(a,b){return!1}),b.addattack(function(a,b){return this.weapons[this.activeweapon].isprimary},this,a))},points:0,ship:"Y-Wing"},{name:"Andrasta",type:Unit.TITLE,done:!0,upgrades:[Unit.BOMB,Unit.BOMB],unique:!0,points:0,ship:"Firespray-31"},{name:"TIE/x1",type:Unit.TITLE,done:!0,upgrades:[Unit.SYSTEM],pointsupg:-4,points:0,ship:"TIE Advanced"},{name:"Emperor Palpatine",type:Unit.CREW,unique:!0,
takesdouble:!0,done:!0,points:8,faction:Unit.EMPIRE,init:function(){var b=this;b.unit.emperor=-1;var a=function(a,e,f,h){if(b.unit.isally(this)&&!b.unit.dead&&"undefined"!=typeof f&&b.unit.emperor<round){for(a=0;a<h.length&&h[a]==f;a++);a<h.length&&confirm("Emperor Palpatine effect\n"+e.name+": "+h[0]+" die -> "+f+" die ?")&&(b.unit.log("%0 -> %1 [%2]",h[a],f,b.name),h[a]=f,b.unit.emperor=round)}return"undefined"!=typeof f?h:e};Unit.prototype.wrap_after("rollattackdie",b,a);Unit.prototype.wrap_after("rolldefensedie",
b,a);Unit.prototype.adddicemodifier(Unit.ATTACK_M,Unit.MOD_M,Unit.ATTACK_M,this,{req:function(a,e){return!b.unit.dead&&b.unit.emperor<round&&activeunit.isally(b.unit)},f:function(a,e){b.unit.emperor=round;var c=Unit.FCH_focus(a),h=Unit.FCH_blank(a,e),l=Unit.FCH_hit(a);0<h?(activeunit.log("blank -> %CRIT% [%0]",b.name),a+=Unit.FCH_CRIT,b.round=round):0<c?(activeunit.log("%FOCUS% -> %CRIT% [%0]",b.name),a=a-Unit.FCH_FOCUS+Unit.FCH_CRIT):0<l&&(activeunit.log("%HIT% -> %CRIT% [%0]",b.name),a=a-Unit.FCH_HIT+
Unit.FCH_CRIT);return a},str:"crew"});Unit.prototype.adddicemodifier(Unit.DEFENSE_M,Unit.MOD_M,Unit.DEFENSE_M,this,{req:function(a,e){return!b.unit.dead&&targetunit.isally(b.unit)&&b.unit.emperor<round},f:function(a,e){b.unit.emperor=round;var c=Unit.FE_focus(a);0<Unit.FE_blank(a,e)?(targetunit.log("blank -> %EVADE% [%0]",b.name),a+=Unit.FE_EVADE):0<c&&(targetunit.log("%FOCUS% -> %EVADE% [%0]",b.name),a=a+Unit.FE_EVADE-Unit.FE_FOCUS);return a},str:"crew"})}},{name:"Extra Munitions",type:Unit.TORPEDO,
limited:!0,firesnd:"missile",isWeapon:function(){return!1},points:2,done:!0,init:function(b){for(var a=0;a<b.upgrades.length;a++){var c=b.upgrades[a];c.type.match(/Missile|Torpedo|Bomb/)&&(c.ordnance=1)}}},{name:"Cluster Mines",type:Unit.BOMB,snd:"explode",img:"cluster.png",width:15,height:10,repeatx:42,size:22,stay:!0,done:!0,getOutlineStringsmall:function(b){var a="M ";this.op=[];"undefined"==typeof b&&(b=this.m);for(var c=0;20>c;c++){var e=transformPoint(b,{x:this.size*Math.sin(2*c*Math.PI/20),
y:this.size*Math.cos(2*c*Math.PI/20)});this.op.push(e);a+=e.x+" "+e.y+" ";0===c&&(a+="L ")}return{s:a+"Z",p:this.op}},candoaction:function(){return this.unit.lastdrop!=round&&this.isactive},action:function(b){this.actiondrop(b)},canbedropped:function(){return!1},explode:function(){},detonate:function(b){if(!this.exploded){for(var a=this.unit.rollattackdie(2,this,"hit"),c=0;2>c;c++)if("hit"==a[c]||"critical"==a[c])b.log("+1 %HIT% [%0]",this.name),b.resolvehit(1),b.checkdead();Bomb.prototype.detonate.call(this)}},
display:function(b,a){this.getOutlineString=this.getOutlineStringsmall;var c=$.extend({},this),e=$.extend({},this);Bomb.prototype.display.call(c,this.repeatx,0);Bomb.prototype.display.call(e,-this.repeatx,0);Bomb.prototype.display.call(this,0,0)},init:function(b){b=s.path("M41.844,-21 C54.632,-21 65,-11.15 65,1 C65,13.15 54.632,23 41.844,23 C33.853,22.912 25.752,18.903 21.904,12.169 C17.975,18.963 10.014,22.806 1.964,23 C-7.439,22.934 -14.635,18.059 -18.94,10.466 C-22.908,18.116 -30.804,22.783 -39.845,23 C-52.633,23 -63,13.15 -63,1 C-63,-11.15 -52.633,-21 -39.845,-21 C-30.441,-20.935 -23.246,-16.06 -18.94,-8.466 C-14.972,-16.116 -7.076,-20.783 1.964,-21 C9.956,-20.913 18.055,-16.902 21.904,-10.17 C25.832,-16.964 33.795,-20.807 41.844,-21 z").attr({display:"none"});
var a=b.getTotalLength();this.op0=[];for(var c=0;60>c;c++)this.op0[c]=b.getPointAtLength(c*a/60)},getOutlineString:function(b){var a="M ",c=this.op0.length;this.op=[];"undefined"==typeof b&&(b=this.m);for(var e=0;e<c;e++){var f={x:this.op0[e].x,y:this.op0[e].y},f=transformPoint(b,f);this.op.push(f);a+=f.x+" "+f.y+" ";0===e&&(a+="L ")}return{s:a+"Z",p:this.op}},points:4},{name:"Glitterstim",type:Unit.ILLICIT,points:2,activated:-1,done:!0,init:function(b){var a=this;a.glitter=-1;b.wrap_after("modifyattackroll",
this,function(a,b,f,h){a=Unit.FCH_focus(h);0<a&&0===this.stress&&(h+=(Unit.FCH_HIT-Unit.FCH_FOCUS)*a);return h});b.wrap_after("begincombatphase",this,function(b){a.isactive&&this.donoaction([{org:a,name:a.name,type:"ILLICIT",action:function(b){this.addstress();a.glitter=round;this.endnoaction(b,"ILLICIT")}.bind(this)}],"",!0);return b});b.wrap_before("endphase",this,function(){a.glitter==round&&a.desactivate()});b.adddicemodifier(Unit.ATTACK_M,Unit.MOD_M,Unit.ATTACK_M,this,{req:function(b,e){return a.glitter==
round&&a.isactive}.bind(b),f:function(b,e){var c=Unit.FCH_focus(b);0<c&&(this.log("%1 %FOCUS% -> %1 %HIT% [%0]",a.name,c),b=b-Unit.FCH_FOCUS*c+c*Unit.FCH_HIT);return b}.bind(b),str:"focus",noreroll:"focus"});b.adddicemodifier(Unit.DEFENSE_M,Unit.MOD_M,Unit.DEFENSE_M,this,{req:function(b,e){return a.glitter==round&&a.isactive}.bind(b),f:function(b,e){var c=Unit.FE_focus(b);0<c&&(this.log("%1 %FOCUS% -> %1 %EVADE% [%0]",a.name,c),b=b-Unit.FE_FOCUS*c+Unit.FE_EVADE*c);return b}.bind(b),str:"focus",noreroll:"focus"})}},
{name:"Cloaking Device",type:Unit.ILLICIT,islarge:!1,points:2,candoaction:function(){return this.isactive&&!this.unit.iscloaked},action:function(b){var a=this.unit;a.log("cloaked [%0]",this.name);a.addcloak(b)},done:!0,init:function(b){var a=this;b.wrap_after("endphase",this,function(){a.isactive&&("focus"==this.rollattackdie(1,a,"blank")[0]&&this.iscloaked&&!0===a.isactive?(this.log("%0 failed -> decloaking",a.name),this.resolvedecloak(!0),a.desactivate()):this.log("%0 still working",a.name))})}},
{name:"Bossk",unique:!0,faction:Unit.SCUM,type:Unit.CREW,points:2,done:!0,init:function(b){var a=this;b.wrap_after("hashit",this,function(b,e){e||(this.log("+1 stress, +1 %FOCUS%, +1 %TARGET% [%0]",a.name),0===this.stress&&this.addstress(),-1<this.gettargetableunits(3).indexOf(b)?this.addtarget(b):this.log("no valid target [%0]",a.name),this.addfocustoken());return e})}},{name:"Wired",type:Unit.ELITE,init:function(b){var a=this,c=function(){return 0<this.stress?(this.log("+%1 %FOCUS% reroll(s) [%0]",
a.name,this.focus),a.isactive):!1}.bind(b);b.adddicemodifier(Unit.ATTACK_M,Unit.REROLL_M,Unit.ATTACK_M,this,{dice:["focus"],n:function(){return 9},req:c});b.adddicemodifier(Unit.DEFENSE_M,Unit.REROLL_M,Unit.DEFENSE_M,this,{dice:["focus"],n:function(){return 9},req:c})},done:!0,points:1},{name:"Cool Hand",type:Unit.ELITE,points:1,rating:1,done:!0,init:function(b){var a=this;b.wrap_after("addstress",this,function(){a.isactive&&this.donoaction([{type:"FOCUS",name:a.name,org:a,action:function(b){a.desactivate();
this.addfocustoken();this.endnoaction(b,"ELITE")}.bind(this)},{type:"EVADE",name:a.name,org:a,action:function(b){a.desactivate();this.addevadetoken();this.endnoaction(b,"ELITE")}.bind(this)}],"Add %EVADE% or %FOCUS% instead of %STRESS% token",!0)})}},{name:"Juke",rating:2,type:Unit.ELITE,points:2,islarge:!1,done:!0,init:function(b){var a=this;b.wrap_after("modifydefenseroll",this,function(a,b,f,h){0<Unit.FE_evade(h)&&(h=h-Unit.FE_EVADE+Unit.FE_FOCUS);return h});b.adddicemodifier(Unit.ATTACK_M,Unit.MOD_M,
Unit.DEFENSE_M,this,{req:function(){return 0<a.unit.evade},f:function(b,e){0<Unit.FE_evade(b)&&(targetunit.log("%EVADE% -> %FOCUS% [%0]",a.name),b=b-Unit.FE_EVADE+Unit.FE_FOCUS);return b},str:"evade"});b.wrap_after("setpriority",this,function(a){"EVADE"==a.type&&0===this.evade&&(a.priority=10)})}},{name:"Lightning Reflexes",type:Unit.ELITE,rating:1,points:1,done:!0,init:function(b){var a=this;b.wrap_after("handledifficulty",this,function(b){"WHITE"!=b&&"GREEN"!=b||!a.isactive||this.donoaction([{type:"ELITE",
name:a.name,org:a,action:function(b){a.desactivate();this.addstress(1);this.m=this.m.rotate(180,0,0);this.show();this.endnoaction(b,Unit.ELITE)}.bind(this)}],"",!0)})},islarge:!1},{name:"Twin Laser Turret",type:Unit.TURRET,firesnd:"falcon_fire",points:6,done:!0,attack:3,range:[2,3],followupattack:function(){return this.unit.weapons.indexOf(this)},modifyhit:function(b){return Unit.FCH_HIT},prehit:function(b,a,c){this.unit.hitresolved=1;this.unit.criticalresolved=0;b.log("+%1 %HIT% [%0]",this.name,
1)},hasdoubleattack:function(){return this.twinattack=!this.twinattack},init:function(b){this.twinattack=!1}},{name:"Plasma Torpedoes",type:Unit.TORPEDO,points:3,attack:4,firesnd:"missile",requires:"Target",consumes:!0,done:!0,posthit:function(b,a,c){0<b.shield&&b.log("-1 %SHIELD% [%0]",this.name);b.removeshield(1)},init:function(b){var a=this;b.wrap_after("setpriority",this,function(b){"TARGET"==b.type&&a.isactive&&this.candotarget()&&(b.priority+=10)})},range:[2,3]},{name:"Ion Bombs",type:Unit.BOMB,
points:2,width:14,height:14,size:15,done:!0,snd:"explode",img:"ion.png",explode:function(){if(phase==ACTIVATION_PHASE&&!this.exploded){for(var b=this.getrangeallunits(),a=0;a<b[1].length;a++)squadron[b[1][a].unit].addiontoken(),squadron[b[1][a].unit].addiontoken();this.explode_base()}}},{name:"Conner Net",type:Unit.BOMB,snd:"explode",img:"conner-net3.png",width:40,height:60,size:40,done:!0,init:function(){this.conner=-1;var b=s.path("M-11.379,-0.26 C-11.241,-6.344 -16.969,-14.641 -19.247,-20.448 C-21.524,-26.255 -24.216,-38.147 -20.213,-39.46 C-16.21,-40.774 -8.619,-37.594 2.424,-37.663 C13.466,-37.732 22.162,-41.327 23.68,-39.322 C25.198,-37.317 26.716,-30.404 22.714,-21.278 C18.711,-12.152 14.156,-6.828 14.087,0.293 C14.018,7.414 19.47,15.364 22.3,22.555 C25.129,29.745 25.681,39.908 23.128,41.429 C20.574,42.95 13.673,41.29 4.218,41.29 C-5.237,41.29 -19.316,42.742 -20.903,41.29 C-22.49,39.839 -24.354,34.446 -20.213,23.108 C-16.072,11.769 -11.448,11.424 -11.379,1.606 C-11.322,-6.487 -11.514,5.685 -11.379,-0.26 z").attr({display:"none"}),
a=b.getTotalLength();this.op0=[];for(var c=0;60>c;c++)this.op0[c]=b.getPointAtLength(c*a/60)},getOutlineString:function(b){var a=this.op0.length,c="M ";this.op=[];"undefined"==typeof b&&(b=this.m);for(var e=0;e<a;e++){var f={x:this.op0[e].x,y:this.op0[e].y},f=transformPoint(b,f);this.op.push(f);c+=f.x+" "+f.y+" ";0===e&&(c+="L ")}return{s:c+"Z",p:this.op}},stay:!0,candoaction:function(){return this.unit.lastdrop!=round&&this.isactive},action:function(b){this.actiondrop(b)},canbedropped:function(){return!1},
explode:function(){},detonate:function(b,a){var c=this;this.exploded||(a?b.hasmoved?(b.log("+1 %HIT%, +2 %ION% next turn [%0]",c.name),b.wrap_after("beginplanningphase",this,function(a){this.log("+2 ion tokens [%0]",c.name);this.addiontoken();this.addiontoken();this.beginplanningphase.unwrap(c);return a})):(b.log("%1 skips action phase [%0]",c.name,b.name),b.wrap_after("candoendmaneuveraction",c,function(){return!1}).unwrapper("endactivationphase")):(b.wrap_before("cleanupmaneuver",this,function(){b.log("+1 %HIT%, +2 %ION% [%0]",
this.name);b.resolvehit(1);b.checkdead();b.addiontoken();b.addiontoken();b.log("%1 skips action phase [%0]",this.name,b.name)}).unwrapper("endactivationphase"),b.wrap_after("candoendmaneuveraction",this,function(){return!1}).unwrapper("endactivationphase")),Bomb.prototype.detonate.call(this,a))},points:4},{name:"Bombardier",type:Unit.CREW,points:1,done:!0,init:function(b){b.wrap_after("getbomblocation",this,function(a){return-1<a.indexOf("F1")?a.concat("F2"):a})}},{name:"Agent Kallus",type:Unit.CREW,
faction:Unit.EMPIRE,points:2,done:!0,init:function(b){var a=this;this.unit.nemesis=null;b.wrap_after("beginactivationphase",a,function(b){1==round&&this.selectunit(this.selectnearbyenemy(4),function(b,c){this.nemesis=b[c];this.log("%0 chosen as nemesis [%1]",b[c].name,a.name)});return b},["select unit [%0]",a.name],!1);b.adddicemodifier(Unit.ATTACK_M,Unit.MOD_M,Unit.ATTACK_M,a,{req:function(){return targetunit==this.nemesis}.bind(b),f:function(b,e){0<Unit.FCH_focus(b)&&(b=b-Unit.FCH_FOCUS+Unit.FCH_HIT,
this.log("1 %FOCUS% -> 1 %HIT% [%0]",a.name));return b}.bind(b),str:"focus"});b.adddicemodifier(Unit.DEFENSE_M,Unit.MOD_M,Unit.DEFENSE_M,a,{req:function(){return activeunit==this.nemesis}.bind(b),f:function(b,e){0<Unit.FE_focus(b)&&(b=b-Unit.FE_FOCUS+Unit.FE_EVADE,this.log("1 %FOCUS% -> 1 %EVADE% [%0]",a.name));return b}.bind(b),str:"focus"})}},{name:"'Crack Shot'",type:Unit.ELITE,points:1,rating:3,done:!0,init:function(b){var a=this;b.adddicemodifier(Unit.DEFENDCOMPARE_M,Unit.ADD_M,Unit.DEFENSE_M,
this,{req:function(){return a.isactive},f:function(b,e){targetunit!=a.unit&&(activeunit.ia?0<Unit.FE_evade(b)&&Unit.FE_evade(b)<=$(".hitreddice").length+$(".criticalreddice").length&&(targetunit.log("%EVADE% removed [%0]",a.name),b-=Unit.FE_EVADE,a.desactivate()):(targetunit.log("%EVADE% removed [%0]",a.name),b-=Unit.FE_EVADE,a.desactivate()));return{m:b,n:e}},str:"evade"})}},{name:"Advanced Homing Missiles",type:Unit.MISSILE,firesnd:"missile",points:3,requires:"Target",consumes:!1,attack:3,range:[2,
2],done:!0,modifyhit:function(b){return Unit.FCH_CRIT},prehit:function(b,a,c){b.log("+1 %CRIT% [%0]",this.name);b.applycritical(1);this.unit.hitresolved=0;this.unit.criticalresolved=0},init:function(b){var a=this;b.wrap_after("setpriority",this,function(b){"TARGET"==b.type&&a.isactive&&this.candotarget()&&(b.priority+=10)})}},{name:"Advanced SLAM",type:Unit.MOD,done:!0,points:2,init:function(b){var a=this;b.wrap_after("resolveslam",this,function(){b.wrap_after("endmaneuver",this,function(){this.doaction(this.getactionbarlist(),
"+1 free action from action bar (Skip to cancel) ["+a.name+"]")}).unwrapper("endactivationphase")})}},{name:"Twin Ion Engine Mk. II",type:Unit.MOD,points:1,ship:"TIE",done:!0,install:function(b){var a=[];b.installed=!0;b.wrap_after("getdial",this,function(b){if(0===a.length)for(var c=0;c<b.length;c++){var f=b[c].move,h=b[c].difficulty;f.match(/BL\d|BR\d/)&&(h="GREEN");a[c]={move:f,difficulty:h}}return a});b.wrap_after("getmaneuver",this,function(a){return a.move.match(/BL\d|BR\d/)?{move:a.move,difficulty:"GREEN"}:
a})},uninstall:function(b){"function"==typeof b.getdial.unwrap&&b.getdial.unwrap(this)}},{name:"Maneuvering Fins",type:Unit.MOD,points:1,ship:"YV-666",done:!0,init:function(b){var a=this;b.wrap_after("getmaneuverlist",a,function(b){if(this.hasionizationeffect())return b;for(var c in b)if(c.match(/TR\d|TL\d/)){this.log("change turn into a bank [%0]",a.name);var f=c.replace(/T/,"B");b[f]={move:f,difficulty:b[c].difficulty,halfturn:b[c].halfturn}}return b}.bind(b))}},{name:"Hound's Tooth",points:6,type:Unit.TITLE,
unique:!0,ship:"YV-666",done:!0,uid:null,getdeploymentmatrix:function(b){for(var a=b.getdial(),c=[],e=0;e<a.length;e++){var f=this.unit.m.clone().translate(0,20).rotate(180,0,0);c.push(b.getpathmatrix(f,a[e].move))}for(e=0;e<a.length;e++)f=this.unit.m.clone().translate(0,-20),c.push(b.getpathmatrix(f,a[e].move));return c},init:function(b){var a=this,c,e,f=-1;for(c in squadron)if("Nashtah Pup Pilot"==squadron[c].name){f=c;e=-1;break}if(-1==f)for(e in generics)if("Nashtah Pup Pilot"==generics[e].name){f=
e;c=-1;break}if(-1!=f&&-1==e)c=squadron[f];else if(-1!=f&&-1==c)c=generics[f];else{for(c=0;c<PILOTS.length&&"Nashtah Pup Pilot"!=PILOTS[c].name;c++);c=addunit(c,Unit.SCUM);c.tosquadron(s)}c.skill=b.skill;for(var h in b.upgrades)if("Veteran Instincts"==b.upgrades[h].name){c.skill=b.skill+2;break}else if("Adaptability"==b.upgrades[h].name){c.skill=b.skill+1;break}a.uid=c.id;c.dock(b);phase!==SELECT_PHASE&&c.show();b.wrap_before("dies",a,function(){if(a.isactive){var b=this.docked;this.init.call(b);
this.hasfired=0;b.wrap_before("endphase",b,function(){this.hasmoved=!1});b.noattack=round;b.deploy(this,a.getdeploymentmatrix(b));b.showstats();b.showpanel()}else this.docked.dead=!0,this.docked.checkdead()});this.uninstall=function(){phase===SELECT_PHASE&&$("#unit"+a.uid+" .close").click()}}},{name:"XX-23 S-Thread Tracers",points:1,type:Unit.MISSILE,firesnd:"missile",range:[1,3],attack:3,done:!0,requires:"Focus",consumes:!1,modifyhit:function(b){return 0},prehit:function(b,a,c){a=this.unit.selectnearbyally(2);
c="";if(0<a.length){a=a.concat(this.unit);for(var e=0;e<a.length;e++)-1<a[e].gettargetableunits(3).indexOf(b)?(a[e].addtarget(b),c+=a[e].name+" "):a[e].log("no valid target [%0]",this.name);this.unit.log("all dice cancelled, %0 now targeted by %1",b,c);this.unit.hitresolved=0;this.unit.criticalresolved=0}}},{name:"Comm Relay",points:3,type:Unit.TECH,done:!0,init:function(b){var a=this;b.wrap_after("addevadetoken",this,function(){1<this.evade&&(this.log("1 %EVADE% max [%0]",a.name),this.evade=1);this.showinfo()});
b.wrap_after("resetevade",this,function(){var b=0;0<this.evade&&(this.log("keep 1 %EVADE% token [%0]",a.name),b=1);return b})}},{name:"Dorsal Turret",type:Unit.TURRET,points:3,firesnd:"falcon_fire",attack:2,range:[1,2],done:!0,getrangeattackbonus:function(b){return 1==this.getrange(b)?(this.unit.log("+1 attack for range 1"),1):0}},{name:"'Chopper'",type:Unit.CREW,points:0,done:!0,init:function(b){b.wrap_after("hasnostresseffect",this,function(a){return!0});b.wrap_before("endaction",this,function(a,
b){null!==b&&0<this.stress&&(this.log("%STRESS% -> +1 %HIT% [%0]",this.name),this.resolvehit(1),this.checkdead())})},faction:Unit.REBEL,unique:!0},{name:"Hera Syndulla",type:Unit.CREW,points:1,faction:Unit.REBEL,done:!0,init:function(b){b.wrap_after("canreveal",this,function(a,b){return"RED"==a.difficulty&&0<this.stress?!0:b})},unique:!0},{name:"'Zeb' Orrelios",type:Unit.CREW,points:1,faction:Unit.REBEL,unique:!0,done:!0,init:function(b){var a=this;Unit.prototype.wrap_after("checkcollision",this,
function(c,e){return!a.unit.dead&&c==b&&b.isinfiringarc(c)?!1:e});b.wrap_after("checkcollision",this,function(c,e){return!a.unit.dead&&b.isinfiringarc(c)?!1:e})}},{name:"Ezra Bridger",type:Unit.CREW,points:3,faction:Unit.REBEL,unique:!0,done:!0,init:function(b){var a=this;b.wrap_after("modifyattackroll",this,function(a,b,f,h){return 0<Unit.FCH_focus(a)?a-Unit.FCH_FOCUS+Unit.FCH_CRIT:a});b.adddicemodifier(Unit.ATTACK_M,Unit.MOD_M,Unit.ATTACK_M,this,{req:function(c,e){return a.isactive&&0<b.stress}.bind(this),
f:function(a,b){return 0<Unit.FCH_focus(a)?(this.unit.log("1 %FOCUS% -> 1 %CRIT% [%0]",this.name),a-Unit.FCH_FOCUS+Unit.FCH_CRIT):a}.bind(this),str:"focus"})}},{name:"Kanan Jarrus",type:Unit.CREW,points:3,faction:Unit.REBEL,unique:!0,done:!0,init:function(b){var a=this;this.rd=-1;Unit.prototype.wrap_before("endmaneuver",a,function(){var b=this.maneuverdifficulty;!a.unit.dead&&"WHITE"==b&&0<this.stress&&a.rd<round&&this.isally(a.unit)&&2>=this.getrange(a.unit)&&(this.log("-1 %STRESS% [%0]",a.name),
a.rd=round,this.removestresstoken())})}},{name:"Sabine Wren",type:Unit.CREW,points:2,upgrades:[Unit.BOMB],faction:Unit.REBEL,unique:!0,done:!0,rd:-1,init:function(b){var a=this;a.rd=-1;Bomb.prototype.wrap_after("explode_base",this,function(){var b=[a.unit];if(a.rd!=round&&!this.unit.isenemy(a.unit)){for(var e in squadron){var f=squadron[e];this.unit.isenemy(f)&&1==this.getrange(f)&&b.push(f)}this.unit.selectunit(b,function(b,c){0!==c&&a.rd!=round&&(b[c].log("+1 %HIT% [%0]",a.name),b[c].resolvehit(1),
a.rd=round,SOUNDS.explode.play(),b[c].checkdead())},["select unit (or self to cancel) [%0]",a.name],!1)}})}},{name:"Ghost",type:Unit.TITLE,points:0,unique:!0,done:!0,aiactivate:function(){var b=!1;4>=this.unit.shield+this.unit.hull&&(b=!0);return b},getdeploymentmatrix:function(b){for(var a=b.getdial(),c=[],e=0;e<a.length;e++){var f=this.unit.m.clone().translate(0,20).rotate(180,0,0);c.push(b.getpathmatrix(f,a[e].move))}return c},init:function(b){var a=-1,c=this,e,f;for(f in squadron){var h=squadron[f];
if(h.isally(b)&&b!=h)for(var l=0;l<h.upgrades.length;l++)if(e=h.upgrades[l],"Phantom"==e.name||"Phantom II"==e.name){a=f;break}if(-1!=a)break}-1!=a?(h=squadron[a],!0===TEAMS[b.team].isia&&(h=$.extend(h,IAUnit.prototype)),h.dock(b),b.weapons[0].auxiliary=AUXILIARY,b.weapons[0].subauxiliary=SUBAUXILIARY,b.weapons[0].type="Bilaser",b.wrap_after("endmaneuver",this,function(){this.docked&&h.donoaction([{org:c,type:"TITLE",name:c.name,action:function(a){this.weapons[0].auxiliary=void 0;this.weapons[0].subauxiliary=
void 0;this.weapons[0].type="Laser";h.deploy(this,c.getdeploymentmatrix(h));h.endnoaction(a,"TITLE")}.bind(this)}],"",!0)}),"Phantom"==e.name?b.wrap_after("endcombatphase",this,function(){if(this.docked&&!this.isfireobstructed())for(var a=0;a<this.weapons.length;a++){var b=this.weapons[a];if(b.type==Unit.TURRET&&b.isactive&&this.noattack<round){this.log("+1 attack with %1 [%0]",c.name,b.name);this.noattack=round;this.selecttargetforattack(a);break}}}):b.wrap_after("endactivationphase",this,function(){this.docked&&
this.candocoordinate()&&this.doaction([this.newaction(this.resolvecoordinate,"COORDINATE")],"Select unit to Coordinate")}.bind(b)),b.wrap_after("dies",this,function(){this.docked&&(this.docked.noattack=round,this.log("emergency deployment of %0, +1 %HIT% [%1]",this.docked.name,this.name),this.docked.resolvehit(1),this.docked.hasfired=0,this.docked.wrap_before("endphase",this.docked,function(){this.hasmoved=!1}),h.deploy(this,c.getdeploymentmatrix(h)))})):b.log("Phantom not found")},ship:"VCX-100"},
{name:"Phantom",type:Unit.TITLE,points:0,unique:!0,done:!0,ship:"Attack Shuttle"},{name:"Phantom II",type:Unit.TITLE,points:0,unique:!0,done:!0,ship:"Sheathipede-class Shuttle"},{name:"Reinforced Deflectors",points:3,type:Unit.SYSTEM,islarge:!0,done:!0,init:function(b){var a=this;b.addafterdefenseeffect(a,function(b,e,f){3<=b+e&&this.addshield(1)&&this.log("+1 %SHIELD% [%0]",a.name)})}},{name:"Targeting Astromech",points:2,type:Unit.ASTROMECH,done:!0,init:function(b){var a=this;b.wrap_after("handledifficulty",
this,function(b){"RED"==b&&this.selectunit(this.gettargetableunits(3),function(a,b){this.addtarget(a[b])},["select target or self to cancel [%0]",a.name],!0)})}},{name:"TIE/x7",points:-2,type:Unit.TITLE,lostupgrades:[Unit.CANNON,Unit.MISSILE],ship:"TIE Defender",done:!0,init:function(b){var a=this;b.wrap_before("endmaneuver",this,function(){this.getdial()[this.maneuver].move.match(/[345]/)&&-1==this.ocollision.overlap&&0===this.touching.length&&this.candoevade()&&(this.log("+1 %EVADE% [%0]",a.name),
this.doselection(function(a){this.addevade(a)}.bind(this)))})}},{name:"TIE/D",points:0,type:Unit.TITLE,ship:"TIE Defender",done:!0,init:function(b){this.unit.tiedattack=-1;b.addattack(function(a,b){var c=this.weapons[this.activeweapon];return c.type==Unit.CANNON&&3>=c.points&&this.tiedattack<round},this,[b.weapons[0]],function(){this.tiedattack=round})}},{name:"TIE Shuttle",points:0,done:!0,type:Unit.TITLE,ship:"TIE Bomber",maxupg:4,lostupgrades:[Unit.TORPEDO,Unit.MISSILE,Unit.BOMB],upgrades:[Unit.CREW,
Unit.CREW]},{name:"Guidance Chips",points:0,type:Unit.MOD,done:!0,init:function(b){var a=this,c;for(c in b.weapons){var e=Unit.FCH_HIT,f=b.weapons[c],h=b.weapons[0];h.isprimary&&3<=h.getattack()&&(e=Unit.FCH_CRIT);f.type.match(/Torpedo|Missile/)&&f.wrap_after("modifyattackroll",this,function(a,b,c,f){0<Unit.FCH_blank(f,b)?f+=e:0<Unit.FCH_focus(f)?f=f-Unit.FCH_FOCUS+e:0<Unit.FCH_crit(f)&&(f=f-Unit.FCH_HIT+e);return f})}b.adddicemodifier(Unit.ATTACK_M,Unit.MOD_M,Unit.ATTACK_M,this,{req:function(a,b){var c=
this.weapons[this.activeweapon].type;return c==Unit.TORPEDO||c==Unit.MISSILE?!0:!1}.bind(b),f:function(c,e){var f=Unit.FCH_blank(c,e),h=Unit.FCH_focus(c),l=Unit.FCH_hit(c),t=Unit.FCH_HIT,y="%HIT%";this.weapons[0].isactive&&3<=this.weapons[0].getattack()&&(t=Unit.FCH_CRIT,y="%CRIT%");0<f?(b.log("+1 "+y+" [%0]",a.name),c+=t):0<h?(b.log("%FOCUS% -> "+y+" [%0]",a.name),c+=t-Unit.FCH_FOCUS):0<l&&t==Unit.FCH_CRIT&&(b.log("%HIT% -> %CRIT% [%0]",a.name),c+=t-Unit.FCH_HIT);return c}.bind(b),str:"target"})}},
{name:"TIE/v1",ship:"TIE Adv. Prototype",points:1,done:!0,init:function(b){var a=this;b.wrap_after("addtarget",this,function(b){a.isactive&&this.candoaction()&&this.candoevade()&&(this.log("free %EVADE% action [%0]",this.name),this.doselection(function(a){this.addevade(a)}.bind(this)))})},type:Unit.TITLE},{name:"Zuckuss",faction:Unit.SCUM,points:1,unique:!0,done:!0,type:Unit.CREW,init:function(b){var a=this;b.adddicemodifier(Unit.ATTACK_M,Unit.MOD_M,Unit.DEFENSE_M,this,{req:function(c,e){return a.isactive&&
0===b.stress},f:function(c,e){var f=Unit.FE_focus(c);if(0<f&&0===b.stress){targetunit.log("Reroll %0 %FOCUS% [%1]",f,a.name);b.log("+%0 %STRESS% [%1]",f,a.name);var h=b.rolldefensedie(f,a,"evade");c-=Unit.FE_FOCUS*f;for(var l=0;l<f;l++)b.addstress(),"evade"==h[l]&&(c+=Unit.FE_EVADE),"focus"==h[l]&&(c+=Unit.FE_FOCUS)}return c},str:"focus"});b.adddicemodifier(Unit.ATTACK_M,Unit.MOD_M,Unit.DEFENSE_M,this,{req:function(c,e){return a.isactive&&0===b.stress},f:function(c,e){var f=Unit.FE_evade(c);if(0<
f&&0===b.stress){targetunit.log("Reroll %0 %EVADE% [%1]",f,a.name);b.log("+%0 %STRESS% [%1]",f,a.name);var h=b.rolldefensedie(f,a,"evade");c-=Unit.FE_EVADE*f;for(var l=0;l<f;l++)b.addstress(),"evade"==h[l]&&(c+=Unit.FE_EVADE),"focus"==h[l]&&(c+=Unit.FE_FOCUS)}return c},str:"evade"})}},{name:"4-LOM",faction:Unit.SCUM,points:1,unique:!0,done:!0,type:Unit.CREW,init:function(b){var a=this;b.adddicemodifier(Unit.ATTACK_M,Unit.MOD_M,Unit.ATTACK_M,this,{req:function(){return targetunit.canusefocus()},f:function(b,
e){this.addiontoken();targetunit.canusefocus()&&(targetunit.log("cannot use focus in this attack [%0]",a.name),targetunit.wrap_after("canusefocus",this,function(){return!1}).unwrapper("afterdefenseeffect"));return b}.bind(b),str:"focus"});b.adddicemodifier(Unit.ATTACK_M,Unit.MOD_M,Unit.ATTACK_M,this,{req:function(){return targetunit.canuseevade()},f:function(b,e){this.addiontoken();targetunit.canusefocus()&&(targetunit.log("cannot use evade in this attack [%0]",a.name),targetunit.wrap_after("canuseevade",
this,function(){return!1}).unwrapper("afterdefenseeffect"));return b}.bind(b),str:"evade"})}},{name:"Mist Hunter",type:Unit.TITLE,points:0,addedaction:"Roll",done:!0,ship:"G-1A Starfighter",unique:!0,upgrades:[Unit.CANNON],install:function(b){var a,c;b.installed=!0;for(c=0;c<UPGRADES.length&&"Tractor Beam"!=UPGRADES[c].name;c++);if(c!=UPGRADES.length)for(a=0;a<b.upgradetype.length;a++)if(b.upgradetype[a]==UPGRADES[c].type&&-1==b.upg[a]){addupgrade(b,c,a,!0);b.log("%0 added [%1]",UPGRADES[c].name,
this.name);break}}},{name:"Adaptability(+1)",type:Unit.ELITE,points:0,invisible:!0},{name:"Adaptability(-1)",type:Unit.ELITE,points:0,invisible:!0},{name:"Dengar",unique:!0,type:Unit.CREW,points:3,faction:Unit.SCUM,done:!0,init:function(b){b.adddicemodifier(Unit.ATTACK_M,Unit.REROLL_M,Unit.ATTACK_M,this,{dice:["blank","focus"],n:function(){return!0===targetunit.unique?2:1},req:function(a,b,e){return this.isactive}.bind(this)})}},{name:"'Gonk'",unique:!0,type:Unit.CREW,points:2,faction:Unit.SCUM,shield:0,
candoaction:function(){return this.isactive},action:function(b){var a=this.unit;this.isactive&&(a.log("+1 %SHIELD% on %0 [%0]",this.name),this.shield++);a.endaction(b,Unit.CREW);return!0},candoaction2:function(){return this.isactive},action2:function(b){var a=this.unit;this.isactive&&0<this.shield&&this.unit.shield<this.unit.ship.shield&&(a.shield<a.ship.shield&&a.log("+1 %SHIELD% [%0]",this.name),a.addshield(1),this.shield--,a.show());a.endaction(b,Unit.CREW);return!0},done:!0},{name:"Boba Fett",
unique:!0,type:Unit.CREW,points:1,faction:Unit.SCUM,done:!0,init:function(b){var a=this;b.wrap_before("hashit",this,function(b){var c=this;a.isactive&&b.wrap_after("deal",a,function(e,h,l){l.then(function(e){if(a.isactive&&e.face==Critical.FACEUP){e=[];for(var f in b.upgrades){var h=b.upgrades[f];h.type.match(/Missile|Torpedo|Crew|Bomb|Cannon|Turret|Astromech|System|Illicit|Salvaged|Tech|Elite|Title|Mod/)&&e.push(h)}b.log("select upgrade to desactivate [%0]",a.name);c.selectupgradetodesactivate(e,
a)}});return l}).unwrapper("afterdefenseeffect")})}},{name:"R5-P8",unique:!0,type:Unit.SALVAGED,points:3,done:!0,r5p8:-1,init:function(b){var a=this;b.addafterdefenseeffect(this,function(b,e,f){a.r5p8!=round&&(a.r5p8=round,this.donoaction([{name:a.name,org:a,type:"HIT",action:function(b){var c=this.rollattackdie(1,a,"hit")[0];this.log("roll 1 attack dice [%0]",a.name);"hit"==c||"critical"==c?(f.log("+1 %HIT% [%1]",a.name),f.resolvehit(1),f.checkdead(),"critical"==c&&(this.log("+1 %HIT% [%1]",a.name),
this.resolvehit(1),this.checkdead())):this.log("No effect [%0]",a.name);this.endnoaction(b,"")}.bind(this)}],"",!0))})}},{name:"Attanni Mindlink",type:Unit.ELITE,points:1,rating:2,done:!0,faction:Unit.SCUM,init:function(b){var a=this;"undefined"==typeof Unit.prototype.getattanni&&(Unit.prototype.getattanni=function(){return[]});Unit.prototype.wrap_after("getattanni",this,function(b){return b.concat(a.unit)});b.wrap_after("addfocustoken",this,function(){if(!this.dead&&a.isactive){var b=this.getattanni(),
e;for(e in b)b[e]!=this&&b[e].isally(this)&&0===b[e].focus&&(b[e].addfocustoken(),b[e].log("+1 %FOCUS% [%0]",a.name))}});b.wrap_after("addstress",this,function(){if(!this.dead&&a.isactive){var b=this.getattanni(),e;for(e in b)b[e]!=this&&b[e].isally(this)&&0===b[e].stress&&(b[e].addstress(),b[e].log("+1 %STRESS% [%0]",a.name))}})}},{name:"Rage",type:Unit.ELITE,round:-1,candoaction:function(){return this.isactive},action:function(b){var a=this.unit;this.isactive&&(this.unit.log("+1 %FOCUS%, +2 %STRESS%, 3 rerolls [%0]",
a.name),this.round=round,a.addfocustoken(),a.addstress(),a.addstress());a.endaction(b,Unit.ELITE);return!0},init:function(b){b.adddicemodifier(Unit.ATTACK_M,Unit.REROLL_M,Unit.ATTACK_M,this,{dice:["blank","focus"],n:function(){return 3},req:function(a,b,e){return this.isactive&&this.round==round}.bind(this)})},done:!0,points:1},{name:"Punishing One",type:Unit.TITLE,unique:!0,points:12,done:!0,ship:"JumpMaster 5000",install:function(b){b.installed=!0;b.weapons[0].wrap_after("getattack",this,function(a){return a+
1});b.showstats()},uninstall:function(b){"function"==typeof b.weapons[0].getattack.unwrap&&b.weapons[0].getattack.unwrap(this);b.showstats()}},{name:"Long-Range Scanners",type:Unit.MOD,points:0,done:!0,requiredupg:[Unit.TORPEDO,Unit.MISSILE],init:function(b){b.wrap_after("gettargetableunits",this,function(a,b){var c=[];if(3>a)return c;for(var f in squadron)squadron[f].isenemy(this)&&3<=this.getrange(squadron[f])&&c.push(squadron[f]);return c})}},{name:"Electronic Baffle",type:Unit.SYSTEM,points:1,
done:!0,init:function(b){var a=this;b.wrap_after("addstress",this,function(){this.donoaction([{type:"SYSTEM",name:a.name,org:a,action:function(b){this.removestresstoken();this.log("-1 %STRESS%, +1 %HIT% [%0]",a.name);this.resolvehit(1);this.endnoaction(b,"SYSTEM")}.bind(this)}],"Take 1 %HIT% instead of %STRESS% token",!0)});b.wrap_after("addiontoken",this,function(){this.donoaction([{type:"SYSTEM",name:a.name,org:a,action:function(b){this.removeiontoken();this.log("-1 %ION%, +1 %HIT% [%0]",a.name);
this.resolvehit(1);this.endnoaction(b,"SYSTEM")}.bind(this)}],"Take 1 %HIT% instead of %ION% token",!0)})}},{name:"Overclocked R4",type:Unit.SALVAGED,points:1,done:!0,init:function(b){var a=this;b.wrap_after("begincombatphase",a,function(b){this.wrap_after("removefocustoken",a,function(){this.donoaction([{type:"STRESS",name:a.name,org:a,action:function(a){this.addstress();this.addfocustoken();this.endnoaction(a,"SALVAGED")}.bind(this)}],"Add %STRESS% for %FOCUS%",!0)}).unwrapper("endcombatphase");
return b})}},{name:"Thermal Detonators",done:!0,img:"seismic.png",snd:"explode",width:16,height:8,size:15,explode:function(){if(phase==ACTIVATION_PHASE&&!this.exploded){for(var b=this.getrangeallunits(),a=0;a<b[1].length;a++){var c=squadron[b[1][a].unit];c.log("+1 %HIT%, +1 %STRESS% [%0]",this.name);c.resolvehit(1);c.addstress();c.checkdead()}this.explode_base()}},type:Unit.BOMB,points:3},{name:"Ion Projector",type:Unit.MOD,islarge:!0,done:!0,points:2,init:function(b){var a=this;b.wrap_before("collidedby",
this,function(b){if(a.isactive&&b.isenemy(this)){var c=this.rollattackdie(1,a,"hit")[0];if("hit"==c||"critical"==c)b.log("+%1 %ION% [%0]",a.name,1),b.addiontoken()}else b.log("no effect [%0]",a.name)})}},{name:"Adaptability",type:Unit.ELITE,rating:2,points:0,done:!0,faceup:!1,canswitch:function(){return phase<=SETUP_PHASE},"switch":function(){this.variant=(this.faceup=!this.faceup)?"+1":"-1";this.unit.showskill()},init:function(b){var a=this;b.wrap_after("getskill",this,function(b){return a.faceup?
b+1:b-1});this["switch"]();b.showskill()}},{name:"Systems Officer",type:Unit.CREW,limited:!0,faction:Unit.EMPIRE,done:!0,points:2,init:function(b){b.wrap_after("endmaneuver",this,function(){var a=this.getdial()[this.lastmaneuver].difficulty,b=this.selectnearbyally(1);"GREEN"==a&&0<b.length&&this.selectunit(b,function(a,b){a[b].selectunit(a[b].gettargetableunits(3),function(a,b){this.addtarget(a[b])},["select target to lock"],!1)},["select unit for free %TARGET% (or self to cancel)"],!0)})}},{name:"Special Ops Training",
type:Unit.TITLE,faction:Unit.EMPIRE,ship:"TIE/SF Fighter",points:0,done:!0,init:function(b){var a=this;b.addattack(function(a,b){return this.secondattack},this,[b.weapons[0]],function(){},function(){var a=this.weapons[0].getenemiesinrange(),b=[],f;for(f in a)this.isinprimaryfiringarc(a[f])||b.push(a[f]);return b});b.wrap_after("preattackroll",this,function(b,e){var c=this.weapons[b];this.secondattack=!1;c.isprimary&&this.isinprimaryfiringarc(e)&&(c={org:a,name:a.name,type:"HIT",action:function(a){this.log("+1 attack die");
this.wrap_after("getattackstrength",this,function(a,b,c){return c+1}).unwrapper("attackroll");this.endnoaction(a,"HIT")}.bind(this)},this.donoaction([c],"Add 1 additional attack die or one auxiliary arc attack (by default)",!0,function(){this.secondattack=!0}.bind(this)))})}},{name:"Sensor Cluster",type:Unit.TECH,points:2,done:!0,init:function(b){var a=this;b.adddicemodifier(Unit.DEFENSE_M,Unit.MOD_M,Unit.DEFENSE_M,a,{req:function(b,e){return a.isactive&&this.canusefocus()}.bind(b),aiactivate:function(a,
b){return 0<Unit.FE_blank(a,b)&&0===Unit.FE_focus(a)},f:function(b,e){0<this.canusefocus()&&0<Unit.FE_blank(b,e)&&(this.removefocustoken(),this.log("1 blank -> 1 %EVADE% [%0]",a.name),b+=Unit.FE_EVADE);return b}.bind(b),str:"blank"})}},{name:"R3 Astromech",type:Unit.ASTROMECH,points:2,done:!0,init:function(b){var a=this,c=-1;b.adddicemodifier(Unit.ATTACK_M,Unit.MOD_M,Unit.ATTACK_M,a,{req:function(a,b){return 0<Unit.FCH_focus(a)&&c<round}.bind(b),aiactivate:function(a,b){return!1},f:function(b,f){0<
Unit.FCH_focus(b,f)&&c<round&&(this.addevadetoken(),this.log("1 %FOCUS% -> 1 blank, +1 %EVADE% [%0]",a.name),c=round,b-=Unit.FCH_FOCUS);return b}.bind(b),str:"focus"})}},{name:"Vectored Thrusters",type:Unit.MOD,done:!0,islarge:!1,addedaction:"Roll",points:2},{name:"Tail Gunner",type:Unit.CREW,done:!0,limited:!0,points:2,init:function(b){b.wrap_before("resolveattack",this,function(a,b){var c=this.weapons[a];c.isprimary&&3>=c.getauxiliarysector(b)&&"Bilaser"==c.type&&(b.log("-1 defense [%0]",this.name),
b.wrap_after("getagility",this,function(a){return 0<a?a-1:a}).unwrapper("afterdefenseeffect"),b.showstats())})}},{name:"Collision Detector",type:Unit.SYSTEM,done:!0,points:0,init:function(b){var a=this;b.wrap_after("canmoveonobstacles",this,function(a,b){return a.match(/DECLOAK|ROLL|BOOST/)?!0:b});b.wrap_after("canhavecriticalocollision",this,function(){this.log("ignoring collision with obstacle [%0]",a.name);return!1})}},{name:"Alliance Overhaul",type:Unit.TITLE,done:!0,points:0,ship:"ARC-170",init:function(b){var a=
this;b.wrap_after("modifyattackroll",this,function(a,b,f,h){b=a=0;for(a;a<this.weapons.length;a++)if(this.weapons[a].isactive){b=a;break}4>this.weapons[b].getauxiliarysector(targetunit)&&0<Unit.FCH_focus(h)&&(h+=Unit.FCH_CRIT-Unit.FCH_FOCUS);return h});b.wrap_after("getattackstrength",this,function(b,e,f){return this.weapons[b].isprimary&&this.isinprimaryfiringarc(e)?(this.log("+1 attack die [%0]",a.name),f+1):f});b.adddicemodifier(Unit.ATTACK_M,Unit.MOD_M,Unit.ATTACK_M,this,{req:function(a,b){return!this.isinprimaryfiringarc(targetunit)}.bind(b),
aiactivate:function(a,b){return 0<Unit.FCH_focus(a)},f:function(a,b){return 0<Unit.FCH_focus(a)?(this.log("1 %FOCUS% ->1 %CRIT%"),a-Unit.FCH_FOCUS+Unit.FCH_CRIT):a}.bind(b),str:"focus"})}},{name:"Concord Dawn Protector",type:Unit.TITLE,done:!0,points:1,ship:"Protectorate Starfighter",init:function(b){var a=this;b.adddicemodifier(Unit.DEFENSE_M,Unit.ADD_M,Unit.DEFENSE_M,this,{req:function(a,b){return activeunit.isinfiringarc(this)&&this.isinfiringarc(activeunit)&&1==activeunit.getrange(this)}.bind(b),
aiactivate:function(a,b){return!0},f:function(b,e){this.log("+1 %EVADE% [%0]",a.name);return{m:b+Unit.FE_EVADE,n:e+1}}.bind(b),str:"evade"})}},{name:"Fearlessness",type:Unit.ELITE,rating:2,done:!0,points:1,faction:Unit.SCUM,init:function(b){var a=this;b.wrap_after("modifyattackroll",this,function(a,b,f,h){1==this.getrange(targetunit)&&(h+=Unit.FCH_HIT);return h});b.adddicemodifier(Unit.ATTACK_M,Unit.ADD_M,Unit.ATTACK_M,this,{req:function(a,b){return targetunit.isinfiringarc(this)&&this.isinfiringarc(targetunit)&&
1==targetunit.getrange(this)}.bind(b),aiactivate:function(a,b){return!0},f:function(b,e){this.log("+1 %HIT% [%0]",a.name);return{m:b+Unit.FCH_HIT,n:e+1}}.bind(b),str:"hit"})}},{name:"Seismic Torpedo",type:Unit.TORPEDO,points:2,done:!0,firesnd:"missile",isWeapon:function(){return!1},candoaction:function(){return this.isactive&&0<this.unit.selectnearbyobstacle(2).length},action:function(b){var a=this.unit,c=a.selectnearbyobstacle(2);0<c.length&&this.isactive?a.resolveactionselection(c,function(e){c[e].type=
NONE;c[e].g.attr({display:"none"});SOUNDS.explode.play();for(var f in squadron){var h=squadron[f];if(1E4>=h.getdist(h.m,c[e])){var l=h.rollattackdie(1,a,"critical")[0];"hit"==l?(h.log("+1 %HIT% [%0]",this.name),h.resolvehit(1),h.checkdead()):"critical"==l&&(h.log("+1 %CRIT% [%0]",this.name),h.resolvecritical(1),h.checkdead())}}this.desactivate();a.endaction(b,Unit.TORPEDO)}.bind(this)):a.endaction(b,Unit.TORPEDO)}},{name:"Latts Razzi",type:Unit.CREW,faction:Unit.SCUM,points:2,unique:!0,done:!0,init:function(b){var a=
this;b.adddicemodifier(Unit.DEFENSE_M,Unit.ADD_M,Unit.DEFENSE_M,this,{req:function(a,b){return 0<activeunit.stress},aiactivate:function(a,b){return 0<activeunit.stress},f:function(b,e){return 0<activeunit.stress?(activeunit.log("-1 stress from %0, +1 %EVADE% for %1 [%2]",activeunit.name,a.unit.name,a.name),activeunit.removestresstoken(),{m:b+Unit.FE_EVADE,n:e+1}):{m:b,n:e}},str:"evade"})}},{name:"Ketsu Onyo",type:Unit.CREW,faction:Unit.SCUM,points:1,unique:!0,done:!0,init:function(b){var a=this;b.wrap_before("endphase",
this,function(){var b=this.selectnearbyenemy(2,function(a,b){return 0<a.tractorbeam});0<b.length&&this.selectunit(b,function(b,c){b[c].wrap_after("resettractorbeam",a,function(a){return this.tractorbeam}).unwrapper("beginplanningphase");b[c].log("keeps %0 tractor beam tokens [%1]",this.tractorbeam,a.name)},["select unit"],!0)})}},{name:"IG-88D",type:Unit.CREW,faction:Unit.SCUM,points:1,unique:!0,done:!0,init:function(b){for(var a in squadron){var c=squadron[a];c!=b&&!0===c.ig2000&&c.isally(b)&&(b.log("copying %0 abilities [%1]",
c.name,this.name),c.init.call(b,c))}}},{name:"Rigged Cargo Chute",type:Unit.ILLICIT,islarge:!0,points:1,done:!0,aiactivate:function(){var b,a=[],c;for(c in squadron)b=squadron[c],this.unit.isenemy(b)&&1>=this.unit.getrange(b)&&a.push(b);return 0<a.length},candoaction:function(){return this.isactive},action:function(b){var a=this.unit,c,e,f=[],h;c=a.getpathmatrix(a.m.clone().rotate(180,0,0),"F1").translate(40,-20).split();c=new Rock(MAXROCKS+9,[c.dx,c.dy,c.rotate+90],a.team,OBSTACLES.length);OBSTACLES.push(c);
c=OBSTACLES.length-1;for(var l in squadron)e=squadron[l],h=e.getocollisions(e.m,e.m),-1!=h.overlap&&f.push(e);for(var t in f)f[t].resolveocollision(c,[]),f[t].oldoverlap=c;this.desactivate();a.endaction(b,Unit.ILLICIT)}},{name:"Black Market Slicer Tools",type:Unit.ILLICIT,points:1,done:!0,aiactivate:function(){var b=!1,a=this.unit,c=1,e;for(e in a.upgrades)a.upgrades[e].name.match(/Push the Limit|Experimental Interface/)&&(c+=1);2<=a.selectnearbyenemy(2,function(a,b){return 0<b.stress&&(a.getenemiesinrange(b)===
[]||2>=b.hull||3<=b.getagility())}).length*c&&(b=!0);return b},candoaction:function(){return this.isactive},action:function(b){var a=this,c=a.unit.selectnearbyenemy(2,function(a,b){return 0<b.stress});0<c.length&&this.isactive&&this.unit.selectunit(c,function(b,c){a.unit.log("Activating %0 against %1...",a.name,b[c].name);var e=a.unit.rollattackdie(1,a,"blank")[0];"hit"==e||"critical"==e?(b[c].applydamage(1),b[c].removestresstoken(),b[c].checkdead()):a.unit.log("No damage from %0 against %1.",a.name,
b[c].name)},["select unit [%0]",a.name],!1);this.unit.endaction(b,Unit.ILLICIT)}},{name:"Gyroscopic Targeting",ship:"Lancer-class Pursuit Craft",type:Unit.MOD,points:2,done:!0,init:function(b){var a=this;b.gtmaneuver=-1;b.wrap_before("endmaneuver",this,function(a){a=this.getmaneuver();this.gtmaneuver=-1;a.move.match(/\w+[345]/)&&(this.gtmaneuver=round)});b.wrap_before("endcombatphase",this,function(){this.gtmaneuver==round&&this.donoaction([{org:a,type:"MOD",name:a.name,action:function(b){this.log("Free moving arc rotation [%0]",
a.name);this.resolvearcrotate(b,!0)}.bind(this)}],"",!0)})}},{name:"Shadow Caster",ship:"Lancer-class Pursuit Craft",type:Unit.TITLE,points:3,done:!0,unique:!0,init:function(b){var a=this;b.wrap_after("hashit",this,function(b,e){e&&2>=this.weapons[0].getauxiliarysector(b)&&(this.log("+1 tractor beam token [%0]",a.name),b.addtractorbeam(this));return e})}},{name:"Jyn Erso",faction:Unit.REBEL,points:2,unique:!0,done:!0,type:Unit.CREW,candoaction:function(){return this.isactive&&!this.unit.dead},action:function(b){var a=
this.unit,c=a.selectnearbyally(2);c.push(a);var e=a.selectnearbyenemy(3,function(a,b){return a.isinfiringarc(b)});0<c.length&&0<e.length?a.resolveactionselection(c,function(f){var h=e.length;3<h&&(h=3);for(var l=0;l<h;l++)c[f].addfocustoken();a.endaction(b,"CREW")}):(a.log("no effect [%0]",this.name),a.endaction(b,"CREW"))}},{name:"Unkar Plutt",faction:Unit.SCUM,points:1,type:Unit.CREW,done:!0,unique:!0,init:function(b){var a=this;b.unkar=-1;b.wrap_after("getcollidingunits",this,function(b,e){for(var c=
[],h=0;h<e.length;h++)this.isenemy(e[h])&&c.push(e[h]);0<c.length&&this.unkar<round&&(this.unkar=round,this.donoaction([{org:a,type:"CREW",name:a.name,action:function(b){a.unit.log("+1 %HIT%, +1 free action [%0]",a.name);this.resolvehit(1);SOUNDS.explode.play();this.checkdead();this.doaction(this.getactionlist(),"");this.endnoaction(b,"CREW")}.bind(this)}],"",!0));return e})}},{name:"Sabine's Masterpiece",faction:Unit.REBEL,ship:"TIE Fighter",unique:!0,done:!0,type:Unit.TITLE,upgrades:[Unit.CREW,
Unit.ILLICIT],points:1},{name:"Millennium Falcon(HoR)",faction:Unit.REBEL,ambiguous:!0,ship:"YT-1300",unique:!0,done:!0,type:Unit.TITLE,points:1,init:function(b){var a=this;b.wrap_after("getmaneuverlist",this,function(b){if(this.hasionizationeffect())return b;for(var c in b)c.match(/BR3|BL3/)&&(this.log("perform half-turn after a bank [%0]",a.name),b["K"+c]={move:c,difficulty:b[c].difficulty,halfturn:!0});return b});b.wrap_before("completemaneuver",this,function(a,b,f){a.match(/BR3|BL3/)&&!0===f&&
this.addstress()})}},{name:"Smuggling Compartment",ship:"YT-",type:Unit.MOD,limited:!0,done:!0,points:0,upgrades:[Unit.MOD,Unit.ILLICIT],maxupg:3},{name:"Burnout Slam",islarge:!0,done:!0,type:Unit.ILLICIT,addedaction:"SLAM",points:1,init:function(b){var a=this;b.wrap_after("resolveslam",this,function(){if(a.isactive){var b=a.unit.shipactionList.indexOf("SLAM");a.unit.shipactionList.splice(b,1);a.desactivate()}}.bind(b))}},{name:"Finn",faction:Unit.REBEL,points:5,unique:!0,type:Unit.CREW,done:!0,init:function(b){b.adddicemodifier(Unit.ATTACK_M,
Unit.ADD_M,Unit.ATTACK_M,this,{req:function(a,b){return this.isactive&&this.unit.isinfiringarc(targetunit)}.bind(this),f:function(a,b){this.unit.log("+1 blank [%0]",this.name);return{m:a,n:b+1}}.bind(this),str:"crew"});b.adddicemodifier(Unit.DEFENSE_M,Unit.ADD_M,Unit.DEFENSE_M,this,{req:function(a,b){return this.isactive&&this.unit.isinfiringarc(activeunit)}.bind(this),f:function(a,b){this.unit.log("+1 blank [%0]",this.name);return{m:a,n:b+1}}.bind(this),str:"crew"})}},{name:"Rey",faction:Unit.REBEL,
points:2,unique:!0,type:Unit.CREW,done:!0,init:function(b){var a=this;a.focus=0;b.wrap_before("endphase",this,function(){this.log("+1 %FOCUS% on %0",a.name);0<this.focus&&(a.focus++,this.removefocustoken())});b.wrap_before("begincombatphase",this,function(){0<a.focus&&this.donoaction([{org:a,type:"CREW",name:a.name,action:function(b){a.focus--;a.unit.addfocustoken();a.unit.endnoaction(b,"CREW")}}],"",!0)})}},{name:"Black One",points:1,unique:!0,done:!0,ship:"T-70 X-Wing",type:Unit.TITLE,skillmin:7,
init:function(b){var a=this;b.wrap_after("endaction",this,function(b,e){if("BOOST"==e||"ROLL"==e){var c=this.selectnearbyally(1,function(a,b){for(var c=0;c<b.istargeted.length;c++)if(!b.istargeted[c].isally(b))return!0;return!1});0<c.length&&this.selectunit(c,function(b,c){for(var e=0;e<b[c].istargeted.length;e++){var f=b[c].istargeted[e];if(!b[c].isally(f)){b[c].log("removing %TARGET% from %0 [%1]",f.name,a.name);f.removetarget(b[c]);break}}},["select unit (or self to cancel) [%0]",a.name],!1)}})}},
{name:"Primed Thrusters",points:1,done:!0,islarge:!1,type:Unit.TECH,init:function(b){b.wrap_after("isactiondone",this,function(a,b){if(0<this.stress&&"ROLL"!=a&&"BOOST"!=a)return!0;0<this.stress&&"ROLL"==a&&b&&this.log("can do %ROLL% [%0]");0<this.stress&&"BOOST"==a&&b&&this.log("can do %BOOST% [%0]");return b});b.wrap_after("hasnostresseffect",this,function(){return 3>this.stress})}},{name:"Snap Shot",points:2,type:Unit.ELITE,done:!0,isWeapon:function(){return!0},isTurret:function(){return!1},endattack:function(b,
a){this.lastphase=this.phase;this.phase=phase},firesnd:"",attack:2,range:[1,1],lastphase:-1,phase:-1,firing:!1,index:-1,init:function(b){var a=this;a.firesnd=a.unit.ship.firesnd;var c=1===b.team?2:1,e;for(e in a.unit.weapons)if(a.unit.weapons[e]==a){this.index=e;break}b.wrap_after("endcombatphase",a,function(){a.lastphase=a.phase;a.phase=-1});$(document).on("endmaneuver"+c,function(c,e){!e.isally(b)&&!b.dead&&0<a.getenemiesinrange([e]).length&&a.phase<phase&&(b.donoaction([{org:a,type:"LASER",name:a.name,
action:function(c){targetunit=e;this.activeweapon=a.index;this.log("attacks %0 with %1",e.name,this.weapons[a.index].name);e.isattackedby(a.index,this);var f;this.hasdamaged=!1;displaycombatdial();var h=e.g.getBBox(),l=transformPoint(this.m,{x:0,y:-(this.islarge?40:20)});s.path("M "+l.x+" "+l.y+" L "+(h.x+h.w/2)+" "+(h.y+h.h/2)).appendTo(VIEWPORT).attr({stroke:this.color,strokeWidth:2,strokeDasharray:100,"class":"animated fireline"});for(f in squadron)if(squadron[f]==this)break;this.preattackroll(a.index,
e);f=this.getattackstrength(a.index,e);h=this.weapons[a.index].modifydamagegiven(this.attackroll(f));this.weapons[a.index].lastattackroll=h;displayattackroll(h,f);this.ar=h;this.ad=f;displayattacktokens(this,function(f){targetunit.predefenseroll(a.index,f);targetunit.defenseroll(targetunit.getdefensestrength(a.index,f)).done(function(a){this.dr=a.roll;this.dd=a.dice;displaydefenseroll(this.dr,this.dd);displaydefensetokens(this,function(){this.resolvedamage();this.endnoaction(c,"LASER");this.newlock().done(function(){this.newlock().done(nextactivation);
nextactivation()}.bind(this))}.bind(b))}.bind(e))});a.lastphase=a.phase;a.phase=phase}.bind(b)}],"Snap Shot",!0),phase!=COMBAT_PHASE&&(b.hasfired=0))})}},{name:"M9-G8",type:Unit.ASTROMECH,points:3,unique:!0,done:!0,init:function(b){var a=this;b.wrap_after("gettargetableunits",this,function(a,b){return this.selectnearbyunits(a)});Unit.prototype.adddicemodifier(Unit.ATTACK_M,Unit.MOD_M,Unit.ATTACK_M,this,{req:function(){return a.isactive&&!a.unit.isally(this)},f:function(a,b){0<Unit.FCH_crit(a)?(this.log("1 %CRIT% rerolled [%0]",
this.name),a=a-Unit.FCH_CRIT+activeunit.attackroll(1)):0<Unit.FCH_hit(a)&&(this.log("1 %HIT% rerolled [%0]",this.name),a=a-Unit.FCH_HIT+activeunit.attackroll(1));return a},str:"critical"});Unit.prototype.adddicemodifier(Unit.ATTACK_M,Unit.MOD_M,Unit.ATTACK_M,this,{req:function(){return a.isactive&&a.unit.isally(this)},f:function(a,b){0<Unit.FCH_blank(a)?(this.log("1 blank rerolled [%0]",this.name),a+=activeunit.attackroll(1)):0<Unit.FCH_focus(a)&&!this.canusefocus()&&(this.log("1 %FOCUS% rerolled [%0]",
this.name),a=a-Unit.FCH_FOCUS+activeunit.attackroll(1));return a},str:"blank"})}},{name:"Pattern Analyzer",type:Unit.TECH,points:2,done:!0,init:function(b){b.wrap_before("resolvemaneuver",this,function(){0==this.stress&&(this.checkpilotstress=!1)});b.wrap_before("endactivate",this,function(){this.checkpilotstress||this.addafteractions(function(){this.checkpilotstress=!0;this.handledifficulty(this.maneuverdifficulty)}.bind(this))}).unwrapper("endactivate")}},{name:"General Hux",type:Unit.CREW,faction:Unit.EMPIRE,
points:5,unique:!0,done:!0,candoaction:function(){return!0},action:function(b){var a=this.unit,c=a.selectnearbyally(2);0<c.length?(1==c.length?(new Condition(c[0],a,"Fanatical Devotion"),c[0].addfocustoken(),a.endaction(b,Unit.CREW)):2<=c.length?(c.push(a),a.log("select up to 3 units (self to cancel) [%0]",a.name),a.resolveactionselection(c,function(e){c[e]==this&&this.endaction(b,Unit.CREW);new Condition(c[e],a,"Fanatical Devotion");c[e].addfocustoken();c.splice(e,1);1<c.length?this.resolveactionselection(c,
function(a){c[a]==this&&this.endaction(b,Unit.CREW);c[a].addfocustoken();c.splice(a,1);1<c.length?this.resolveactionselection(c,function(a){c[a]==this&&this.endaction(b,Unit.CREW);c[a].addfocustoken();this.endaction(b,Unit.CREW)}.bind(this)):this.endaction(b,Unit.CREW)}.bind(this)):this.endaction(b,Unit.CREW)}.bind(a))):a.endaction(b,Unit.CREW),a.addstress()):a.endaction(b,Unit.CREW)}},{name:"Kylo Ren",type:Unit.CREW,faction:Unit.EMPIRE,points:3,unique:!0,done:!0,candoaction:function(){return 0<this.unit.selectnearbyenemy(3).length},
action:function(b){var a=this.unit,c=a.selectnearbyenemy(3);this.resolveactionselection(c,function(b){new Condition(c[b],a,"I'll Show You The Dark Side")}.bind(this))}},{name:"Operations Specialist",type:Unit.CREW,points:3,limited:!0,done:!0,init:function(b){var a=this;Unit.prototype.wrap_after("endattack",a,function(b,e,f){if(a.isactive&&this.isally(a.unit)&&2>=this.getrange(a.unit)&&0===b+e){var c=this.selectnearbyally(3);0<c.length&&this.doselection(function(a){this.resolveactionselection(c,function(b){c[b].addfocustoken();
this.endnoaction(a,"OP")}.bind(this))}.bind(this))}})}},{name:"Kylo Ren's Shuttle",type:Unit.TITLE,points:2,ship:"Upsilon-Class Shuttle",unique:!0,done:!0,init:function(b){b.wrap_after("endcombatphase",this,function(){var a=this.selectnearbyenemy(2,function(a,b){return 0===b.stress});0<a.length&&0<a[0].selectnearbyally(3,function(a,e){return 2>=e.getrange(b)&&0===e.stress}).length&&a[0].doselection(function(b){this.resolveactionselection(a,function(c){a[c].addstress();a[0].endnoaction(b,Unit.TITLE)})})})}},
{name:"Targeting Synchronizer",type:Unit.TECH,points:3,done:!0,init:function(b){var a=this;Unit.prototype.wrap_after("canusetarget",a,function(b,e){return a.unit!=this&&a.unit.isally(this)&&2>=a.unit.getrange(this)&&-1<a.unit.targeting.indexOf(b)?!0:e});Unit.prototype.wrap_before("removetarget",a,function(b){a.unit!=this&&a.unit.isally(this)&&2>=a.unit.getrange(this)&&-1==this.targeting.indexOf(b)&&-1<a.unit.targeting.indexOf(b)&&a.unit.removetarget(b)})}},{name:"Hyperwave Comm Scanner",type:Unit.TECH,
done:!0,points:1,init:function(b){var a=this;b.wrap_after("endsetupphase",this,function(){var b=this.selectnearbyally(2);if(a.isactive)for(var e in b){var f=b[e];f.donoaction([{type:"FOCUS",name:a.name,org:a,action:function(a){this.addfocustoken();this.endnoaction(a,"TECH")}.bind(f)},{type:"EVADE",name:a.name,org:a,action:function(b){a.desactivate();this.addevadetoken();this.endnoaction(b,"TECH")}.bind(f)}],"+1 %EVADE% / %FOCUS%",!0)}})}},{name:"A Score To Settle",type:Unit.ELITE,points:0,done:!0,
init:function(b){var a=this;b.ascoretosettle=a;b.wrap_after("endsetupphase",this,function(){var b=[],e;for(e in squadron)squadron[e].team!=this.team&&b.push(squadron[e]);0<b.length&&(this.log("select unit for condition [%0]",a.name),this.resolveactionselection(b,function(a){new Condition(b[a],this,"A Debt To Pay")}.bind(this)),this.adddicemodifier(Unit.ATTACK_M,Unit.MOD_M,Unit.ATTACK_M,a,{req:function(a,b){return"undefined"!=typeof targetunit.adebttopay?targetunit.adebttopay.isactive:!1},f:function(b,
c){this.log("1 %FOCUS% -> 1 %CRIT% [%0]",a.name);return b=b-Unit.FCH_FOCUS+Unit.FCH_CRIT}.bind(this),str:"focus"}))})}},{name:"Cassian Andor",type:Unit.CREW,points:2,faction:Unit.REBEL,unique:!0,init:function(b){b.wrap_after("endplanningphase",this,function(){var a=this.selectnearbyenemy(2);0<a&&this.doselection(function(b){this.resolveactionselection(a,function(b){this.guessmove(a[b].maneuver)}.bind(this))}.bind(this))})}},{name:"Captain Rex",type:Unit.CREW,points:2,faction:Unit.REBEL,unique:!0,
done:!0,init:function(b){var a=this;b.wrap_after("hashit",this,function(b,e){e||(this.log("+1 stress, +1 %FOCUS% [%0]",a.name),this.addfocustoken());return e})}},{name:"EMP Device",unique:!0,type:Unit.ILLICIT,points:2,range:[1,1],done:!0,isTurret:function(){return!0},issecondary:!1,firesnd:"missile",isWeapon:function(){return!0},getenemiesinrange:function(){return[this.unit]},declareattack:function(b){if(!this.isactive)return!1;var a;b=this.unit.selectnearbyunits(1,function(a,b){return a!=b});for(a in b)b[a].addiontoken(),
b[a].addiontoken(),b[a].log("+2 %ION% [%0]",this.name);this.isactive=!1;this.unit.cancelattack();return!1},init:function(b){this.toString=Upgrade.prototype.toString}},{name:"Captured TIE",unique:!0,type:Unit.MOD,ship:"TIE Fighter",faction:Unit.REBEL,points:1,done:!0,init:function(b){var a=this,c=!1,e=function(){var b=0,c;for(c in squadron)squadron[c].team==this.team&&b++;1==b&&a.desactivate()};b.wrap_after("declareattack",this,function(a,b,e){e&&(c=!0);return e});b.wrap_after("endsetupphase",this,
e);Unit.prototype.wrap_before("dies",this,e);b.wrap_after("isenemy",this,function(b,e){return a.isactive?e&&!(!c&&this.getskill()>b.getskill()):e})}},{name:"Spacetug Tractor Array",type:Unit.MOD,ship:"Quadjumper",points:2,done:!0,candoaction:function(){return this.isactive},action:function(b){var a=this.unit,c=a.selectnearbyunits(1,function(a,b){return a!=b&&a.isinfiringarc(b)});0<c.length?a.resolveactionselection(c,function(e){c[e].addtractorbeam(a);a.endaction(b,"MOD")}):a.endaction(b,"MOD")}},
{name:"Scavenger Crane",type:Unit.ILLICIT,points:2,done:!0,init:function(b){var a=this;Unit.prototype.wrap_before("dies",this,function(){if(this!=b&&a.isactive&&2>=b.getrange(this)){for(var c in b.upgrades){var e=b.upgrades[c];if((e.type==Unit.TORPEDO||e.type==Unit.MISSILE||e.type==Unit.BOMB||e.type==Unit.CANNON||e.type==Unit.TURRET||e.type==Unit.MOD)&&!1===e.isactive){this.log("%0 active again [%1]",e.name,a.name);e.isactive=!0;break}}"blank"==b.rollattackdie(1)[0]&&a.desactivate()}})}},{name:"Inspiring Recruit",
type:Unit.CREW,points:1,done:!0,init:function(b){var a=this;Unit.prototype.wrap_after("removestresstoken",this,function(){this.isally(b)&&2>=this.getrange(b)&&0<this.stress&&(this.log("-1 stress token [%0]",a.name),this.removestresstoken.vanilla.call(this))})}},{name:"Baze Malbus",type:Unit.CREW,points:3,unique:!0,done:!0,faction:Unit.REBEL,init:function(b){var a=this;b.addattack(function(a,b){return this.weapons[0].isactive&&0===a+b},this,[b.weapons[0]],function(){this.noattack=round},function(){this.log("+1 attack [%0]",
a.name);return this.selectnearbyenemy(3,function(a,b){return b!=targetunit})})}},{name:"Bodhi Rook",type:Unit.CREW,points:1,unique:!0,faction:Unit.REBEL,done:!0,init:function(b){b.wrap_after("gettargetableunits",this,function(a,b){var c=[],f;for(f in squadron){var h=squadron[f];h.isally(this)&&(c=c.concat(Unit.prototype.gettargetableunits.call(h,3)))}return c})}},{name:"Pivot Wing",type:Unit.TITLE,points:0,ship:"U-Wing",canbeswitched:!1,done:!0,canswitch:function(){return this.canbeswitched},"switch":function(){var b=
this.unit;this.canbeswitched=!1;this.faceup?("undefined"!=typeof b.getagility.unwrap&&b.getagility.unwrap(this),b.wrap_after("getmaneuverlist",this,function(a){"undefined"!=typeof a.F0&&(a.F0r={move:a.F0.move,difficulty:a.F0.difficulty,halfturn:!0});return a}),this.variant="Landing"):("undefined"!=typeof b.getmaneuverlist.unwrap&&b.getmaneuverlist.unwrap(this),b.wrap_after("getagility",this,function(a){return a+1}),this.variant="Attack");this.faceup=!this.faceup},init:function(b){var a=this;this["switch"]();
this.unit.wrap_before("endmaneuver",this,function(){a.canbeswitched=!0})}},{name:"Adaptive Ailerons",type:Unit.TITLE,points:0,ship:"TIE Striker",done:!0,init:function(b){var a=this;b.adaptive=-1;"undefined"==typeof b.facultativeailerons&&(b.facultativeailerons=!1);b.wrap_after("premove",this,function(){var a=["F1","BR1","BL1"],b=this.moves[0];this.facultativeailerons||(this.moves=[]);0==this.stress&&(this.moves=this.moves.concat([this.getpathmatrix(b,a[0]),this.getpathmatrix(b,a[1]),this.getpathmatrix(b,
a[2])]))});a.processing=!1;b.wrap_before("evaluatemoves",this,function(){if(b.ia&&!a.processing){a.processing=!0;a.oldm=b.m;if(0>=b.stress){var c,e=b.meanmround;b.evaluatemoves(!0,!0);b.meanmround=e;e=this.getdial().filter(function(a){return a.move.match(/F1|BL1|BR1/)});c=b.findpositions(e);c.sort(function(a,b){return b.n-a.n});c=c[0].m;b.m=b.getpathmatrix(a.oldm,e[c].move);a.maneuverchoice=c}a.processing=!1}});b.wrap_before("beginactivation",this,function(){for(var b=this.maneuver,e=this.getdial(),
f=[],h=[],l=0;l<e.length;l++)e[l].move.match(/F1|BL1|BR1/)&&(f.push(this.getpathmatrix(this.m,e[l].move)),h.push(l));this.adaptive<round&&0==this.stress&&(this.adaptive=round,this.donoaction([{org:a,type:"TITLE",name:a.name,action:function(c){this.wrap_after("candoendmaneuveraction",this,function(){return!1}).unwrapper("cleanupmaneuver");this.wrap_after("getdial",this,function(a){for(var b=[],c=0;c<a.length;c++)b[c]={move:a[c].move,difficulty:"WHITE"};return b}).unwrapper("endmaneuver");this.wrap_before("cleanupmaneuver",
a,function(){this.maneuver=b;this.cleanupmaneuver.unwrap(a);this.endnoaction(c,"TITLE");this.hasmoved=!1;this.newlock().done(function(){this.newlock().done(nextactivation);nextactivation()}.bind(this))});this.resolveactionmove(f,function(b,c){-1===c?c=0:this.ia&&(c=a.maneuverchoice);this.maneuver=h[c];this.resolvemaneuver()}.bind(this),!1,!0)}.bind(this)}],"",this.facultativeailerons))})}},{name:"Swarm Leader",unique:!0,points:3,type:Unit.ELITE,done:!0,init:function(b){var a=this;b.wrap_after("preattackroll",
this,function(b,e){var c=this.selectnearbyally(3,function(a,b){return b.canuseevade()&&b.isinfiringarc(e)?!0:!1}),h=0;0<c.length&&(h++,c[0].removeevadetoken());1<c.length&&(h++,c[1].removeevadetoken());this.log("+%1 attack die [%0]",h,a.name);this.wrap_after("getattackstrength",this,function(a,b,c){return c+h}).unwrapper("attackroll")})}},{name:"Lightweight Frame",type:Unit.MOD,points:2,agilitymax:3,ship:"TIE",done:!0,init:function(b){var a=this;b.wrap_after("getdefensestrength",this,function(b,e,
f){getattackdice()>f&&ENGAGED&&(this.log("+1 defense roll [%0]",a.name),f+=1);return f})}},{name:"'Light Scyk' Interceptor",type:Unit.TITLE,points:-2,ship:"M3-A Interceptor",lostupgrades:[Unit.MOD],done:!0,init:function(b){this.deal=function(a,b){return $.Deferred().resolve({crit:a,face:Critical.FACEUP})};var a=[];b.installed=!0;b.wrap_after("getdial",this,function(b){if(0===a.length)for(var c=0;c<b.length;c++){var f=b[c].move,h=b[c].difficulty;f.match(/BL\d|BR\d/)&&(h="GREEN");a[c]={move:f,difficulty:h}}return a})}},
{name:"Hotshot Co-Pilot",type:Unit.CREW,points:4,done:!0,init:function(b){var a=this,c=function(){if(this.canusefocus()){this.log("- %0 %FOCUS% [%1]",this.focus,a.name);for(var b=0;b<this.focus;b++)this.removefocustoken()}};b.wrap_before("resolveattack",this,function(b,f){this.weapons[b].isprimary&&f.wrap_before("endmodifydefensestep",a,c)});b.wrap_before("isattackedby",this,function(b,f){f.wrap_before("endmodifyattackstep",a,c)})}},{name:"Trick Shot",type:Unit.ELITE,points:0,done:!0,init:function(b){var a=
this;b.wrap_after("getattackstrength",this,function(b,e,f){0<this.getobstructiondef(e)&&(this.log("obstructed attack => +1 die [%0]",a.name),f+=1);return f})}},{name:"Bistan",type:Unit.CREW,points:2,unique:!0,done:!0,faction:Unit.REBEL,init:function(b){b.wrap_after("modifyattackroll",this,function(a,b,e,f){2>=this.getrange(targetunit)&&(f=f+Unit.FCH_CRIT-Unit.FCH_HIT);return f});b.adddicemodifier(Unit.ATTACK_M,Unit.MOD_M,Unit.ATTACK_M,this,{req:function(a,c){return 2>=b.getrange(targetunit)}.bind(this),
aiactivate:function(a,b){return!0},f:function(a,b){0<Unit.FCH_hit(a)&&(this.unit.log("%HIT% -> %CRIT% [%0]",this.name),a=a+Unit.FCH_CRIT-Unit.FCH_HIT);return a}.bind(this),str:"hit"})}},{name:"Expertise",type:Unit.ELITE,rating:2,points:4,done:!0,init:function(b){b.wrap_after("modifyattackroll",this,function(a,b,e,f){0===this.stress&&Unit.FCH_focus(f)&&(f+=(Unit.FCH_HIT-Unit.FCH_FOCUS)*Unit.FCH_focus(f));return f});b.adddicemodifier(Unit.ATTACK_M,Unit.MOD_M,Unit.ATTACK_M,this,{req:function(a,c){return 0===
b.stress}.bind(this),aiactivate:function(a,b){return 0<Unit.FCH_focus(a)},f:function(a,b){0<Unit.FCH_focus(a)&&(this.unit.log("%FOCUS% -> %HIT% [%0]",this.name),a+=Unit.FCH_focus(a)*(Unit.FCH_HIT-Unit.FCH_FOCUS));return a}.bind(this),str:"focus"})}},{name:"BoShek",type:Unit.CREW,points:2},{name:"Pulsed Ray Shield",type:Unit.MOD,faction:"REBEL|SCUM",points:2,init:function(b){var a=this;b.wrap_before("endphase",this,function(){this.donoaction([{org:a,type:"SHIELD",name:a.name,action:function(b){a.unit.log("+1 %ION%, +1 %SHIELD% [%0]",
a.name);a.unit.addiontoken();a.unit.addshield(1);this.endnoaction(b,"SHIELD")}.bind(this)}],"",!0)})}},{name:"Arc Caster",type:Unit.CANNON,faction:"REBEL|SCUM",range:[1,1],attack:4,canbeswitched:function(){return!1},points:2},{name:"Cikatro Vizago",type:Unit.CREW,unique:!0,faction:Unit.SCUM,points:0},{name:"Jabba The Hutt",unique:!0,done:!0,takesdouble:!0,type:Unit.CREW,faction:Unit.SCUM,points:5,init:function(b){for(var a in squadron)if(squadron[a].team==b.team){var c=squadron[a],e;for(e in c.upgrades)c.upgrades[e].type==
Unit.ILLICIT&&(c.log("x2 %0 [%1]",c.upgrades[e].name,this.name),c.upgrades[e].ordnance=1)}}},{name:"Advanced Optics",points:2,type:Unit.TECH,done:!0,init:function(b){var a=this;b.wrap_after("addfocustoken",this,function(){1<this.focus&&(this.log("1 %FOCUS% max [%0]",a.name),this.focus=1);this.showinfo()});b.wrap_after("resetfocus",this,function(){var b=0;0<this.focus&&(this.log("keep 1 %FOCUS% token [%0]",a.name),b=1);return b})}},{name:"StarViper Mk. II",done:!0,points:-3,type:Unit.TITLE,limited:!0,
ship:"StarViper",upgrades:[Unit.TITLE],init:function(b){b.getrollmatrix=function(a){var b,e=[a];for(b=-20;20>=b;b+=20)var f=a.clone().translate(0,b).rotate(90,0,0),h=a.clone().translate(0,b).rotate(-90,0,0),e=e.concat([this.getpathmatrix(f,"BL1").rotate(-90,0,0),this.getpathmatrix(f,"BR1").rotate(-90,0,0),this.getpathmatrix(h,"BL1").rotate(90,0,0),this.getpathmatrix(h,"BR1").rotate(90,0,0)]);return e}}},{name:"Havoc",done:!0,points:0,type:Unit.TITLE,unique:!0,ship:"Scurrg H-6 Bomber",lostupgrades:[Unit.CREW],
upgrades:[Unit.SYSTEM,Unit.SALVAGED],init:function(b){b.getupgradelist=function(a){var c=Unit.prototype.getupgradelist.call(b,a);if(a==Unit.SALVAGED){a=[];for(var e=0;e<c.length;e++)UPGRADES[c[e]].unique&&a.push(c[e]);return a}return c}}},{name:"Harpoon Missiles",requires:"Target",consumes:!1,type:Unit.MISSILE,firesnd:"missile",attack:4,range:[2,3],done:!0,points:4,posthit:function(b,a,c){new Condition(b,this.unit,"Harpooned!")}},{name:"Cad Bane",type:Unit.CREW,points:2,upgrades:[Unit.BOMB],faction:Unit.SCUM,
unique:!0,done:!1},{name:"Cruise Missiles",requires:"Target",consumes:!1,type:Unit.MISSILE,firesnd:"missile",attack:1,range:[2,3],done:!0,points:3,getattack:function(){var b=this.attack,a=this.unit.lastmaneuver,c=this.unit.dial;-1!=a&&(a=parseInt(c[a].move.substr(-1)),b=4>=a?b+a:b+4);return b}},{name:"Trajectory Simulator",type:Unit.SYSTEM,points:1,done:!0,init:function(b){b.wrap_after("getbomblocation",this,function(a){return-1<a.indexOf("F1")?a.concat("RF5"):a})}},{name:"Bomblet Generator",done:!0,
img:"seismic.png",snd:"explode",width:16,height:8,size:15,unique:!0,explode:function(){if(phase==ACTIVATION_PHASE&&!this.exploded){for(var b=this.getrangeallunits(),a=0;a<b[1].length;a++)for(var c=squadron[b[1][a].unit],e=this.unit.rollattackdie(2,this,"hit"),f=0;2>f;f++)"hit"==e[f]?(c.log("+1 %HIT% [%0]",this.name),c.resolvehit(1),c.checkdead()):"critical"==e[a]?(c.log("+1 %CRIT% [%0]",this.name),c.resolvecritical(1),c.checkdead()):c.log("No damage from [%0]",this.name);this.explode_base();this.exploded=
!1}},drop:function(b,a){this.resolveactionmove(this.unit.getbombposition(b,this.size),function(b){this.display(0,0);this.unit.bombdropped(this);"undefined"!=typeof a&&this.unit.endnoaction(a,"DROP")}.bind(this),!1,!0)},type:Unit.BOMB,points:3,takesdouble:!0},{name:"Wookiee Commandos",type:Unit.CREW,points:1,faction:Unit.REBEL,done:!0,takesdouble:!0,init:function(b){b.adddicemodifier(Unit.ATTACK_M,Unit.REROLL_M,Unit.ATTACK_M,this,{dice:["focus"],n:function(){return 0<=b.activeweapon?Math.floor(b.weapons[b.activeweapon].lastattackroll/
Unit.FCH_FOCUS):0},req:function(a,b,e){return this.isactive}.bind(this)})}},{name:"Xg-1 Assault Configuration",type:Unit.TITLE,done:!0,upgrades:[Unit.CANNON,Unit.CANNON],points:1,ship:"Alpha-class Star Wing",init:function(b){for(var a=[],c=0;c<b.weapons.length;c++){var e=b.weapons[c];e.type==Unit.CANNON&&2>=e.points&&a.push(e)}b.canfire=function(){return(this.noattack<round||0<a.length)&&this.hasfired<this.maxfired&&!this.iscloaked&&!this.isfireobstructed()}.bind(b);b.getactiveweapons=function(b){return this.noattack<
round?this.weapons:a}.bind(b)}},{name:"Os-1 Arsenal Loadout",type:Unit.TITLE,done:!1,upgrades:[Unit.TORPEDO,Unit.MISSILE],points:2,ship:"Alpha-class Star Wing",getactiveordnance:function(b){for(var a=[],c=0;c<b.weapons.length;c++){var e=b.weapons[c];e.type!=Unit.TORPEDO&&e.type!=Unit.MISSILE||a.push(e)}return a},init:function(b){var a=this;b.canfire=function(){return(this.noattack<round||0<a.getactiveordnance(b).length)&&this.hasfired<this.maxfired&&!this.iscloaked&&!this.isfireobstructed()}.bind(b);
b.getactiveweapons=function(b){return this.noattack<round?this.weapons:a.getactiveordnance(this)}.bind(b)}},{name:"Flight-Assist Astromech",type:Unit.ASTROMECH,done:!0,points:1,init:function(b){b.wrap_before("endmaneuver",this,function(){if(this.candoaction()&&!this.collision&&!this.hascollidedobstacle()&&0==this.getenemiesinrange(this.weapons,this.selectnearbyenemy(3))[0].length){var a=[];this.candoboost()&&a.push(this.newaction(this.resolveboost,"BOOST"));this.candoroll()&&a.push(this.newaction(this.resolveroll,
"ROLL"));this.doaction(a,"free %BOOST% or %ROLL% action")}});for(var a=[],c=0;c<b.weapons.length;c++){var e=b.weapons[c];e.type==Unit.TURRET&&!1===e.isprimary&&(a.push(e),e.wrap_after("isTurret",this,function(){return!1}))}0!==a.length&&b.wrap_after("isTurret",this,function(a,b){return!1})}},{name:"First Order Vanguard",type:Unit.TITLE,done:!1,points:2,unique:!0,ship:"TIE Silencer",init:function(b){var a=this;b.adddicemodifier(Unit.ATTACK_M,Unit.REROLL_M,Unit.ATTACK_M,this,{dice:["blank","focus"],
n:function(){return 1},req:function(b,e,f){b=this.unit.getenemiesinrange(this.unit.weapons,this.unit.selectnearbyenemy(3))[0];1===b.length&&a.isactive&&this.unit.log("+1 reroll [%0]",a.name);return 1===b.length&&a.isactive}.bind(this)});b.adddicemodifier(Unit.DEFENSE_M,Unit.REROLL_M,Unit.DEFENSE_M,this,{dice:["blank","focus","evade"],req:function(){return a.isactive}.bind(this),n:function(){return 9},f:function(b,e){this.unit.log("reroll all dice results [%0]",a.name);a.desactivate();return{m:b,n:e}}.bind(this)})}},
{name:"Deflective Plating",type:Unit.MOD,done:!1,points:1,ship:"B/SF-17 Bomber"},{name:"Ordnance Silos",type:Unit.BOMB,done:!0,points:2,ship:"B/SF-17 Bomber",isBomb:function(){return!1},isWeapon:function(){return!1},init:function(b){for(var a=0;a<b.upgrades.length;a++){var c=b.upgrades[a];c.type.match(/Bomb/)&&(c.ordnance=3)}}},{name:"Vaksai",type:Unit.TITLE,done:!0,upgrades:[Unit.MOD,Unit.MOD],pointsupg:-1,points:0,ship:"Kihraxz Fighter",init:function(b){for(var a=0;a<b.upgradetype.length;a++)b.upgbonus[b.upgradetype[a]]=
this.pointsupg}},{name:"Linked Battery",type:Unit.CANNON,done:!0,points:2,limited:!0,isLarge:!1,isWeapon:function(){return!1},init:function(b){b.adddicemodifier(Unit.ATTACK_M,Unit.REROLL_M,Unit.ATTACK_M,this,{dice:["blank","focus"],n:function(){return 1},req:function(a,b,e){a=a.weapons[a.activeweapon];return this.isactive&&(a.isprimary||a.type==Unit.CANNON)}.bind(this)})}},{name:"Unguided Rockets",type:Unit.MISSILE,done:!0,points:2,attack:3,range:[1,3],firesnd:"missile",requires:"Focus",consumes:!1,
takesdouble:!0,init:function(b){var a=this;b.wrap_before("resolveattack",this,function(b,e){this.weapons[this.activeweapon]==a&&this.wrap_after("getdicemodifiers",this,function(a){for(var b=[],c=0;c<a.length;c++)a[c].from==Unit.ATTACK_M&&"focus"==a[c].str&&1==a[c].token&&b.push(a[c]);return b}).unwrapper("cleanupattack")})},desactivate:function(){return!1}}];var allunits=[],Unit=window.Unit||{},Upgrade=window.Upgrade||{},IAUnit=window.IAUnit||{},Snap=window.Snap||{},PILOTS=window.PILOTS||{},UPGRADES=window.UPGRADES||{};function Team(b){this.team=b;this.initiative=this.isia=this.isdead=!1;this.units=[];this.conditions=[];this.captain=null;this.faction=Unit.REBEL;this.allhits=this.allcrits=this.allevade=this.allred=this.allgreen=0}
Team.prototype={setia:function(){for(var b in squadron)if(squadron[b].team==this.team){for(var a in IAUnit.prototype)squadron[b][a]=IAUnit.prototype[a];squadron[b].IAinit()}this.ia=!0},setplayer:function(){for(var b in squadron)if(squadron[b].team==this.team)for(var a in IAUnit.prototype)"undefined"!=typeof Unit.prototype[a]&&(squadron[b][a]=Unit.prototype[a]);this.ia=!1},setfaction:function(b){$(".listunits .generic").remove();this.faction=b;$("#"+b+"select").prop("checked",!0);this.color=this.faction==
Unit.REBEL?RED:this.faction==Unit.EMPIRE?GREEN:YELLOW},changefaction:function(b,a){$("#rocks").hide();$("#debris").hide();$("#caroussel").show();if(this.faction!=b||1==a){for(var c in generics)generics[c].team==this.team&&delete generics[c];$("#totalpts").html(0);this.setfaction(b);displayfactionunits()}},setrocks:function(b){this.rocks="undefined"==typeof b?[-1,-1,-1]:b},displayrockdebris:function(b,a,c,e,f,h,l){var t=b%MAXROCKS+(b>=MAXROCKS?ROCKS.length:0),x=f[t].getBBox();a=b<MAXROCKS?MT(b*a/ROCKS.length+
a/ROCKS.length/4,c/4-x.height*e/2).scale(e,e):MT((b-MAXROCKS)*a/DEBRISCLOUD.length+a/DEBRISCLOUD.length/4,3*c/4-x.height*e/2).scale(e,e);f[t].transform(a);f[t].appendTo(h);f[t].hover(function(){f[t].attr({strokeWidth:12})},function(){f[t].attr({strokeWidth:3})});f[t].click(function(){var a=this.rocks.indexOf(b);if(-1<a)this.rocks[a]=-1,f[t].attr("fill",l);else{-1==this.rocks[0]?this.rocks[0]=b:-1==this.rocks[1]?this.rocks[1]=b:-1==this.rocks[2]&&(this.rocks[2]=b);if(-1<this.rocks[0]&&-1<this.rocks[1]&&
-1<this.rocks[2])for(a=0;3>a;a++){var c=OBSTACLES[a+3*(this.team-1)];c.g.remove();OBSTACLES[a+3*(this.team-1)]=new Rock(this.rocks[a],[c.tx,c.ty,c.alpha],this.team,a)}-1<this.rocks.indexOf(b)&&f[t].attr("fill",halftone(this.color))}}.bind(this))},selectrocks:function(){"undefined"==typeof this.rocks&&(this.rocks=[-1,-1,-1]);$(".aster").empty();for(var b=Snap(".aster"),a=[],c=b.g(),e=0,f=0,h=b.image(DEBRISIMG,0,0,256,256).pattern(0,0,256,256),l=b.image(ROCKIMG,0,0,256,256).pattern(0,0,256,256),t=0;t<
ROCKS.length+DEBRISCLOUD.length;t++){t<ROCKS.length?(a[t]=b.path(ROCKS[t]).attr({strokeWidth:3}),-1<this.rocks.indexOf(t)?a[t].attr({fill:halftone(this.color),stroke:this.color}):a[t].attr({fill:l,stroke:"#888"})):(a[t]=b.path(DEBRISCLOUD[t-ROCKS.length]).attr({strokeWidth:3}),-1<this.rocks.indexOf(t)?a[t].attr({fill:halftone(this.color),stroke:this.color}):a[t].attr({fill:h,stroke:"#888"}));var x=a[t].getBBox();e<x.width&&(e=x.width);f<x.height&&(f=x.height)}b=$(".aster").height();x=$(".aster").width();
f=b/2/f;x/e/ROCKS.length<f&&(f=x/e/ROCKS.length);for(t=0;t<ROCKS.length;t++)this.displayrockdebris(t,x,b,f,a,c,l);for(t=0;t<DEBRISCLOUD.length;t++)this.displayrockdebris(t+MAXROCKS,x,b,f,a,c,h)},checkdead:function(){var b,a=!0;for(b=0;b<this.units.length;b++)if(!this.units[b].dead){a=!1;break}return this.isdead=a},toggleplayer:function(b){this.isia=!this.isia},updatepoints:function(){var b=0;$("#listunits li").each(function(){var a=0;$(this).find(".pts").each(function(){a+=parseInt($(this).text())});
$(this).find(".upts span:first-child").html(a);b+=a});$(".upts span:nth-child(2)").html(b)},addunit:function(b){-1==b&&log("unknown addunit pilot "+pilots[b]);b=new Unit(this.team,b);$("#listunits").append(""+b);this.updatepoints()},tosquadron:function(b){var a,c,e=this.sortedgenerics(),f=0,h=0;for(a in generics)1==generics[a].team&&f++;this.captain=null;for(a=0;a<e.length;a++)if(this.team==e[a].team){e[a].id=h++;2==e[a].team&&(e[a].id+=f);var l=e[a];for(c in PILOTS[l.pilotid]){var t=PILOTS[l.pilotid];
"function"==typeof t[c]&&(l[c]=t[c])}l.tosquadron(b);allunits.push(l);squadron.push(l);this.units.push(l)}for(a in squadron)l=squadron[a],l.team==this.team&&"function"==typeof l.init&&l.init();for(a in squadron)if(l=squadron[a],l.team==this.team)for(c=0;c<l.upgrades.length;c++)b=l.upgrades[c],0<=b.id&&"function"==typeof UPGRADES[b.id].uninstall&&UPGRADES[b.id].uninstall(l),"function"==typeof b.install&&b.install!==Upgrade.prototype.install&&b.install(l),Upgrade.prototype.install.call(b,l);for(a in squadron)if(l=
squadron[a],l.team==this.team)for(c=0;c<l.upgrades.length;c++)b=l.upgrades[c],"function"!=typeof b.init||l.isdocked||b.init(l);this.units.sort(function(a,b){return b.getskill()-a.getskill()});this.history={title:{text:UI_translation["Damage taken per turn"]},axisX:{interval:1,title:UI_translation.Turns},axisY:{title:UI_translation["Cumulated damage"]},rawdata:[],data:[{indexLabelFontColor:"darkSlateGray",name:"views",type:"area",color:"rgba(200,10,10,0.8)",markerSize:8,dataPoints:[]}]};return this.units},
endsetup:function(){var b;for(b=0;b<this.units.length;b++)this.units[b].g.undrag()},endselection:function(b){var a=this.team;this.name=$("#teamname"+this.team).val();""==this.name&&(this.name="Squad #"+a);$("#team"+a).empty();$("#importexport"+a).remove();var c=this.tosquadron(b);for(b=0;b<c.length;b++){if(1==a){if(0>=c[b].tx||0>=c[b].ty)c[b].tx=80-(c[b].islarge?20:0),c[b].ty=70+82*b,c[b].alpha=90;$("#team1").append('<div id="'+c[b].id+'" onclick=\'select($(this).attr("id"))\'>'+c[b]+"</div>")}else{if(0>=
c[b].tx||0>=c[b].ty)c[b].tx=GW-80+(c[b].islarge?20:0),c[b].ty=70+82*b,c[b].alpha=-90;$("#team2").append('<div id="'+c[b].id+'" onclick=\'select("'+c[b].id+"\")'>"+c[b]+"</div>")}c[b].m.translate(c[b].tx,c[b].ty).rotate(c[b].alpha,0,0);c[b].show()}$("#team"+a).css("top",$("nav").height()+2);activeunit=c[0]},sortedgenerics:function(){var b=[],a;for(a in generics)generics[a].team==this.team&&b.push(generics[a]);b.sort(function(a,b){"undefined"==typeof a.points&&log("undefined score");return a.points<
b.points?-1:a.points>b.points?1:a.toJuggler(!1)<b.toJuggler(!1)});return b},toASCII:function(){for(var b="",a=this.sortedgenerics(),c=0;c<a.length;c++)b+=a[c].toASCII()+";";return b},toKey:function(){var b="",a=[],c;for(c in generics)generics[c].team==this.team&&a.push(generics[c]);a.sort(function(a,b){return a.pilotid-b.pilotid});for(c=0;c<a.length;c++)b+=a[c].toKey()+";";return b},toJSON:function(){var b={description:""};b.faction={REBEL:"rebels",SCUM:"scum",EMPIRE:"empire"}[this.faction];b.name=
this.name;for(var a=[],c=0,e=this.sortedgenerics(),f=0;f<e.length;f++){var h=e[f].toJSON(),c=c+h.points;a.push(h)}b.pilots=a;this.points=b.points=c;b.vendor={xwsbenchmark:{builder:"Squadron Benchmark",builder_url:"http://baranidlo.github.io/bench/"}};b.version="0.3.0";return b},toJuggler:function(b,a){for(var c="",e=this.sortedgenerics(),f=0;f<e.length;f++)c+=e[f].toJuggler(b,a)+"\n";return c},parseJuggler:function(b,a){var c,e,f,h;c=-1;var l=function(a){return a==Unit.REBEL?1:a==Unit.SCUM?2:4};c=
7;if(""!=b){var t=b.trim().split("\n");for(e in generics)generics[e].team==this.team&&delete generics[e];for(e=0;e<t.length;e++){var x=t[e].split(/\s+\+\s+/),q=0;for(f=0;f<PILOTS.length;f++){var m=PILOTS[f].name;h=translate(m);var r="";1==PILOTS[f].ambiguous&&"undefined"!=typeof PILOTS[f].edition&&(r="("+PILOTS[f].edition+")");h+=r;m+=r;m.replace(/\'/g,"")==x[0]&&(q|=l(PILOTS[f].faction));h.replace(/\'/g,"")==x[0]&&(q|=l(PILOTS[f].faction))}c&=q}this.faction=1==(c&1)?Unit.REBEL:2==(c&2)?Unit.SCUM:
Unit.EMPIRE;this.color=this.faction==Unit.REBEL?RED:this.faction==Unit.EMPIRE?GREEN:YELLOW;for(e=0;e<t.length;e++){c=-1;x=t[e].split(/\s+\+\s+/);for(f=0;f<PILOTS.length;f++)if(h=m=PILOTS[f].name,r="",PILOTS[f].faction==this.faction){h=translate(m);1==PILOTS[f].ambiguous&&"undefined"!=typeof PILOTS[f].edition&&(r="("+PILOTS[f].edition+")");m+=r;h+=r;if(m.replace(/\'/g,"")==x[0]){c=f;break}if(h.replace(/\'/g,"")==x[0]){c=f;a=!0;break}}-1==c&&console.log("pid undefined:"+a+"!!"+x[0]+"!!"+this.faction);
-1==c&&log("unknown Juggler pilot:"+t[e]+"/"+b);m=new Unit(this.team,c);m.upg=[];for(f=0;20>f;f++)m.upg[f]=-1;"undefined"==typeof m.pilotid&&(console.log(c+" "+m.name+" "+m.pilotid),console.trace());r=[Unit.TITLE,Unit.MOD].concat(PILOTS[m.pilotid].upgrades);for(f=1;f<x.length;f++)for(h=0;h<UPGRADES.length;h++){if((1==a&&translate(UPGRADES[h].name).replace(/\'/g,"").replace(/\(Crew\)/g,"")==x[f]||UPGRADES[h].name.replace(/\'/g,"")==x[f])&&-1<r.indexOf(UPGRADES[h].type)){"undefined"!=typeof UPGRADES[h].upgrades&&
("Cannon|Torpedo|Missile"==UPGRADES[h].upgrades[0]?(r=r.concat([Unit.CANNON,Unit.TORPEDO,Unit.MISSILE]),m.upgradetype=m.upgradetype.concat([Unit.CANNON,Unit.TORPEDO,Unit.MISSILE])):(r=r.concat(UPGRADES[h].upgrades),m.upgradetype=m.upgradetype.concat(UPGRADES[h].upgrades)));break}h==UPGRADES.length&&log("UPGRADE undefined: "+x[f])}for(f=1;f<x.length;f++)for(h=0;h<UPGRADES.length;h++)if(1==a&&translate(UPGRADES[h].name).replace(/\'/g,"").replace(/\(Crew\)/g,"")==x[f]||UPGRADES[h].name.replace(/\'/g,
"")==x[f])if(-1<r.indexOf(UPGRADES[h].type)){for(c=0;c<m.upgradetype.length;c++)if(m.upgradetype[c]==UPGRADES[h].type&&-1==m.upg[c]){m.upg[c]=h;break}break}else log("** "+x[f]+" UPGRADE not listed: "+UPGRADES[h].type+" in "+m.name+"/"+b)}}},parseASCII:function(b){b=b.split(";");for(var a in generics)generics[a].team==this.team&&delete generics[a];for(a=0;a<b.length-1;a++){var c=b[a].split(":"),e=c[0].split(","),f=parseInt(e[0],10);this.faction=PILOTS[f].faction;this.color=this.faction==Unit.REBEL?
RED:this.faction==Unit.EMPIRE?GREEN:YELLOW;-1==f&&log("unknown ASCII pilot "+b[a]);f=new Unit(this.team,f);f.upg=[];for(var h=0;10>h;h++)f.upg[h]=-1;for(h=1;h<e.length;h++){for(var l=parseInt(e[h],10),t=0;t<f.upgradetype.length;t++)if(f.upgradetype[t]==UPGRADES[l].type&&-1==f.upg[t]){f.upg[t]=l;break}f.upg[t]==l&&"undefined"!=typeof UPGRADES[l].upgrades&&(f.upgradetype="Cannon|Torpedo|Missile"==UPGRADES[l].upgrades[0]?f.upgradetype.concat([Unit.CANNON,Unit.TORPEDO,Unit.MISSILE]):f.upgradetype.concat(UPGRADES[l].upgrades))}1<
c.length&&(c=c[1].split(","),f.tx=parseInt(c[0],10),f.ty=parseInt(c[1],10),f.alpha=parseInt(c[2],10))}},parseJSON:function(b,a){var c,e={rebel:Unit.REBEL,scum:Unit.SCUM,imperial:Unit.EMPIRE};try{c="string"==typeof b?$.parseJSON(b):b,ga("send","event",{eventCategory:"social",eventAction:"receive",eventLabel:"xws"})}catch(y){return this.parseJuggler(b,a)}var f,h,l;this.name=c.name;this.points=c.points;this.faction=e[c.faction];this.color=this.faction==Unit.REBEL?RED:this.faction==Unit.REBEL?GREEN:YELLOW;
for(f in generics)generics[f].team==this.team&&delete generics[f];for(f=0;f<c.pilots.length;f++){var t=c.pilots[f],x,e=-1;t.team=this.team;null!=t.name.match(/-/)&&(t.name=t.name.split("-")[0]);for(h=0;h<PILOTS.length;h++)if(PILOTS[h].faction==this.faction&&PILOTS[h].unit==PILOT_dict[t.ship]&&PILOTS[h].name==PILOT_dict[t.name]){e=h;break}if(-1==e)throw"pid undefined:"+PILOT_dict[t.name]+"-"+t.name+"/"+this.faction+"/"+PILOT_dict[t.ship];x=new Unit(this.team,e);x.upg=[];for(h=0;10>h;h++)x.upg[h]=-1;
if("undefined"!=typeof t.upgrades){var q=0;for(h in t.upgrades){var m=t.upgrades[h];for(l=0;l<m.length;l++){q++;for(var r=0;r<UPGRADES.length;r++)if(UPGRADES[r].name==UPGRADE_dict[m[l]]){for(e=0;e<x.upgradetype.length;e++)if(x.upgradetype[e]==UPGRADES[r].type&&-1==x.upg[e]){x.upg[e]=r;break}break}}}}}}};var a1=[.25,.375];a1[10]=.125;a1[100]=.25;var d1=[.375,.375];d1[10]=.25;function addattackdice(b,a){var c,e,f,h,l=[];for(c=0;c<b;c++)for(f=0;f<b-c;f++)for(e=0;e<b-f-c;e++)h=100*c+f+10*e,l[h]=0,l[h+1]=0,l[h+10]=0,l[h+100]=0;for(c=0;c<b;c++)for(f=0;f<b-c;f++)for(e=0;e<b-f-c;e++)h=100*c+f+10*e,l[h]+=a[h]*a1[0],l[h+1]+=a[h]*a1[1],l[h+10]+=a[h]*a1[10],l[h+100]+=a[h]*a1[100];return l}
function adddefensedice(b,a){var c,e,f,h=[];for(c=0;c<b;c++)for(e=0;e<b-c;e++)f=10*c+e,h[f]=0,h[f+1]=0,h[f+10]=0;for(c=0;c<b;c++)for(e=0;e<b-c;e++)f=10*c+e,h[f]+=a[f]*d1[0],h[f+1]+=a[f]*d1[1],h[f+10]+=a[f]*d1[10];return h}function attackproba(b){var a,c=[];c[0]=a1[0];c[1]=a1[1];c[10]=a1[10];c[100]=a1[100];for(a=2;a<=b;a++)c=addattackdice(a,c);return c}function defenseproba(b){var a,c=[];c[0]=d1[0];c[1]=d1[1];c[10]=d1[10];for(a=2;a<=b;a++)c=adddefensedice(a,c);return c}
function attackwithreroll(b,a,c){var e,f,h,l,t,x,q,m,r=[];if(0==b.reroll||"undefined"==typeof b.reroll)return a;for(e=0;e<=c;e++)for(f=0;f<=c-e;f++)for(h=0;h<=c-f-e;h++)q=100*e+f+10*h,r[q]=0;var y,B;for(e=0;e<=c;e++)for(f=0;f<=c-e;f++)for(h=0;h<=c-f-e;h++)if(q=100*e+f+10*h,l=c-f-h-e,B=b.reroll,y=e,b.reroll>l&&(0==b.focus?b.reroll>e+l?(B=e+l,y=0):y=e-(B-l):B=l),0==B)r[q]+=a[q];else for(l=0;l<=B;l++)for(t=0;t<=B-l;t++)for(x=0;x<=B-l-t;x++)m=100*l+t+10*x,r[100*(y+l)+f+t+10*(h+x)]+=a[q]*ATTACK[B][m];
return r}function defendwithreroll(b,a,c){var e,f,h,l,t,x,q=[];if(0==b.reroll||"undefined"==typeof b.reroll)return a;for(e=0;e<=c;e++)for(f=0;f<=c-e;f++)q[10*e+f]=0;var m,r;for(e=0;e<=c;e++)for(f=0;f<=c-e;f++)if(t=10*e+f,h=c-f-e,r=b.reroll,m=e,b.reroll>h&&(0==b.focus?b.reroll>e+h?(r=e+h,m=0):m=e-(r-h):r=h),0==r)q[t]+=a[t];else for(h=0;h<=r;h++)for(l=0;l<=r-h;l++)x=10*h+l,k=10*(m+h)+f+l,q[k]+=a[t]*DEFENSE[r][x];return q}
function tohitproba(b,a,c,e,f,h,l,t){var x=[],q,m,r,y,B,z,E,G,I,F=0,D=0,H=0,M,N=f,L=h;f=0==l?[]:f;for(m=0;m<=h;m++)for(r=0;r<=h-m;r++)z=m+10*r,x[z]=0;"undefined"==typeof t&&(t=!1);if("undefined"==typeof e)return{proba:[],tohit:0,meanhit:0,meancritical:0,tokill:0};0<l&&(N=defendwithreroll(c,f,l));for(q=0;q<=h;q++)for(m=0;m<=h-q;m++)for(r=0;r<=h-m-q;r++){G=Unit.FCH_FOCUS*q+Unit.FCH_CRIT*r+Unit.FCH_HIT*m;var O,S,ka=b.focus,sa=b.reroll;"undefined"!=typeof b.attackrerolls&&(b.reroll=Math.max(b.attackrerolls(a,
c),b.reroll));M=attackwithreroll(b,e,h);var W=M[Unit.FCH_FOCUS*q+Unit.FCH_HIT*m+Unit.FCH_CRIT*r];G=a.modifyattackroll(G,h,c);"undefined"!=typeof b.modifyattackroll&&(G=b.modifyattackroll(G,h,c));y=Unit.FCH_focus(G);M=Unit.FCH_crit(G);G=Unit.FCH_hit(G);0<b.focus&&0<y&&(G+=y,b.focus--);for(O=0;O<=l;O++)for(S=0;S<=l-O;S++){var ma=c.evade,pa=c.focus;z=Unit.FE_FOCUS*O+Unit.FE_EVADE*S;y=0==l?1:N[z];"undefined"!=typeof b.modifydefenseroll&&(z=b.modifydefenseroll(b,z,l));B=Unit.FE_focus(z);I=Unit.FE_evade(z);
z=0;0<c.focus&&0<B&&I<G+M&&(I+=B,c.focus--);0<c.evade&&I<G+M&&(I+=1,c.evade--);"undefined"!=typeof c.cancelhit?(z=c.cancelhit({ch:G*Unit.FCH_HIT+M*Unit.FCH_CRIT,e:I},targetunit),z=c.cancelcritical(z,targetunit),z=z.ch):(G>I?(z=Unit.FCH_HIT*(G-I),I=0):I-=G,M>I&&(z+=Unit.FCH_CRIT*(M-I)));"function"==typeof a.modifyhit&&0<z&&(z=a.modifyhit(z));b.reroll=0;if("function"==typeof a.followupattack&&0==t)for(E in B=tohitproba(b,a,c,e,f,h,l,!0),L=2*h,B.proba)I=z+1*E,"undefined"==typeof x[I]&&(x[I]=0),x[I]+=
B.proba[E]*W*y;else x[z]+=W*y;c.focus=pa;c.evade=ma}b.focus=ka;b.reroll=sa}for(m=0;m<=L;m++)for(r=0;r<=L-m;r++)z=Unit.FCH_HIT*m+Unit.FCH_CRIT*r,0<z&&"undefined"!=typeof x[z]&&(F+=x[z]),D+=m*x[z],H+=r*x[z];return{proba:x,tohit:Math.floor(1E4*F)/100,meanhit:0==F?0:Math.floor(100*D)/100,meancritical:0==F?0:Math.floor(100*H)/100}};var cmd=[],startreplayall=function(){if(0!=REPLAY.length){try{FAST="W"!=REPLAY.substr(-1)&&window.self==window.top,window.self!=window.top&&console.log("REPLAY in FRAME: "+FAST)}catch(a){FAST=!1}ANIM=REPLAY;cmd=LZString.decompressFromEncodedURIComponent(decodeURI(window.location.search.substr(1))).split("&")[6].split("_");cmd.splice(0,1);if(0!=cmd.length){$(".nextphase").prop("disabled",!0);$(".unit").css("cursor","pointer");actionrlock=$.Deferred();actionrlock.progress(replayall);1==TEAMS[1].isia&&
TEAMS[1].setia();1==TEAMS[2].isia&&TEAMS[2].setia();subphase=ACTIVATION_PHASE;for(var b in squadron)squadron[b].hasmoved=!1,squadron[b].maneuver=-1,squadron[b].hasdecloaked=!1;replayall()}}},stopreplay=function(){actionrlock=$.Deferred()},restartreplay=function(){ga("send","event",{eventCategory:"interaction",eventAction:"replay",eventLabel:"replay"});actionrlock=$.Deferred();actionrlock.progress(replayall);replayall()},replayall=function(){if(""==cmd){FAST=!1;filltabskill();if(phase!=SETUP_PHASE)setphase();
else{$(".imagebg").hide();$(".nextphase").prop("disabled",!1);for(var b=0;b<OBSTACLES.length;b++)OBSTACLES[b].addDrag();1==TEAMS[1].isia&&TEAMS[1].setplayer();1==TEAMS[2].isia&&TEAMS[2].setplayer();displayplayertype(1);displayplayertype(2)}INREPLAY=!1}else{INREPLAY=!0;var a=cmd[0].split("-");console.log(cmd[0]);cmd.splice(0,1);var c=null,e;if(0<a[0].length){c=parseInt(a[0],10);for(e in squadron)if(squadron[e].id==c)break;if(squadron[e].id==c)c=squadron[e];else{console.log("cannot find id "+c);actionrlock.notify();
return}}var f={fo:"removefocustoken",FO:"addfocustoken",e:"removeevadetoken",E:"addevadetoken",ct:"removecloaktoken",CT:"addcloaktoken",i:"removeiontoken",I:"addiontoken",tb:"removetractorbeamtoken",TB:"addtractorbeamtoken",ST:"addstress",DPY:"deploy",st:"removestresstoken",d:"dies"};if("string"==typeof f[a[1]])b=Unit.prototype[f[a[1]]],"function"==typeof b.vanilla?b.vanilla.call(c,h):b.call(c),actionrlock.notify();else switch(a[1]){case "W":break;case "P":h=parseInt(a[2],10);phase=parseInt(a[3],
10);if(round!=h)for(b in $("#turnselector").append("<option value='"+round+"'>"+UI_translation["turn #"]+round+"</option>"),round=h,squadron)c=squadron[b],c.focus=Unit.prototype.resetfocus.call(c),c.evade=Unit.prototype.resetevade.call(c),c.tractorbeam=Unit.prototype.resettractorbeam.call(c),c.showinfo();phase==SETUP_PHASE+1&&1==h&&endsetupphase();$("#phase").html(UI_translation["turn #"]+round+" "+UI_translation["phase"+phase]);actionrlock.notify();break;case "L":FAST?actionrlock.notify():(b=decodeURIComponent(a[2].substring(2,
a[2].length-2)),c.setinfo(b).delay(1500).fadeOut(400),setTimeout(function(){actionrlock.notify()},2E3));break;case "t":for(e in squadron)if(squadron[e].id==parseInt(a[2],10))break;if(squadron[e].id!=parseInt(a[2],10)){console.log("cannot find target "+a[2]);actionrlock.notify();break}var h=squadron[e];"function"==typeof Unit.prototype.removetarget.vanilla?Unit.prototype.removetarget.vanilla.call(c,h):Unit.prototype.removetarget.call(c,h);actionrlock.notify();break;case "T":for(e in squadron)if(squadron[e].id==
parseInt(a[2],10))break;if(squadron[e].id!=parseInt(a[2],10)){console.log("cannot find target "+a[2]);actionrlock.notify();break}h=squadron[e];"function"==typeof Unit.prototype.addtarget.vanilla?Unit.prototype.addtarget.vanilla.call(c,h):Unit.prototype.addtarget.call(c,h);actionrlock.notify();break;case "R":c.setarcrotate(parseInt(a[2],10));actionrlock.notify();break;case "s":Unit.prototype.removeshield.call(c,parseInt(a[2],10));c.show();actionrlock.notify();break;case "S":Unit.prototype.addshield.call(c,
parseInt(a[2],10));c.show();actionrlock.notify();break;case "h":Unit.prototype.removehull.call(c,parseInt(a[2],10));c.show();actionrlock.notify();break;case "H":Unit.prototype.addhull.call(c,parseInt(a[2],10));c.show();actionrlock.notify();break;case "f":c.select();for(e in squadron)if(squadron[e].id==parseInt(a[2],10))break;squadron[e].id!=parseInt(a[2],10)?(console.log("cannot find target unit "+a[2]),actionrlock.notify()):(targetunit=squadron[e],c.activeweapon=parseInt(a[3],10),FAST||c.playfiresnd(),
setTimeout(function(){actionrlock.notify()},FAST?0:1E3));break;case "am":c.select();c.m=(new Snap.Matrix).translate(a[2]-300,a[3]-300).rotate(a[4],0,0);c.g.transform(c.m);c.geffect.transform(c.m);actionrlock.notify();break;case "c":(new Critical(c,parseInt(a[2],10))).faceup();actionrlock.notify();break;case "D":c.upgrades[parseInt(a[2],10)].desactivate();actionrlock.notify();break;case "m":c.select();var b=a[2],l=parseInt(a[4],10),t=c.m,x=P[b].path;if(FAST){c.m=c.getmatrixwithmove(t,x,l);c.m.rotate(parseFloat(a[3],
0,0),0,0);c.g.transform(c.m);c.geffect.transform(c.m);actionrlock.notify();break}SOUNDS[c.ship.flysnd].play();Snap.animate(0,l,function(a){a=this.getmatrixwithmove(t,x,a);this.g.transform(a);this.geffect.transform(a)}.bind(c),TIMEANIM*l/200,mina.linear,function(){this.m=this.getmatrixwithmove(t,x,l);this.m.rotate(parseFloat(a[3]),0,0);this.g.transform(this.m);this.geffect.transform(this.m);actionrlock.notify()}.bind(c));break;default:console.log("unknown cmd:"+a[1]),FAST=!1,filltabskill(),setphase(phase==
SETUP_PHASE)}}};var phase=1,subphase=0,round=1,skillturn=0,tabskill,VERSION="v0.99.2",LANG="en",FILTER="none",DECLOAK_PHASE=1,WEBSITE="https://baranidlo.github.io/bench/main.html",DICES="focusred hitred criticalred blankred focusgreen evadegreen blankgreen".split(" "),SETUP_PHASE=2,PLANNING_PHASE=3,ACTIVATION_PHASE=4,COMBAT_PHASE=5,SELECT_PHASE=1,CREATION_PHASE=6,XP_PHASE=7,MAIN_PHASE=0,BOMBS=[],ROCKDATA="",WINCOND=0,INREPLAY=!1,allunits=[],PILOT_translation,SHIP_translation,CRIT_translation,UI_translation,UPGRADE_translation,
PILOT_dict,UPGRADE_dict,RATINGS_upgrades,RATINGS_ships,RATING_pilots,TOP_squads,CC,actionr=[],actionrlock,HISTORY=[],replayid=0,dice=1,ATTACK=[],DEFENSE=[],SEARCHINGSQUAD,FACTIONS={rebel:"REBEL",empire:"EMPIRE",scum:"SCUM"},SQUADLIST,SCENARIOLIST,TEAMS=[new Team(0),new Team(1),new Team(2),new Team(3)],currentteam=TEAMS[0],teamtarget=0,VIEWPORT,ANIM="",SETUP,SHOWDIAL=[],TRACE=!1,TEMPLATES={},HEADER="",SCENARIOTITLE="",WAVEFILTER="0",UNITFILTER={},ACTIONFILTER={},MOVEFILTER={},TEXTFILTER="",COSTFILTER=
50,UNIQUE=[],stype="",REPLAY="",PERMALINK="",Unit=window.Unit||{},metaUnit=window.metaUnit||{},PILOTS=window.PILOTS||{},UPGRADES=window.UPGRADES||{},Mustache=window.Mustache||{},SCENARIOS={"Battle of Yavin, the final":{text:"Here you are, Red 5, in the trench leading to the exhaust port. Destroy it ! Beware of the Imperial squad on your tail and of the ionization turrets. You have less than 12 turns.",link:"GQVgNAjA7AbAXBATFCZEA4AsYC0BOABgG5wDJYF0U1lcJ1jTz4II9EwQBmbYxcCCCiQuwvBDi1EXGGEJF+kISLETFXLmXm0Q6JcIii5EqOAzh58ZDGzI9+YsGAAzAIYAbAM4BTYABcAJwBXXwARb1c-AAtPP1cApwAhSL93bwACAHtndIBNVwA3AEsAOzB06IznUo9gAAlvAIyAT0yg9PjvcoAlbwATdPB00oqojMDvEoBjKPS01z7SgHMKzNGM7wAPKNcg2PSAB0yAvwA6dPDYgMzm4b90gEJ0xO8Ad06snMr0gEkAWwOjSKHnSngAjkEFlkSulWkEAhVXEV3B0SgNsuthpkSkUAF6RIrYirwpp+TznXJtdI7AoZNKeTyjVwwpDEgIlcnpACyrlu32cxymGQARhlXkVorCqQ9gEggA",
wincond:12},"A secret trench":{text:"A new death star has been built! There's a secret trench that leads to an exhaust port. You must destroy it before turn 10, take your best pilot with an agile ship.",link:"GQVgNAjALAHAXAZgAwCYwJWgnEg3OaeEKANjBCTAFod9JY4B2GRsKLa2ghhV2GMF3rwIJNIyisqUELhJwYINIrQ08wYADMAhgBsAzgFNgAFwBOAV2MARQ9pMALfSe1mUGgIIACIwGMzhiZe5oYAdr4OwN6hhgDuXgAmdo4+LmZeDtr6XgBGhmG5FgCWuiYAhF4AKg6GAQDk2do+hv6BwQHhDsGZQbp2CdkmAPZe2qFehgAemRbOXgAOQ2YmAHReAJpDFl4AtrNBSc5mQwCeXkVBeZpLhsEWZuMcwdoA1rcnW+l5c-MlQ0GxC5dMajADmJVu+gcRXmawAstozo5btczL5bnkvICUh9tmVgBAkEA",
wincond:10},"The Pirate Magic Roundabout":{link:"GQRgTAzANCAsAcMAMEBcBWJBOKmDsUAtCBOgNzjRyIgqoRYhQNhSzmUwLJrvQR4kULEgqQuNOuybowOQiLLAIYWMxVtWo2INy6sOeGVkF0cGDjDGAbAVhJryKNbIQSbLFUewysLIjlDHHRgADMAQwAbAGcAU2AAFwAnAFd4gBFY0NiAOwATWKTgYAAVAAtYgAIABQBLJPCEqoBZcIBzWoBjSoAlAHsU-PCAIwGE4ABBUKakyvDKyL6ctsqywYSoSoBPAcrQ2pyoyK29gfzKhIrKgAd6xqqc2OiEgDpKzOekvpPL2IBbOaRSIAQkqACFYgB3cJJKp9UIXK7hZ6FPq1PLRF7AJBAA",text:"After a long hunt, you finally find the pirate nest. Destroy all of them!",wincond:0},"Asteroid Field":{link:"GQFgHANCAMEEwHYBcYFwgZgKwEYIFoBOaAbnClkRThHkMIOLMhnmTBqh3SNODlR1a+AGy1SGaJA4iCI9CJJYQ6BGFn4wtOEpwIo9AoLAkBsEdB4h9cHErhYIOMBgJYb0YADMAhgBsAZwBTYAAXACcAVxCAYT8fAICASwBjAEJgYABBANCg8IB7JIATAAIvJKC-YuAYqICAC1LQhqSA0oAHSIA7AE9S8KCAIyrygvCUoIA6UoAVBqD+1uKg0qTu5oXShLzCktKhyNDSgBlxsoA1HxXw0oB3H27Q9u6C0qCADxTI4IzoIA",
text:"Crush this puny rebel force. They hide in the asteroid but Lord Vader wants no excuse!",wincond:0}},SETUPS={Classic:{background:"css/playmat10.jpg",zone1:"M 0 0 L 100 0 100 914.4 0 914.4 Z",zone2:"M 814.4 0 L 914.4 0 914.4 914.4 814.4 914.4 Z",playzone1:"M 0 0 L 914.4 0 914.4 914.4 0 914.4 Z",asteroids:6},"Cloud City":{background:"css/playmat6.jpg",zone1:"M 0 0 L 100 0 100 914.4 0 914.4 Z",zone2:"M 814.4 0 L 914.4 0 914.4 914.4 814.4 914.4 Z",playzone1:"M 0 0 L 914.4 0 914.4 914.4 0 914.4 Z",
asteroids:6},"Blue Sky":{background:"css/playmat13.jpg",zone1:"M 0 0 L 100 0 100 914.4 0 914.4 Z",zone2:"M 814.4 0 L 914.4 0 914.4 914.4 814.4 914.4 Z",playzone1:"M 0 0 L 914.4 0 914.4 914.4 0 914.4 Z",asteroids:0},"Blue Planet":{background:"css/playmat11.jpg",zone1:"M 0 0 L 100 0 100 914.4 0 914.4 Z",zone2:"M 814.4 0 L 914.4 0 914.4 914.4 814.4 914.4 Z",playzone1:"M 0 0 L 914.4 0 914.4 914.4 0 914.4 Z",asteroids:6},Mars:{background:"css/playmat14.jpg",zone1:"M 0 0 L 100 0 100 914.4 0 914.4 Z",zone2:"M 814.4 0 L 914.4 0 914.4 914.4 814.4 914.4 Z",
playzone1:"M 0 0 L 914.4 0 914.4 914.4 0 914.4 Z",asteroids:6},Defender:{playzone1:"M 0 0 L 914.4 0 914.4 914.4 0 914.4 Z",playzone2:"M340,450a110,110 0 1,0 220,0a110,110 0 1,0 -220,0",background:"css/playmat10.jpg",zone2:"M340,450a110,110 0 1,0 220,0a110,110 0 1,0 -220,0",zone1:"M 0 0 L 100 0 100 914.4 0 914.4 Z",asteroids:12},Deathstar:{playzone1:"M 0 200 L 1300 200 1300 400 1800 400 1800 200 2800 200 2800 360 1960 360 1960 560 1100 560 1100 360 0 360 Z",background:"css/deathstar.png",pattern:"css/deathstar2.png",
zone2:"M 0 200 L 100 200 100 360 0 360 Z",zone1:"M 500 200 L 600  200 600 360 500 360 Z",asteroids:0},Deathstar2:{playzone1:"M 12.241 24.907 L 803.813 24.907 C 861.372 36.696 884.737 73.238 873.908 134.534 C 867.964 168.18 604.249 421.618 188.337 459.88 C 57.346 471.931 307.368 724.082 701.233 804.672 C 746.071 813.845 823.307 826.148 873.908 822.354 C 883.509 821.635 888.068 844.03 887.586 889.544 C 887.569 891.228 727.43 885.923 407.173 873.629 C 243.345 867.341 68.391 771.86 15.662 523.532 C -7.502 414.436 60.669 277.644 241.335 293.67 C 518.775 318.28 758.698 119.655 747.395 113.317 C 747.395 113.317 509.751 112.728 34.467 111.549 C 6.27 111.48 -1.138 82.599 12.241 24.907 Z",
background:"css/deathstar.png",pattern:"css/deathstar2.png",zone1:"M 12 24 L 140 24 140 110 12 110 Z",zone2:"M 0 0",asteroids:0}};function setSetup(b){"undefined"!=typeof SETUPS[b]?(SETUP=SETUPS[b],SETUP.name=b):(SETUP=SETUPS.Classic,SETUP.name="Classic");"undefined"==typeof SETUP.playzone2&&(SETUP.playzone2=SETUP.playzone1)}
function changeimage(b){if(b.files&&b.files[0]){var a=new FileReader;a.onload=function(a){var b=ZONE[0].getBBox();a=s.image(a.target.result,0,0,b.w,b.h).pattern(0,0,b.w,b.h);ZONE[0].attr({fill:a,fillOpacity:1})};a.readAsDataURL(b.files[0])}}
function center(){var b=activeunit.g.getBBox(),a=b.x+b.width/2,c=b.y+b.height/2,b=$("#svgout").width(),e=$("#svgout").height(),f=0,h=0;e>b?h=(e-b)/2:f=(b-e)/2;var l=Math.min(b/GW,e/GH),t=f+VIEWPORT.m.x(a,c)*l,a=h+VIEWPORT.m.y(a,c)*l;if(0>t||t>b)VIEWPORT.m=MT((-t+b/2-f)/l,0).add(VIEWPORT.m);if(0>a||a>e)VIEWPORT.m=MT(0,(-a+e/2-h)/l).add(VIEWPORT.m);VIEWPORT.transform(VIEWPORT.m);activeunit.show()}
var save=function(){movelog("W");var b=WEBSITE+"?"+permalink(!1);$(".social").html(Mustache.render(TEMPLATES.social,{url:b,name:"save this link",encodedurl:encodeURI(b)}));"undefined"!=typeof gapi&&"undefined"!=typeof gapi.client&&"undefined"!=typeof gapi.client.urlshortener?gapi.client.urlshortener.url.insert({longUrl:b}).then(function(a){a=a.result.id;$(".tweet").show();$("#submission").contents().find("#entry_245821581").val(a);$("#submission").contents().find("#ss-form").submit();$(".social").html(Mustache.render(TEMPLATES.social,
{url:a,name:a,encodedurl:encodeURI(a)}))},function(a){$("#submission").contents().find("#ss-form").submit();console.log("Error: "+a.result.error.message)}):$("#submission").contents().find("#ss-form").submit()};
function translate(b){return"undefined"!=typeof PILOT_translation[b]&&"undefined"!=typeof PILOT_translation[b].name?PILOT_translation[b].name:"undefined"!=typeof PILOT_translation[b+" (Scum)"]&&"undefined"!=typeof PILOT_translation[b+" (Scum)"].name?PILOT_translation[b+" (Scum)"].name:"undefined"!=typeof UPGRADE_translation[b]&&"undefined"!=typeof UPGRADE_translation[b].name?UPGRADE_translation[b].name:"undefined"!=typeof UPGRADE_translation[b+"(Crew)"]&&"undefined"!=typeof UPGRADE_translation[b+
"(Crew)"].name?UPGRADE_translation[b+"(Crew)"].name:"undefined"!=typeof CRIT_translation[b]&&"undefined"!=typeof CRIT_translation[b].name?CRIT_translation[b].name:b}
function formatstring(b){return b.replace(/%HIT%/g,"<code class='hit'></code>").replace(/%ACTION%/g,"<b>Action:</b>").replace(/%STRESS%/g,"<code class='xstresstoken'></code>").replace(/%CRIT%/g,"<code class='critical'></code>").replace(/%EVADE%/g,"<code class='symbols'>e</code>").replace(/%FOCUS%/g,"<code class='symbols'>f</code>").replace(/%SHIELD%/g,"<code class='cshield'></code>").replace(/%HULL%/g,"<code class='chull'></code>").replace(/%ROLL%/g,"<code class='symbols'>r</code>").replace(/%TURNLEFT%/g,
"<code class='symbols'>4</code>").replace(/%TURNRIGHT%/g,"<code class='symbols'>6</code>").replace(/%BOOST%/g,"<code class='symbols'>b</code>").replace(/%ELITE%/g,"<code class='symbols'>E</code>").replace(/%ION%/g,"<code class='xionizedtoken'></code>").replace(/%BOMB%/g,"<code class='symbols'>B</code>").replace(/%STRAIGHT%/g,"<code class='symbols'>8</code>").replace(/%STOP%/g,"<code class='symbols'>5</code>").replace(/%TARGET%/g,"<code class='symbols'>l</code>").replace(/%TORPEDO%/g,"<code class='symbols'>P</code>").replace(/%CANNON%/g,
"<code class='symbols'>C</code>").replace(/%SYSTEM%/g,"<code class='symbols'>S</code>").replace(/%ILLICIT%/g,"<code class='symbols'>I</code>").replace(/%MISSILE%/g,"<code class='symbols'>M</code>").replace(/%TURRET%/g,"<code class='symbols'>U</code>").replace(/%BANKLEFT%/g,"<code class='symbols'>7</code>").replace(/%BANKRIGHT%/g,"<code class='symbols'>9</code>").replace(/%UTURN%/g,"<code class='symbols'>2</code>").replace(/%SLOOPLEFT%/g,"<code class='symbols'>1</code>").replace(/%SLOOPRIGHT%/g,"<code class='symbols'>3</code>").replace(/%TALONLEFT%/g,
"<code class='symbols'>;</code>").replace(/%TALONRIGHT%/g,"<code class='symbols'>:</code>").replace(/%ASTROMECH%/g,"<code class='symbols'>A</code>").replace(/%CREW%/g,"<code class='symbols'>W</code>").replace(/%MOD%/g,"<code class='symbols'>m</code>").replace(/%SLAM%/g,"<code class='symbols'>s</code>")}
function displayplayertype(b,a){TEAMS[b].isia?($("#player"+b+" option[value='computer']").prop("selected",!0),$("#player"+b+" option[value='computer']").text(UI_translation.computer)):($("#player"+b+" option[value='human']").prop("selected",!0),$("#player"+b+" option[value='human']").text(UI_translation.human));$("#playerteam"+b).text({REBEL:"x",EMPIRE:"y",SCUM:"z"}[TEAMS[b].faction])}
function nextunit(b,a,c,e){var f,h=!1,l=0;if(0>skillturn||12<skillturn)return c();for(f=0;f<tabskill[skillturn].length;f++){var t=tabskill[skillturn][f];if(b(t)&&1!=t.isdocked){h=!0;l=f;break}}if(!h){do if(a(tabskill),l=0,0<=skillturn&&12>=skillturn){for(;l<tabskill[skillturn].length&&(1==tabskill[skillturn][l].isdocked||!b(tabskill[skillturn][l]));)l++;l==tabskill[skillturn].length&&(l=-1)}while(0<=skillturn&&12>=skillturn&&-1==l)}if(0>skillturn||12<skillturn||-1==l)return c();barrier(function(){tabskill[skillturn][l].select();
e()})}function endphase(){for(var b in squadron)squadron[b].endphase();for(b in OBSTACLES)"undefined"!=typeof OBSTACLES[b].endphase&&OBSTACLES[b].endphase()}
function nextcombat(){nextunit(function(b){return b.canfire()},function(b){var a=!1;0<=skillturn&&skillturn--;for(var c=0;c<b[skillturn+1].length;c++){var e=b[skillturn+1][c];e.canbedestroyed(skillturn)&&e.checkdead()&&(a=!0)}a&&(b=TEAMS[1].checkdead(),a=TEAMS[2].checkdead(),b&&a?win(0):b?win(1):a&&win(2))},function(){return enablenextphase()},function(){activeunit.beginattack();activeunit.doattack()})}
function nextactivation(){nextunit(function(b){return b.candomaneuver()},function(){13>skillturn&&skillturn++},function(){return enablenextphase()},function(){activeunit.beginactivation();activeunit.doactivation()})}function nextdecloak(){nextunit(function(b){return b.candecloak()},function(){13>skillturn&&skillturn++},function(){return enablenextphase()},function(){activeunit.dodecloak()})}
function nextplanning(){nextunit(function(b){return-1==b.maneuver},function(){13>skillturn&&skillturn++},function(){return enablenextphase()},function(){activeunit.select();activeunit.doplan()})}function getattackresult(){var b=$(".hitreddice").length,a=$(".criticalreddice").length;return Unit.FCH_CRIT*a+Unit.FCH_HIT*b}function getdefenseresult(){return $(".evadegreendice").length+$(".evadegreen").length}
function addattackdie(b,a){for(var c=0;c<a;c++)$("#attack").append("<td class="+b+"reddice'></td>")}function adddefensedie(b,a){for(var c=0;c<a;c++)$("#defense").append("<td class="+b+"greendice'></td>")}function getattackdice(){return $(".focusreddice").length+$(".criticalreddice").length+$(".hitreddice").length+$(".blankreddice").length}function getattackvalue(){return $(".focusreddice").length*Unit.FCH_FOCUS+$(".criticalreddice").length*Unit.FCH_CRIT+$(".hitreddice").length*Unit.FCH_HIT}
function getdefensedice(){return $(".focusgreendice").length+$(".blankgreendice").length+$(".evadegreendice").length}function displaycombatdial(){$("#attackdial").empty();$("#dtokens").empty();$("#defense").empty();$("#combatdial").show()}
function addredclickchange(){var b=function(){$(this).hasClass("focusreddice")?($(this).removeClass("focusreddice"),$(this).addClass("hitreddice")):$(this).hasClass("blankreddice")?($(this).removeClass("blankreddice"),$(this).addClass("focusreddice")):$(this).hasClass("hitreddice")?($(this).removeClass("hitreddice"),$(this).addClass("criticalreddice")):$(this).hasClass("criticalreddice")&&($(this).removeClass("criticalreddice"),$(this).addClass("blankreddice"))};$(".focusreddice").click(b);$(".hitreddice").click(b);
$(".blankreddice").click(b);$(".criticalreddice").click(b)}
function displayattackroll(b,a){var c,e=0;for(c=0;c<DICES.length;c++)$("."+DICES[c]+"dice").remove();$("#attack").empty();for(c=0;c<Math.floor(b/100)%10;c++,e++)$("#attack").append("<td class='focusreddice'></td>");for(c=0;c<Math.floor(b/10)%10;c++,e++)$("#attack").append("<td class='criticalreddice'></td>");for(c=0;c<b%10;c++,e++)$("#attack").append("<td class='hitreddice'></td>");for(c=e;c<a;c++)$("#attack").append("<td class='blankreddice'></td>");addredclickchange()}
function displayattacktokens(b,a){$("#atokens").empty();var c=targetunit.getresultmodifiers(b.ar,b.ad,Unit.DEFENSE_M,Unit.ATTACK_M);0<c.length?($("#atokens").append(c),$("#atokens").append($("<button>").addClass("m-done").click(function(){displayattacktokens2(b,a)}))):displayattacktokens2(b,a)}
function displayattacktokens2(b,a){"function"!=typeof a?a=b.lastaf:b.lastaf=a;$("#atokens").empty();var c=b.getresultmodifiers(b.ar,b.ad,Unit.ATTACK_M,Unit.ATTACK_M);0<c.length?($("#atokens").append(c),$("#atokens").append($("<button>").addClass("m-done").click(function(){$("#atokens").empty();this.endmodifyattackstep();a(this)}.bind(b)))):a(b)}
function displaydefensetokens(b,a){$("#dtokens").empty();var c=activeunit.getresultmodifiers(b.dr,b.dd,Unit.ATTACK_M,Unit.DEFENSE_M);0<c.length?($("#dtokens").append(c),$("#dtokens").append($("<button>").addClass("m-done").click(function(){displaydefensetokens2(b,a)}))):displaydefensetokens2(b,a)}
function displaydefensetokens2(b,a){"function"!=typeof a&&(a=b.lastdf);b.lastdf=a;$("#dtokens").empty();var c=b.getresultmodifiers(b.dr,b.dd,Unit.DEFENSE_M,Unit.DEFENSE_M);FAST?displaycompareresults(b,a):($("#dtokens").append(c),$("#dtokens").append($("<button>").addClass("m-fire").click(function(){this.endmodifydefensestep();displaycompareresults(activeunit,a)}.bind(b))))}
function displaycompareresults(b,a){"function"!=typeof a&&(a=b.lastdf);b.lastdf=a;$("#dtokens").empty();var c=targetunit.getresultmodifiers(b.ar,b.ad,Unit.ATTACKCOMPARE_M,Unit.ATTACK_M),e=b.getresultmodifiers(b.ar,b.ad,Unit.ATTACKCOMPARE_M,Unit.ATTACK_M),f=b.getresultmodifiers(targetunit.dr,targetunit.dd,Unit.DEFENDCOMPARE_M,Unit.DEFENSE_M),h=targetunit.getresultmodifiers(targetunit.dr,targetunit.dd,Unit.DEFENDCOMPARE_M,Unit.DEFENSE_M);FAST||b.ia&&0==c.length&&0==h.length||0==c.length&&0==e.length&&
0==f.length&&0==h.length?($("#combatdial").hide(),a()):($("#dtokens").append(c).append(e).append(f).append(h),$("#dtokens").append($("<button>").addClass("m-fire").click(function(){$("#combatdial").hide();a()}.bind(b))))}function costfilter(b){COSTFILTER="undefined"==typeof b?10:parseInt(b,10);displayfactionunits(!0)}function wavefilter(b){WAVEFILTER=b;displayfactionunits(!0)}function unitfilter(b){"undefined"!=typeof UNITFILTER[b]?delete UNITFILTER[b]:UNITFILTER[b]=!0;displayfactionunits(!0)}
function actionfilter(b){"undefined"!=typeof ACTIONFILTER[b]?delete ACTIONFILTER[b]:ACTIONFILTER[b]=!0;displayfactionunits(!0)}function textfilter(b){TEXTFILTER=b;displayfactionunits(!0)}function addroll(b,a,c){if(c==Unit.DEFENSE_M)return addrolld(b,a);c=getattackdice();var e=$(".focusreddice").length,f=$(".hitreddice").length,h=$(".criticalreddice").length;b=b(100*e+10*h+f,c);displayattackroll(b.m,b.n);$("#atokens #mod"+a).remove()}
function addrolld(b,a){var c=getdefensedice(),e=$(".focusgreendice").length,f=$(".evadegreendice").length,c=b(10*e+f,c);displaydefenseroll(c.m,c.n);$("#dtokens #mod"+a).remove()}function modroll(b,a,c){if(c==Unit.DEFENSE_M)return modrolld(b,a);c=getattackdice();var e=$(".focusreddice").length,f=$(".hitreddice").length,h=$(".criticalreddice").length;b=b(100*e+10*h+f,c);displayattackroll(b,c);$("#atokens #mod"+a).remove()}
function modrolld(b,a){var c=getdefensedice(),e=$(".focusgreendice").length,f=$(".evadegreendice").length,e=b(10*e+f,c);displaydefenseroll(e,c);$("#dtokens #mod"+a).remove()}
function addgreenclickchange(){var b=function(){$(this).hasClass("focusgreendice")?($(this).removeClass("focusgreendice"),$(this).addClass("evadegreendice")):$(this).hasClass("blankgreendice")?($(this).removeClass("blankgreendice"),$(this).addClass("focusgreendice")):$(this).hasClass("evadegreendice")&&($(this).removeClass("evadegreendice"),$(this).addClass("blankgreendice"))};$(".focusgreendice").click(b);$(".evadegreendice").click(b);$(".blankgreendice").click(b)}
function displaydefenseroll(b,a){var c,e=0;$("#defense").empty();for(c=0;c<Math.floor(b/10);c++,e++)$("#defense").append("<td class='focusgreendice'></td>");for(c=0;c<b%10;c++,e++)$("#defense").append("<td class='evadegreendice'></td>");for(c=e;c<a;c++)$("#defense").append("<td class='blankgreendice'></td>");addgreenclickchange()}
function reroll(b,a,c,e,f){var h,l,t=0,x=["blank","focus","hit","critical"],q=["blank","focus","evade"];"function"==typeof e.f&&e.f();var m="";if(c==Unit.ATTACK_M){for(h=0;4>h;h++)if((!activeunit.hasnorerollmodifiers(a,c,getattackvalue(),getattackdice(),"focus")||"undefined"!=typeof e.mustreroll||"focus"!=x[h])&&-1<e.dice.indexOf(x[h]))if(l=$("."+x[h]+"reddice:not([noreroll])"),l.length<b)l.remove(),m+=("<span class='"+x[h]+"reddice'></span>").repeat(l.length),t+=l.length,b-=l.length;else{$("."+x[h]+
"reddice:lt("+b+"):not([noreroll])").remove();m+=("<span class='"+x[h]+"reddice'></span>").repeat(b);t+=b;b=0;break}m+=" -> ";$("#atokens #reroll"+f).remove();b=activeunit.rollattackdie(t);for(h=0;h<t;h++)m+="<span class='"+b[h]+"reddice'></span>",$("#attack").append("<td class='"+b[h]+"reddice' noreroll></td>");addredclickchange()}else{for(h=0;3>h;h++)if(("undefined"!=typeof e.mustreroll||!targetunit.hasnorerollmodifiers(a,c,getattackvalue(),getattackdice(),"focus")||"focus"!=x[h])&&-1<e.dice.indexOf(q[h]))if(l=
$("."+q[h]+"greendice:not([noreroll])"),l.length<b)l.remove(),t+=l.length,b-=l.length;else{$("."+x[h]+"greendice:lt("+b+"):not([noreroll])").remove();t+=b;b=0;break}$("#dtokens #reroll"+f).remove();activeunit.defenseroll(t).done(function(a){var b;for(b=0;b<Unit.FE_evade(a.roll);b++)$("#defense").append("<td class='evadegreendice'></td>");for(b=0;b<Unit.FE_focus(a.roll);b++)$("#defense").append("<td class='focusgreendice'></td>");for(b=0;b<Unit.FE_blank(a.roll,a.dice);b++)$("#defense").append("<td class='blankgreendice'></td>");
addgreenclickchange()})}}function next_replay(){var b=[];0<REPLAY.length&&(b=REPLAY[replayid].split("_"));return b}
function enablenextphase(){var b,a=!0;switch(phase){case SELECT_PHASE:b=parseInt($("#squad1points").text(),10);var c=parseInt($("#squad2points").text(),10);if(mode==FREECOMBAT&&(0==b||0==c)||mode==SCENARIO&&(0==b||0==$("#scenariolist tr.selected").length)||mode==SCENARIOCREATOR&&(0==c||""==SCENARIOTITLE||""==HEADER))a=!1,$(".nextphase").addClass("disabled");break;case PLANNING_PHASE:for(b in squadron)if(0>squadron[b].maneuver&&!squadron[b].isdocked){a=!1;break}a&&$(".nextphase").hasClass("disabled")&&
log(UI_translation["All units have planned a maneuver, ready to end phase"]);break;case ACTIVATION_PHASE:if(subphase!=ACTIVATION_PHASE){subphase=ACTIVATION_PHASE;skillturn=0;a=!1;for(b in squadron)squadron[b].enddecloak().done(nextactivation);barrier(nextactivation)}else{for(b in squadron)if(-1<squadron[b].maneuver&&!squadron[b].isdocked){a=!1;break}a&&$(".nextphase").hasClass("disabled")&&log(UI_translation["All units have been activated, ready to end phase"])}break;case COMBAT_PHASE:if(0>skillturn){$("#attackdial").hide();
for(b in squadron)squadron[b].endcombatphase();log(UI_translation["No more firing units, ready to end phase."]);barrier(endphase);a=!0}else a=!1}a&&$(".nextphase").removeClass("disabled");return a&&FAST&&phase>=SETUP_PHASE?nextphase():a}
function win(b){log("Squad "+b+" is destroyed!");movelog("W");var a="m-draw",c,e="",f="",h=0,l=0,t=!1,x=!1;for(c=0;c<allunits.length;c++){var q=allunits[c];q.dead||1!=q.team||(t=!0);q.dead||2!=q.team||(x=!0);if(q.dead||q.islarge&&q.shield+q.hull<(q.ship.hull+q.ship.shield)/2){var m=q.dead?q.points:q.points/2;1==q.team?(f+="<tr><td>"+q.name+(q.dead?"":" (1/2 points)")+"</td><td>"+m+"</td></tr>",l+=m):(e+="<tr><td>"+q.name+(q.dead?"":" (1/2 points)")+"</td><td>"+m+"</td></tr>",h+=m)}}0==t&&(l=100);
0==x&&(h=100);""==e&&(e="<tr><td class='m-nocasualty'></td><td>0</td></tr>");""==f&&(f="<tr><td class='m-nocasualty'></td><td>0</td></tr>");t=h-l;h=t+100;l=100-t;$(".victory-table").empty();$(".victory-table").append("<tr><th class='m-squad1'></th><th>"+h+"</th></tr>");$(".victory-table").append(e);$(".victory-table").append("<tr><th class='m-squad2'></th><th>"+l+"</th></tr>");$(".victory-table").append(f);if(0<t&&0>WINCOND||2==b&&(WINCOND>round||0==WINCOND))a="m-1win";else if(0>t&&0>WINCOND||1==
b&&(WINCOND>round||0==WINCOND))a="m-2win";$(".victory").addClass(a);b=(TEAMS[1].isia?"Computer":"Player")+":"+h+" "+(TEAMS[2].isia?"Computer":"Player")+":"+l;a=TEAMS[1].toJuggler(!1);a+="VS"+TEAMS[2].toJuggler(!1);a=a.replace(/\n/g,".");a=a.replace(/ \+ /g,"*");a=a.replace(/ /g,"_");e=encodeURI(WEBSITE+"?"+permalink(!1));$("#submission").contents().find("#entry_209965003").val(b);$("#submission").contents().find("#entry_390767903").val(a);$("#submission").contents().find("#entry_245821581").val("no short url");
$("#submission").contents().find("#entry_1690611500").val(e);$(".tweet").hide();save();for(c in["email","facebook","tweet","googlep"])(function(a){$("."+a).click(function(){ga("send","event",{eventCategory:"social",eventAction:"send",eventLabel:a})})})(c);$(".victory-link").attr("href",e);window.location="#modal"}function page_creation(){$("#selectphase").hide();$(".headlines").hide();$("#creation").show()}
function page_main(){$("#addcomment").hide();$(".buttonbar .share-buttons").hide();$(".h2 .share-buttons").show();$(".permalink").hide();$(".activeunit").prop("disabled",!0);$("#rightpanel").hide();$("#leftpanel").hide();$("#game").hide();$("nav").hide();$(".mainarticle").hide();$(".headlines").show();SCENARIOTITLE=HEADER="";currentteam.setfaction(Unit.REBEL);window.location="index.html"}
function page_select(){$("#creation").hide();$("nav").hide();$("#game").hide();$("#rightpanel").hide();$("#leftpanel").hide();$("#selectphase").show();$(".nextphase").addClass("disabled");enablenextphase();phase=SELECT_PHASE}
function createsquad(b){page_creation();var a=currentteam.faction;"undefined"!=typeof b&&(a=b);$(".activeunit").prop("disabled",!0);$("#consolecb").removeAttr("Checked");currentteam.changefaction(a);$(".factionselect selected").val(a);b={getdial:function(){return[{move:"TL1",difficulty:"WHITE"},{move:"BL1",difficulty:"WHITE"},{move:"F1",difficulty:"WHITE"},{move:"SL2",difficulty:"WHITE"},{move:"TL2",difficulty:"WHITE"},{move:"BL2",difficulty:"WHITE"},{move:"F2",difficulty:"WHITE"},{move:"K2",difficulty:"WHITE"},
{move:"SL3",difficulty:"WHITE"},{move:"TL3",difficulty:"WHITE"},{move:"BL3",difficulty:"WHITE"},{move:"F3",difficulty:"WHITE"},{move:"K3",difficulty:"WHITE"},{move:"F4",difficulty:"WHITE"},{move:"K4",difficulty:"WHITE"},{move:"F5",difficulty:"WHITE"},{move:"K5",difficulty:"WHITE"}]}};$(".dialfilter").html(Unit.prototype.getdialstring.call(b));$(".dialfilter td[move]").click(function(){var a=$(this).attr("move");"undefined"!=typeof MOVEFILTER[a]?(delete MOVEFILTER[a],$(this).removeClass("selected")):
(MOVEFILTER[a]=!0,$(this).addClass("selected"));displayfactionunits(!0)});displayfactionunits(!1);for(var c in generics)if(b=generics[c],b.team==currentteam.team)for(addunit(b.pilotid,currentteam.faction,b),b.tosquadron(s),b.g.attr({display:"none"}),b.geffect.attr({display:"none"}),a=0;a<b.upgradetype.length;a++){var e=b.upg[a];-1<e&&addupgrade(b,e,a)}}
function switchdialimg(b){1==b?($("#caroussel .shipimg").css("display","none"),$("#caroussel .shipdial").css("display","table-cell")):($("#caroussel .shipdial").css("display","none"),$("#caroussel .shipimg").css("display","table-cell"))}function selectrocks(){var b=[1,2,3,4,5,6];$(".aster img").click(function(a){a=parseInt(a.target.id.substr(1),10);if(-1<b.indexOf(a))b[a]=null;else{var c;for(c=0;6>c&&null!=b[c];c++);6>c&&(b[c]=a,$("#a"+a).addClass("selected"))}}.bind(this))}
function dial2JSON(b){var a=[],c,e;for(c=0;5>=c;c++)a[c]={item:"",moves:null};for(c=0;c<b.length;c++){var f=b[c],h=MPOS[f.move][0],l=MPOS[f.move][1];a[5-h].item=h;if(null==a[5-h].moves)for(a[5-h].moves=[],e=0;6>=e;e++)a[5-h].moves[e]={difficulty:"",key:""};a[5-h].moves[l]={difficulty:f.difficulty,key:P[f.move].key}}return a}function selectweapon(b){$("#attackdial").html(Mustache.render(TEMPLATES.selectweapon,b)).show()}
function getpilottexttranslation(b,a){var c=b.name+(a==Unit.SCUM?" (Scum)":"");if("undefined"!=typeof b.edition){var e=b.name+"("+b.edition+")";if("undefined"!=typeof PILOT_translation[e]&&"undefined"!=typeof PILOT_translation[e].text)return formatstring(PILOT_translation[e].text)}return"undefined"!=typeof PILOT_translation[c]&&"undefined"!=typeof PILOT_translation[c].text?formatstring(PILOT_translation[c].text):""}
function getupgtxttranslation(b,a){var c=b+(a==Unit.CREW?"(Crew)":"");return"undefined"!=typeof UPGRADE_translation[c]&&"undefined"!=typeof UPGRADE_translation[c].text?formatstring(UPGRADE_translation[c].text):""}
function importsquad(b){currentteam.parseJSON($("#squad"+b).val(),!0);currentteam.name="SQUAD."+currentteam.toASCII();var a=currentteam.toJuggler(!0);currentteam.toJSON();$("#squad"+b+"points").html(currentteam.points);localStorage[currentteam.name]=JSON.stringify({pts:currentteam.points,faction:currentteam.faction,jug:currentteam.toJuggler(!1)});SQUADLIST.addrow(b,currentteam.name,currentteam.points,currentteam.faction,a);enablenextphase()}function startcombat(){}
function filltabskill(){var b;tabskill=[];for(b=0;12>=b;b++)tabskill[b]=[];for(b in squadron)tabskill[squadron[b].getskill()].push(squadron[b]);for(b=0;12>=b;b++)tabskill[b].sort(function(a,b){var c=0,f=0;1==TEAMS[a.team].initiative&&(c=1);1==TEAMS[b.team].initiative&&(f=1);return 0==f-c?b.id-a.id:f-c})}var ZONE=[];function movelog(b){ANIM+="_-"+b}
function endsetupphase(){$(".buttonbar .share-buttons").hide();$("#leftpanel").show();$(".bigbutton").hide();$(".playertype").prop("disabled",!0);ZONE[2].remove();ZONE[3].remove();TEAMS[1].endsetup();TEAMS[2].endsetup();PERMALINK=permalink(!0);$("#turnselector").append("<option value='0'>"+UI_translation["phase"+SETUP_PHASE]+"</option>");$(".playerselect").remove();$(".nextphase").addClass("disabled");$(".unit").css("cursor","pointer");$("#positiondial").hide();for(var b=0;b<OBSTACLES.length;b++)OBSTACLES[b].unDrag();
HISTORY=[];for(b in squadron)squadron[b].endsetupphase()}
function nextphase(){var b;window.location="#";switch(phase){case SELECT_PHASE:mode==SCENARIO&&(b=$("#scenariolist tr.selected").attr("id"),b=parseInt(b.replace(/sc([0-9]+)/,"$1"),10),SCENARIOLIST.checkrow(b));$(".mainarticle").hide();$(".permalink").show();$("nav").show();$("#game").show();$("#rightpanel").show();$("#leftpanel").show();break;case SETUP_PHASE:if(mode==SCENARIOCREATOR){phase=SELECT_PHASE-1;SCENARIOLIST.addrow(SCENARIOTITLE,HEADER,WINCOND,permalink(!0));break}var a=!0;for(b in squadron)squadron[b].areactionspending()&&
(a=!1);if(0==a)return;"human"==$("#player1 option:checked").val()?TEAMS[1].isia=!1:TEAMS[1].isia=!0;"human"==$("#player2 option:checked").val()?TEAMS[2].isia=!1:TEAMS[2].isia=!0;1==TEAMS[1].isia&&TEAMS[1].setia();1==TEAMS[2].isia&&TEAMS[2].setia();$(".imagebg").hide();endsetupphase();break;case PLANNING_PHASE:$("#maneuverdial").hide();for(b in squadron)squadron[b].endplanningphase();break;case ACTIVATION_PHASE:$("#activationdial").hide();for(b in squadron)squadron[b].hasmoved=!1,squadron[b].hasdecloaked=
!1,squadron[b].actiondone=!1,squadron[b].endactivationphase();a=[];for(b=0;b<BOMBS.length;b++)a[b]=BOMBS[b];for(b=0;b<a.length;b++)a[b].explode();break;case COMBAT_PHASE:$("#attackdial").hide();$("#listunits").html("");for(b in squadron)squadron[b].endround();$("#turnselector").append("<option value='"+round+"'>"+UI_translation["turn #"]+round+"</option>");round++;WINCOND<round&&0<WINCOND&&win(0);-WINCOND<round&&0>WINCOND&&win(0)}phase>=SELECT_PHASE&&(phase=phase==COMBAT_PHASE?PLANNING_PHASE:phase+
1,movelog("P-"+round+"-"+phase),1>=phase?$("#phase").empty():3>phase?$("#phase").html(UI_translation["phase"+phase]):$("#phase").html(UI_translation["turn #"]+round+" "+UI_translation["phase"+phase]),$("#combatdial").hide(),$(".nextphase").removeClass("disabled"));setphase()}
function setphase(b){$(".imagebg").hide();switch(phase){case SELECT_PHASE:page_select();$(".nextphase").addClass("disabled");break;case SETUP_PHASE:$(".imagebg").show();$("#addcomment").show();for(var a="bomb weapon upgrade social condition squad-display".split(" "),c=0;c<a.length;c++)TEMPLATES[a[c]]=$("#"+a[c]).html(),Mustache.parse(TEMPLATES[a[c]]);var a=UI_translation.human,e=UI_translation.computer;$("#player1").html("<option selected value='human'>"+a+"</option>");$("#player1").append("<option value='computer'>"+
e+"</option>");$("#player2").html("<option selected value='human'>"+a+"</option>");$("#player2").append("<option value='computer'>"+e+"</option>");$("#player1").change(function(){TEAMS[1].isia=!TEAMS[1].isia;displayplayertype(1)});$("#player2").change(function(){TEAMS[2].isia=!TEAMS[2].isia;displayplayertype(2)});TEAMS[1].isia=!1;displayplayertype(1);TEAMS[2].isia=!0;displayplayertype(2);$(".playertype").removeProp("disabled");$(".bigbutton").show();$(".bigbutton2").prop("disabled",!1);$(".buttonbar .share-buttons").show();
$("#team2").css("top",$("nav").height()+2);$("#team1").css("top",$("nav").height()+2);$(".ctrl").css("display","block");ZONE[0]=s.path(SETUP.playzone1).attr({strokeWidth:6,stroke:halftone(WHITE),strokeDasharray:"20,10,5,5,5,10",id:"ZONE1",fillOpacity:1,filter:"drop-shadow( 5px 5px 5px #000 )",pointerEvents:"none"});SETUP.playzone1!=SETUP.playzone2?(ZONE[1]=s.path(SETUP.playzone2).attr({strokeWidth:6,stroke:halftone(WHITE),strokeDasharray:"20,10,5,5,5,10",id:"ZONE2",fillOpacity:0,pointerEvents:"none"}),
ZONE[1].appendTo(VIEWPORT)):ZONE[1]=ZONE[0];$("#imagebg").change(function(){changeimage(this)});""!=SETUP.background&&$(".playmat").css({background:"url("+SETUP.background+") no-repeat",backgroundSize:"100% 100%"});""==SETUP.pattern?ZONE[0].attr("fillOpacity",0):(a=s.image(SETUP.pattern,0,0,360,360).pattern(0,0,360,360),ZONE[0].attr("fill",a));ZONE[0].appendTo(VIEWPORT);ZONE[2]=s.path(SETUP.zone1).attr({fill:TEAMS[1].color,strokeWidth:2,opacity:.3,pointerEvents:"none"});ZONE[2].appendTo(VIEWPORT);
ZONE[3]=s.path(SETUP.zone2).attr({fill:TEAMS[2].color,strokeWidth:2,opacity:.3,pointerEvents:"none"});ZONE[3].appendTo(VIEWPORT);TEAMS[1].endselection(s);TEAMS[2].endselection(s);loadsound();""!=HEADER&&2>round&&($("footer").hide(),$("#titlecontent").html("<h1>"+SCENARIOTITLE+"</h1>"+HEADER));TEAMS[1].points<TEAMS[2].points?TEAMS[2].initiative=!0:TEAMS[1].initiative=!0;1==TEAMS[1].initiative?log("TEAM #1 has initiative"):log("TEAM #2 has initiative");$(".activeunit").prop("disabled",!1);for(c in squadron)if(!squadron[c].isdocked)break;
activeunit=squadron[c];activeunit.select();activeunit.show();jwerty.key("f",function(){});$("#svgout").bind("mousewheel DOMMouseScroll",function(a){var b=a.originalEvent;a=Math.pow(1.1,"undefined"!=typeof b.wheelDelta?b.wheelDelta/360:b.detail/-9);var c=b.clientX-$("#team1").width(),b=b.clientY-$("nav").height(),e=$("#svgout").width(),f=$("#svgout").height(),q=0,m=0;f>e?m=(f-e)/2:q=(e-f)/2;e=Math.max(GW/e,GH/f);c=(c-q)*e;m=(b-m)*e;q=VIEWPORT.m.clone().invert();b=q.x(c,m);c=q.y(c,m);VIEWPORT.m.translate(b,
c).scale(a).translate(-b,-c);VIEWPORT.transform(VIEWPORT.m);activeunit.show()});$("#svgout").mousedown(function(a){dragstart(a)});$("#svgout").mousemove(function(a){dragmove(a)});$("#svgout").mouseup(function(a){dragstop(a)});jwerty.key("escape",nextphase);jwerty.key("alt+p",function(){activeunit.showpositions(activeunit.getdial())},{});jwerty.key("alt+g",function(){TEAMS[activeunit.team].isia?activeunit.showgrouppositions():console.log("not an IA")},{});jwerty.key("alt+m",function(){activeunit.showmeanposition()});
jwerty.key("alt+shift+p",function(){$(".possible").remove()});jwerty.key("alt+1",function(){activeunit.addfocustoken();activeunit.show()});jwerty.key("alt+2",function(){activeunit.addevadetoken();activeunit.show()});jwerty.key("alt+3",function(){activeunit.iscloaked||(activeunit.addcloaktoken(),activeunit.show())});jwerty.key("alt+4",function(){activeunit.addstress();activeunit.show()});jwerty.key("alt+5",function(){activeunit.addiontoken();activeunit.show()});jwerty.key("alt+6",function(){activeunit.addtractorbeamtoken();
activeunit.show()});jwerty.key("alt+shift+1",function(){0<activeunit.focus&&activeunit.removefocustoken();activeunit.show()});jwerty.key("alt+shift+2",function(){0<activeunit.evade&&activeunit.removeevadetoken();activeunit.show()});jwerty.key("alt+shift+3",function(){activeunit.iscloaked&&(activeunit.removecloaktoken(),activeunit.show())});jwerty.key("alt+shift+4",function(){0<activeunit.stress&&activeunit.removestresstoken();activeunit.show()});jwerty.key("alt+shift+5",function(){0<activeunit.ionized&&
activeunit.removeiontoken()});jwerty.key("alt+shift+6",function(){0<activeunit.tractorbeam&&activeunit.removetractorbeamtoken()});jwerty.key("alt+d",function(){activeunit.resolvehit(1)});jwerty.key("alt+c",function(){activeunit.resolvecritical(1)});jwerty.key("alt+shift+d",function(){activeunit.hull<activeunit.ship.hull?activeunit.addhull(1):activeunit.shield<activeunit.ship.shield&&activeunit.addshield(1);activeunit.show()});0<SETUP.asteroids&&loadrock(s,ROCKDATA);log("<div>["+UI_translation["turn #"]+
round+"]"+UI_translation["phase"+phase]+"</div>");$("footer").show();$(".unit").css("cursor","move");$("#positiondial").show();$(".permalink").show();$("#savebtn").hide();for(c in squadron)squadron[c].beginsetupphase();1!=b&&startreplayall();break;case PLANNING_PHASE:active=0;actionr=[$.Deferred().resolve()];actionrlock=$.Deferred().resolve();log("<div>["+UI_translation["turn #"]+round+"]"+UI_translation["phase"+phase]+"</div>");$(".nextphase").addClass("disabled");$("#maneuverdial").show();skillturn=
0;filltabskill();$("#savebtn").show();for(c in squadron)squadron[c].newm=squadron[c].m,squadron[c].beginplanningphase().progress(nextplanning);nextplanning();break;case ACTIVATION_PHASE:log("<div>["+UI_translation["turn #"]+round+"]"+UI_translation["phase"+phase]+"</div>");$(".nextphase").addClass("disabled");$("#activationdial").show();for(c in squadron)squadron[c].beginactivationphase().done(nextdecloak);filltabskill();subphase=DECLOAK_PHASE;skillturn=0;barrier(nextdecloak);break;case COMBAT_PHASE:log("<div>["+
UI_translation["turn #"]+round+"]"+UI_translation["phase"+phase]+"</div>");$("#attackdial").show();skillturn=12;$(".nextphase").addClass("disabled");for(c in squadron)squadron[c].begincombatphase().done(nextcombat);barrier(nextcombat)}}function barrier(b){$.when.apply(null,actionr).done(b)}function log(b){$("#log").append("<div>"+b+"<div>");$("#log").scrollTop(1E4)}
function permalink(b){var a="";b||(a=ANIM);return LZString.compressToEncodedURIComponent(TEAMS[1].toASCII()+"&"+TEAMS[2].toASCII()+"&"+saverock()+"&"+TEAMS[1].isia+"&"+TEAMS[2].isia+"&"+SETUP.name+(MOVING_ASTER?"!":"")+"&"+a+"&"+SCENARIOTITLE+"&"+HEADER+"&"+WINCOND)}function savesquad(){return LZString.compressToEncodedURIComponent(TEAMS[3].toASCII()+"&&")}
function resetlink(b,a,c){switch(phase){case SETUP_PHASE:case SELECT_PHASE:document.location.search="";c=document.location.href;0<c.indexOf("?")&&(c=c.substring(0,c.indexOf("?")),window.history.replaceState({},document.title,c));location.reload();break;default:1==b?""!=document.location.search?document.location.search="":document.location.reload():(1==a?ANIM="":1==c?$("#turnselector option:selected").each(function(){var a=$(this).val();-1!=a&&(0==a?ANIM="":(a=ANIM.search("_-P-"+a+"-3"),ANIM=ANIM.slice(0,
ANIM.indexOf("_",a+1))))}):(b=ANIM.search("_-P-"+c+"-3"),-1==ANIM.indexOf("_",b+1)&&(b=ANIM.search("_-P-"+(c-1)+"-3")),ANIM=ANIM.slice(0,ANIM.indexOf("_",b+1))),c=LZString.decompressFromEncodedURIComponent(decodeURI(PERMALINK)),args=c.split("&"),args[2]=saverock(),args[6]=ANIM,args[7]=SCENARIOTITLE,args[8]=HEADER,args[9]=WINCOND,c=args.join("&"),document.location.search="?"+LZString.compressToEncodedURIComponent(c))}}function record(b,a,c){}
function history_toASCII(){for(var b="",a=0;a<HISTORY.length;a++)b+=HISTORY[a].s+"_"+HISTORY[a].id+";";return b}function select(b){for(var a in squadron)if(squadron[a].id==b)break;squadron[a].select();$("#"+activeunit.id).attr({color:"white",background:"tomato"})}
function probatable(b,a){var c,e,f="";for(c=0;5>=c;c++){f+="<tr><td>"+c+"</td>";for(e=0;5>=e;e++){var h=e;0<a.adddice&&(h+=a.adddice);h=tohitproba(b,{modifyattackroll:function(a,b,c){return a}},a,ATTACK[c],DEFENSE[h],c,h);f+="<td class='probacell' style='background:hsl("+1.2*(100-h.tohit)+",100%,80%)'>";f+="<div>"+h.tohit+"%</div><div><code class='symbols'>d</code>"+h.meanhit+"</div><div><code class='symbols'>c</code>"+h.meancritical+"</div></td>"}f+="</tr>"}return f}
function fillprobatable(){var b={focus:$("#focusA").prop("checked")?1:0,reroll:$("#targetA").prop("checked")?5:0},a={focus:$("#focusD").prop("checked")?1:0,evade:$("#evadeD").prop("checked")?1:0,adddice:$("#cloakD").prop("checked")?2:0,reroll:0},c;c=parseInt($("#rerollA").val(),10);var e=parseInt($("#rerollD").val(),10);if(0==b.reroll||0<c&&c<b.reroll)b.reroll=c;if(0==a.reroll||0<e&&e<a.reroll)a.reroll=e;b="<tr><th>Rolls</th><th>0</th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th></tr>"+probatable(b,
a);$("#probatable").html(b)}function modal_dragstart(b){var a=window.getComputedStyle(b.originalEvent.target,null);b.originalEvent.dataTransfer.setData("text/plain",b.target.parentElement.id+","+(parseInt(a.getPropertyValue("left"),10)-b.originalEvent.clientX)+","+(parseInt(a.getPropertyValue("top"),10)-b.originalEvent.clientY))}function modal_dragover(b){b.originalEvent.preventDefault();return!1}
function modal_drop(b){var a=b.originalEvent.dataTransfer.getData("text/plain").split(","),c=a[0];$("#"+c+" > div").css("left",b.originalEvent.clientX+parseInt(a[1],10)+"px");$("#"+c+" > div").css("top",b.originalEvent.clientY+parseInt(a[2],10)+"px");b.originalEvent.preventDefault();return!1}
var viewport_translate=function(b,a){VIEWPORT.m=MT(b,a).add(VIEWPORT.m);$(".phasepanel").hide();VIEWPORT.transform(VIEWPORT.m)},viewport_zoom=function(b){var a=activeunit.m.x(0,0),c=activeunit.m.y(0,0),e=VIEWPORT.m.clone().invert(),f=e.x(a,c),a=e.y(a,c);VIEWPORT.m.translate(f,a).scale(b).translate(-f,-a);VIEWPORT.transform(VIEWPORT.m);activeunit.show()},dragmove=function(b){if(1!=activeunit.dragged&&VIEWPORT.dragged){var a=$("#svgout").width(),c=$("#svgout").height(),a=Math.max(GW/a,GH/c);VIEWPORT.dragMatrix=
MT((b.offsetX-VIEWPORT.x0)*a,(b.offsetY-VIEWPORT.y0)*a).add(VIEWPORT.m);VIEWPORT.dragged=!0;$(".phasepanel").hide();VIEWPORT.transform(VIEWPORT.dragMatrix)}},dragstart=function(b){VIEWPORT.dragged=!0;"svgout"==b.originalEvent.target.id?(VIEWPORT.x0=b.offsetX,VIEWPORT.y0=b.offsetY,VIEWPORT.dragged=!0,VIEWPORT.dragMatrix=VIEWPORT.m):VIEWPORT.dragged=!1},dragstop=function(b){VIEWPORT.dragged&&(VIEWPORT.m=VIEWPORT.dragMatrix,VIEWPORT.m.clone(),VIEWPORT.transform(VIEWPORT.m),activeunit.show());VIEWPORT.dragged=
!1},scrolloverflow=function(b){$("#"+b.currentTarget.id+" .outoverflow").each(function(a){"auto"!=$(this).css("top")&&$(this).css("top",$(this).parent().offset().top+"px")})},changelanguage=function(b){localStorage.LANG=b;location.reload()};
$(document).ready(function(){var b;s=Snap("#svgout");VIEWPORT=s.g().attr({id:"viewport"});VIEWPORT.m=new Snap.Matrix;FILTER=s.filter(Snap.filter.blur(5,5));P={F0:{path:s.path("M 0 0 L 0 0"),speed:0,key:"5"},F1:{path:s.path("M 0 0 L 0 -80"),speed:1,key:"8"},RF1:{path:s.path("M 0 0 L 0 -80"),speed:1,key:"|"},F2:{path:s.path("M 0 0 L 0 -120"),speed:2,key:"8"},F3:{path:s.path("M 0 0 L 0 -160"),speed:3,key:"8"},F4:{path:s.path("M 0 0 L 0 -200"),speed:4,key:"8"},F5:{path:s.path("M 0 0 L 0 -240"),speed:5,
key:"8"},RF5:{path:s.path("M 0 0 L 0 -240"),speed:5,key:"|"},TR1:{path:s.path("M0 0 C 0 -40 15 -55 55 -55"),speed:1,key:"6"},TR2:{path:s.path("M0 0 C 0 -50 33 -83 83 -83"),speed:2,key:"6"},TRR2:{path:s.path("M0 0 C 0 -50 33 -83 83 -83"),speed:2,key:";"},TR3:{path:s.path("M0 0 C 0 -60 45 -105 105 -105"),speed:3,key:"6"},TRR3:{path:s.path("M0 0 C 0 -60 45 -105 105 -105"),speed:3,key:";"},TL1:{path:s.path("M0 0 C 0 -40 -15 -55 -55 -55"),speed:1,key:"4"},TL2:{path:s.path("M0 0 C 0 -50 -33 -83 -83 -83"),
speed:2,key:"4"},TRL2:{path:s.path("M0 0 C 0 -50 -33 -83 -83 -83"),speed:2,key:":"},TL3:{path:s.path("M0 0 C 0 -60 -45 -105 -105 -105"),speed:3,key:"4"},TRL3:{path:s.path("M0 0 C 0 -60 -45 -105 -105 -105"),speed:3,key:":"},BR1:{path:s.path("M0 0 C 0 -20 18 -72 38 -92"),speed:1,key:"9"},RL1:{path:s.path("M0 0 C 0 -20 18 -72 38 -92"),speed:1,key:"}"},BR2:{path:s.path("M0 0 C 0 -30 24 -96 54 -126"),speed:2,key:"9"},SR2:{path:s.path("M0 0 C 0 -30 24 -96 54 -126"),speed:2,key:"3"},BR3:{path:s.path("M0 0 C 0 -40 29 -120 69 -160"),
speed:3,key:"9"},SR3:{path:s.path("M0 0 C 0 -40 29 -120 69 -160"),speed:3,key:"3"},BL1:{path:s.path("M0 0 C 0 -20 -18 -72 -38 -92"),speed:1,key:"7"},RR1:{path:s.path("M0 0 C 0 -20 -18 -72 -38 -92"),speed:1,key:"{"},BL2:{path:s.path("M0 0 C 0 -30 -24 -96 -54 -126"),speed:2,key:"7"},SL2:{path:s.path("M0 0 C 0 -30 -24 -96 -54 -126"),speed:2,key:"1"},BL3:{path:s.path("M0 0 C 0 -40 -29 -120 -69 -160"),speed:3,key:"7"},SL3:{path:s.path("M0 0 C 0 -40 -29 -120 -69 -160"),speed:3,key:"1"},K1:{path:s.path("M 0 0 L 0 -80"),
speed:1,key:"2"},K2:{path:s.path("M 0 0 L 0 -120"),speed:2,key:"2"},K3:{path:s.path("M 0 0 L 0 -160"),speed:3,key:"2"},K4:{path:s.path("M 0 0 L 0 -200"),speed:4,key:"2"},K5:{path:s.path("M 0 0 L 0 -240"),speed:5,key:"2"}};for(b in P)P[b].path.attr({display:"none"});$(".menu").mouseover(function(){$(".menu ul").css({display:"block",visibility:"visible"})}).mouseout(function(){$("nav ul").css({display:"none",visibility:"hidden"})});$("footer").hide();$("#squad1").on("paste",function(){setTimeout(function(){currentteam=
TEAMS[1];importsquad(1)},4)});$("#squad2").on("paste",function(){setTimeout(function(){currentteam=TEAMS[2];importsquad(2)},4)});LANG=localStorage.LANG||window.navigator.userLanguage||window.navigator.language;LANG=LANG.substring(0,2);$.ajaxSetup({beforeSend:function(a){a.overrideMimeType&&a.overrideMimeType("application/json")},isLocal:!0});-1=="en fr de es it pl".split(" ").indexOf(LANG)&&(LANG="en");$("#langselect").val(LANG);$.when($.ajax("data/ships.json",{error:function(a,b,e){console.log("**Error loading ships.json\n"+
b+" "+e)}}),$.ajax("data/strings."+LANG+".json",{error:function(a,b,e){console.log("**Error loading strings."+LANG+".json\n"+b+" "+e)}}),$.ajax("data/xws.json",{error:function(a,b,e){console.log("**Error loading xws.json\n"+b+" "+e)}}),$.ajax("data/strings.en.json",{error:function(a,b,e){console.log("**Error loading strings."+LANG+".json\n"+b+" "+e)}}),$.ajax("data/ratings.json",{error:function(a,b,e){console.log("**Error loading ratings.json\n"+b+" "+e)}}),$.ajax("data/countrycodes.json",{error:function(a,
b,e){console.log("**Error loading countrycodes.json\n"+b+" "+e)}})).done(function(a,b,e,f,h,l){var c=setInterval(function(){ATTACK[dice]=attackproba(dice);DEFENSE[dice]=defenseproba(dice);dice++;8==dice&&(fillprobatable(),$("#showproba").prop("disabled",!1),clearInterval(c))},500);unitlist=a[0];ENSHIP_translation=f[0].ships;ENPILOT_translation=f[0].pilots;ENUPGRADE_translation=f[0].upgrades;SHIP_translation=b[0].ships;PILOT_translation=b[0].pilots;UPGRADE_translation=b[0].upgrades;RATINGS_upgrades=
h[0].upgrades;RATINGS_ships=h[0].ships;RATINGS_pilots=h[0].pilots;CC=l[0];UI_translation=b[0].ui;CRIT_translation=b[0].criticals;f=b[0].css;a="";if("en"!=LANG){for(m in ENUPGRADE_translation)b=ENUPGRADE_translation[m],h=UPGRADE_translation[m],"undefined"==typeof h&&(UPGRADE_translation[m]=b);for(m in ENPILOT_translation)b=ENPILOT_translation[m],h=PILOT_translation[m],"undefined"==typeof h&&(PILOT_translation[m]=b)}for(m in f)a+="."+m+'::after { content:"'+f[m]+'";}\n';$("#localstrings").html(a);UPGRADE_dict=
e[0].upgrades;PILOT_dict=e[0].pilots;for(x in PILOT_dict){for(m=0;m<PILOTS.length;m++)PILOTS[m].name==PILOT_dict[x]&&(PILOTS[m].dict=x);for(m in unitlist)m==PILOT_dict[x]&&(unitlist[m].dict=x)}for(m=0;m<UPGRADES.length;m++)b=UPGRADES[m],b.type==Unit.TITLE&&(unitlist[b.ship].hastitle=!0);for(m=0;m<PILOTS.length;m++){e=!1;for(var x in PILOT_dict)if(PILOTS[m].name==PILOT_dict[x]){e=!0;break}e||log("no xws translation for "+PILOTS[m].name)}for(m=0;m<UPGRADES.length;m++){e=!1;for(x in UPGRADE_dict)if(UPGRADES[m].name==
UPGRADE_dict[x]){e=!0;break}e||log("no xws translation for "+UPGRADES[m].name)}squadron=[];s.attr({width:"100%",height:"100%",viewBox:"0 0 914.4 914.4"});f=b=e=0;a="";for(m=0;m<PILOTS.length;m++)1==PILOTS[m].done&&(PILOTS[m].unique&&b++,e++),PILOTS[m].done||(a=PILOTS[m].unique?a+", .":a+", ",a+=PILOTS[m].name);console.log(e+"/"+PILOTS.length+" pilots with full effect");log(e+"/"+PILOTS.length+" pilots with full effect<br/>");""!=a&&log("Pilots NOT working yet:"+a+"<br/>");e=0;a="";for(m=0;m<UPGRADES.length;m++)UPGRADES[m].invisible||
(1==UPGRADES[m].done?e++:a+=(""==a?"":", ")+(UPGRADES[m].unique?".":"")+UPGRADES[m].name,f++);$(".ver").html(VERSION);console.log(e+"/"+f+" upgrades with full effect");log(e+"/"+f+" upgrades with full effect<br/>");""!=a&&log("Upgrades NOT working yet:"+a+"<br/>");$("#showproba").prop("disabled",!0);new Date;"undefined"==typeof localStorage.volume&&(localStorage.volume=.8);var q=new Hammer(document.getElementById("svgout"));q.get("pinch").set({enable:!0});q.get("pan").set({direction:Hammer.DIRECTION_ALL});
q.on("panleft panright panup pandown",function(a){"svgout"==a.target.id&&1!=activeunit.dragged&&viewport_translate(50*a.velocityX,50*a.velocityY)});e="unit-creation combat-display unit-printable unit-combat upglist-creation faction usabletokens selectweapon".split(" ");for(m in e)TEMPLATES[e[m]]=$("#"+e[m]).html(),Mustache.parse(TEMPLATES[e[m]]);$("body").on("mousedown","footer",function(){$(this).addClass("draggable").parents().on("mousemove",function(a){$(".draggable").offset({top:a.pageY-$(".draggable").outerHeight()/
2,left:a.pageX-$(".draggable").outerWidth()/2}).on("mouseup",function(){$(this).removeClass("draggable")})});"function"==typeof(0).preventDefault&&(0).preventDefault()}).on("mouseup",function(){$(".draggable").removeClass("draggable")});q.zoom=1;q.on("pinch",function(a){if("svgout"==a.target.id&&1!=activeunit.dragged){var b=VIEWPORT.m.clone().invert(),c=b.x(a.center.x,a.center.y),b=b.y(a.center.x,a.center.y);VIEWPORT.m.translate(c,b).scale(a.scale).scale(1/q.zoom).translate(-c,-b);q.zoom=a.scale;
VIEWPORT.transform(VIEWPORT.m);activeunit.show();a["final"]&&(q.zoom=1)}});$("aside").on("scroll touchmove touchstart mousewheel",scrolloverflow);scenariomode(FREECOMBAT);"CREATION"==localStorage.mode?(delete localStorage.mode,page_creation()):page_select();a=LZString.decompressFromEncodedURIComponent(decodeURI(window.location.search.substr(1)));e=[];null!=a&&(e=a.split("&"));if(1<e.length)if(log("Loading permalink..."),ROCKDATA=e[2],TEAMS[1].parseASCII(e[0]),TEAMS[1].toJSON(),""==e[1])for(x in TEAMS[3].parseASCII(e[0]),
currentteam=TEAMS[3],currentteam.team=3,createsquad(currentteam.faction),generics){if(b=generics[x],3==b.team)for(var m in metaUnit.prototype)b[m]=metaUnit.prototype[m]}else return TEAMS[2].parseASCII(e[1]),TEAMS[2].toJSON(),TEAMS[1].isia=!1,TEAMS[2].isia=!1,"true"==e[3]&&(TEAMS[1].isia=!0),"true"==e[4]&&(TEAMS[2].isia=!0),MOVING_ASTER=!1,"undefined"!=typeof e[5]&&(a=e[5],"!"==a.substr(-1,1)&&(MOVING_ASTER=!0,a=a.substr(0,a.len-1)),setSetup(a)),phase=SELECT_PHASE,SCENARIOTITLE=HEADERS="",6<e.length&
""!=e[6]&&(REPLAY=e[6]),8<e.length&&(HEADER=e[8],SCENARIOTITLE=e[7]),WINCOND=9<e.length?parseInt(e[9],10):0,PERMALINK=LZString.compressToEncodedURIComponent(TEAMS[1].toASCII()+"&"+TEAMS[2].toASCII()+"&"+saverock()+"&"+TEAMS[1].isia+"&"+TEAMS[2].isia+"&"+e[5]+"&&"+SCENARIOTITLE+"&"+HEADERS+"&"+WINCOND),nextphase();delete localStorage.imageplayer;delete localStorage.playername;phase=SELECT_PHASE;setSetup("Classic");SQUADLIST=new Squadlist("#squadlist");SQUADLIST.latest();SCENARIOLIST=new Scenariolist("#scenariolist");
SCENARIOLIST.user();for(m in squadron)delete squadron[m];$("#caroussel").hover(function(){$(this).scrollLeft(10)});squadron=[];generics=[];TEAMS[3].changefaction(Unit.REBEL,!0);x=[];for(m=0;m<PILOTS.length;m++)e=m,a=translate(PILOTS[m].name),1==PILOTS[m].ambiguous&&"undefined"!=typeof PILOTS[m].edition&&(a+="("+PILOTS[m].edition+")"),x.push(a.replace(/\'/g,"").replace(/\(Scum\)/g,""));e=[];for(m in UPGRADE_translation)e.push(" "+translate(m).replace(/\'/g,"").replace(/\(Crew\)/g,""));$(".squadbg > textarea").asuggest(x,
{delimiters:"^\n",cycleOnTab:!0});$(".squadbg > textarea").asuggest(e,{delimiters:"+",cycleOnTab:!0});return!0})});
function printunits(){var b="",a=0,c;for(c in generics){var e=generics[c];if(e.team==currentteam.team){var f=0,h;for(h in e.upgrades){var l=e.upgrades[h];"undefined"==typeof l.points&&(l.points=e.points,l.name="Ship:"+e.ship.name);f+=parseInt(l.points,10)}e.totpoints=f;a+=f;b+=Mustache.render(TEMPLATES["unit-printable"],e)}}$("#factionname").addClass(currentteam.faction.toUpperCase());$("#pointsname").html(a);$("#printunits").html(b)};var JUGGLERWEBSITE="",mk2split=function(b){b=b.split(".");for(var a=[],c=!1,e=1;e<b.length;e++)b[e].match(/_II.*/)?(a.push(b[e-1]+"."+b[e]),b[e]=null,c=!1):(b[e-1]&&a.push(b[e-1]),c=!0);c&&a.push(b[b.length-1]);return a};
function Squadlist(b){this.id=b;TEMPLATES["row-manage"]=$("#row-manage").html();Mustache.parse(TEMPLATES["row-manage"]);TEMPLATES["header-manage"]=$("#header-manage").html();Mustache.parse(TEMPLATES["header-manage"]);$(b).html(Mustache.render(TEMPLATES["header-manage"],{translation:UI_translation.type}));$(b+" tbody").on("click","tr",function(){$(b+" .selected").removeClass("selected");$(this).addClass("selected")})}
Squadlist.prototype={isinrow:function(b){return"undefined"!=typeof this.rows&&-1<this.rows.indexOf(b)},filter:function(b){for(var a in this.rows)this.rows[a].match(b)?$("#r"+a).show():$("#r"+a).hide()},"import":function(b){},addrow:function(b,a,c,e,f,h,l){b=e.toUpperCase();if("undefined"==typeof localStorage[a]||1==h)this.rows[this.nrows]=f,TEAMS[0].parseJuggler(f,!1),f=TEAMS[0].toJuggler(!0,!0),$(this.id+" tbody").append(Mustache.render(TEMPLATES["row-manage"],{nrows:this.nrows,faction:b,pts:c,name:a,
tournament:l,jug:f})),this.nrows++},removerow:function(b){TEAMS[0].parseJuggler(this.rows[b],!1);var a="SQUAD."+TEAMS[0].toASCII();$("#r"+b).remove();delete this.rows[b];"undefined"!=typeof localStorage[a]&&delete localStorage[a]},createfromrow:function(b){b=this.rows[b];currentteam=TEAMS[3];currentteam.parseJuggler(b,!0);createsquad(currentteam.faction);for(var a in generics)if(b=generics[a],3==b.team)for(var c in metaUnit.prototype)b[c]=metaUnit.prototype[c]},toplist:function(){var b;this.rows=
[];this.nrows=0;$(this.id+" tbody").html("");this.log={};for(b=0;b<TOP_squads.length;b++)TEAMS[0].parseJuggler(TOP_squads[b],!1),this.addrow(0,b,TEAMS[0].points,TEAMS[0].faction,TEAMS[0].toJuggler(!1),!0)},user:function(){var b;this.rows=[];this.nrows=0;$(this.id+" tbody").html("");this.log={};for(b in localStorage)if("string"==typeof localStorage[b]&&b.match(/SQUAD.*/)){var a=$.parseJSON(localStorage[b]);"undefined"==typeof a.jug||"undefined"==typeof a.pts||"undefined"==typeof a.faction?delete localStorage[b]:
this.addrow(0,b,a.pts,a.faction,a.jug,!0)}},addtournamentlists:function(b){var a=new XMLHttpRequest;a.overrideMimeType("application/json");a.open("GET",JUGGLERWEBSITE+"tournament/"+b,!0);a.onreadystatechange=function(){if(4===a.readyState)if(200<=a.status&&400>a.status){var c=$.parseJSON(a.responseText),e="us";"undefined"==typeof CC[c.tournament.venue.country]?console.log("No country:"+c.tournament.venue.country):e=CC[c.tournament.venue.country].toLowerCase();var e={cc:e,country:c.tournament.venue.country,
type:c.tournament.type,format:c.tournament.format.replace(/Standard -/,""),date:c.tournament.date},f=[],h;for(h in c.tournament.players){var l=c.tournament.players[h];if("undefined"!=typeof l.list&&(TEAMS[0].parseJSON(l.list),TEAMS[0].toJSON(),l=TEAMS[0].toKey(),1!=this.allresults[l])){var t=TEAMS[0].toJuggler(!1);f.push({points:TEAMS[0].points,faction:TEAMS[0].faction,jug:t});this.addrow(0,"COMPETITION"+l,TEAMS[0].points,TEAMS[0].faction,t,!1,e);this.allresults[l]=!0}}localStorage["_TOURNAMENT"+
b]=JSON.stringify({list:f,event:e})}else console.log("no tournament "+b+" (status:"+a.status+")")}.bind(this);a.send()},latest:function(){var b=new XMLHttpRequest;b.overrideMimeType("application/json");var a;this.allresults={};this.rows=[];this.nrows=0;$(this.id+" tbody").html("");this.log={};b.open("GET",JUGGLERWEBSITE+"tournament/tournaments",!0);b.onreadystatechange=function(){if(4===b.readyState)if(200<=b.status&&400>b.status){var c=$.parseJSON(b.responseText);c.tournaments.sort(function(a,b){return parseInt(a,
10)-parseInt(b,10)});var e=[];for(a=0;5>a;a++){var f=c.tournaments[c.tournaments.length-1-a];this.addtournamentlists(f);e[a]=parseInt(f,10)}for(a in localStorage)null!=a.match(/_TOURNAMENT/)&&(c=parseInt(a.replace(/_TOURNAMENT([0-9]*)/,"$1"),10),-1==e.indexOf(c)&&(console.log("removing old tournament "+a),delete localStorage[a]))}else console.log("tournaments not loaded (status:"+b.status+")")}.bind(this);b.send()},latest2:function(){this.rows=[];this.nrows=0;$(this.id+" tbody").html("");this.log=
{};for(var b=0;b<mySpreadsheets.length;b++)$("#squadlist").sheetrock({url:mySpreadsheets[b],query:"select C order by A desc",fetchSize:40,rowTemplate:this.myTemplatesl})},myTemplatesl:function(b){var a=b.cellsArray[0].split("VS");if(!(2>a.length)){b=mk2split(a[0]);for(var a=mk2split(a[1]),c="",e="",f="",h="",l=0;l<b.length-1;l++)e+=b[l].replace(/\*/g," + ").replace(/_/g," ")+"\n",c+=b[l].replace(/\*/g," + ").replace(/_/g," ")+"\n";for(l=0;l<a.length-1;l++)h+=a[l].replace(/\*/g," + ").replace(/_/g,
" ")+"\n",f+=a[l].replace(/\*/g," + ").replace(/_/g," ")+"\n";TEAMS[0].parseJuggler(e,!1);TEAMS[0].toJSON();"undefined"==typeof SQUADLIST.log[c]&&(SQUADLIST.addrow(0,"SQUAD."+TEAMS[0].toASCII(),TEAMS[0].points,TEAMS[0].faction,c,!0),SQUADLIST.log[c]=!0);TEAMS[0].parseJuggler(h,!1);TEAMS[0].toJSON();"undefined"==typeof SQUADLIST.log[f]&&(SQUADLIST.addrow(0,"SQUAD."+TEAMS[0].toASCII(),TEAMS[0].points,TEAMS[0].faction,f,!0),SQUADLIST.log[f]=!0)}},displaycombats:function(b){generics=[];squadron=[];"undefined"!=
typeof b&&(TEAMS[0].parseJuggler(this.rows[b],!0),b=TEAMS[0].toJuggler(!1),b=b.replace(/\n/g,"."),b=b.replace(/ \+ /g,"*"),SEARCHINGSQUAD=b=b.replace(/ /g,"_"));stype="";b=SEARCHINGSQUAD;$("#replay").attr("src","space.html");for(var a=0;a<mySpreadsheets.length;a++)$("#squadbattlediv").sheetrock({url:mySpreadsheets[a],query:"select B,C,E,A where C contains '"+b+"'",fetchSize:2,rowTemplate:myTemplate})},printfromrow:function(b){b=this.rows[b];generics=[];squadron=[];TEAMS[0].parseJuggler(b,!0);currentteam=
TEAMS[0];for(var a in generics)if(b=generics[a],0==b.team){addunit(b.pilotid,currentteam.faction,b);for(var c=0;c<b.upgradetype.length;c++){var e=b.upg[c];-1<e&&addupgrade(b,e,c)}}printunits();window.print()},checkrow:function(b,a){prepareforcombat(this.rows[a],b)}};Unit=window.Unit||{};PILOTS=window.PILOTS||{};UPGRADES=window.UPGRADES||{};Mustache=window.Mustache||{};
function displayfactionunits(b){var a=0,c=0,e,f,h,l=TEAMS[3].faction,t={},x=[];currentteam=TEAMS[3];"REBEL"==l?($(".dialfilter td[move=SL3]").text(P.TRL3.key).attr("move","TRL3"),$(".dialfilter td[move=SL2]").text(P.TRL2.key).attr("move","TRL2")):($(".dialfilter td[move=TRL3]").text(P.SL3.key).attr("move","SL3"),$(".dialfilter td[move=TRL2]").text(P.SL2.key).attr("move","SL2"));for(e in unitlist)-1<unitlist[e].faction.indexOf(l)&&a++;1==b?$("#caroussel").html(""):$(".caroussel").html("");for(e=0;e<
PILOTS.length;e++){var q=PILOTS[e].unit,a="";b=PILOTS[e].name;if(PILOTS[e].faction==l){"undefined"==typeof t[q]&&(t[q]=[]);-1<PILOTS[e].upgrades.indexOf(Unit.ELITE)&&(PILOTS[e].haselite=!0);var m=getpilottexttranslation(PILOTS[e],l);""!=m&&(m+=1==PILOTS[e].done?"":"<div><strong class='m-notimplemented'></strong></div>");PILOTS[e].faction==Unit.SCUM&&(b+="(SCUM)");"undefined"!=typeof PILOTS[e].edition&&(b+=" ("+PILOTS[e].edition+")");"undefined"!=typeof RATINGS_pilots[b]&&(m=m+"<hr/><p class='strategy'>"+
RATINGS_pilots[b].text+"</p>",a=repeat("\u00ff",RATINGS_pilots[b].rating));PILOTS[e].tooltip=m;PILOTS[e].rating=a;PILOTS[e].trname=translate(PILOTS[e].name);t[q].push(PILOTS[e])}}for(q in t)t[q].sort(function(a,b){return a.points-b.points});for(e in unitlist)-1<unitlist[e].faction.indexOf(l)&&(unitlist[e].trname=SHIP_translation[e],unitlist[e].name=e,"undefined"==typeof unitlist[e].trname&&(unitlist[e].trname=e),x.push(unitlist[e]));x.sort(function(a,b){return a.trname>b.trname});for(e=0;e<x.length;e++){c++;
q=x[e];b=t[q.name];var r=t[q.name][0].upgrades,a=!0;if("0"!=WAVEFILTER){m=[];for(h in b){var y=b[h];"undefined"!=typeof y.wave?-1<y.wave.indexOf(WAVEFILTER)&&m.push(y):q.wave==WAVEFILTER&&m.push(y)}0==m.length&&(a=!1);b=m}for(f in UNITFILTER)-1==r.indexOf(f)&&(a=!1);for(f in ACTIONFILTER)-1==q.actionList.indexOf(f)&&(a=!1);if(0<COSTFILTER){m=[];for(h in b)y=b[h],y.points<=COSTFILTER&&m.push(y);0==m.length&&(a=!1);b=m}if(""!=TEXTFILTER&&1==a){m=[];for(h in b){var y=b[h],r=getpilottexttranslation(y,
l),B=translate(y.name),z=new RegExp(TEXTFILTER,"i");(r.match(z)||B.match(z))&&m.push(y)}0==m.length&&(a=!1);b=m}for(f in MOVEFILTER){m=!1;for(h=0;h<q.dial.length;h++)q.dial[h].move==f&&(m=!0);m||(a=!1)}a&&(a=[],b=Mustache.render(TEMPLATES.faction,{shipimg:q.img[0],fire:repeat("u",q.fire),evade:repeat("u",q.evade),hull:repeat("u",q.hull),shield:repeat("u",q.shield),diallist:dial2JSON(q.dial),shipname:q.trname,primary:q.weapon_type,faction:l,actionlist:function(){var a=[];for(f=0;f<q.actionList.length;f++)a[f]=
A[q.actionList[f]].key;return a},hastitle:q.hastitle,shipupgrades:t[q.name][0].upgrades,pilots:b}),$("#caroussel").append("<li>"+b+"</li>"))}}function addunique(b){var a;UNIQUE[b]=!0;for(a=0;a<PILOTS.length;a++)b==PILOTS[a].name&&$(".pilots button[pilotid="+PILOTS[a].pilotid+"]").prop("disabled",!0);for(a=0;a<UPGRADES.length;a++)b==UPGRADES[a].name&&$(".upglist button[data="+a+"]").prop("disabled",!0)}
function removeunique(b){UNIQUE[b]=!1;for(var a=0;a<PILOTS.length;a++)b==PILOTS[a].name&&$(".pilots button[pilotid="+PILOTS[a].pilotid+"]").prop("disabled",!1);for(a=0;a<UPGRADES.length;a++)b==UPGRADES[a].name&&$(".upglist button[data="+a+"]").prop("disabled",!1)}function addlimited(b,a){$("#unit"+b.id+" .upglist button[data="+a+"]").prop("disabled",!0)}function removelimited(b,a){$("#unit"+b.id+" .upglist button[data="+a+"]").prop("disabled",!1)}
function addupgradeaddhandler(b){$("#unit"+b.id+" button.upgrades").click(function(a){var b=a.currentTarget.getAttribute("class").split(" ")[1];a=a.currentTarget.getAttribute("num");var e=this.getupgradelist(b);$("#unit"+this.id+" .upgs .upgavail").hide();$("#unit"+this.id+" .upgs .upg").hide();"undefined"==typeof this.upgbonus[b]&&(this.upgbonus[b]=0);for(var f=[],h=0;h<e.length;h++){var l=UPGRADES[e[h]],t,x=[];if(!l.invisible){t=1==UNIQUE[l.name]||(1==l.limited||1==this.exclupg[l.type])&&0<$("#unit"+
this.id+" .upg tr[data="+e[h]+"]").length;var q=l.points+this.upgbonus[b];0<=l.points&&0>q&&(q=0);var m=formatstring(getupgtxttranslation(l.name,l.type));1!=l.done&&(m+="<div><strong class='m-notimplemented'></strong></div>");"undefined"!=typeof l.attack&&(x=[{attack:l.attack,lrange:l.range[0],hrange:l.range[1]}]);var r=0,y="",B=l.name+(l.type==Unit.CREW?"(Crew)":"");"undefined"!=typeof RATINGS_upgrades[B]&&"undefined"!=typeof RATINGS_upgrades[B].rating?(r=RATINGS_upgrades[B].rating,y=RATINGS_upgrades[B].text):
console.log("no rating for "+l.name);f.push({pts:q,rating:repeat("\u00ff",r),tooltip:[m+"<hr/><p class='strategy'>"+y+"</p>"],text:m,isdisabled:t,num:a,data:e[h],name:translate(l.name).replace(/\(Crew\)/g,""),attacks:x})}}$("#unit"+this.id+" .upglist").html(Mustache.render(TEMPLATES["upglist-creation"],{upglist:f}));$("#unit"+this.id+" .upglist button").click(function(a){var b=a.currentTarget.getAttribute("data");a=a.currentTarget.getAttribute("num");$("#unit"+this.id+" .upgs .upgavail").show();$("#unit"+
this.id+" .upgs .upg").show();addupgrade(this,b,a)}.bind(this))}.bind(b))}
function addunit(b,a,c){"undefined"==typeof c&&(c=new Unit(currentteam.team,b),c.faction=a);for(var e in metaUnit.prototype)c[e]=metaUnit.prototype[e];for(var f in PILOTS[c.pilotid])b=PILOTS[c.pilotid],"function"==typeof b[f]&&(c[f]=b[f]);"undefined"!=typeof c.init&&c.init();3==currentteam.team?($("#listunits").append("<li id='unit"+c.id+"'></li>"),c.show(),$("li#unit"+c.id).hover(function(){$(".highlighted").removeClass("highlighted");$(this).addClass("highlighted")},function(){}),1==c.unique&&addunique(c.name),
$("#unit"+c.id+" .close").click(function(){var a=$(this).attr("data"),b=generics["u"+a];$("#unit"+a+" .upg tr[data]").each(function(){var a=$(this).attr("data");1==UPGRADES[a].unique&&removeunique(UPGRADES[a].name)});1==PILOTS[b.pilotid].unique&&removeunique(b.name);$("#unit"+a).remove();delete generics["u"+a];currentteam.updatepoints()}),$("#unit"+c.id+" .duplicate").click(function(){var b=$(this).attr("data"),c=generics["u"+b],e=addunit(c.pilotid,a);$("#unit"+b+" .upg tr[data]").each(function(){var a=
$(this).attr("data"),b=$(this).attr("num");1!=UPGRADES[a].unique&&c.upgnocopy!=a&&addupgrade(e,a,b)})}),$("#unit"+c.id+" .dialopen").click(function(){var a=$(this).attr("data");$("#unit"+a+" .upg").hide();$("#unit"+a+" .upglist").hide();$("#unit"+a+" .upgavail").hide();$("#unit"+a+" .statlist").hide();$("#unit"+a+" .shipdial").show();$("#unit"+a+" .movelist").hide()}),$("#unit"+c.id+" .upgradelists").click(function(){var a=$(this).attr("data");$("#unit"+a+" .upg").show();$("#unit"+a+" .upglist").empty();
$("#unit"+a+" .upglist").show();$("#unit"+a+" .upgavail").show();$("#unit"+a+" .statlist").hide();$("#unit"+a+" .shipdial").hide();$("#unit"+a+" .movelist").hide()}),$("#unit"+c.id+" .moves").click(function(){var a=$(this).attr("data"),b=generics["u"+a];$("#unit"+a+" .upg").hide();$("#unit"+a+" .upglist").hide();$("#unit"+a+" .upgavail").hide();$("#unit"+a+" .statlist").hide();$("#unit"+a+" .shipdial").hide();$("#unit"+a+" .movelist").show();var c=Snap("#unit"+a+" .movesvg");$("#unit"+a+" .statbutton");
c.clear();var e=$(".movesvg").width();targetunit=new Unit(0,13);for(var f in metaUnit.prototype)targetunit[f]=metaUnit.prototype[f];b.moves=[MT(e/2,e/2)];b.doactivation();b.s=c;setTimeout(function(){for(f in b.moves)c.path(b.getOutlineString(b.moves[f]).s).attr({"stroke-width":5,stroke:"#0a0",opacity:.5,fill:"rgba(0,0,0,0)",pointerEvents:"none"});c.path(b.getOutlineString(MT(e/2,e/2)).s).attr({"stroke-width":5,stroke:"#a00",opacity:1,fill:"rgba(0,0,0,0)",pointerEvents:"none"})})}),$("#unit"+c.id+
" .statistics").click(function(){var a=$(this).attr("data"),b=generics["u"+a];$("#unit"+a+" .upg").hide();$("#unit"+a+" .upglist").hide();$("#unit"+a+" .upgavail").hide();$("#unit"+a+" .statlist").show();$("#unit"+a+" .shipdial").hide();$("#unit"+a+" .movelist").hide();var c=Snap("#unit"+a+" .statisticsvg");$("#unit"+a+" .statbutton");c.clear();var e=$(".statisticsvg").width();targetunit=new Unit(0,13);for(var f in metaUnit.prototype)targetunit[f]=metaUnit.prototype[f];b.moves=[MT(e/2,e/2)];b.doactivation();
b.s=c;var m=c.text(0,0,"Computing...").attr({"font-size":50,stroke:WHITE});setTimeout(function(){b.showattack(b.weapons,c);m.attr({display:"none"});c.path(b.getOutlineString(MT(e/2,e/2)).s).attr({"stroke-width":5,stroke:"#0a0",opacity:.5,fill:"rgba(0,0,0,0)",pointerEvents:"none"});for(f=1;5>=f;f++)c.path(b.getRangeString(f,MT(e/2,e/2))).attr({"stroke-width":5,stroke:"#0a0",opacity:.5,fill:"rgba(0,0,0,0)",pointerEvents:"none","stroke-dasharray":"5,5"});var a=c.gradient("l(0,0,0,1)hsl(0,80,50)-hsl(60,100,50)-hsl(120,100,25)");
c.rect(-400,-500,30,800).attr({fill:a});c.text(-350,-450,"100%").attr({"font-size":50,stroke:WHITE});c.text(-350,-75,"50%").attr({"font-size":50,stroke:WHITE});c.text(-350,300,"0%").attr({"font-size":50,stroke:WHITE})},30)}),currentteam.updatepoints(),addupgradeaddhandler(c)):currentteam.updatepoints();return c}
function addupgrade(b,a,c,e){var f=UPGRADES[a];$("#unit"+b.id+" .upglist").empty();if("undefined"!=typeof f){1==f.unique&&addunique(f.name);1==f.limited&&addlimited(b,a);$("#unit"+b.id+" .upgavail span[num="+c+"]").hide();var h=translate(f.name).replace(/\(Crew\)/g,"").replace(/\'/g,"");"undefined"==typeof b.upgbonus[f.type]&&(b.upgbonus[f.type]=0);var l=f.points+b.upgbonus[f.type];0<=f.points&&0>l&&(l=0);var t="",x=formatstring(getupgtxttranslation(f.name,f.type));""!=x&&(t=x+(1==f.done?"":"<div><strong class='m-notimplemented'></strong></div>"));
$("#unit"+b.id+" .upg").append("<tr data="+a+" num="+c+"><td><span class='upgrades "+f.type+"'></span></td><td><button>"+h+"</button></td><td class='pts'>"+l+"</td><td class='tooltip'>"+t+"</td></tr>");b.upg[c]=a;f=Upgradefromid(b,a);"undefined"!=typeof UPGRADES[a].install&&f.install(b);Upgrade.prototype.install.call(f,b);"undefined"!=typeof f.init&&f.init(b);$("#unit"+b.id+" .shipdial").html("<table>"+b.getdialstring()+"</table>");b.showupgradeadd();b.showactionlist();b.showstats();currentteam.updatepoints();
"undefined"==typeof e?$("#unit"+b.id+" .upg tr[num="+c+"] button").click(function(a){var c=a.currentTarget.parentElement.parentElement.getAttribute("num");a=a.currentTarget.parentElement.parentElement.getAttribute("data");$("#unit"+b.id+" .upglist").empty();removeupgrade(b,c,a)}.bind(b)):b.upgnocopy=a}}
function removeupgrade(b,a,c){for(var e in b.upgrades)if(b.upgrades[e].id==c)break;e=b.upgrades[e];if("undefined"!=typeof b["addedupg"+c]){var f=b["addedupg"+c];-1<b.upg[f]&&removeupgrade(b,f,b.upg[f])}$("#unit"+b.id+" .upgavail span[num="+a+"]").show();$("#unit"+b.id+" .upg tr[num="+a+"]").remove();1==e.unique&&removeunique(e.name);1==e.limited&&removelimited(b,c);b.upg[a]=-1;"undefined"!=typeof e.uninstall&&e.uninstall(b);Upgrade.prototype.uninstall.call(e,b);e.isactive=!1;$("#unit"+b.id+" .shipdial").html("<table>"+
b.getdialstring()+"</table>");b.showupgradeadd();b.showactionlist();b.showstats();currentteam.updatepoints()};var FREECOMBAT=0,SCENARIO=1,SCENARIOCREATOR=2,mode=FREECOMBAT;
function prepareforcombat(b,a){""!==b&&"undefined"!==typeof b&&(TEAMS[a].parseJuggler(b,!0),$("#squad"+a).html(TEAMS[a].toJuggler(!0)),TEAMS[a].name="SQUAD."+TEAMS[a].toASCII(),TEAMS[a].toJSON(),"undefined"==typeof localStorage[TEAMS[a].name]&&(localStorage[TEAMS[a].name]=JSON.stringify({pts:TEAMS[a].points,faction:TEAMS[a].faction,jug:b})),SQUADLIST.isinrow(b)||SQUADLIST.addrow(0,TEAMS[a].name,TEAMS[a].points,TEAMS[a].faction,TEAMS[a].toJuggler(!0),!0),$("#squad"+a+"points").html(TEAMS[a].points));
enablenextphase()}function scenariomode(b){mode=b;switch(b){case SCENARIO:$(".duelmode").hide();$(".scenariocreator").hide();$(".scenariomode").show();break;case FREECOMBAT:$(".scenariocreator").hide();$(".scenariomode").hide();$(".duelmode").show();break;case SCENARIOCREATOR:$(".duelmode").hide(),$(".scenariomode").hide(),$(".scenariocreator").show()}enablenextphase()}
function Scenariolist(b){this.id=b;TEMPLATES["scenario-row-manage"]=$("#scenario-row-manage").html();Mustache.parse(TEMPLATES["scenario-row-manage"]);TEMPLATES["scenario-header-manage"]=$("#scenario-header-manage").html();Mustache.parse(TEMPLATES["scenario-header-manage"]);$(b).html(Mustache.render(TEMPLATES["scenario-header-manage"],{}));$(b+" tbody").on("click","tr",function(){$(b+" .selected").removeClass("selected");$(this).addClass("selected")});this.rows=[];this.nrows=0;this.log={};for(var a in SCENARIOS){var c=
SCENARIOS[a];this.addrow(a,c.text,c.wincond,c.link)}}
Scenariolist.prototype={remove:function(b){$("#sc"+b).remove();delete localStorage["SCENARIO"+this.rows[b].title];delete this.rows[b]},isinrow:function(b){return"undefined"!=typeof this.rows&&-1<this.rows.indexOf(b)},addrow:function(b,a,c,e){this.rows[this.nrows]={title:b,text:a,link:e,wincond:c};var f=LZString.decompressFromEncodedURIComponent(e).split("&");TEAMS[3].parseASCII(f[1]);f="Death match";0<c&&(f="Destroy all units before "+c+" turns");0>c&&(f="Highest score after "+c+" turns");$(this.id+
" tbody").append(Mustache.render(TEMPLATES["scenario-row-manage"],{nrows:this.nrows,title:b,text:a,faction:TEAMS[3].faction,wincond:f,link:e}));this.nrows++;"undefined"==typeof localStorage["SCENARIO"+b]&&(localStorage["SCENARIO"+b]=JSON.stringify({title:b,text:a,link:e,wincond:c}))},user:function(){var b;$(this.id+" tbody").html("");for(b in localStorage)if("string"==typeof localStorage[b]&&b.match(/SCENARIO.*/)){var a=$.parseJSON(localStorage[b]);"undefined"==typeof a.title||"undefined"==typeof a.text||
"undefined"==typeof a.link?delete localStorage[b]:("undefined"==typeof a.wincond&&(a.wincond=0),this.addrow(a.title,a.text,a.wincond,a.link))}},checkrow:function(b){HEADERS=this.rows[b].text;SCENARIOTITLE=this.rows[b].title;WINCOND=this.rows[b].wincond;b=LZString.decompressFromEncodedURIComponent(this.rows[b].link);var a=b.split("&");prepareforcombat($("#squad1").html(),1);a[0]=TEAMS[1].toASCII();b=a.join("&");TEAMS[1].parseASCII(a[0]);document.location.search="?"+LZString.compressToEncodedURIComponent(b)}};
